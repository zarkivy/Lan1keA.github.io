<!DOCTYPE html>
<html lang="" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='å€ŸåŠ©äºlibFuzzerè¿›è¡ŒFuzzing'><title>CVE-2014-0160 å¿ƒè„æ»´è¡€æ¼æ´æŒ–æ˜ä¸åˆ†æ</title>

<link rel='canonical' href='https://cerr.cc/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/'>

<link rel="stylesheet" href="/scss/style.min.e75bab105855f77caa94de85bd0b7a889920eb03fa3048257f51f59c063a674d.css"><meta property='og:title' content='CVE-2014-0160 å¿ƒè„æ»´è¡€æ¼æ´æŒ–æ˜ä¸åˆ†æ'>
<meta property='og:description' content='å€ŸåŠ©äºlibFuzzerè¿›è¡ŒFuzzing'>
<meta property='og:url' content='https://cerr.cc/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/'>
<meta property='og:site_name' content='Zikey Vi'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Coreutils' /><meta property='article:tag' content='Fuzzing' /><meta property='article:published_time' content='2022-05-20T17:57:07&#43;08:00'/><meta property='article:modified_time' content='2022-05-20T17:57:07&#43;08:00'/><meta property='og:image' content='https://s2.loli.net/2022/05/20/atE5hjX1gbFPnUN.jpg' />
<meta name="twitter:title" content="CVE-2014-0160 å¿ƒè„æ»´è¡€æ¼æ´æŒ–æ˜ä¸åˆ†æ">
<meta name="twitter:description" content="å€ŸåŠ©äºlibFuzzerè¿›è¡ŒFuzzing"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://s2.loli.net/2022/05/20/atE5hjX1gbFPnUN.jpg' />
    <link rel="shortcut icon" href="favicon.png" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu83ce41192ed66b608a10477eb7108e0c_128714_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸŸ</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Zikey Vi</a></h1>
            <h2 class="site-description">Yet anothor cyber nyandog.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/dev2ero'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:dev2ero@foxmail.com'
                        target="_blank"
                        title="Mail"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail-opened" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <polyline points="3 9 12 15 21 9 12 3 3 9" />
  <path d="M21 9v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10" />
  <line x1="3" y1="19" x2="9" y2="13" />
  <line x1="15" y1="13" x2="21" y2="19" />
</svg>

                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/dev2ero'
                        target="_blank"
                        title="Twitter"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archive</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/love/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-heart" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M19.5 13.572l-7.5 7.428l-7.5 -7.428m0 0a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" />
</svg>

                
                <span>Love</span>
            </a>
        </li>
        
        

        <li >
            <a href='/friends/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-friends" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <circle cx="7" cy="5" r="2" />
  <path d="M5 22v-5l-1 -1v-4a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4l-1 1v5" />
  <circle cx="17" cy="5" r="2" />
  <path d="M15 22v-4h-2l2 -6a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1l2 6h-2v4" />
</svg>

                
                <span>Friends</span>
            </a>
        </li>
        
        

        <li >
            <a href='/utils/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Utils</span>
            </a>
        </li>
        
        

        <li >
            <a href='/board/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="8" y="8" width="12" height="12" rx="2" />
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2" />
</svg>

                
                <span>Board</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/">
                
                    <img src="https://s2.loli.net/2022/05/20/atE5hjX1gbFPnUN.jpg" loading="lazy" alt="Featured image of post CVE-2014-0160 å¿ƒè„æ»´è¡€æ¼æ´æŒ–æ˜ä¸åˆ†æ" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" >
                æ¼æ´åˆ†æ
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/">CVE-2014-0160 å¿ƒè„æ»´è¡€æ¼æ´æŒ–æ˜ä¸åˆ†æ</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            å€ŸåŠ©äºlibFuzzerè¿›è¡ŒFuzzing
        </h3>
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 20, 2022</time>
            </div>
        

        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <blockquote>
<p>æ¼æ´ç¼–å·ï¼šCVE-2014-0160</p>
<p>æ¼æ´ç±»å‹ï¼šå†…å­˜è¶Šç•Œè®¿é—®</p>
<p>æ¼æ´å±å®³ï¼šä¿¡æ¯æ³„éœ²</p>
<p>å½±å“èŒƒå›´ï¼šOpenSSL1.0.1ã€OpenSSL 1.0.1a~ OpenSSL 1.0.1fã€OpenSSL 1.0.2-beta</p>
<p>æ¼æ´æè¿°ï¼šOpenSSL åœ¨å®ç° TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å’Œ DTLSï¼ˆæ•°æ®æŠ¥å®‰å…¨ä¼ è¾“åè®®ï¼‰çš„å¿ƒè·³åŒ…å¤„ç†é€»è¾‘æ—¶å­˜åœ¨é—®é¢˜ã€‚OpenSSL çš„ Heartbleed æ¨¡å—åœ¨å¤„ç†å¿ƒè·³åŒ…æ—¶æ²¡æœ‰æ£€æŸ¥å¿ƒè·³åŒ…ä¸­çš„é•¿åº¦å­—æ®µæ˜¯å¦ä¸åç»­çš„æ•°æ®å­—æ®µä¸€è‡´ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´æ„é€ å¼‚å¸¸æ•°æ®åŒ…ï¼Œå¯è·å–æœåŠ¡å™¨å†…å­˜ä¸­å¤šè¾¾ 64KB çš„æ•°æ®ã€‚è¿™äº›æ•°æ®å¯èƒ½ä¼šåŒ…å«è¯ä¹¦ç§é’¥ã€ç”¨æˆ·è´¦å·ã€å¯†ç ã€é‚®ä»¶å†…å®¹ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p>
</blockquote>
<h1 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</h1>
<h1 id="ç®€ä»‹">ç®€ä»‹</h1>
<p><a class="link" href="https://en.wikipedia.org/wiki/Transport_Layer_Security"  target="_blank" rel="noopener"
    >ä¼ è¾“å±‚å®‰å…¨æ€§åè®®SSL</a></p>
<p><strong>SSL</strong> å…¨ç§° Secure Sockets Layerï¼ˆå®‰å…¨å¥—æ¥å­—å±‚åè®®ï¼‰ï¼Œè¦æ±‚å»ºç«‹åœ¨å¯é çš„ä¼ è¾“å±‚åè®®ï¼ˆ<strong>TCP</strong>ï¼‰ä¹‹ä¸Šï¼Œä¸»è¦æä¾›æœºå¯†æ€§ã€è®¤è¯æ€§åŠæ•°æ®å®Œæ•´æ€§æœåŠ¡ã€‚SSL æœ€åˆï¼ˆSSL 1.0ã€SSL2.0ã€SSL 3.0 ç‰ˆæœ¬ï¼‰ç”±ç½‘æ™¯å…¬å¸è®¾è®¡å’Œç»´æŠ¤ï¼Œä» 3.1 ç‰ˆæœ¬å¼€å§‹ï¼ŒSSL åè®®ç”±å› ç‰¹ç½‘å·¥ç¨‹ä»»åŠ¡å°ç»„ï¼ˆIETFï¼‰æ­£å¼æ¥ç®¡ï¼Œå¹¶æ›´åä¸º <strong>TLS</strong>ï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼ŒTransport Layer Securityï¼‰ï¼Œå‘å±•è‡³ä»Šå·²æœ‰ TLS 1.0ã€TLS1.1ã€TLS1.2 ä¸‰ä¸ªç‰ˆæœ¬ã€‚</p>
<p>SSL/TLS åè®®èƒ½å¤Ÿæä¾›çš„å®‰å…¨æœåŠ¡ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>è®¤è¯æ€§â€”â€”ä½¿ç”¨æ•°å­—è¯ä¹¦è®¤è¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯èº«ä»½ï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ï¼›</li>
<li>æœºå¯†æ€§â€”â€”ä½¿ç”¨åŠ å¯†ç®—æ³•é˜²æ­¢ç¬¬ä¸‰æ–¹çªƒå¬ï¼›</li>
<li>å®Œæ•´æ€§â€”â€”ä½¿ç”¨æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ä¿éšœæ•°æ®å®Œæ•´æ€§ï¼Œé˜²æ­¢æ¶ˆæ¯è¢«ç¯¡æ”¹ï¼›</li>
<li>é‡æ”¾ä¿æŠ¤â€”â€”é€šè¿‡ä½¿ç”¨éšå¼åºåˆ—å·é˜²æ­¢é‡æ”¾æ”»å‡»ï¼›</li>
</ul>
<h2 id="sslæ¡æ‰‹è¿‡ç¨‹">SSLæ¡æ‰‹è¿‡ç¨‹</h2>
<p>å®¢æˆ·ç«¯è·å–æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦åï¼Œåå•†åç»­æ•°æ®ä¼ è¾“æ‰€ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†å¯†é’¥ã€‚</p>
<p><img src="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/1.png"
	width="499"
	height="563"
	srcset="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/1_huababda8551a2150b04ea0eb0561ab941_1126238_480x0_resize_box_3.png 480w, /post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/1_huababda8551a2150b04ea0eb0561ab941_1126238_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="88"
		data-flex-basis="212px"
	
></p>
<h2 id="ssl-heartbeat">SSL Heartbeat</h2>
<blockquote>
<p>Heartbleed was introduced by the Heartbeat Extension in the OpenSSL version 1.0.11 . This extension enables a low-cost, keepalive mechanism for peers to know that theyâ€™re still connected and all is well at the TLS layer. Standard implementations of TLS do not require the extension as they can rely on TCP for equivalent session management. Version 1.0.1 of OpenSSL added support for the Heartbeat functionality and enabled it by default.</p>
</blockquote>
<p>æ–‡æ¡£ï¼š<a class="link" href="https://datatracker.ietf.org/doc/html/rfc6520"  target="_blank" rel="noopener"
    >Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS) Heartbeat Extension</a></p>
<p>SSL åè®®å®Œæˆæ¡æ‰‹è¿‡ç¨‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´ä¾¿å»ºç«‹å®‰å…¨å¯é çš„é€šä¿¡ã€‚SSL å®‰å…¨åè®®å·¥ä½œåœ¨ä¼ è¾“å±‚çš„ TCP åè®®ä¹‹ä¸Šï¼Œæ‰€ä»¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éœ€è¦ä¿æŒæŒç»­è¿æ¥çš„çŠ¶æ€ã€‚ç”±äºæœåŠ¡å™¨çš„èµ„æºæœ‰é™ï¼Œå½“è¿æ¥çš„å®¢æˆ·ç«¯æ•°é‡è¾ƒå¤§æ—¶ï¼ŒæœåŠ¡å™¨è¦ç»´æŒè¿™äº›è¿æ¥å°†ä¼šæ¶ˆè€—å¾ˆå¤šèµ„æºï¼Œå› æ­¤éœ€è¦åŠæ—¶æ–­å¼€å®Œæˆé€šä¿¡çš„å®¢æˆ·ç«¯ä»¥å‡å°‘æœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ã€‚æœåŠ¡å™¨é€šè¿‡ SSL çš„å¿ƒè·³æœºåˆ¶å¯åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦å·²å®Œæˆé€šä¿¡ã€‚</p>
<p>SSL åè®®ä¸­çš„å¿ƒè·³æœºåˆ¶å·¥ä½œäº SSL è®°å½•åè®®ä¹‹ä¸Šï¼Œå¿ƒè·³æœºåˆ¶ä¸­åŒ…å«ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼šå¿ƒè·³è¯·æ±‚æ¶ˆæ¯ï¼ˆHeartbeatRequest Messageï¼‰å’Œå¿ƒè·³å“åº”æ¶ˆæ¯ï¼ˆHeartbeatResponse Messageï¼‰ï¼Œè¿™ä¸¤ç§æ¶ˆæ¯å…·æœ‰ç›¸åŒçš„åŒ…ç»“æ„ã€‚å½“æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å®Œæˆ SSL åè®®çš„æ¡æ‰‹é˜¶æ®µåï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸€æ®µæ—¶é—´æ²¡æœ‰ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå®¢æˆ·ç«¯éœ€è¦å‘¨æœŸæ€§åœ°å‘æœåŠ¡å™¨å‘é€å¿ƒè·³è¯·æ±‚æ¶ˆæ¯ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å¿ƒè·³è¯·æ±‚æ¶ˆæ¯ï¼Œåˆ™è®¤ä¸ºå®¢æˆ·ç«¯è¿˜æ²¡æœ‰å®Œæˆé€šä¿¡ï¼Œç»§ç»­ç»´æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¿æ¥ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€å¿ƒè·³å“åº”æ¶ˆæ¯ã€‚</p>
<p>é€šä¿¡åŒæ–¹åœ¨å»ºç«‹ SSL è¿æ¥æ—¶å¯åå•†æ˜¯å¦æ”¯æŒå¿ƒè·³æœºåˆ¶ã€‚åœ¨ SSL ç¬¬ä¸€æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­é€šè¿‡ Client Hello æ¶ˆæ¯å’Œ Server Hello æ¶ˆæ¯çš„ Heartbeat Hello æ‰©å±•å‘ŠçŸ¥å¯¹æ–¹æ˜¯å¦æ”¯æŒå¿ƒè·³æœºåˆ¶ã€‚Heartbeat Hello æ‰©å±•çš„æ ¼å¼å¦‚ä¸‹ã€‚å½“æ”¯æŒå¿ƒè·³æœºåˆ¶æ—¶è®¾ç½® HeartbeatMode ä¸º peer_allowed_to_sendï¼Œå¯æ¥æ”¶å¿ƒè·³è¯·æ±‚æ¶ˆæ¯å¹¶èƒ½è¿”å›å“åº”åŒ…ï¼›å½“ä¸æ”¯æŒå¿ƒè·³æœºåˆ¶æ—¶è®¾ç½® HeartbeatMode ä¸º peer_not_allowed_to_sendï¼Œè‹¥å¯¹ç«¯å‘é€å¿ƒè·³è¯·æ±‚æ¶ˆæ¯ï¼Œå°†ä¼šä¸¢å¼ƒè¯¥æ¶ˆæ¯å¹¶è¿”å› unexpected_message è­¦å‘Šæ¶ˆæ¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">enum</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">peer_allowed_to_send</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">peer_not_allowed_to_send</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">HeartbeatMode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">HeartbeatMode</span> <span class="n">mode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">HeartbeatExtension</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¿ƒè·³åŒ…çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‰åŠéƒ¨åˆ†ä¸º SSL è®°å½•å¤´ï¼ŒContent Type ä¸ºæ¶ˆæ¯ç±»å‹ï¼ˆ0x18 è¡¨ç¤ºå¿ƒè·³åŒ…æ¶ˆæ¯ï¼‰ï¼ŒTLS Version ä¸º SSL ç‰ˆæœ¬ä¿¡æ¯ï¼ŒRecord length ä¸ºè®°å½•é•¿åº¦ï¼›ååŠéƒ¨åˆ†å³ä¸ºå¿ƒè·³æ¶ˆæ¯ã€‚</p>
<p><img src="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/2.png"
	width="765"
	height="187"
	srcset="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/2_hu1526675b6e4ccd34471df08b7157cac7_25420_480x0_resize_box_3.png 480w, /post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/2_hu1526675b6e4ccd34471df08b7157cac7_25420_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="409"
		data-flex-basis="981px"
	
></p>
<p>å…¶ä¸­ï¼ŒSSL è®°å½•é•¿åº¦ï¼ˆRecord lengthï¼‰ä¸ºå¿ƒè·³æ¶ˆæ¯çš„æ€»é•¿åº¦ã€‚å¿ƒè·³åŒ…æ¶ˆæ¯ç”±æ•°æ®åŒ…ç±»å‹ï¼ˆtypeï¼‰ã€è½½è·é•¿åº¦ï¼ˆpayload lengthï¼‰ã€è½½è·å†…å®¹ï¼ˆpayloadï¼‰å’Œå¡«å……å­—èŠ‚ï¼ˆpaddingï¼‰ç»„æˆã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">HeartbeatMessageType</span> <span class="n">type</span><span class="p">;</span>    <span class="c1">// 1 bytesï¼ŒåŒ…æ‹¬requestå’Œresponseä¸¤ç§ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">uint16</span> <span class="n">payload_length</span><span class="p">;</span>    <span class="c1">// 2 bytesï¼Œè½½è·é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">opaque</span> <span class="n">payload</span><span class="p">[</span><span class="n">HeartbeatMessage</span><span class="p">.</span><span class="n">payload_length</span><span class="p">];</span>    <span class="c1">// payload_length bytesï¼Œè½½è·å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">opaque</span> <span class="n">padding</span><span class="p">[</span><span class="n">padding_length</span><span class="p">];</span>    <span class="c1">// å¡«å……å­—èŠ‚ï¼Œè‡³å°‘ä¸º16 bytes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">HeartbeatMessage</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹å›¾ä¸ºå¿ƒè·³è¯·æ±‚åŒ…çš„æ•°æ®åŒ…å®ä¾‹ï¼Œå…¶è½½è·é•¿åº¦ä¸º 5 bytesï¼š</p>
<p><img src="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/3.png"
	width="770"
	height="482"
	srcset="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/3_hu568688140641e115f76d508bf029e7b2_40703_480x0_resize_box_3.png 480w, /post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/3_hu568688140641e115f76d508bf029e7b2_40703_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="159"
		data-flex-basis="383px"
	
></p>
<h2 id="openssl">OpenSSL</h2>
<p><a class="link" href="https://www.openssl.org/"  target="_blank" rel="noopener"
    >https://www.openssl.org/</a></p>
<p>æŸ¥é˜…æ–‡æ¡£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">man <span class="m">7</span> crypto
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>The OpenSSL crypto library (<code>libcrypto</code>) implements a wide range of cryptographic algorithms used in various Internet standards. The services provided by this library are used by the OpenSSL implementations of TLS and CMS, and they have also been used to implement many other third party products and protocols.</p>
<p>The functionality includes symmetric encryption, public key cryptography, key agreement, certificate handling, cryptographic hash functions, cryptographic pseudo-random number generators, message authentication codes (MACs), key derivation functions (KDFs), and various utilities.</p>
</blockquote>
<h1 id="æ¼æ´åˆ†æ">æ¼æ´åˆ†æ</h1>
<h2 id="æºç è·å–">æºç è·å–</h2>
<p>è·å–å«æ¼æ´çš„æºç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">git clone git://git.openssl.org/openssl.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> openssl
</span></span><span class="line"><span class="cl">git checkout OpenSSL_1_0_1f
</span></span></code></pre></td></tr></table>
</div>
</div><p>OpenSSL æ˜¯ SSL åè®®å®ç°çš„å¼€æºè½¯ä»¶åŒ…ï¼Œå­˜åœ¨æ¼æ´çš„ä¸¤ä¸ªæ–‡ä»¶ä¸º ssl/d1_both.c å’Œ ssl/t1_lib.cï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„ dtls1_process_heartbeat å‡½æ•°å’Œ tls1_process_heartbeat å‡½æ•°åˆ†åˆ«ä¸º DTLSï¼ˆæ•°æ®æŠ¥å®‰å…¨ä¼ è¾“åè®®ï¼‰å’Œ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å¤„ç†å¿ƒè·³è¯·æ±‚åŒ…çš„å‡½æ•°ã€‚ä¸¤å‡½æ•°çš„å®ç°å®Œå…¨ç›¸åŒï¼Œæ­¤å¤„é€‰å– dtls1_process_heartbeat è¿›è¡Œåˆ†æã€‚</p>
<h2 id="æˆå› é¢„ä¹ ">æˆå› é¢„ä¹ </h2>
<p><img src="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/4.jpg"
	width="808"
	height="1722"
	srcset="/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/4_hu1354b5c6a958b4785706b4507bf6d245_207842_480x0_resize_q75_box.jpg 480w, /post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/4_hu1354b5c6a958b4785706b4507bf6d245_207842_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="46"
		data-flex-basis="112px"
	
></p>
<h2 id="ä»£ç åˆ†æ">ä»£ç åˆ†æ</h2>
<p>é¢„ä¹ å®Œåé¦–å…ˆæ¥çœ‹çœ‹å‡ºç°æ¼æ´çš„å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#ifndef OPENSSL_NO_HEARTBEATS
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="nf">dtls1_process_heartbeat</span><span class="p">(</span><span class="n">SSL</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">s3</span><span class="o">-&gt;</span><span class="n">rrec</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">pl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å‘ç°ï¼Œä¸ºäº†å®Œæ•´å¼„æ¸…æ¥šè¯¥å‡½æ•°ä¸­çš„é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜éœ€äº†è§£å‚æ•°SSLçš„å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* crypto/ossl_tpy.h */</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ssl_st</span> <span class="n">SSL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* ssl/ssl.h */</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">ssl_st</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">ssl2_state_st</span> <span class="o">*</span><span class="n">s2</span><span class="p">;</span>  <span class="cm">/* SSLv2 variables */</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">ssl3_state_st</span> <span class="o">*</span><span class="n">s3</span><span class="p">;</span>  <span class="cm">/* SSLv3 variables */</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">dtls1_state_st</span> <span class="o">*</span><span class="n">d1</span><span class="p">;</span> <span class="cm">/* DTLSv1 variables */</span>
</span></span><span class="line"><span class="cl">	<span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* ssl/ssl3.h */</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ssl3_state_st</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">...</span>
</span></span><span class="line"><span class="cl">	<span class="n">SSL3_RECORD</span> <span class="n">rrec</span><span class="p">;</span>	<span class="cm">/* each decoded record goes in here */</span>
</span></span><span class="line"><span class="cl">	<span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* ssl/ssl3.h */</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ssl3_record_st</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*r */</span>	<span class="kt">int</span> <span class="n">type</span><span class="p">;</span>                  <span class="cm">/* type of record */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*rw*/</span>	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">;</span>       <span class="cm">/* How many bytes available */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*r */</span>	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">off</span><span class="p">;</span>          <span class="cm">/* read/write offset into &#39;buf&#39; */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*rw*/</span>	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>       <span class="cm">/* pointer to the record data */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*rw*/</span>	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">input</span><span class="p">;</span>      <span class="cm">/* where the decode bytes are */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*r */</span>	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">comp</span><span class="p">;</span>       <span class="cm">/* only used with decompression - malloc()ed */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*r */</span>  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epoch</span><span class="p">;</span>       <span class="cm">/* epoch number, needed by DTLS1 */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*r */</span>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">seq_num</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>  <span class="cm">/* sequence number, needed by DTLS1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">SSL3_RECORD</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±æ­¤å¯çŸ¥ï¼Œå‡½æ•°ç¬¬ä¸€è¡Œçš„æŒ‡é’ˆpï¼ŒæŒ‡å‘ SSL3 è®°å½•æ•°æ®ï¼Œå³å¿ƒè·³æ¶ˆæ¯ã€‚å‡½æ•°ä½“å³å¤„ç†è¯¥å¿ƒè·³æ¶ˆæ¯ã€‚</p>
<p>æ¥ä¸‹æ¥è¿˜åŸå‡½æ•°é€»è¾‘ä¸æ¼æ´åŸå› ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#ifndef OPENSSL_NO_HEARTBEATS
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="nf">dtls1_process_heartbeat</span><span class="p">(</span><span class="n">SSL</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">s3</span><span class="o">-&gt;</span><span class="n">rrec</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">pl</span><span class="p">;</span> <span class="c1">// pæŒ‡å‘SSL3è¯·æ±‚åŒ…ä¸­çš„å¿ƒè·³æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hbtype</span><span class="p">;</span> <span class="c1">// å¿ƒè·³åŒ…ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">payload</span><span class="p">;</span> <span class="c1">// å¿ƒè·³è¯·æ±‚åŒ…payloadé•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">padding</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="cm">/* Use minimum padding */</span> <span class="c1">// å¿ƒè·³è¯·æ±‚åŒ…paddingé•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Read type and payload length first */</span>
</span></span><span class="line"><span class="cl">    <span class="n">hbtype</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span> <span class="c1">// å¿ƒè·³åŒ…ç±»å‹ = 1ï¼Œä¸ºå¿ƒè·³è¯·æ±‚åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">n2s</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span> <span class="c1">// ä½¿ç”¨n2så®ä»è¯·æ±‚åŒ…ä¸­å–ä¸¤ä¸ªå­—èŠ‚çš„è½½è·é•¿åº¦èµ‹ç»™å˜é‡payloadï¼Œå¹¶å°†pæŒ‡é’ˆåç§»2ä¸ªå­—èŠ‚ï¼Œæ­¤åæŒ‡é’ˆpæŒ‡å‘å¿ƒè·³åŒ…è½½è·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pl</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// plæŒ‡å‘å¿ƒè·³åŒ…è½½è·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">msg_callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span><span class="o">-&gt;</span><span class="n">msg_callback</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">,</span> <span class="n">TLS1_RT_HEARTBEAT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">s3</span><span class="o">-&gt;</span><span class="n">rrec</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">s3</span><span class="o">-&gt;</span><span class="n">rrec</span><span class="p">.</span><span class="n">length</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">msg_callback_arg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">hbtype</span> <span class="o">==</span> <span class="n">TLS1_HB_REQUEST</span><span class="p">)</span> <span class="c1">// è‹¥å¿ƒè·³åŒ…ç±»å‹ä¸º TLS1_HB_REQUESTï¼Œæ˜¯ä¸€ä¸ªè¯·æ±‚åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="o">*</span><span class="n">bp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cm">/* Allocate memory for the response, size is 1 byte
</span></span></span><span class="line"><span class="cl"><span class="cm">         * message type, plus 2 bytes payload length, plus
</span></span></span><span class="line"><span class="cl"><span class="cm">         * payload, plus padding
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">buffer</span> <span class="o">=</span> <span class="n">OPENSSL_malloc</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">payload</span> <span class="o">+</span> <span class="n">padding</span><span class="p">);</span> <span class="c1">// ä¾æ®è¯·æ±‚åŒ…ä¸­è®°å½•çš„payloadä¸paddingé•¿åº¦ï¼Œä¸ºå¿ƒè·³å“åº”åŒ…åˆ†é…å†…å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">bp</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cm">/* Enter response type, length and copy payload */</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">bp</span><span class="o">++</span> <span class="o">=</span> <span class="n">TLS1_HB_RESPONSE</span><span class="p">;</span> <span class="c1">// å¡«å…… 1 byte çš„å¿ƒè·³åŒ…ç±»å‹ = 0x02ï¼Œä¸ºå¿ƒè·³å“åº”åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">s2n</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">bp</span><span class="p">);</span> <span class="c1">// å¡«å…… 2 bytes çš„è½½è·é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">memcpy</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">pl</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span> <span class="cm">/* å¡«å……å¿ƒè·³å“åº”åŒ…è½½è·ï¼ˆç”±ç”¨æˆ·æä¾›ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="cm">        						  * ç”±äºå¿ƒè·³åŒ…è½½è·é•¿åº¦ï¼ˆpayloadï¼‰å®Œå…¨ç”±æ¥è‡ªè¯·æ±‚åŒ…ï¼Œç”±ç”¨æˆ·æ§åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="cm">        						  * æ•…æ­¤å¤„è‹¥payloadå˜é‡å€¼å¤§äºå®é™…payloadå¤§å°
</span></span></span><span class="line"><span class="cl"><span class="cm">        						  * å°±ä¼šå¯¼è‡´é¢å¤–çš„æ•°æ®è¢«æ‹·è´è‡³å“åº”åŒ…
</span></span></span><span class="line"><span class="cl"><span class="cm">        						  * è¿›è€Œé€ æˆä¿¡æ¯æ³„éœ² */</span>
</span></span><span class="line"><span class="cl">        <span class="n">bp</span> <span class="o">+=</span> <span class="n">payload</span><span class="p">;</span> <span class="c1">// æŒ‡é’ˆåç§»payloadå­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="cm">/* Random padding */</span>
</span></span><span class="line"><span class="cl">        <span class="n">RAND_pseudo_bytes</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">padding</span><span class="p">);</span> <span class="c1">// å¡«å……éšæœºå­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">dtls1_write_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">TLS1_RT_HEARTBEAT</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">payload</span> <span class="o">+</span> <span class="n">padding</span><span class="p">);</span> <span class="c1">// å°†æ„é€ å¥½çš„å¿ƒè·³å“åº”åŒ…å†™å…¥ SSL3_RECORD ä¸­ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">msg_callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="o">-&gt;</span><span class="n">msg_callback</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">,</span> <span class="n">TLS1_RT_HEARTBEAT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">buffer</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">payload</span> <span class="o">+</span> <span class="n">padding</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">msg_callback_arg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">OPENSSL_free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>                                                                       
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">r</span><span class="p">;</span>                                                                     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hbtype</span> <span class="o">==</span> <span class="n">TLS1_HB_RESPONSE</span><span class="p">)</span>                                                     <span class="p">{</span>                                                                                     
</span></span><span class="line"><span class="cl">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">seq</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="cm">/* We only send sequence numbers (2 bytes unsigned int),
</span></span></span><span class="line"><span class="cl"><span class="cm">         * and 16 random bytes, so we just try to read the
</span></span></span><span class="line"><span class="cl"><span class="cm">         * sequence number */</span>
</span></span><span class="line"><span class="cl">        <span class="n">n2s</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">seq</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">payload</span> <span class="o">==</span> <span class="mi">18</span> <span class="o">&amp;&amp;</span> <span class="n">seq</span> <span class="o">==</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">tlsext_hb_seq</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">dtls1_stop_timer</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="o">-&gt;</span><span class="n">tlsext_hb_seq</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="o">-&gt;</span><span class="n">tlsext_hb_pending</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ¼æ´ä¿®å¤">æ¼æ´ä¿®å¤</h2>
<p>git æŸ¥çœ‹æ¼æ´ä¿®å¤å‰åç‰ˆæœ¬å·®å¼‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">git diff OpenSSL_1_0_1f OpenSSL_1_0_1g
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä½åˆ°<code>dtls1_process_heartbeat</code>å‡½æ•°ï¼Œå¾—åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">-Version: 1.0.1f
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+Version: 1.0.1g
</span></span></span><span class="line"><span class="cl"><span class="gi"></span> Source0: ftp://ftp.openssl.org/source/%{name}-%{version}.tar.gz
</span></span><span class="line"><span class="cl"> License: OpenSSL
</span></span><span class="line"><span class="cl"> Group: System Environment/Libraries
</span></span><span class="line"><span class="cl"><span class="gh">diff --git a/ssl/d1_both.c b/ssl/d1_both.c
</span></span></span><span class="line"><span class="cl"><span class="gh">index 7a5596a6b3..2e8cf681ed 100644
</span></span></span><span class="line"><span class="cl"><span class="gh"></span><span class="gd">--- a/ssl/d1_both.c
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+++ b/ssl/d1_both.c
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">@@ -1459,26 +1459,36 @@ dtls1_process_heartbeat(SSL *s)
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>        unsigned int payload;
</span></span><span class="line"><span class="cl">        unsigned int padding = 16; /* Use minimum padding */
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="gd">-       /* Read type and payload length first */
</span></span></span><span class="line"><span class="cl"><span class="gd">-       hbtype = *p++;
</span></span></span><span class="line"><span class="cl"><span class="gd">-       n2s(p, payload);
</span></span></span><span class="line"><span class="cl"><span class="gd">-       pl = p;
</span></span></span><span class="line"><span class="cl"><span class="gd">-
</span></span></span><span class="line"><span class="cl"><span class="gd"></span>        if (s-&gt;msg_callback)
</span></span><span class="line"><span class="cl">                s-&gt;msg_callback(0, s-&gt;version, TLS1_RT_HEARTBEAT,
</span></span><span class="line"><span class="cl">                        &amp;s-&gt;s3-&gt;rrec.data[0], s-&gt;s3-&gt;rrec.length,
</span></span><span class="line"><span class="cl">                        s, s-&gt;msg_callback_arg);
</span></span><span class="line"><span class="cl">        # æ·»åŠ çš„æ£€æŸ¥1ï¼šå½“å®é™…å¿ƒè·³è½½è·ï¼ˆpayloadï¼‰é•¿åº¦ä¸º0æ—¶ï¼Œå‡½æ•°è¿”å›0
</span></span><span class="line"><span class="cl"><span class="gi">+       /* Read type and payload length first */
</span></span></span><span class="line"><span class="cl"><span class="gi">+       if (1 + 2 + 16 &gt; s-&gt;s3-&gt;rrec.length)
</span></span></span><span class="line"><span class="cl"><span class="gi">+               return 0; /* silently discard */
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl"><span class="gi">+       hbtype = *p++;
</span></span></span><span class="line"><span class="cl"><span class="gi">+       n2s(p, payload);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>        # æ·»åŠ çš„æ£€æŸ¥2ï¼šå½“è®¡ç®—å¾—å¿ƒè·³æ¶ˆæ¯é•¿åº¦å¤§äºSSL3æ•°æ®åŒ…é•¿åº¦æ—¶ï¼ˆä¸¤è€…åº”è¯¥ç­‰åŒï¼‰ï¼Œå³å¿ƒè·³åŒ…è½½è·é•¿åº¦ï¼ˆpayload lengthï¼‰å¤§äºå®é™…è½½è·ï¼ˆpayloadï¼‰çš„é•¿åº¦æ—¶ï¼Œå‡½æ•°è¿”å›0
</span></span><span class="line"><span class="cl"><span class="gi">+       if (1 + 2 + payload + 16 &gt; s-&gt;s3-&gt;rrec.length)
</span></span></span><span class="line"><span class="cl"><span class="gi">+               return 0; /* silently discard per RFC 6520 sec. 4 */
</span></span></span><span class="line"><span class="cl"><span class="gi">+       pl = p;
</span></span></span><span class="line"><span class="cl"><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>        if (hbtype == TLS1_HB_REQUEST)
</span></span><span class="line"><span class="cl">                {
</span></span><span class="line"><span class="cl">                unsigned char *buffer, *bp;
</span></span><span class="line"><span class="cl"><span class="gi">+               unsigned int write_length = 1 /* heartbeat type */ +
</span></span></span><span class="line"><span class="cl"><span class="gi">+                                           2 /* heartbeat length */ +
</span></span></span><span class="line"><span class="cl"><span class="gi">+                                           payload + padding;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>                int r;
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="gi">+               if (write_length &gt; SSL3_RT_MAX_PLAIN_LENGTH)
</span></span></span><span class="line"><span class="cl"><span class="gi">+                       return 0;
</span></span></span><span class="line"><span class="cl"><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>                /* Allocate memory for the response, size is 1 byte
</span></span><span class="line"><span class="cl">                 * message type, plus 2 bytes payload length, plus
</span></span><span class="line"><span class="cl">                 * payload, plus padding
</span></span><span class="line"><span class="cl">                 */
</span></span><span class="line"><span class="cl"><span class="gd">-               buffer = OPENSSL_malloc(1 + 2 + payload + padding);
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+               buffer = OPENSSL_malloc(write_length);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>                bp = buffer;
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">                /* Enter response type, length and copy payload */
</span></span><span class="line"><span class="cl"><span class="gu">@@ -1489,11 +1499,11 @@ dtls1_process_heartbeat(SSL *s)
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>                /* Random padding */
</span></span><span class="line"><span class="cl">                RAND_pseudo_bytes(bp, padding);
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="gd">-               r = dtls1_write_bytes(s, TLS1_RT_HEARTBEAT, buffer, 3 + payload + padding);
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+               r = dtls1_write_bytes(s, TLS1_RT_HEARTBEAT, buffer, write_length);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span> 
</span></span><span class="line"><span class="cl">                if (r &gt;= 0 &amp;&amp; s-&gt;msg_callback)
</span></span><span class="line"><span class="cl">                        s-&gt;msg_callback(1, s-&gt;version, TLS1_RT_HEARTBEAT,
</span></span><span class="line"><span class="cl"><span class="gd">-                               buffer, 3 + payload + padding,
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+                               buffer, write_length,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>                                s, s-&gt;msg_callback_arg);
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">                OPENSSL_free(buffer);
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="fuzzing-æŒ–æ˜-cve-2014-0160">Fuzzing æŒ–æ˜ CVE-2014-0160</h1>
<p>ä½¿ç”¨Googleçš„<a class="link" href="https://github.com/google/fuzzer-test-suite"  target="_blank" rel="noopener"
    >fuzzer-test-suite</a>æ¥å®è·µï¼Œå…ˆæ„å»ºåŒ…å«æ¼æ´çš„opensslï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">git clone https://github.com/google/fuzzer-test-suite.git
</span></span><span class="line"><span class="cl">mkdir CVE-2014-0160<span class="p">;</span> <span class="nb">cd</span> CVE-2014-0160
</span></span><span class="line"><span class="cl">../fuzzer-test-suite/openssl-1.0.1f/build.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>This command will download the openssl sources at the affected revision and build the fuzzer for one specific API that has the bug, see <a class="link" href="https://github.com/google/fuzzer-test-suite/blob/master/openssl-1.0.1f/target.cc"  target="_blank" rel="noopener"
    >openssl-1.0.1f/target.cc</a>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// Copyright 2016 Google Inc. All Rights Reserved.
</span></span></span><span class="line"><span class="cl"><span class="c1">// Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;openssl/ssl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;openssl/err.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stddef.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">SSL_CTX</span> <span class="o">*</span><span class="nf">Init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL_library_init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL_load_error_strings</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">ERR_load_BIO_strings</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">OpenSSL_add_all_algorithms</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL_CTX</span> <span class="o">*</span><span class="n">sctx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span> <span class="p">(</span><span class="n">sctx</span> <span class="o">=</span> <span class="n">SSL_CTX_new</span><span class="p">(</span><span class="n">TLSv1_method</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* These two file were created with this command:
</span></span></span><span class="line"><span class="cl"><span class="cm">      openssl req -x509 -newkey rsa:512 -keyout server.key \
</span></span></span><span class="line"><span class="cl"><span class="cm">     -out server.pem -days 9999 -nodes -subj /CN=a/
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span><span class="p">(</span><span class="n">SSL_CTX_use_certificate_file</span><span class="p">(</span><span class="n">sctx</span><span class="p">,</span> <span class="s">&#34;runtime/server.pem&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                      <span class="n">SSL_FILETYPE_PEM</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span><span class="p">(</span><span class="n">SSL_CTX_use_PrivateKey_file</span><span class="p">(</span><span class="n">sctx</span><span class="p">,</span> <span class="s">&#34;runtime/server.key&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                     <span class="n">SSL_FILETYPE_PEM</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">sctx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="s">&#34;C&#34;</span> <span class="kt">int</span> <span class="n">LLVMFuzzerTestOneInput</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">Data</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">Size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="n">SSL_CTX</span> <span class="o">*</span><span class="n">sctx</span> <span class="o">=</span> <span class="n">Init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL</span> <span class="o">*</span><span class="n">server</span> <span class="o">=</span> <span class="n">SSL_new</span><span class="p">(</span><span class="n">sctx</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">BIO</span> <span class="o">*</span><span class="n">sinbio</span> <span class="o">=</span> <span class="n">BIO_new</span><span class="p">(</span><span class="n">BIO_s_mem</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="n">BIO</span> <span class="o">*</span><span class="n">soutbio</span> <span class="o">=</span> <span class="n">BIO_new</span><span class="p">(</span><span class="n">BIO_s_mem</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL_set_bio</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">sinbio</span><span class="p">,</span> <span class="n">soutbio</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL_set_accept_state</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">BIO_write</span><span class="p">(</span><span class="n">sinbio</span><span class="p">,</span> <span class="n">Data</span><span class="p">,</span> <span class="n">Size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL_do_handshake</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">SSL_free</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ„å»ºå®Œæˆåè¿è¡Œåˆšåˆšç¼–è¯‘å¥½çš„fuzzerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">./openssl-1.0.1f-fsanitize_fuzzer
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±èƒ½è·‘å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">=================================================================</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span><span class="nv">2190163</span><span class="o">==</span>ERROR: AddressSanitizer: heap-buffer-overflow on address 0x629000009748 at pc 0x00000051d75a bp 0x7fff7d14a450 sp 0x7fff7d149c18
</span></span><span class="line"><span class="cl">READ of size <span class="m">33536</span> at 0x629000009748 thread T0
</span></span><span class="line"><span class="cl">    <span class="c1">#0 0x51d759 in __asan_memcpy (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x51d759)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#1 0x55c283 in tls1_process_heartbeat /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/t1_lib.c:2586:3</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#2 0x5c7321 in ssl3_read_bytes /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_pkt.c:1092:4</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#3 0x5cb7f3 in ssl3_get_message /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:457:7</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#4 0x597c86 in ssl3_get_client_hello /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_srvr.c:941:4</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#5 0x593b21 in ssl3_accept /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_srvr.c:357:9</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#6 0x55052d in LLVMFuzzerTestOneInput /root/lab/fuzzing_baby/CVE-2014-0160/../fuzzer-test-suite/openssl-1.0.1f/target.cc:34:3</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#7 0x4587a1 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x4587a1)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#8 0x457ee5 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x457ee5)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#9 0x45a187 in fuzzer::Fuzzer::MutateAndTestOne() (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45a187)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#10 0x45ae85 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45ae85)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#11 0x44983e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x44983e)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#12 0x472682 in main (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x472682)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#13 0x7f58322b0082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#14 0x41e5dd in _start (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x41e5dd)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0x629000009748 is located <span class="m">0</span> bytes to the right of 17736-byte region <span class="o">[</span>0x629000005200,0x629000009748<span class="o">)</span>
</span></span><span class="line"><span class="cl">allocated by thread T0 here:
</span></span><span class="line"><span class="cl">    <span class="c1">#0 0x51e30d in malloc (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x51e30d)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#1 0x5fab2b in CRYPTO_malloc /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/crypto/mem.c:308:8</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#2 0x5ccf07 in freelist_extract /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:708:12</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#3 0x5ccf07 in ssl3_setup_read_buffer /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:770:10</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#4 0x5cd51c in ssl3_setup_buffers /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:827:7</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#5 0x59474f in ssl3_accept /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_srvr.c:292:9</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#6 0x55052d in LLVMFuzzerTestOneInput /root/lab/fuzzing_baby/CVE-2014-0160/../fuzzer-test-suite/openssl-1.0.1f/target.cc:34:3</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#7 0x4587a1 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x4587a1)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#8 0x45a4da in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::__Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45a4da)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#9 0x45ab69 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45ab69)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#10 0x44983e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x44983e)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#11 0x472682 in main (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x472682)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#12 0x7f58322b0082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SUMMARY: AddressSanitizer: heap-buffer-overflow <span class="o">(</span>/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x51d759<span class="o">)</span> in __asan_memcpy
</span></span><span class="line"><span class="cl">Shadow bytes around the buggy address:
</span></span><span class="line"><span class="cl">  0x0c527fff9290: <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>
</span></span><span class="line"><span class="cl">  0x0c527fff92a0: <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>
</span></span><span class="line"><span class="cl">  0x0c527fff92b0: <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>
</span></span><span class="line"><span class="cl">  0x0c527fff92c0: <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>
</span></span><span class="line"><span class="cl">  0x0c527fff92d0: <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="nv">00</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt;0x0c527fff92e0: <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 00<span class="o">[</span>fa<span class="o">]</span>fa fa fa fa fa fa
</span></span><span class="line"><span class="cl">  0x0c527fff92f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
</span></span><span class="line"><span class="cl">  0x0c527fff9300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
</span></span><span class="line"><span class="cl">  0x0c527fff9310: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
</span></span><span class="line"><span class="cl">  0x0c527fff9320: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
</span></span><span class="line"><span class="cl">  0x0c527fff9330: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
</span></span><span class="line"><span class="cl">Shadow byte legend <span class="o">(</span>one shadow byte represents <span class="m">8</span> application bytes<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  Addressable:           <span class="m">00</span>
</span></span><span class="line"><span class="cl">  Partially addressable: <span class="m">01</span> <span class="m">02</span> <span class="m">03</span> <span class="m">04</span> <span class="m">05</span> <span class="m">06</span> <span class="m">07</span>
</span></span><span class="line"><span class="cl">  Heap left redzone:       fa
</span></span><span class="line"><span class="cl">  Freed heap region:       fd
</span></span><span class="line"><span class="cl">  Stack left redzone:      f1
</span></span><span class="line"><span class="cl">  Stack mid redzone:       f2
</span></span><span class="line"><span class="cl">  Stack right redzone:     f3
</span></span><span class="line"><span class="cl">  Stack after <span class="k">return</span>:      f5
</span></span><span class="line"><span class="cl">  Stack use after scope:   f8
</span></span><span class="line"><span class="cl">  Global redzone:          f9
</span></span><span class="line"><span class="cl">  Global init order:       f6
</span></span><span class="line"><span class="cl">  Poisoned by user:        f7
</span></span><span class="line"><span class="cl">  Container overflow:      <span class="nb">fc</span>
</span></span><span class="line"><span class="cl">  Array cookie:            ac
</span></span><span class="line"><span class="cl">  Intra object redzone:    bb
</span></span><span class="line"><span class="cl">  ASan internal:           fe
</span></span><span class="line"><span class="cl">  Left alloca redzone:     ca
</span></span><span class="line"><span class="cl">  Right alloca redzone:    cb
</span></span><span class="line"><span class="cl">  Shadow gap:              <span class="nv">cc</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span><span class="nv">2190163</span><span class="o">==</span>ABORTING
</span></span><span class="line"><span class="cl">MS: <span class="m">1</span> CopyPart-<span class="p">;</span> base unit: 380cd810619fc15deda5a170f6bec4cfd229086b
</span></span><span class="line"><span class="cl">0x18,0x3,0x29,0x0,0x1,0x1,0x0,
</span></span><span class="line"><span class="cl"><span class="se">\x</span>18<span class="se">\x</span>03<span class="o">)</span><span class="se">\x</span>00<span class="se">\x</span>01<span class="se">\x</span>01<span class="se">\x</span><span class="m">00</span>
</span></span><span class="line"><span class="cl"><span class="nv">artifact_prefix</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">;</span> Test unit written to ./crash-8f882413170d68fb148303a53b5208b0f2dc61cc
</span></span><span class="line"><span class="cl">Base64: <span class="nv">GAMpAAEBAA</span><span class="o">==</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/coreutils/">Coreutils</a>
        
            <a href="/tags/fuzzing/">Fuzzing</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/post/%E5%AF%B9u-boot-cve-2022-30790%E7%9A%84%E8%B7%9F%E8%B8%AA/">
        
        
            <div class="article-image">
                
                    <img src="https://s2.loli.net/2022/06/16/R9KWInUb6Cdyhl2.jpg" loading="lazy" data-key="" data-hash="https://s2.loli.net/2022/06/16/R9KWInUb6Cdyhl2.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">å¯¹U-Boot CVE-2022-30790çš„è·Ÿè¸ª</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/post/cve-2021-3156-sudo-%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">
        
        
            <div class="article-image">
                
                    <img src="https://s2.loli.net/2022/05/19/FeqdKtWJZ3GonMX.png" loading="lazy" data-key="" data-hash="https://s2.loli.net/2022/05/19/FeqdKtWJZ3GonMX.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CVE-2021-3156 sudo ææƒæ¼æ´åˆ†æ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/post/cve-2015-5165-qemu%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">
        
        
            <div class="article-image">
                
                    <img src="https://s2.loli.net/2022/06/09/jupCyBcahdQEJmP.jpg" loading="lazy" data-key="" data-hash="https://s2.loli.net/2022/06/09/jupCyBcahdQEJmP.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CVE-2015-5165 QEMUä¿¡æ¯æ³„éœ²æ¼æ´åˆ†æ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/post/cve-2016-5195-linux-dirtycow%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">
        
        
            <div class="article-image">
                
                    <img src="https://s2.loli.net/2022/05/24/JFAS5mGpYn9utWi.jpg" loading="lazy" data-key="" data-hash="https://s2.loli.net/2022/05/24/JFAS5mGpYn9utWi.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CVE-2016-5195 Linux DirtyCOWæ¼æ´åˆ†æ</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2022 Zikey Vi
    </section>
    
    <section class="powerby">
        
            All Rights Abandoned. <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.13.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</a></li>
    <li><a href="#ç®€ä»‹">ç®€ä»‹</a>
      <ol>
        <li><a href="#sslæ¡æ‰‹è¿‡ç¨‹">SSLæ¡æ‰‹è¿‡ç¨‹</a></li>
        <li><a href="#ssl-heartbeat">SSL Heartbeat</a></li>
        <li><a href="#openssl">OpenSSL</a></li>
      </ol>
    </li>
    <li><a href="#æ¼æ´åˆ†æ">æ¼æ´åˆ†æ</a>
      <ol>
        <li><a href="#æºç è·å–">æºç è·å–</a></li>
        <li><a href="#æˆå› é¢„ä¹ ">æˆå› é¢„ä¹ </a></li>
        <li><a href="#ä»£ç åˆ†æ">ä»£ç åˆ†æ</a></li>
        <li><a href="#æ¼æ´ä¿®å¤">æ¼æ´ä¿®å¤</a></li>
      </ol>
    </li>
    <li><a href="#fuzzing-æŒ–æ˜-cve-2014-0160">Fuzzing æŒ–æ˜ CVE-2014-0160</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
